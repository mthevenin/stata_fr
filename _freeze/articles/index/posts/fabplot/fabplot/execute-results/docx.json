{
  "hash": "01fef774f3f2cbec33e37ad12bf4ea6a",
  "result": {
    "markdown": "---\ntitle: \"**Contrôler l'effet spaghetti avec fabplot (NJ.Cox)**\"\n\ntitle-block-banner: false\n\ncategories:\n  - graphique\n  - ado\n\nauthor: \n  - name: \"Marc Thévenin\"\n    affiliations:\n      - name: \"Ined\"\n\ndate: 09/26/2022\n\nformat: \n  html: default\n  docx:\n    toc: true\n    number-sections: true\n\nfilters:\n   - lightbox\nlightbox: auto\n\nabstract: |\n La commande **`fabplot`** programmée en 2021 par Nj.Cox permet de contrôler efficacement les effets dits *spaghetti* (courbes) ou *paella* (nuages de points). J'ai ajouté une option pour modifier les courbes au second plan, NJ.Cox ayant toujours tendance à bloquer l'habillage de ces commandes graphiques. La commande a été renommée **`fabplot2`** et s'installe via github. Bien évidemment, tout le mérite revient à l'auteur d'origine, l'ajout de l'option ne m'a pris que quelques dizaines de secondes.\n\n---\n\n\n\n\n[**Article Stata Journal**](https://journals.sagepub.com/doi/full/10.1177/1536867X211025838) \n\nJ'avais présenté le problème lors de la formation de 2020, mais avec un programme très compliqué. Cette commande très simple, permet de bien contrôler ce problème visualisation en utilisant sur deux objets graphiques l'option `by`.....pourquoi je n'y avais pas pensé.\n\n\n# Installation\n\n## `fabplot`\n\nCommande d'origine. L'objet en arrière plan n'est pas modifiable.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nssc install fabplot\n\n* help fabplot\n```\n:::\n\n\n\n## `fabplot2`\n\nJ'ai juste ajouté l'option **`backopts`**. Même principe que l'option **`frontopts`** qui modifie l'objet au premier plan.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnet install fabplot2, from(\"https://raw.githubusercontent.com/mthevenin/stata_graphiques/master/ressources/fabplot2/\") replace\n```\n:::\n\n\n\n## Exemple\n\n\n> **Note** J'utilise systématiquement un thème  que je génère avec le paquet **`grstyle`** de B.Jann.  \n\n\nJe reprends le même exemple que pour la formation, avec la base babynames.  \nOuverture de de la base:  \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwebuse set \"https://raw.githubusercontent.com//mthevenin/stata_graphiques/master/ressources/fabplot2\"\nuse babynames, clear\nwebuse set\n```\n:::\n\n\n\n### Empilement des 9 courbes\n\n..... C'est illisible\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n* thème avec grstyle\ngrstyle init \ngrstyle set mesh\ngrstyle set color tableau, n(9)\n\n* Graphique\nlevelsof name, local(name)\nlocal i = 1\nforeach nom of local name  {\nlocal j = `i++'\t\nlocal line `line' line n year if name==\"`nom'\" ||\t\t\nlocal leg `leg'  `j' \"`nom'\"\n}\n\ntw `line' , legend(order(`leg') row(2) size(*.8)  region(color(%0)) pos(11)) ytitle(\"\") ylabel(0(20000)100000, angle(0)) ///\ntitle(\"Popularité des prénoms\")\n```\n:::\n\n\n\n![](g1.png){width=70%}\n\n# Small-Multiple avec fabplot\n\nAvec un graphique de type statique, une solution à priviliégier serait un graphique de type ***small-multiple*** en conservant les autres courbes en arrière plan. Avec Stata, ce type de graphique est exécuté avec l'option **`by()`**. \n\n## Syntaxe allégée\n\n**`fabplot[2] command yvar xvar [if] [in], by(byvar [,byopts]) [frontopts() backopts()] ....`**\n\n* `fabplot[2]`: `fabplot` ou `fabplot2`\n* `command`: **line** ou **scatter**\n* `by(byvar [,opts)]`: indiquer à minima la variable catégorielle qui produira chaque sous graphique. Beaucoup d'options du graphique entre sans cette option, comme les titres ou la couleur du background\n* `frontopts`: les options de l'objet graphique en relief, comme la couleur et l'épaisseur de la courbe ou des marqueurs\n* `backopts`: avec `fabplot2` seulement, les options de l'objet graphique en arrière plan.\n\n## Application\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#delimit ;\n\nfabplot2 line n year, \nby(name, title(\"Popularité des prénoms\", pos(11))) \n\nfrontopts(lw(*2) lc(\"45 178 125\")) \nbackopts(lw(*.5) lc(gs9)) \n\nytitle(\"\")  ylabel(0(20000)100000, labsize(*.8) glw(*.5))\n; \n\n#delimit cr\n```\n:::\n\n\n\n![](g2.png){width=70%}\n\n\n[**Programme .do**](https://github.com/mthevenin/stata_graphiques/blob/main/ressources/fabplot/prog_fabplot.do) \n\n\n\n\n",
    "supporting": [
      "fabplot_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}