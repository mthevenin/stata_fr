{
  "hash": "8bbbc068f9a6fab3bda9e660b6d4ec56",
  "result": {
    "markdown": "---\ntitle: \"**Intro - Collect**\"\n\ntitle-block-banner: false\n\nauthor: \n  - name: \"Marc Thévenin\"\n    affiliations:\n      - name: \"Ined\"\n\ndate: 09/26/2022\n\nformat: \n  html: default\n  docx:\n    toc: true\n    number-sections: true\n \nfilters:\n   - lightbox\nlightbox: auto    \n          \nabstract: | \n La suite **`collect`** introduite avec le version 17 va t-elle remplacer `outreg2` et autres commandes de mise en forme et d'exportation de tableaux? Pas encore un tutoriel, dès éléments sont encore  obscurs, mais avec quelques copier-coller issus des fichiers d'aides je présente juste deux exemples avec des régressions.\n        \n---\n\n\n\n\n\n\n**Principe de la suite `collect`**:\n\n-   Il s'agit d'un ensemble de commandes pour paramétrer le style des tableaux que l'on souhaite exporter dans des formats comme .doc, .xls, .tex, .html ou .md\n-   Un style peut être enregistré et utilisé à plusieurs reprises.\n-   Un style enregistré peut être modifié pour un tableau spécifique.\n\nA partir de la base *nanhes21*:\n\n-   Exemple1: Deux modèles avec spécifications différentes. Il s'agit d'une simple OLS qui mesure la pression artérielle\n-   Exemple2: AME après un modèle multinomial avec les outcomes en colonne. Pour des raisons de place, je n'ai gardé que deux des quatres outcomes dans l'output. J'utilise une multinomiale même s'il s'agit d'une variable ordinale; j'ai seulement pris de que j'avais sous la main pour l'exemple.\n-   Dans les tableaux les informations reportées sont les effets marginaux (\\_r_b), les erreurs type (\\_r_se) et les p-values (\\_r_p). D'autres sont disponibles commes les bornes des intervalles de confiances.\n\n# **Définition d'un style pour une suite de tableaux**\n\n**Rappel**: un tuto plus complet viendra ultérieurement (s'il y a une demande)\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\ncollect style row split, dups(first)  // ajoute le label de la variable à gauche comme nom de variable\ncollect style column,    dups(center) // permet de ne pas multiplier le nombre de cellule sur la première ligne\ncollect style cell result[_r_b _r_se _r_p], nformat(%8.3f)   // décimales des valeurs (ici idem)\ncollect style cell border_block,  border(right, pattern(nil)) // bête copier-coller, je n'ai pas testé avec/sans\ncollect layout (colname) (cmdset#result)  // Cette ligne semble obligatoire même si on ne définit pas de style\n                          \ncollect save multimod , replace   // sauvegarde dans repertoire temporaire du style appelé ici multimod (format .stjson)\n```\n:::\n\n\n\n# **Exemples**\n\nOuverture de la base\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\nqui use https://www.stata-press.com/data/r17/nhanes2l, clear\nqui save nhanes, replace\n```\n:::\n\n\n\n## **Ols**\n\n::: callout-warning\nLorsqu'on génère un tableau avec `collect` avec un même style il me semble préférable d'exécuter systématiquement:\n\n\n\n::: {.cell filename='Syntaxe'}\n\n```{.stata .cell-code}\ncollect clear\ncollect use nom_style, replace\n```\n:::\n\n\n:::\n\n**Estimation du modèle avec `collect`**\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\n\nqui: collect _r_b _r_se _r_p: regress bpsystol i.agegrp i.region\nqui: collect _r_b _r_se _r_p: regress bpsystol i.agegrp i.region i.sex\n```\n:::\n\n\n\n**Modification du style pour ajouter le nom des modèles**\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\ncollect label values cmdset 1 \"Modèle 1\" 2 \"Modèle 2\" \n```\n:::\n\n\n\nOn peut également ajouter un titre, modifier les labels des variables, je pense aussi les libellées des colonnes pour les indicateurs (par exemple AME au lieu de Coefficient).\n\n**Prévisualisation du tableau**\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\ncollect preview\n\n/*\n------------------------------------------------------------------------------\n                            Modèle 1                       Modèle 2           \n                 Coefficient Std. error p-value Coefficient Std. error p-value\n------------------------------------------------------------------------------\nAge group 20–29        0.000      0.000               0.000      0.000        \n          30–39        2.891      0.664   0.000       2.917      0.661   0.000\n          40–49        9.580      0.716   0.000       9.584      0.713   0.000\n          50–59       18.324      0.713   0.000      18.384      0.710   0.000\n          60–69       24.184      0.574   0.000      24.193      0.571   0.000\n          70+         30.851      0.780   0.000      30.958      0.777   0.000\nRegion    NE           0.000      0.000               0.000      0.000        \n          MW          -0.023      0.595   0.969       0.033      0.592   0.956\n          S           -0.303      0.591   0.608      -0.227      0.588   0.699\n          W           -0.777      0.601   0.196      -0.745      0.599   0.213\nSex       Male                                        0.000      0.000        \n          Female                                     -4.015      0.402   0.000\nIntercept            117.632      0.589   0.000     119.672      0.621   0.000\n------------------------------------------------------------------------------\n*/  \n\n```\n:::\n\n\n\n*Remarque*: on peut supprimer les baselines, mais je n'ai pas trouvé comment mettre par exemple *ref* pour la contrainte à 0.\n\n**Exportations**\\\nJ'ai vu large pour l'exemple\n\n::: callout-important\n## Exportation latex\n\nMettre l'option **`tableonly`** pour que la balise d'ouverture soit celle d'un tableau et non d'un document.\n:::\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\ncollect export ex1, as(docx)     replace\ncollect export ex1, as(xls)      replace\ncollect export ex1, as(tex)      replace tableonly\ncollect export ex1, as(html)     replace\ncollect export ex1, as(markdown) replace\n```\n:::\n\n\n\nEnsemble du programme (sauf la création du style multimod et les exportations)\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\ncollect clear\ncollect use multimod\n\nquietly: collect _r_b _r_se _r_p: regress bpsystol i.agegrp i.region\nquietly: collect _r_b _r_se _r_p: regress bpsystol i.agegrp i.region i.sex\n\ncollect label values cmdset 1 \"Modèle 1\" 2 \"Modèle 2\"\n\ncollect preview\n```\n:::\n\n\n\n### **Visualisation des exportations**\n\n::: panel-tabset\n## **Word**\n\n![](word1.PNG)\n\n## **Excel**\n\n![](excel1.PNG)\n\n## **Latex (pdf)**\n\n![](tex1.PNG)\n\n-   \n-   le fichier tex1.tex généré avec `collect export` donne le tableau brut balisé. Le fichier peut être  inséré dans un document Latex avec `\\estauto{nom_fichier.tex}` ou `\\input{nom_fichier.tex}`\n\n\nJuste une petite remarque sur les **notes** de bas de tableau. `collect` gère également leur présence et leur mise en forme, mais le code généré semble systématiquement les aligner au centre. A creuser, sinon il faut modifier le code *Latex* pour les aligner à gauche. Par exemple:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\\multicolumn{3}{l}{\\footnotesize Note 1: blablabla}\\\\\n\\multicolumn{3}{l}{\\footnotesize Note 2: blablabla}\\\\\n\\end{tabular}\n\\end{table}\n```\n:::\n\n\n\n## **Markdown (Html)**\n\n|                 |        | Modèle 1        |                |             | Modèle 2        |                |             |\n|---------|---------|---------|---------|---------|---------|---------|---------|\n|                 |        | **Coefficient** | **Std. error** | **p-value** | **Coefficient** | **Std. error** | **p-value** |\n| **Age group**   | 20--29 | *Ref*           | *Ref*          |             | *Ref*           | *Ref*          |             |\n|                 | 30--39 | 2.891           | 0.664          | 0.000       | 2.917           | 0.661          | 0.000       |\n|                 | 40--49 | 9.580           | 0.716          | 0.000       | 9.584           | 0.713          | 0.000       |\n|                 | 50--59 | 18.324          | 0.713          | 0.000       | 18.384          | 0.710          | 0.000       |\n|                 | 60--69 | 24.184          | 0.574          | 0.000       | 24.193          | 0.571          | 0.000       |\n|                 | 70+    | 30.851          | 0.780          | 0.000       | 30.958          | 0.777          | 0.000       |\n| **Region**      | NE     | *Ref*           | *Ref*          |             | *Ref*           | *Ref*          |             |\n|                 | MW     | -0.023          | 0.595          | 0.969       | 0.033           | 0.592          | 0.956       |\n|                 | S      | -0.303          | 0.591          | 0.608       | -0.227          | 0.588          | 0.699       |\n|                 | W      | -0.777          | 0.601          | 0.196       | -0.745          | 0.599          | 0.213       |\n| **Sex**         | Male   |                 |                |             | *Ref*           | *Ref*          |             |\n|                 | Female |                 |                |             | -4.015          | 0.402          | 0.000       |\n| ***Intercept*** |        | 117.632         | 0.589          | 0.000       | 119.672         | 0.621          | 0.000       |\n\nLe tableau est un peu complexe, pour et les 3 premières lignes doivent être modifiée en md (je n'ai pas trouvé mieux pour l'instant):\n\n***md du fichier ex1.md***\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n|           |        | Modèle 1    |            |         | Modèle 2    |            |         |\n|           |        | Coefficient | Std. error | p-value | Coefficient | Std. error | p-value |\n|-----------|--------|-------------|------------|---------|-------------|------------|---------|\n| Age group | 20–29  | 0.000       | 0.000      |         | 0.000       | 0.000      |         |\n|           | 30–39  | 2.891       | 0.664      | 0.000   | 2.917       | 0.661      | 0.000   |\n|           | 40–49  | 9.580       | 0.716      | 0.000   | 9.584       | 0.713      | 0.000   |\n|           | 50–59  | 18.324      | 0.713      | 0.000   | 18.384      | 0.710      | 0.000   |\n|           | 60–69  | 24.184      | 0.574      | 0.000   | 24.193      | 0.571      | 0.000   |\n|           | 70+    | 30.851      | 0.780      | 0.000   | 30.958      | 0.777      | 0.000   |\n| Region    | NE     | 0.000       | 0.000      |         | 0.000       | 0.000      |         |\n|           | MW     | -0.023      | 0.595      | 0.969   | 0.033       | 0.592      | 0.956   |\n|           | S      | -0.303      | 0.591      | 0.608   | -0.227      | 0.588      | 0.699   |\n|           | W      | -0.777      | 0.601      | 0.196   | -0.745      | 0.599      | 0.213   |\n| Sex       | Male   |             |            |         | 0.000       | 0.000      |         |\n|           | Female |             |            |         | -4.015      | 0.402      | 0.000   |\n| Intercept |        | 117.632     | 0.589      | 0.000   | 119.672     | 0.621      | 0.000   |\n```\n:::\n\n\n\n***md modifié (ligne 1 à 3***\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n|           |        | Modèle 1    |            |         | Modèle 2    |            |         |\n|-----------|--------|-------------|------------|---------|-------------|------------|---------|  \n|           |        | Coefficient | Std. error | p-value | Coefficient | Std. error | p-value |\n| Age group | 20–29  | 0.000       | 0.000      |         | 0.000       | 0.000      |         |\n|           | 30–39  | 2.891       | 0.664      | 0.000   | 2.917       | 0.661      | 0.000   |\n|           | 40–49  | 9.580       | 0.716      | 0.000   | 9.584       | 0.713      | 0.000   |\n|           | 50–59  | 18.324      | 0.713      | 0.000   | 18.384      | 0.710      | 0.000   |\n|           | 60–69  | 24.184      | 0.574      | 0.000   | 24.193      | 0.571      | 0.000   |\n|           | 70+    | 30.851      | 0.780      | 0.000   | 30.958      | 0.777      | 0.000   |\n| Region    | NE     | 0.000       | 0.000      |         | 0.000       | 0.000      |         |\n|           | MW     | -0.023      | 0.595      | 0.969   | 0.033       | 0.592      | 0.956   |\n|           | S      | -0.303      | 0.591      | 0.608   | -0.227      | 0.588      | 0.699   |\n|           | W      | -0.777      | 0.601      | 0.196   | -0.745      | 0.599      | 0.213   |\n| Sex       | Male   |             |            |         | 0.000       | 0.000      |         |\n|           | Female |             |            |         | -4.015      | 0.402      | 0.000   |\n| Intercept |        | 117.632     | 0.589      | 0.000   | 119.672     | 0.621      | 0.000   |\n```\n:::\n\n\n:::\n\nPour la sortie, j'ai fait également quelques modifs au niveau du texte et changé les valeurs des baselines de 0.00 à *Ref*\n\n## **Margins avec mlogit**\n\n-   Le programme est très simple, et au final on arrive à produire rapidement un output très satisfaisant avec les résulats des différentes modalités en colonne.\n-   Je n'ai pas reproduit la fin du programme avec `collect export`.\n\n*Rappel*: j'ai seulement reporté les AME pour seulement deux catégories *excellent* et *poor*\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\ncollect clear\ncollect use multimod\n\nqui mlogit hlthstat i.agegrp i.region i.sex i.race\nqui: collect _r_b _r_se _r_p: margins, dydx(*) predict(outcome(Excellent))\nqui: collect _r_b _r_se _r_p: margins, dydx(*) predict(outcome(Poor))\n\ncollect label values cmdset 1 \"Excellent\" 2 \"Poor\" \n\ncollect preview\n\n\n/*\n------------------------------------------------------------------------------\n                            Excellent                        Poor             \n                 Coefficient Std. error p-value Coefficient Std. error p-value\n------------------------------------------------------------------------------\nAge group 20–29        0.000          .       .       0.000          .       .\n          30–39       -0.028      0.015   0.066       0.008      0.004   0.031\n          40–49       -0.089      0.016   0.000       0.038      0.006   0.000\n          50–59       -0.185      0.014   0.000       0.079      0.008   0.000\n          60–69       -0.241      0.012   0.000       0.117      0.006   0.000\n          70+         -0.234      0.014   0.000       0.132      0.011   0.000\nRegion    NE           0.000          .       .       0.000          .       .\n          MW          -0.008      0.012   0.525       0.025      0.006   0.000\n          S           -0.060      0.012   0.000       0.064      0.007   0.000\n          W           -0.050      0.012   0.000       0.028      0.006   0.000\nSex       Male         0.000          .       .       0.000          .       .\n          Female      -0.039      0.008   0.000      -0.016      0.005   0.001\nRace      White        0.000          .       .       0.000          .       .\n          Black       -0.113      0.011   0.000       0.060      0.010   0.000\n          Other       -0.042      0.028   0.134      -0.011      0.017   0.526\n------------------------------------------------------------------------------\n*/  \n```\n:::\n\n\n\n### **Visualisation des exportations**\n\n::: panel-tabset\n## **Word**\n\n![](word2.PNG)\n\n## **Excel**\n\n![](excel2.PNG)\n\n## **Latex (pdf**)\n\n![](tex2.PNG)\n\n## **Markdown (Html)**\n\n|               |        | **Excellent**   |                |             | **Poor**        |                |             |\n|---------|---------|---------|---------|---------|---------|---------|---------|\n|               |        | **Coefficient** | **Std. error** | **p-value** | **Coefficient** | **Std. error** | **p-value** |\n| **Age group** | 20--29 | *Ref*           | .              | .           | *Ref*           | .              | .           |\n|               | 30--39 | -0.028          | 0.015          | 0.066       | 0.008           | 0.004          | 0.031       |\n|               | 40--49 | -0.089          | 0.016          | 0.000       | 0.038           | 0.006          | 0.000       |\n|               | 50--59 | -0.185          | 0.014          | 0.000       | 0.079           | 0.008          | 0.000       |\n|               | 60--69 | -0.241          | 0.012          | 0.000       | 0.117           | 0.006          | 0.000       |\n|               | 70+    | -0.234          | 0.014          | 0.000       | 0.132           | 0.011          | 0.000       |\n| **Region**    | NE     | *Ref*           | .              | .           | *Ref*           | .              | .           |\n|               | MW     | -0.008          | 0.012          | 0.525       | 0.025           | 0.006          | 0.000       |\n|               | S      | -0.060          | 0.012          | 0.000       | 0.064           | 0.007          | 0.000       |\n|               | W      | -0.050          | 0.012          | 0.000       | 0.028           | 0.006          | 0.000       |\n| **Sex**       | Male   | *Ref*           | .              | .           | *Ref*           | .              | .           |\n|               | Female | -0.039          | 0.008          | 0.000       | -0.016          | 0.005          | 0.001       |\n| **Race**      | White  | 0.000           | .              | .           | 0.000           | .              | .           |\n|               | Black  | -0.113          | 0.011          | 0.000       | 0.060           | 0.010          | 0.000       |\n|               | Other  | -0.042          | 0.028          | 0.134       | -0.011          | 0.017          | 0.526       |\n:::\n\n# **Sans style enregistré**\n\nIl est bien évidemment de programmer et d'utiliser les styles à la volée. A minima, il semblerait que pour les résultats de régression la ligne **`collect layout (colname) (cmdset#result)`** soit obligatoire.\n\nPour un simple modèle (exemple1 Ols), sans style.\n\n\n\n::: {.cell}\n\n```{.stata .cell-code}\ncollect clear\nquietly: collect _r_b _r_se _r_p: regress bpsystol i.agegrp i.region i.sex\ncollect preview\n\n* Your layout specification does not identify any items.\n\ncollect clear\n\ncollect layout (colname) (cmdset#result)\n                          \nquietly: collect _r_b _r_se _r_p: regress bpsystol i.agegrp i.region i.sex\ncollect preview\n\n/*\n------------------------------------------\n          |           1          1       1\n          | Coefficient Std. error p-value\n----------+-------------------------------\n20–29     |           0          0        \n30–39     |    2.917042   .6613269   0.000\n40–49     |    9.584328   .7129385   0.000\n50–59     |    18.38351   .7100856   0.000\n60–69     |     24.1932   .5711481   0.000\n70+       |    30.95843   .7768639   0.000\nNE        |           0          0        \nMW        |    .0329983   .5917749   0.956\nS         |   -.2269237   .5877579   0.699\nW         |   -.7447052   .5985115   0.213\nMale      |           0          0        \nFemale    |    -4.01548   .4021621   0.000\nIntercept |    119.6719   .6205858   0.000\n------------------------------------------\n*/\n```\n:::\n\n\n\nAu lieu de sélectionner des items comme \\_r_b \\_r_se \\_r_se, on peut directement tous ceux qui sont disponibles avec **`collect get`**. Pas forcément conseillé avec les exemples car chaque regression enregistre 10 information (bornes des IC, degré de liberté, statistique t pour l'Ols, sa valeur absolue...)\n\nPour info la ligne avec collect get est: **`collect get: regress bpsystol i.agegrp i.region i.sex`**\n\n# **Le builder**\n\nStata a installé un builder intéractif pour mettre en forme. Je ne suis pas du tout à l'aise avec ce genre d'outil, pour ne pas dire complètement nul.\n\n**`help Tables_Builder`**\n\n**Tutoriels youtube (Chuck Huber):**\n\n-   Régression <https://www.youtube.com/watch?v=TFFdTIHHtUg>\n-   A partir de la commande **`table`** (attention la syntaxe à été modifiée depuis la version 17...Merci Cris)\n    -   <https://www.youtube.com/watch?v=OPyA8w26IGc>\n    -   <https://www.youtube.com/watch?v=u_Efw1oWxWk>\n",
    "supporting": [
      "intro_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}