<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Marc Thevenin" />


<title>Formation</title>

<script src="site_libs/header-attrs-2.2/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Stata</a>
</li>
<li>
  <a href="utils.html">Tips &amp; utilitaires</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Graphiques
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="graphiques.html">Graphiques</a>
    </li>
    <li>
      <a href="couleurs.html">Couleurs</a>
    </li>
    <li>
      <a href="programmes.html">Programmes</a>
    </li>
  </ul>
</li>
<li>
  <a href="python.html">Python</a>
</li>
<li>
  <a href="commandes.html">Commandes</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Formation</h1>
<h4 class="author">Marc Thevenin</h4>
<h4 class="date">26/07/2020</h4>

</div>


<style>
hide {
  background-color: #d6d6d6;
  color: #d6d6d6;
}
hide:hover {
  background-color: white;
  color: black;
}
</style>
<div id="plan" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Plan</h1>
<ul>
<li><strong>Visualisation de la progression</strong>:
<ul>
<li><span style="color:rgb(97, 156, 255)"><strong>Bien avancée</strong></span></li>
<li><span style="color:rgb(0, 191, 125)"><strong>Avancée</strong></span></li>
<li><span style="color:rgb(201, 152, 0)"><strong>Un peu avancée</strong></span><br />
</li>
<li><span style="color:rgb(255, 103, 164)"><strong>A faire</strong></span></li>
</ul></li>
</ul>
<p><BR></p>
<ul>
<li><strong><span style="color:rgb(97, 156, 255)">Générer des graphiques</span></strong>
<ul>
<li><span style="color:rgb(97, 156, 255)">Les graphiques Stata</span></li>
<li><span style="color:rgb(97, 156, 255)">Générer et éditer un graphique</span></li>
<li><span style="color:rgb(97, 156, 255)">Les options graphiques</span>
<ul>
<li><span style="color:rgb(97, 156, 255)">Options d’un objet graphique</span></li>
<li><span style="color:rgb(97, 156, 255)">Options générales d’un graphique</span></li>
</ul></li>
<li><span style="color:rgb(97, 156, 255)">Graphiques combinés</span></li>
<li><span style="color:rgb(97, 156, 255)">Stata 16 et Python</red></li>
</ul></li>
<li><strong><span style="color:rgb(97, 156, 255)">Utilisation des macros</span></strong>
<ul>
<li><span style="color:rgb(97, 156, 255)"> Rappel sur les macro</span>
<ul>
<li><span style="color:rgb(97, 156, 255)"> global/local - levelsof - fonctions associées</span></li>
<li><span style="color:rgb(97, 156, 255)"> return et ereturn</span></li>
<li><span style="color:rgb(97, 156, 255)"> Autres: token, compteur++, tempvar</span><br />
</li>
</ul></li>
<li><span style="color:rgb(97, 156, 255)">Alleger la syntaxe et automatiser les modifications</span></li>
<li><span style="color:rgb(97, 156, 255)">Macro étendue pour générer un graphique à plusieurs composantes et une légende</span></li>
<li><span style="color:rgb(97, 156, 255)">Programmation d’une routine</span></li>
</ul></li>
<li><strong><span style="color:rgb(97, 156, 255)">Couleurs et thèmes</span></strong>
<ul>
<li><span style="color:rgb(97, 156, 255)">Les palettes de couleurs</span>
<ul>
<li><span style="color:rgb(97, 156, 255)">Les palettes Stata</span></li>
<li><span style="color:rgb(97, 156, 255)">Colorpalette de Ben Jann</span></li>
</ul></li>
<li><span style="color:rgb(97, 156, 255)">Les thèmes graphiques</span>
<ul>
<li><span style="color:rgb(97, 156, 255)">Les thèmes Stata et externes</span></li>
<li><span style="color:rgb(97, 156, 255)">Grstyle de Ben Jann</span></li>
</ul></li>
<li><span style="color:rgb(97, 156, 255)">Application</span><br />
</li>
</ul></li>
<li><strong><span style="color:rgb(0, 191, 125)">Visualisation des données avec Stata</span></strong>
<ul>
<li><span style="color:rgb(97, 156, 255)">Graphiques statiques</span>
<ul>
<li><span style="color:rgb(97, 156, 255)">Histogramme et densité</span><br />
</li>
<li><span style="color:rgb(97, 156, 255)">Box plot et violon</span><br />
</li>
<li><span style="color:rgb(97, 156, 255)">Nuages et densité 2d</span><br />
</li>
<li><span style="color:rgb(97, 156, 255)">Courbes</span><br />
</li>
<li><span style="color:rgb(0, 191, 125)">Barres,lollipop et parallel lines</span></li>
<li><span style="color:rgb(255, 103, 164)">Catplot et spineplot</span><br />
</li>
<li><span style="color:rgb(255, 103, 164)">La tarte au camenbertfromage</span></li>
<li><span style="color:rgb(255, 103, 164)">Résultats d’analyses</span></li>
</ul></li>
</ul></li>
<li><strong><span style="color:rgb(255, 103, 164)">Graphiques intéractifs &amp; animés: Python</span></strong>
<ul>
<li><span style="color:rgb(255, 103, 164)">Exemples de graphiques intéractifs</span></li>
<li><span style="color:rgb(255, 103, 164)">Exemple de graphiques animés</span></li>
</ul></li>
<li><strong><span style="color:rgb(201, 152, 0)">Bibliographie &amp; sources</span></strong></li>
</ul>
<br> Pour alléger le document des programmes ont été collapsés. Cliquer sur <font color="#178ACC">Programme</font> pour les faire apparaitre
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<pre><code>PROGRAMME STATA</code></pre>
</details>
<p>La taille des graphiques a été réduite: clic droit + “view image” pour les visualiser en taille réelle</p>
</div>
<div id="générer-et-modifier-des-graphiques" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Générer et modifier des graphiques</h1>
<div id="les-graphiques-stata" class="section level2" number="2.1">
<h2 number="2.1"><span class="header-section-number">2.1</span> Les graphiques Stata</h2>
<ul>
<li>Graphiques de type statiques et non intéractifs</li>
<li>Graphiques de type <strong>one way</strong> (Y)) ou <strong>two way</strong> (X Y)</li>
<li>Une syntaxe de base plutôt simple</li>
<li>Des graphiques critiqués pour leur aspect rustre par défaut, loin des standards actuels
<ul>
<li>Mauvaise communication officielle : www.stata.com/stata-news/news33-4/spotlight/</li>
<li>Alors que…: <a href="https://graphworkflow.com/?fbclid=IwAR30KGud-TWYLlvpZ1OPNrCeKN01hqPbIIoZ-GTAaoiS90xuE8G8WHwDh3w">graphworkflow.com</a></li>
</ul></li>
</ul>
<p><br> <strong>Améliorations récentes</strong>:</p>
<ul>
<li>Depuis Stata 15, l’opacité/transparence des couleurs peut être modifiée.</li>
<li>Des commandes externes qui permettent de démultiplier les possibilités en termes de couleurs et de styles, en particulier les deux commandes de <strong>Ben Jann</strong>: <em>colorpalette</em> et <em>grstyle</em></li>
<li>Depuis la version 16 on peut utiliser intéractivement <strong>Python</strong> sous Stata, ce qui ouvre de nombreuses possibilités au niveau de la visualisation des données [graphiques intéractifs et dynamiques]</li>
</ul>
</div>
<div id="générer-et-éditer-un-graphique" class="section level2" number="2.2">
<h2 number="2.2"><span class="header-section-number">2.2</span> Générer et éditer un graphique</h2>
<div id="par-les-boites-de-dialogue" class="section level3" number="2.2.1">
<h3 number="2.2.1"><span class="header-section-number">2.2.1</span> Par les boites de dialogue</h3>
<p><strong>Générer un graphique</strong>:</p>
<ul>
<li>Ouverture d’une boite directement dans la fenêtre <em>command</em> avec la commande <em>db</em>: <code>db command</code></li>
<li>Préférer <em>submit`</em> à <em>OK</em> pour laisser la boîte ouverte</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>db tw</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>db histogram</span></code></pre></div>
<p><strong>Editer un graphique</strong>:</p>
<ul>
<li>On peut éditer manuellement le graphique après sa création dans la boîte d’édition du graphique, ou en le chargeant après sauvegarde</li>
<li>On peut enregistrer les modifications avec <em>record</em> - <em>play</em> pour une édition ultérieure. Un fichier au format <em>.grec</em> est enregistrée. Il peut être édité</li>
<li>Quelques améliorations de l’interface d’édition avec stata 16 [mettre image]</li>
</ul>
<p>exemple:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a>sysuse auto, clear</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>sauvegarde en mémoire</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>tw scatter price mpg, <span class="kw">name</span>(g1, replace)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>graph display g1 [, <span class="kw">scheme</span>() <span class="kw">play</span>()....]</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>sauvegarde en dur</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>tw scatter price mpg, <span class="kw">save</span>(g1, replace)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>graph display g1 [, <span class="kw">scheme</span>() <span class="kw">play</span>()....]</span></code></pre></div>
</div>
<div id="syntaxe" class="section level3" number="2.2.2">
<h3 number="2.2.2"><span class="header-section-number">2.2.2</span> Syntaxe</h3>
<div id="un-seul-objet-graphique" class="section level4" number="2.2.2.1">
<h4 number="2.2.2.1"><span class="header-section-number">2.2.2.1</span> Un seul objet graphique</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>[tw<span class="op">/</span>graph] type_graph Y1 Y2 Y3.... [X] [Z] [, <span class="kw">option1</span>(Y1 Y2 Y3... X Z)....options_generales] </span></code></pre></div>
<p><strong>Important</strong>: si plusieurs éléments graphiques, le contenu des options suit l’ordre Y1,Y2,Y3….. <BR> <strong>Remarque 1</strong>: Yi - X peuvent-être des variables ou des coordonnées (graphique type <strong>scatteri</strong> - <strong>pci</strong> - <strong>pcarrowi</strong>) <strong>Remarque 2</strong>: on peut genérer des graphiques sur des fonctions: <strong><code>tw function Y=f(X)</code></strong></p>
<p><strong>Exemple [graph gauche]</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>sysuse uslifeexp.dta , clear</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>tw line le year, <span class="kw">title</span>(<span class="st">&quot;Espérance de vie&quot;</span>) </span></code></pre></div>
<ul>
<li>Options:
<ul>
<li>Option générale: <em><code>title()</code></em> titre du graphique avec aspect par défaut</li>
</ul></li>
</ul>
<p><strong>Exemple [graph droite]</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a>tw line  le le_male le_female year,                                        <span class="op">/</span><span class="er">//</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="st">   </span><span class="kw">lc</span>(<span class="op">*</span>.<span class="dv">3</span>)                                                                 <span class="op">/</span><span class="er">//</span><span class="st"> </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="st">   </span><span class="kw">title</span>(<span class="st">&quot;Espérance de vie&quot;</span>)                                               <span class="op">/</span><span class="er">//</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Ensemble&quot;</span> <span class="dv">2</span> <span class="st">&quot;Hommes&quot;</span> <span class="dv">3</span> <span class="st">&quot;Femmes&quot;</span>) <span class="kw">pos</span>(<span class="dv">4</span>) <span class="kw">col</span>(<span class="dv">1</span>) <span class="kw">ring</span>(<span class="dv">0</span>)) <span class="op">/</span><span class="er">//</span></span></code></pre></div>
<ul>
<li>Options:
<ul>
<li>Options des courbes: intensité de la couleur des courbes réduite pour la variable <em>le</em> <strong><code>lc(*.2)</code></strong> et augmentée pour <em>le_male</em> et <em>le_female</em> <strong><code>lc(1.3)</code></strong></li>
<li>Options générales:
<ul>
<li>Titre: positionné à 11 heures à l’exterieur du graphique <strong><code>pos(11)</code></strong></li>
<li>modification de la légende
<ul>
<li>Labels: <strong><code>order(1 "Ensemble" 2 "Hommes" 3 "femmes")</code></strong></li>
<li>A l’intérieur du graphique <strong><code>ring(0)</code></strong></li>
<li>Positionnée à 4 heures <strong><code>pos(4)</code></strong></li>
<li>Affichée en une seule colonne <strong><code>col(1</code>)`</strong></li>
</ul></li>
</ul></li>
</ul></li>
<li><strong>Remarque</strong>: la courbe pour l’ensemble de la population a éte mise en arrière plan (première position des Y dans la commande)</li>
</ul>
<p><em>Graphique 1</em><br />
<img src="imgf/g1.png" style="width:75.0%" /></p>
</div>
<div id="plusieurs-objets-graphiques" class="section level4" number="2.2.2.2">
<h4 number="2.2.2.2"><span class="header-section-number">2.2.2.2</span> Plusieurs objets graphiques</h4>
<ul>
<li>Chaque objetest séparé par <strong>()</strong> ou <strong>||</strong></li>
<li>Elle contient ses options</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a>[tw<span class="op">/</span>graph] (type_graph1 Y1 [Y2] [X] [Z] [, <span class="kw">option</span>(Y1 [Y2] ) <span class="kw">option</span>(X) <span class="kw">option</span>(Z)...])   <span class="op">/</span><span class="er">//</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a><span class="st">           </span>(type_graph2 Y2 [Y2] [X] [Z] [, <span class="kw">optio1</span>(Y1 [Y2] ) <span class="kw">option</span>(X) <span class="kw">option</span>(Z)...])   <span class="op">/</span><span class="er">//</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a><span class="st">          </span>[(type_graph3...)]                                                           <span class="op">/</span><span class="er">//</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a><span class="st">          </span>[(type_graph4...)] ...                                                       <span class="op">/</span><span class="er">//</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a><span class="st">          </span>[, options_generales]   </span></code></pre></div>
<p>ou</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a>[tw<span class="op">/</span>graph]  type_graph1 Y1 [Y2] [X] [Z] [, <span class="kw">option</span>(Y1 [Y2]) <span class="kw">option1</span>(X) <span class="kw">option1</span>(Z)...]   <span class="op">/</span><span class="er">//</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="st">        </span><span class="er">||</span><span class="st">  </span>type_graph2 Y2 [Y2] [Z] [Z] [, <span class="kw">option</span>(Y1 [Y2]) <span class="kw">option1</span>(X) <span class="kw">option1</span>(Z)...]   <span class="op">/</span><span class="er">//</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="st">        </span><span class="er">||</span><span class="st"> </span>[type_graph3...]                                                            <span class="op">/</span><span class="er">//</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a><span class="st">        </span><span class="er">||</span><span class="st"> </span>[type_graph4...] ...                                                        <span class="op">/</span><span class="er">//</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a><span class="st">        </span><span class="er">||</span><span class="st"> </span>[, options_generales]   </span></code></pre></div>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true"></a>sysuse auto, clear</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>sans option</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true"></a>tw scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span>                                                              <span class="op">/</span><span class="er">//</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span>                                                              <span class="op">/</span><span class="er">//</span><span class="st">  </span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true"></a><span class="er">||</span>, <span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">2</span> <span class="st">&quot;Foreign&quot;</span>))  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>avec options</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true"></a>tw scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span> , <span class="kw">msiz</span>(vlarge) <span class="kw">mc</span>(<span class="st">&quot;84 2 163%60&quot;</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin)      <span class="op">/</span><span class="er">//</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span> , <span class="kw">msiz</span>(vlarge) <span class="kw">mc</span>(<span class="st">&quot;244 136 73%60&quot;</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin)    <span class="op">/</span><span class="er">//</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true"></a>, <span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">2</span> <span class="st">&quot;Foreign&quot;</span>) <span class="kw">region</span>(<span class="kw">lcolor</span>(%<span class="dv">0</span>)))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true"></a><span class="st">  </span><span class="kw">graphr</span>(<span class="kw">color</span>(white)) <span class="kw">plotr</span>(<span class="kw">color</span>(white))  <span class="kw">name</span>(g2,replace) </span></code></pre></div>
<p><em>Graphique 2</em><br />
<img src="imgf/g2.png" style="width:75.0%" /></p>
<ul>
<li><strong>Options sur les cercles/bulles</strong>:
<ul>
<li>Modification de la couleur de remplissage de la bulle avec l’option <strong><code>mc()</code></strong> [<strong><code>mcolor</code></strong>: marker-color). L’opacité à été réduite à 60% pour laisser apparaitre les bulles superposées en arrière plan: <strong><code>84 2 163%60</code></strong> et <strong><code>244 136 73%60</code></strong></li>
<li>Modification du contour des bulles avec <strong><code>mlc(black)</code></strong> (marker-line-color) et <strong><code>mlw(vthin)</code></strong> (marker-line-width)</li>
<li>Augmentation de la taille des bulles avec <strong><code>msiz(large)</code></strong> (marker-size)</li>
</ul></li>
<li><strong>Option générale</strong>:
<ul>
<li>Ajout d’une légende et suppression du contour: <strong><code>legend(order(1 "Domestic" 2 "Foreign") region(lcolor(%0)))</code></strong></li>
</ul></li>
</ul>
<p><strong>Cas particuliers</strong>: pour les graphiques de type barres, les options des barres pour chaque variable sont renseignées en précisant le numéro de la barre (yi)</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a>  graph bar  y1 y2, <span class="op">/</span><span class="er">//</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">bar</span>(<span class="dv">1</span>, options)   <span class="op">/</span><span class="er">//</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="st">  </span><span class="kw">bar</span>(<span class="dv">2</span>, options)  </span></code></pre></div>
<p><strong>Préférer un graphique à un bloc d’éléments ??</strong><br />
Plutôt que de multiplier le nombre d’objets et d’options, il peut être judicieux de créer une variable pour chaque strate (ici <em>foreign</em>) et de générer un graphique à un seul bloc</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a>gen price0 =<span class="st"> </span>price <span class="cf">if</span>  foreign<span class="op">==</span><span class="dv">0</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true"></a>gen price1 =<span class="st"> </span>price <span class="cf">if</span>  foreign<span class="op">==</span><span class="dv">1</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true"></a>tw scatter price0 price1 mpg  <span class="op">/</span><span class="er">//</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true"></a><span class="st"> </span>, <span class="kw">msiz</span>(large large) <span class="kw">mc</span>(red<span class="op">%50 blue%</span><span class="dv">50</span>) <span class="kw">mlc</span>(black black) <span class="kw">mlw</span>(vthin vthin) <span class="op">/</span><span class="er">//</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true"></a><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">2</span> <span class="st">&quot;Foreign&quot;</span>) <span class="kw">region</span>(<span class="kw">lcolor</span>(%<span class="dv">0</span>)))             <span class="op">/</span><span class="er">//</span></span></code></pre></div>
</div>
</div>
</div>
<div id="quelques-options-graphiques" class="section level2" number="2.3">
<h2 number="2.3"><span class="header-section-number">2.3</span> [Quelques] Options graphiques</h2>
<p>Il s’agit d’un tour d’horizon forcément imcomplet des options graphiques…bienvenue dans une piscine sans fond.</p>
<p>Un très bon pense bête: <a href="https://geocenter.github.io/StataTraining/pdf/StataCheatSheet_visualization15_Syntax_2016_June-REV.pdf" class="uri">https://geocenter.github.io/StataTraining/pdf/StataCheatSheet_visualization15_Syntax_2016_June-REV.pdf</a></p>
<div id="options-dun-objet-graphique" class="section level3" number="2.3.1">
<h3 number="2.3.1"><span class="header-section-number">2.3.1</span> Options d’un objet graphique</h3>
<p><strong>COULEURS ET TAILLES/EPAISSEURS</strong></p>
<div id="couleurs" class="section level4" number="2.3.1.1">
<h4 number="2.3.1.1"><span class="header-section-number">2.3.1.1</span> Couleurs</h4>
<ul>
<li>3 Eléments dans les options couleurs
<ul>
<li><p><strong>Un nom ou un code numérique</strong>: la couleur <em>navy</em> (première couleur de la palette Stata <strong>s2</strong>) à pour code RGB [Red-Green-Blue] <strong><code>"26 71 11"</code></strong></p></li>
<li><p><strong>Modification de l’intensité</strong>: par défaut la couleur d’une palette a une intensité de 1, on tire vers le blanc en la réduisant, vers le noir en l’augmentant</p>
<ul>
<li>Valeur minimale 0 (blanc ou quasi blanc), pas de valeur maximale.</li>
<li>Après le nom ou le code couleur, l’intensité est modifiée par <strong><code>*#</code></strong></li>
<li>Exemples:
<ul>
<li><strong><code>option_couleur(*.5)</code></strong> réduit l’intensité de 50% de la couleur utilisée par défaut</li>
<li><strong><code>option_couleur(*1.2)</code></strong> augmente l’intensité de 20% de la couleur utilisée par défaut<br />
<br></li>
</ul></li>
</ul></li>
<li><p><strong>Réduction de l’opacité</strong> (depuis Stata 15): par défaut le niveau d’opacité est de 100% [transparence = 0%]</p>
<ul>
<li>Valeur minimale 0, valeur maximale 100</li>
<li>Après le nom ou le code de la couleur, l’opacité est réduite par <strong><code>%#</code></strong> avec # compris entre 0 et 100-]</li>
<li>Une transparence totale <strong>optionc(<code>%0</code>)</strong> permet de cacher des éléments d’un graphique</li>
<li>Exemples <strong><code>option_couleurc(%50)</code></strong> donne 50% de transparence à la couleur utilisée par défaut</li>
</ul></li>
<li><p>On peut <strong>combiner les deux modifications</strong>:</p>
<ul>
<li>Baisser l’intensité et réduire l’opacité n’a pas d’intérêt (voir graphique sur les barres plus bas)</li>
<li>Augmenter l’intensité et baisser l’opacité modifiera le rendu de la couleur dans le graphique <strong><code>optionc([couleur]*1.5%50)</code></strong>: ici intensité multiplié par 1.5 avec 50% de transparence<br />
<br> <br></li>
</ul></li>
</ul></li>
</ul>
<p><strong>Exemples de syntaxes</strong></p>
<p><em>Objets graphiques</em></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true"></a>tw scatter Y X,  <span class="kw">mc</span>(blue%<span class="dv">30</span>) <span class="kw">mlc</span>(black)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true"></a>tw line    Y X,  <span class="kw">lc</span>(blue<span class="op">*</span><span class="fl">1.2</span>) </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true"></a>graph box Y1 Y2, <span class="kw">box</span>(<span class="dv">1</span>,<span class="kw">fc</span>(red<span class="op">%50)) box(2,fc(blue%</span><span class="dv">50</span>))</span></code></pre></div>
<p><em>Options</em></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">title</span>(<span class="st">&quot;MON TITRE&quot;</span>, <span class="kw">c</span>(red) box <span class="kw">fc</span>(blue) <span class="kw">lc</span>(black)   )  <span class="op">/</span><span class="er">//</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true"></a><span class="kw">legend</span>(<span class="kw">region</span>(<span class="kw">fc</span>(blue<span class="op">*</span>.<span class="dv">2</span>) <span class="kw">lc</span>(black)))</span></code></pre></div>
<p><strong>EXEMPLES</strong><br />
<br> <strong>Nuages - bulles <a href="#scatter">scatter</a></strong><br />
<em>Graphique 3</em><br />
<img src="imgf/g4.png" style="width:75.0%" /></p>
<p><strong>Barres [bar - histogram - box - area - rarea]</strong><br />
<em>Graphique 4</em><br />
<img src="imgf/g5.png" style="width:75.0%" /></p>
<p><em>Graphique 5</em><br />
<img src="imgf/g6.png" style="width:75.0%" /></p>
</div>
<div id="taille---epaisseurs" class="section level4" number="2.3.1.2">
<h4 number="2.3.1.2"><span class="header-section-number">2.3.1.2</span> Taille - Epaisseurs</h4>
<div id="taillesépaisseurs-prédéfinies" class="section level5" number="2.3.1.2.1">
<h5 number="2.3.1.2.1"><span class="header-section-number">2.3.1.2.1</span> Tailles/épaisseurs prédéfinies</h5>
<ul>
<li>Les tailles et épaisseurs prédéfinies ont un nom (small, large…)</li>
<li>Selon l’élément (symbole, courbe, texte), les noms et la liste changent</li>
</ul>
<p><strong>Types marker</strong><br />
<em>Graphique 6</em><br />
<img src="imgf/g7.png" style="width:75.0%" /></p>
<p><em>Graphique 7</em><br />
<img src="imgf/g8.png" style="width:75.0%" /></p>
<p><em>Graphique 8</em><br />
<img src="imgf/g9.png" style="width:75.0%" /></p>
<p><em>Graphique 9</em><br />
<img src="imgf/g10.png" style="width:75.0%" /></p>
<p><strong>Types line</strong><br />
<em>Graphique 10</em> <img src="imgf/g11.png" style="width:75.0%" /></p>
<p><em>Graphique 11</em><br />
<img src="imgf/g12.png" style="width:75.0%" /></p>
<p><em>Graphique 12</em><br />
<img src="imgf/g13.png" style="width:75.0%" /></p>
</div>
<div id="tailles-paramétrées" class="section level5" number="2.3.1.2.2">
<h5 number="2.3.1.2.2"><span class="header-section-number">2.3.1.2.2</span> Tailles paramétrées</h5>
<ul>
<li>Les tailles et épaisseurs peuvent être paramétrées manuellement:
<ul>
<li>par unité de mesure: <strong>#pt</strong> (printer point) <strong>#in</strong> (pouce) <strong>#cm</strong> (centimètre ) <strong>#rs</strong><br />
</li>
<li>par un degré relatif de la taille du graph <strong>#rs(#)</strong></li>
<li>par un coefficient multiplicateur d’une taille de référence =1:<strong><code>option_couleur(*#)</code></strong></li>
</ul></li>
</ul>
<p><em>Graphique 13</em><br />
<img src="imgf/g13b.png" style="width:75.0%" /></p>
<p><strong>Exercices</strong><br />
<br> Avec la base <em>auto</em> [<em><code>sysuse auto.dta</code></em>] <br> * <strong>Graphique(s) I</strong></p>
<ul>
<li>Reproduiser l’un et/ou l’autre de ces graphiques</li>
<li>Les densités sont estimées avec la fonction <strong><code>kdensity</code></strong> [<strong><code>help kdensity</code></strong>]</li>
</ul>
<p><em>Graphique 14</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true"></a>sysuse auto, clear</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true"></a>qui separate mpg, <span class="kw">by</span>(foreign)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true"></a>kdensity mpg0 , <span class="kw">g</span>(x1 d1) nograph <span class="kw">k</span>(gauss)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true"></a>kdensity mpg1 , <span class="kw">g</span>(x0 d0) nograph <span class="kw">k</span>(gauss)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true"></a> </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true"></a>tw histogram mpg0  , <span class="kw">bin</span>(<span class="dv">20</span>)  percent <span class="kw">fcolor</span>(<span class="st">&quot;72 27 109%70&quot;</span>)  <span class="kw">lc</span>(black) <span class="kw">lw</span>(vvthin)   <span class="op">/</span><span class="er">//</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>histogram mpg1  , <span class="kw">bin</span>(<span class="dv">20</span>)  percent <span class="kw">fcolor</span>(<span class="st">&quot;207 225 28%70&quot;</span>) <span class="kw">lc</span>(black) <span class="kw">lw</span>(vvthin)   <span class="op">/</span><span class="er">//</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true"></a><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">2</span> <span class="st">&quot;Foreign&quot;</span>)  <span class="kw">region</span>(<span class="kw">lcolor</span>(%<span class="dv">0</span>)))                          <span class="op">/</span><span class="er">//</span><span class="st"> </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true"></a><span class="kw">xlabel</span>(<span class="dv">10</span>(<span class="dv">10</span>)<span class="dv">50</span>) </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true"></a>tw area d1 d0 x0, <span class="kw">fc</span>(<span class="st">&quot;72 27 109%70&quot;</span> <span class="st">&quot;207 225 28%70&quot;</span>) <span class="kw">lc</span>(black black) <span class="kw">lw</span>(vthin vthin)           <span class="op">/</span><span class="er">//</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true"></a><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">2</span> <span class="st">&quot;Foreign&quot;</span>)  <span class="kw">region</span>(<span class="kw">lcolor</span>(%<span class="dv">0</span>))) <span class="kw">name</span>(g2,replace) <span class="kw">xlabel</span>(<span class="dv">10</span>(<span class="dv">10</span>)<span class="dv">50</span>)  <span class="op">/</span><span class="er">//</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true"></a><span class="kw">xtitle</span>(<span class="st">&quot;&quot;</span>)  <span class="kw">ytitle</span>(<span class="st">&quot;Density&quot;</span>) </span></code></pre></div>
</details>
<p><img src="imgf/g3.png" style="width:75.0%" /></p>
<ul>
<li><ul>
<li><p><strong>Graphique(s) II</strong></p></li>
<li><p>Reproduire le graphique suivant:</p></li>
<li><p>La droite de l’OLS est générée avec le type de graphique <strong><code>lfitci</code></strong>:</p>
<ul>
<li>Couleur de la droite: option <strong><code>clcolor()</code></strong></li>
<li>Couleur de l’intervalle de confiance: option <strong><code>flcolor()</code></strong></li>
<li>Couleur du contour de l’intervalle de confiance: option <strong><code>alcolor()</code></strong></li>
</ul></li>
<li><p>Légende facultative (voir section suivante)</p></li>
</ul></li>
</ul>
<p><em>Graphique 15</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a>tw  lfitci  price mpg  <span class="cf">if</span> <span class="op">!</span>foreign, <span class="kw">clcolor</span>(<span class="st">&quot;72 27 109*1.2&quot;</span>) <span class="kw">fcolor</span>(<span class="st">&quot;72 27 109%10&quot;</span>)    <span class="kw">alcolor</span>(%<span class="dv">0</span>)          <span class="op">/</span><span class="er">//</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true"></a><span class="st"> </span><span class="er">||</span><span class="st"> </span>lfitci  price mpg  <span class="cf">if</span> foreign,  <span class="kw">clcolor</span>(<span class="st">&quot;207 225 28*1.2&quot;</span>)  <span class="kw">fcolor</span>(<span class="st">&quot;207 225 28%10&quot;</span>) <span class="kw">alcolor</span>(%<span class="dv">0</span>)          <span class="op">/</span><span class="er">//</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true"></a><span class="st"> </span><span class="er">||</span><span class="st"> </span>scatter price mpg  <span class="cf">if</span> <span class="op">!</span>foreign, <span class="kw">msize</span>(medlarge)   <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(<span class="st">&quot;72 27 109*.5&quot;</span>) <span class="kw">jitter</span>(<span class="dv">2</span>)    <span class="op">/</span><span class="er">//</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true"></a><span class="st"> </span><span class="er">||</span><span class="st"> </span>scatter price mpg  <span class="cf">if</span> foreign,  <span class="kw">msize</span>(medlarge)   <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(<span class="st">&quot;207 225 28*.5&quot;</span>) <span class="kw">jitter</span>(<span class="dv">2</span>)   <span class="op">/</span><span class="er">//</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true"></a><span class="st"> </span><span class="er">||</span><span class="st"> </span>, <span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">5</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">6</span> <span class="st">&quot;Foreign&quot;</span>) <span class="kw">pos</span>(<span class="dv">1</span>) <span class="kw">region</span>(<span class="kw">lc</span>(%<span class="dv">0</span>))) <span class="op">/</span><span class="er">//</span><span class="st">                                            </span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true"></a><span class="st">     </span><span class="kw">ytitle</span>(<span class="st">&quot;price&quot;</span>) <span class="kw">xtitle</span>(<span class="st">&quot;mpg&quot;</span>)         </span></code></pre></div>
</details>
<p><img src="imgf/g14.png" style="width:75.0%" /></p>
</div>
</div>
</div>
<div id="axes---légendes---titres" class="section level3" number="2.3.2">
<h3 number="2.3.2"><span class="header-section-number">2.3.2</span> Axes - Légendes - Titres</h3>
<div id="axes" class="section level4" number="2.3.2.1">
<h4 number="2.3.2.1"><span class="header-section-number">2.3.2.1</span> Axes</h4>
<p>4 sous ensembles d’options: <em>titre</em>, <em>label</em>, <em>échelles</em> et <em>choix</em> pour les axes multiples (non traité)</p>
<p><strong>Titres</strong></p>
<ul>
<li><strong>xtitle()</strong> <strong>ytitle()</strong>: <strong><code>xtitle(["titres"] [, options]</code></strong>
<ul>
<li>Si seulement des option(s) en conservant le titre par défaut (label de la variable): <strong><code>xtitle(, options)</code></strong></li>
<li>Principales options: taille <strong><code>size()</code></strong>, couleur <strong><code>color()</code></strong></li>
<li>Titres sur plusieurs lignes: <strong><code>xtitle("ligne1" ligne2"....[, options]</code></strong></li>
</ul></li>
</ul>
<p><strong>Labels</strong></p>
<ul>
<li><strong>xlabel()</strong> <strong>ylabel()</strong>: <strong><code>xlabel([coordonnées] [,options])</code></strong>
<ul>
<li>Si seulement des option(s) en conservant les coordonnées par défaut: <strong><code>xlabel(, options)</code></strong></li>
</ul></li>
<li>Modification du label:
<ul>
<li>Avec <strong>min(delta)max</strong>: <strong><code>xlabel(#1([#2]#3))</code></strong>. Exemple <strong><code>xlabel(0(5)10)</code></strong></li>
<li>Manuel: <strong><code>xlabel( #1 "label1" #2 "label2"... )</code></strong>. Exemple <strong><code>xlabel(0 "0" 5 "5" 10 "10"... )</code></strong>. Permet d’ajouter des éléments de texte: <strong><code>xlabel(0 "0X" 5 "5X" 10 "10X"... )</code></strong></li>
</ul></li>
<li>Principales options:
<ul>
<li>taille <strong><code>labsize()</code></strong> [<strong><code>labs</code></strong>] , couleur <strong><code>labcolor()</code></strong> [<strong><code>labc</code></strong>]</li>
<li>Alterner les positions pour éviter les chevauchements: <strong><code>alternate</code></strong> (<strong><code>alt</code></strong>)</li>
<li>Modifier l’angle: <strong><code>angle(#)</code></strong> avec # valeur de l’angle [0 (horizontal), 45, 90 (vertical) …]</li>
</ul></li>
</ul>
<p><strong>Echelles</strong></p>
<ul>
<li><strong>xscale()</strong> <strong>yscale()</strong>
<ul>
<li>Principalement utilisé pour l’option <strong><code>log</code></strong> (voir exemple ci-dessous): utilisation d’une échelle logarithmique (voir exemple ci-dessous)</li>
<li>Echelle en ordre décroissant: <strong><code>reverse</code></strong></li>
<li>Supprimer l’affichage des axes: <strong><code>xscale(off)</code></strong> et/ou <strong><code>yscale(off)</code></strong></li>
</ul></li>
</ul>
<p><em>Graphique 16</em><br />
<img src="imgf/g16.png" style="width:75.0%" /></p>
<p><strong>Attention</strong> pour la dernière option, le label doit-être indiqué par des doubles quotes <strong>" label "</strong> et non par <strong>‘label’</strong>: <strong><code>xlabel(10000 "10k" 20000 "20k" 30000 "30k" 40000 "40k")</code></strong></p>
<p><strong>Graphique options 1</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true"></a>tw scatter lexp gnppc <span class="cf">if</span> region<span class="op">==</span><span class="dv">1</span>,                      <span class="op">/</span><span class="er">//</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter lexp gnppc <span class="cf">if</span> region<span class="op">==</span><span class="dv">2</span>,                      <span class="op">/</span><span class="er">//</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter lexp gnppc <span class="cf">if</span> region<span class="op">==</span><span class="dv">3</span>,                      <span class="op">/</span><span class="er">//</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true"></a>,  <span class="kw">title</span>(<span class="st">&quot;Options 2&quot;</span>)                                    <span class="op">/</span><span class="er">//</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true"></a><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Eur &amp; C.Asia&quot;</span> <span class="dv">2</span> <span class="st">&quot;N.A&quot;</span> <span class="dv">3</span> <span class="st">&quot;S.A&quot;</span>))       <span class="op">/</span><span class="er">//</span><span class="st"> </span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true"></a><span class="st">   </span><span class="kw">xscale</span>(log) <span class="kw">xlabel</span>(,alt) <span class="kw">xtitle</span>(, <span class="kw">size</span>(small))        <span class="op">/</span><span class="er">//</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true"></a><span class="st">   </span><span class="kw">ylabel</span>(<span class="dv">50</span>(<span class="dv">5</span>)<span class="dv">80</span>)          <span class="kw">ytitle</span>(, <span class="kw">size</span>(small))                </span></code></pre></div>
<p><strong>AIDES</strong></p>
<ul>
<li><a href="https://www.stata.com/manuals/g-3axis_options.pdf#g-3axis_options" class="uri">https://www.stata.com/manuals/g-3axis_options.pdf#g-3axis_options</a>
<ul>
<li><strong><code>help axis_options</code></strong></li>
<li><strong><code>help axis_title_options</code></strong></li>
<li><strong><code>help axis_label_options</code></strong></li>
<li><strong><code>help axis_scale_options</code></strong></li>
<li><strong><code>help axis_choice_options</code></strong></li>
</ul></li>
</ul>
</div>
<div id="légendes" class="section level4" number="2.3.2.2">
<h4 number="2.3.2.2"><span class="header-section-number">2.3.2.2</span> Légendes</h4>
<ul>
<li><strong>legend()</strong>: <strong><code>legend()</code></strong></li>
<li>Ne pas afficher une légende: <strong><code>legend(off)</code></strong></li>
<li>Position par défaut: 6 heures (Sud) - Extérieur. Modifiable avec <strong><code>pos(#)</code></strong> et <strong><code>ring(#)</code></strong> [voir Annexe plus bas]</li>
<li>Modifier le nombre de lignes et de colonne: <strong><code>row(#)</code></strong> et <strong><code>col(#)</code></strong></li>
<li>Modifier les labels de la légende:
<ul>
<li><strong>order()</strong>: <em><code>order( 1 "label1" 2 "label2" .....)</code></em></li>
<li><strong>lab()</strong>: <em><code>lab(1 "label1") lab(2 "label2") ...)</code></em></li>
<li>L’apparence (gras, itallique…) sont modifiables avec des balises <strong>smcl</strong></li>
</ul></li>
<li>Modifier l’aspect de la région: <strong><code>region(options)</code></strong> ou <strong><code>r(options)</code></strong></li>
<li>Texte sous le symbol: <strong><code>stack</code></strong></li>
</ul>
<p><em>Graphique 17</em><br />
<img src="imgf/g17.png" style="width:75.0%" /></p>
<p><strong>Par défaut</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true"></a>tw scatter   mpg price <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span>   <span class="op">/</span><span class="er">//</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter   mpg price <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span>   <span class="op">/</span><span class="er">//</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true"></a><span class="kw">title</span>(<span class="st">&quot;Legende par défaut&quot;</span>)</span></code></pre></div>
<p><strong>Avec modification</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true"></a>tw scatter   mpg price <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span>                <span class="op">/</span><span class="er">//</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter   mpg price <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span>                <span class="op">/</span><span class="er">//</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true"></a>,  <span class="kw">title</span>(<span class="st">&quot;Modification de la légende&quot;</span>)              <span class="op">/</span><span class="er">//</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true"></a><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;{bf:Domestic}&quot;</span> <span class="dv">2</span> <span class="st">&quot;{bf:Foreign}&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true"></a><span class="st">   </span>pos1) <span class="kw">ring</span>(<span class="dv">0</span>) <span class="kw">col</span>(<span class="dv">1</span>)                             <span class="op">/</span><span class="er">//</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true"></a><span class="st">   </span><span class="kw">region</span>(<span class="kw">lw</span>(vvthin))                               <span class="op">/</span><span class="er">//</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true"></a><span class="st">   </span>stack <span class="er">)</span> </span></code></pre></div>
<ul>
<li>Changement des labels de la légende, affichés en gras: <strong><code>order(1 "{bf:Domestic}" 2 "{bf:Foreign}")</code></strong></li>
<li>Position à 1 heure dans le graphique et affichage sur une ligne : <strong><code>pos(1) ring(0) col(1)</code></strong></li>
<li>Modification de la boite avec un contour très fin: <strong><code>region(lw(vvthin)</code></strong></li>
<li>Text sous le symnol: option <strong><code>stack</code></strong></li>
</ul>
<p><strong>AIDES</strong></p>
<ul>
<li><a href="https://www.stata.com/manuals/g-3legend_options.pdf" class="uri">https://www.stata.com/manuals/g-3legend_options.pdf</a></li>
<li><strong><code>help legend_options</code></strong></li>
</ul>
</div>
<div id="titres---notes---texte" class="section level4" number="2.3.2.3">
<h4 number="2.3.2.3"><span class="header-section-number">2.3.2.3</span> Titres - Notes - Texte</h4>
<ul>
<li>Modification de la position
<ul>
<li>Titre par défaut: à 12 heures à l’extérieur</li>
<li>Note par défaut: à 17 heures à l’extérieur</li>
<li>Caption par défaut: sous la note</li>
<li>Titre(s) - Notes - Texte: Modifiable avec <strong><code>pos(#)</code></strong> et <strong><code>ring(#)</code></strong> [voir Annexe plus bas]</li>
<li>Texte libre: positionné sur les coordonnées des axes (x,y)</li>
</ul></li>
<li>L’apparence (gras, italique, polices…) sont modifiables avec des balises <strong>smcl</strong> + ajout de symboles mathématiques + lettres grecques</li>
<li>Tailles et couleurs modifiables avec <strong><code>size</code></strong> et <strong><code>color</code></strong></li>
<li>Plusieurs lignes: <strong><code>"ligne1" "ligne2"....</code></strong></li>
</ul>
<p><br> <strong>ANNEXE: POSITION</strong></p>
<p><strong>Texte positionné au Nord et au Sud</strong><br />
<em>Graphique 18</em><br />
<img src="imgf/g15.png" style="width:75.0%" /></p>
<p><strong>Texte positionné à l’Ouest et à l’Est</strong><br />
<em>Graphique 19</em><br />
<img src="imgf/g15b.png" style="width:75.0%" /></p>
<p><strong>idée du 26/06: Positionner un texte manuellement pour faire apparaitre un point/une zone du graphique [A faire]</strong></p>
</div>
</div>
<div id="autres" class="section level3" number="2.3.3">
<h3 number="2.3.3"><span class="header-section-number">2.3.3</span> Autres</h3>
<ul>
<li><strong>name</strong>: sauvegarde temporaire sur la session
<ul>
<li>utiliser l’option replace pour écraser le graph, sinon effectuer <strong><code>graph drop noms_graphs</code></strong> ou <strong><code>graph drop _all</code></strong></li>
<li>Exemple: <strong><code>tw line y x, name(g1,replace)</code></strong></li>
</ul></li>
<li><strong>save</strong>: sauvegarde en dur sur le disque
<ul>
<li>Utile de créer un répertoire par défaut avec une macro (type <strong><code>global</code></strong>): <strong><code>global g "D:/stata_graph/"</code></strong> puis <strong><code>tw line y x, save($g/g1, replace)</code></strong></li>
<li>récupérer les infos d’un graph enregistré: <strong><code>graph describe nom_grap.gph</code></strong> (le code est affiché)</li>
</ul></li>
<li><strong>scale(#)</strong>: permet de réduire la taille de tous les éléments générés par le graphique, en particulier le texte. Utile, par exemple, lorsque le texte d’une légende sort du contour.</li>
<li><strong>nodraw</strong>: équivalent de <em><code>quietly</code></em> pour les graphiques. Permet de réduire le temps d’exécution pour les graphiques combinés</li>
</ul>
</div>
</div>
<div id="les-graphiques-combinés" class="section level2" number="2.4">
<h2 number="2.4"><span class="header-section-number">2.4</span> Les graphiques combinés</h2>
<ul>
<li>2 commandes:
<ul>
<li>interne: <strong>graph combine</strong></li>
<li>externe: <strong>grc1leg</strong> pour avoir une seule légende, si elle est partagé pour tous les graphiques<br />
<br></li>
</ul></li>
<li>préférer <strong><code>name()</code></strong> à <strong><code>save()</code></strong> pour les graphiques composants le graphique combiné</li>
<li>utiliser <strong><code>nodraw</code></strong> pour raccourcir le temps d’exécution</li>
<li>Utiliser <strong><code>fysize()</code></strong> et <strong><code>fxsize()</code></strong> pour modifier le ratio des graphiques individuel (voir plus bas <em>Pour en savoir plus</em>)</li>
<li><strong>graph combine</strong> et <strong>gr1leg</strong> (externe: permet d’afficher une seule légende)
<ul>
<li><strong>row(#)</strong> - <strong>cols(#)</strong></li>
<li><strong>iscale(#)</strong>: baisse ou augmente la taille des éléments textes par un coefficient multiplicateur</li>
<li><strong>xsize(#)</strong> - <strong>ysize(#)</strong>: taille du graphique en <em>pt</em> (max # = 20)
<ul>
<li>Pour un graphique à plusieurs colonne et une ligne: on peut augmenter le ratio xsize(#)/ysize(#)</li>
<li>Pour un graphique à plusieurs lignes et une colonne: on peut baisser le ratio xsize(#)/ysize(#)</li>
</ul></li>
<li><strong>xcommon</strong> - <strong>ycommon</strong>: ajuster les axes pour tous les graphiques</li>
<li><strong>legendfrom</strong>: une seule légende avec l’option <strong>legendfrom(name)</strong> de la commande <strong><code>gr1leg</code></strong></li>
<li>gestion des styles: si les graphiques utilisent des thèmes graphiques différents, le dernier sera appliqué à tous les graphiques. Pour conserver les thèmes d’origine: <strong><code>scheme(nom_style1 nom_style2....)</code></strong></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true"></a>tw graph1, <span class="kw">name</span>(g1, replace) nodraw </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true"></a>tw graph2, <span class="kw">name</span>(g2, replace) nodraw </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true"></a>graph combine g1 g2, <span class="kw">iscale</span>(.<span class="dv">9</span>) <span class="kw">xsize</span>(<span class="dv">20</span>) <span class="kw">ysize</span>(<span class="dv">15</span>) <span class="kw">scheme</span>(style1 style2) <span class="kw">title</span>(<span class="st">&quot;graphique combiné&quot;</span>)</span></code></pre></div>
<ul>
<li>Il peut être utile d’avoir un graphique “blanc” si le nombre de graphiques individuels est impair et/ou qu’on souhaite ajoute un espace conséquent pour rédiger une note:
<ul>
<li>Faire un graphique de type <code>scatteri</code> avec une seule coordonnées (x,y)</li>
<li>Supprimer tous les élements type <code>title</code>, enlever les grids, par exemple <code>xlabel(,nogrid)</code>, et mettre les éléments restant en blanc (<code>graphr(color(%0)))</code> <code>plotr(color(%0))</code>)</li>
</ul></li>
</ul>
<p><em>Pour en savoir plus</em><br />
<strong>Graph combine—Combining graphs - Lars ̈Angquist</strong> <a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400115" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400115</a></p>
</div>
<div id="python" class="section level2" number="2.5">
<h2 number="2.5"><span class="header-section-number">2.5</span> Python</h2>
<ul>
<li>Implémentation de Python avec la version 16 de Stata:
<ul>
<li>Stata n’intalle pas Python: [Installation de Python] <a href="https://mthevenin.github.io/stata_fr/python.html" class="uri">https://mthevenin.github.io/stata_fr/python.html</a></li>
<li>Implémentation de commandes Stata dédiées pour gérer l’utilisation de Python [<code>python query</code> <code>python describe</code> <code>python clear</code> ….]</li>
<li>Python est exécutable dans la fenêtre <em>command</em> ou dans l’éditeur de programme</li>
<li>Une librairie Python pour faciliter le passage d’une application à une autre</li>
<li>Les macros Stata reconnues lorsqu’on passe en code Python (très intéressant pour les graphiques)</li>
</ul></li>
</ul>
<p><strong>Exemple 1</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true"></a>Exemple <span class="dv">1</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true"></a>python<span class="op">:</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true"></a><span class="op">-----------------------</span><span class="st"> </span><span class="kw">python</span> (type end to exit) <span class="op">--------------------</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true"></a><span class="st"> </span>a=<span class="dv">1</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true"></a> b=<span class="dv">2</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true"></a> a<span class="op">+</span>b</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true"></a> <span class="dv">3</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true"></a> end</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true"></a><span class="op">----------------------------------------------------------------------</span></span></code></pre></div>
<p><strong>Exemple 2: importation d’une base Stata avec la librarie <code>pandas</code></strong> <strong>Fonction panda</strong>: read_stata(‘path/nom_bas’)</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true"></a>python<span class="op">:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true"></a><span class="op">-----------------------</span><span class="st"> </span><span class="kw">python</span> (type end to exit) <span class="op">--------------------</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true"></a>import pandas as pa </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true"></a>df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;D:/stata_temp/auto.dta&#39;</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true"></a><span class="kw">df.head</span>(<span class="dv">10</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true"></a>   price  mpg  turn  displacement  gear_ratio   foreign</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true"></a><span class="dv">0</span>   <span class="dv">4099</span>   <span class="dv">22</span>    <span class="dv">40</span>           <span class="dv">121</span>        <span class="fl">3.58</span>  Domestic</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true"></a><span class="dv">1</span>   <span class="dv">4749</span>   <span class="dv">17</span>    <span class="dv">40</span>           <span class="dv">258</span>        <span class="fl">2.53</span>  Domestic</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true"></a><span class="dv">2</span>   <span class="dv">3799</span>   <span class="dv">22</span>    <span class="dv">35</span>           <span class="dv">121</span>        <span class="fl">3.08</span>  Domestic</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true"></a><span class="dv">3</span>   <span class="dv">4816</span>   <span class="dv">20</span>    <span class="dv">40</span>           <span class="dv">196</span>        <span class="fl">2.93</span>  Domestic</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true"></a><span class="dv">4</span>   <span class="dv">7827</span>   <span class="dv">15</span>    <span class="dv">43</span>           <span class="dv">350</span>        <span class="fl">2.41</span>  Domestic</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true"></a><span class="dv">5</span>   <span class="dv">5788</span>   <span class="dv">18</span>    <span class="dv">43</span>           <span class="dv">231</span>        <span class="fl">2.73</span>  Domestic</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true"></a><span class="dv">6</span>   <span class="dv">4453</span>   <span class="dv">26</span>    <span class="dv">34</span>           <span class="dv">304</span>        <span class="fl">2.87</span>  Domestic</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true"></a><span class="dv">7</span>   <span class="dv">5189</span>   <span class="dv">20</span>    <span class="dv">42</span>           <span class="dv">196</span>        <span class="fl">2.93</span>  Domestic</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true"></a><span class="dv">8</span>  <span class="dv">10372</span>   <span class="dv">16</span>    <span class="dv">43</span>           <span class="dv">231</span>        <span class="fl">2.93</span>  Domestic</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true"></a><span class="dv">9</span>   <span class="dv">4082</span>   <span class="dv">19</span>    <span class="dv">42</span>           <span class="dv">231</span>        <span class="fl">3.08</span>  Domestic</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true"></a>end</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true"></a><span class="op">----------------------------------------------------------------------</span></span></code></pre></div>
<ul>
<li>Graphiques et data-visualisation</li>
<li>Les trois principales librairies pour les graphiques
<ul>
<li><strong><code>matplotlib</code></strong>: <a href="https://matplotlib.org/" class="uri">https://matplotlib.org/</a></li>
<li><strong><code>seaborn</code></strong>: <a href="https://seaborn.pydata.org/" class="uri">https://seaborn.pydata.org/</a></li>
<li><strong><code>plotly</code></strong> <a href="https://plotly.com/graphing-libraries/" class="uri">https://plotly.com/graphing-libraries/</a></li>
</ul></li>
<li>Autres: <strong><code>ggplot</code></strong> et <strong><code>plotnine</code></strong> pour des graphiques types ggplot2
<ul>
<li><em>ggplot</em>: la librairie n’est plus mise à jour - très imcomplète</li>
<li><em>plotninne</em>: la librairue est mise à jour - incomplète</li>
</ul></li>
</ul>
<div id="librairie-seaborn" class="section level3" number="2.5.1">
<h3 number="2.5.1"><span class="header-section-number">2.5.1</span> Librairie seaborn</h3>
<ul>
<li>Graphiques statiques</li>
</ul>
<p><strong>Exemple 1</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Partie Stata</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true"></a>sysuse auto, clear</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true"></a>xtile mpg2 =<span class="st"> </span>mpg, <span class="kw">n</span>(<span class="dv">2</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true"></a>label define mpg <span class="dv">1</span> <span class="st">&quot;mpg&lt;20&quot;</span> <span class="dv">2</span> <span class="st">&quot;mpg&gt;=20&quot;</span>, modify</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true"></a>label value mpg2 mpg</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true"></a>keep price mpg weight displacement turn mpg2</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true"></a>save auto2, replace</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Partie Python</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true"></a>python<span class="op">:</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true"></a>import pandas as pa </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true"></a>import seaborn as sns</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true"></a>df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;auto2.dta&#39;</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true"></a>g =<span class="st"> </span><span class="kw">sns.pairplot</span>(df, <span class="dt">hue=</span><span class="st">&quot;mpg2&quot;</span>,<span class="dt">palette=</span><span class="st">&quot;hls&quot;</span>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true"></a><span class="kw">g.savefig</span>(<span class="st">&quot;graph1.png&quot;</span>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true"></a>end</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true"></a><span class="op">!</span><span class="st"> </span>graph1.png</span></code></pre></div>
<p><em>Graphique 20</em><br />
<img src="imgf/g25.png" style="width:75.0%" /></p>
<p><strong>Remarques</strong>:</p>
<ul>
<li>Les labels de la variable <strong>mpg2</strong> ont été lus par la fonction Python <strong><code>pairplot</code></strong></li>
<li>Le graphique a du être enregistré avec la fonction <strong><code>savefig(nom_graph)</code></strong> et ouvert avec l’invite de commande windows: <strong><code>! nom_graph</code></strong> ou <strong><code>shell nom_graph</code></strong>
<ul>
<li>Ce n’est pas une obligation, tout dépend de la fonction.</li>
<li>Si le graphique peut-être affiché directement, on peut utiliser la fonction <strong><code>show()</code></strong></li>
</ul></li>
</ul>
<p>**Exemple 2</p>
<p><strong>Histogrammes et heatplot</strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true"></a>use nhanes2, clear</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true"></a>keep height weight</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true"></a>save pression, replace</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true"></a>python<span class="op">:</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true"></a>import pandas as pa </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true"></a>import seaborn as sns</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true"></a>df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;pression.dta&#39;</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true"></a><span class="kw">sns.set</span>(<span class="dt">style=</span><span class="st">&quot;ticks&quot;</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true"></a>g =<span class="st"> </span><span class="kw">sns.jointplot</span>(<span class="dt">x=</span><span class="st">&quot;height&quot;</span>, <span class="dt">y=</span><span class="st">&quot;weight&quot;</span>, <span class="dt">kind=</span><span class="st">&quot;hex&quot;</span>, <span class="dt">color=</span><span class="st">&quot;mediumvioletred&quot;</span>, <span class="dt">data=</span>df)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true"></a><span class="kw">g.savefig</span>(<span class="st">&quot;graph2.png&quot;</span>)</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true"></a>end</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true"></a><span class="op">!</span><span class="st"> </span>graph2.png </span></code></pre></div>
<p><em>Graphique 21</em><br />
<img src="imgf/g26.png" style="width:50.0%" /></p>
<p><strong>Lecture/Remarques</strong>: [A FAIRE]</p>
<p><strong>Densité</strong>: en remplaçant l’option <strong><code>kind="hex"</code></strong> par <strong><code>kind="kde"</code></strong><br />
<em>Graphique 22</em><br />
<img src="imgf/g26b.png" style="width:50.0%" /></p>
</div>
<div id="plotly" class="section level3" number="2.5.2">
<h3 number="2.5.2"><span class="header-section-number">2.5.2</span> Plotly</h3>
<p>Graphiques de type intéractifs et/ou dynamiques - possibilité de programmer des dashboard [A testé d’ici septembre]</p>
<ul>
<li>Graphiques intéractif et dynamique Intéractivité:
<ul>
<li>des informations s’affichent en passant sur le(s) élément(s) du graphique - on peut sélectionner une partie du graphique</li>
<li>On peut choisir de faire apparaître une partie des éléments composant le graphique. Pratique pour les courbes (clic et double clic dans la légende)</li>
<li>Des options en haut et à gauche du graphiques permettent de zoomer/dezoomer…</li>
</ul></li>
<li>Graphique enregistré en format html. Pour une capture <em>png</em>, on peut l’enregistrer directement (voir menu en haut et à gauche)</li>
</ul>
<p><strong>Exemple 1:</strong> <strong>Graphique intéractif de type line</strong><br />
<a href="https://plotly.com/python/line-charts/" class="uri">https://plotly.com/python/line-charts/</a></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true"></a>sysuse uslifeexp.dta , clear</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true"></a>keep year le le_male le_female</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true"></a>rename le le1</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true"></a>rename le_male le2</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true"></a>rename le_female le3</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true"></a>reshape long le, <span class="kw">i</span>(year) <span class="kw">j</span>(pop)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true"></a>label define pop <span class="dv">1</span> <span class="st">&quot;tot&quot;</span> <span class="dv">2</span> <span class="st">&quot;Hommes&quot;</span> <span class="dv">3</span> <span class="st">&quot;Femmes&quot;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true"></a>label value pop pop </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true"></a>save uslifeexp.dta , replace</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true"></a>python<span class="op">:</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true"></a>import pandas as pa </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true"></a>import plotly.express as px</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true"></a>df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;uslifeexp.dta&#39;</span>)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true"></a>fig =<span class="st"> </span><span class="kw">px.line</span>(df, <span class="dt">x=</span><span class="st">&quot;year&quot;</span>, <span class="dt">y=</span><span class="st">&quot;le&quot;</span>, <span class="dt">color=</span><span class="st">&quot;pop&quot;</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true"></a><span class="kw">fig.update_layout</span>( <span class="dt">title=</span><span class="st">&quot;Espérance de vie US de 1900 &amp; 1999&quot;</span>, <span class="dt">yaxis_title=</span><span class="st">&quot;Espérance de vie&quot;</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true"></a><span class="kw">fig.show</span>()</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true"></a>end</span></code></pre></div>
<p><em>Graphique 23</em><br />
<iframe width="800" height="600"  src="imgf/g27.html"></iframe></p>
<p><em>Options d’intéractivité</em>: [A FAIRE]</p>
<p><strong>Exemple 3 :</strong> <strong>Graphique intéractif de type tree</strong><br />
<a href="https://plotly.com/python/treemaps/" class="uri">https://plotly.com/python/treemaps/</a></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true"></a>use <span class="st">&quot;gm2.dta&quot;</span>, clear</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true"></a>des</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true"></a><span class="op">/</span><span class="er">*</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true"></a><span class="op">--------------------------------------------------------------------------------</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true"></a><span class="st">              </span>storage   display    value</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true"></a>variable name   type    format     label      variable label</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true"></a><span class="op">--------------------------------------------------------------------------------</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true"></a>country         str30   %30s                  </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true"></a>continent       str14   %14s                  </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true"></a>lifeexp         double  %<span class="fl">6.2</span>f                 </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true"></a>year            float   %<span class="fl">9.0</span>g                 </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true"></a>pop             long    %<span class="fl">12.0</span>g                </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true"></a>world           str5    %9s                   </span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true"></a><span class="op">--------------------------------------------------------------------------------</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true"></a><span class="er">*/</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true"></a>python<span class="op">:</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true"></a>import pandas as pa </span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true"></a>import plotly.express as px</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true"></a>df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;gm2.dta&#39;</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true"></a>fig =<span class="st"> </span><span class="kw">px.treemap</span>(df, <span class="dt">path=</span>[<span class="st">&#39;world&#39;</span>, <span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>], <span class="dt">values=</span><span class="st">&#39;pop&#39;</span>, <span class="dt">color=</span><span class="st">&#39;lifeexp&#39;</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true"></a><span class="kw">fig.show</span>()</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true"></a>end</span></code></pre></div>
<p><em>Graphique 24</em><br />
<iframe width="800" height="600"  src="imgf/g29.html"></iframe></p>
<p><em>Lecture</em>:</p>
<ul>
<li>Les périmètres des boîtes sont relatifs à la taille de la population: taille relative des <em>continents</em> - taille relative des pays dans chaque <em>continent</em></li>
<li>Les différentes couleurs sont relative à la valeur de l’espérance de vie</li>
<li>Pour <em>world</em> et les continents les espérances sont calculés par une moyenne pondérée: avec stata pour l’Europe: <strong><code>sum lifeexp [iw=pop] if continent=Europe"</code></strong></li>
<li>Manque quelques pays dont le continent n’était pas renseigné dans la base d’origine et que je n’ai pas pris la peine et/ou le temps de modifier</li>
</ul>
<p><strong>Exemple 3 :</strong> <strong>Graphique intéractif et dynamique de type barres</strong><br />
<a href="https://plotly.com/python/bar-charts/" class="uri">https://plotly.com/python/bar-charts/</a></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true"></a>use gm3, clear</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true"></a>drop <span class="cf">if</span> year<span class="op">&lt;</span><span class="dv">1960</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true"></a>drop <span class="cf">if</span> continent<span class="op">==</span><span class="st">&quot;&quot;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true"></a>replace continent=<span class="st">&quot;Asia &amp; Oceania&quot;</span> <span class="cf">if</span> <span class="kw">inlist</span>(continent, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Oceania&quot;</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true"></a>bysort country<span class="op">:</span><span class="st"> </span>gen N=_N</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true"></a>sort year pop</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true"></a>drop <span class="cf">if</span> N<span class="op">&lt;</span><span class="dv">61</span>   <span class="op">/</span><span class="er">/</span><span class="st"> </span>On conserve seulement les pays avec toutes les années renseignées</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true"></a>tostring year, replace</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true"></a>drop N</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true"></a>save gm4, replace</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true"></a>des</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true"></a><span class="op">--------------------------------------------------------------------------------</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true"></a><span class="st">              </span>storage   display    value</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true"></a>variable name   type    format     label      variable label</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true"></a><span class="op">--------------------------------------------------------------------------------</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true"></a>country         str30   %30s                  </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true"></a>continent       str14   %14s                  </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true"></a>pop             long    %<span class="fl">12.0</span>g                </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true"></a>year            float   %<span class="fl">6.0</span>f                 </span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true"></a><span class="op">--------------------------------------------------------------------------------</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true"></a>python<span class="op">:</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true"></a>import pandas as pa </span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true"></a>import plotly.express as px</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true"></a>df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;gm4.dta&#39;</span>)</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true"></a>fig =<span class="st"> </span><span class="kw">px.bar</span>(df, <span class="dt">x=</span><span class="st">&quot;continent&quot;</span>, <span class="dt">y=</span><span class="st">&quot;pop&quot;</span>, <span class="dt">color=</span><span class="st">&quot;continent&quot;</span>,</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true"></a><span class="dt">animation_frame=</span><span class="st">&quot;year&quot;</span>, <span class="dt">animation_group=</span><span class="st">&quot;country&quot;</span>, <span class="dt">range_y=</span>[<span class="dv">0</span>, <span class="dv">5000000000</span>])</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true"></a><span class="kw">fig.update_layout</span>( <span class="dt">title=</span><span class="st">&quot;Evolution de la population mondiale  depuis 1960&quot;</span>,</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true"></a><span class="dt">yaxis_title=</span><span class="st">&quot;Population&quot;</span>, <span class="dt">xaxis_title=</span><span class="st">&quot;Continents&quot;</span>)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true"></a><span class="kw">fig.show</span>()</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true"></a>end</span></code></pre></div>
<p><em>Graphique 25</em><br />
<iframe width="800" height="600"  src="imgf/g28.html"></iframe></p>
</div>
</div>
</div>
<div id="utilisation-des-macros" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Utilisation des macros</h1>
<div id="types-et-objets-macro" class="section level2" number="3.1">
<h2 number="3.1"><span class="header-section-number">3.1</span> Types et objets macro</h2>
<ul>
<li><strong>Rappel important</strong>: (toujours) tester le contenu de la macro avec <strong><code>display</code></strong> (<code>di</code>) ou <strong>[très conseillé]</strong> avec <strong><code>macro list</code></strong>:
<ul>
<li><strong><code>macro list _nom_macro</code></strong></li>
<li><strong>di `nom_macro’</strong></li>
<li><strong>di “`nom_macro’”</strong></li>
</ul></li>
<li><strong>boucles</strong>: pour générer des boucles se reporter à l’aide: <strong><code>help foreach</code></strong> - <strong><code>help forvalue</code></strong></li>
</ul>
<div id="local---global" class="section level3" number="3.1.1">
<h3 number="3.1.1"><span class="header-section-number">3.1.1</span> local - global</h3>
<ul>
<li><strong>global</strong>: macro en dur (enregistrée)
<ul>
<li><p>Appelé avec <strong>$</strong></p></li>
<li><p>Supression: <strong>`macro drop nom_macro1 nom_macro2…``</strong></p></li>
<li><p>Pas de grande utilité à mon sens pour les graphiques, sauf pour utiliser un répertoire par défaut de sauvegarde des graphiques</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true"></a>    mkdir <span class="st">&quot;D:/stata_graph&quot;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true"></a>    global g <span class="st">&quot;D:/stata_graph&quot;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true"></a>    tw scatter y x, <span class="kw">save</span>(<span class="op">$</span>g<span class="op">/</span>nom_graph)</span></code></pre></div>
<ul>
<li><strong>local</strong>: macro temporaire (à l’exécution)
<ul>
<li>Appelé avec des quotes simples <strong>`<code>nom_macro'</code></strong> (première quote: [alt6])</li>
</ul></li>
</ul>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true"></a>sysuse auto, clear</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true"></a>global varlist price mpg </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true"></a>tw scatter <span class="op">$</span>varlist</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true"></a>macro drop varlist</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true"></a>local varlist price mpg </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true"></a>tw scatter <span class="st">`</span><span class="dt">varlist&#39;</span></span></code></pre></div>
<ul>
<li><strong>Macro et doubles quotes apparentes [TRES IMPORTANT]</strong>
<ul>
<li>se fier à <strong><code>macro list</code></strong> et non à <code>di</code> pour vérifier la lecture de la macro</li>
</ul></li>
</ul>
<p>Non lue avec display, utilisable dans une commande</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true"></a>local x <span class="st">&quot;A&quot;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true"></a>di <span class="st">`</span><span class="dt">x&#39;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true"></a><span class="dt">A not found</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true"></a><span class="dt">macro list _x</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true"></a><span class="dt">_x: A</span></span></code></pre></div>
<p>Lue avec des doubles quotes, non utilisable dans une commande<br />
<strong>[A réserver avec <code>display</code>]</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true"></a>local x <span class="st">&quot;`&quot;&quot;A&quot;&quot;&#39;&quot;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true"></a>di <span class="st">`</span><span class="dt">x&#39;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true"></a><span class="dt">&quot;A&quot;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true"></a><span class="dt">mac list _x</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true"></a><span class="dt">_x:  </span><span class="st">`&quot;&quot;</span>A<span class="st">&quot;&quot;&#39;</span></span></code></pre></div>
<p>Lue sans les doubles quotes, utilisable dans une commande <strong>[A utiliser avec des commandes ultérieures qui demandent des doubles quotes apprentes]</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true"></a>local x <span class="st">`</span><span class="dt">&quot;&quot;A&quot;&quot;&#39;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true"></a><span class="dt">di </span><span class="st">`</span>x<span class="st">&#39;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true"></a><span class="st">A</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true"></a><span class="st">mac list _x</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true"></a><span class="st">_x: &quot;A&quot;</span></span></code></pre></div>
<p>On reviendra plus bas sur cette question avec les macros élargies pour générer, par exemple, des légendes automatiquement</p>
<ul>
<li><strong>La commande magique LEVELSOF</strong>
<ul>
<li>Transforme les valeurs d’une variable en expression macro</li>
<li>Syntaxe: <strong><code>levelsof nom_var [if/in], local(nom_macro)</code></strong></li>
</ul></li>
</ul>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true"></a>levelsof foreign, <span class="kw">local</span>(f)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true"></a>di <span class="st">&quot;`f&#39;&quot;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true"></a><span class="dv">0</span> <span class="dv">1</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true"></a>levelsof rep78, <span class="kw">local</span>(r)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true"></a>di <span class="st">&quot;`r&#39;&quot;</span> </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true"></a><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span></span></code></pre></div>
<ul>
<li><strong>Fonctions associées au macro</strong>:
<ul>
<li>On peut associer des fonctions aux macros, certaines sont utiles pour les graphiques (<code>help macro</code> - <a href="https://www.stata.com/manuals/pmacro.pdf" class="uri">https://www.stata.com/manuals/pmacro.pdf</a>)</li>
<li>Exemple: <strong><code>word count()</code></strong>, <strong><code>labn</code></strong>, <strong><code>lab</code></strong></li>
</ul></li>
</ul>
<p><em>word count()</em><br />
On compte le nombre d’objets contenus dans une macro (séparé par un espace). Utile pour compter le nombre de boucles a effectuer avec <code>forvalue</code></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true"></a>levelsof rep78, <span class="kw">local</span>(r)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true"></a>local n<span class="op">:</span><span class="st"> </span>word <span class="kw">count</span>(<span class="st">`</span><span class="dt">r&#39;)</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true"></a><span class="dt">di </span><span class="st">`</span>n<span class="st">&#39;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true"></a><span class="st">5</span></span></code></pre></div>
<p><em>value label nom_variable</em> Récupère le nom d’un label</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true"></a>local varname foreign</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true"></a>local labn<span class="op">:</span><span class="st"> </span>value label <span class="st">`</span><span class="dt">varname&#39;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true"></a><span class="dt">di &quot;</span><span class="st">`</span>labn<span class="st">&#39;&quot;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true"></a><span class="st">origin</span></span></code></pre></div>
<p><em>label nom_label valeur</em> Récupère le nom de la modalité associé à une valeur d’un nom de label</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true"></a>local lab0<span class="op">:</span><span class="st"> </span>label origin  <span class="dv">0</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true"></a>local lab1<span class="op">:</span><span class="st"> </span>label origin  <span class="dv">1</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true"></a>di <span class="st">&quot;`lab0&#39;&quot;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true"></a>Domestic</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true"></a>di <span class="st">&quot;`lab1&#39;&quot;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true"></a>Foreign</span></code></pre></div>
<p><strong>Exemple dans une boucle</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true"></a>gen rep=<span class="st"> </span>rep78<span class="op">&lt;</span><span class="dv">4</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true"></a>label define rep <span class="dv">0</span> <span class="st">&quot;rep&lt;4&quot;</span> <span class="dv">1</span> <span class="st">&quot;rep&gt;=4&quot;</span>, modify</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true"></a>label value rep rep</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true"></a>local varname rep</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true"></a>local labn<span class="op">:</span><span class="st"> </span>value label <span class="st">`</span><span class="dt">varname&#39;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true"></a><span class="dt">levelsof </span><span class="st">`</span>varname<span class="st">&#39;, local(l)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true"></a><span class="st">foreach l2 of local l {</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true"></a><span class="st">local lab`l2&#39;</span><span class="op">:</span><span class="st"> </span>label <span class="st">`</span><span class="dt">labn&#39;  </span><span class="st">`</span>l2<span class="st">&#39;</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true"></a><span class="st">tw scatter price mpg if `varname&#39;</span><span class="op">==</span><span class="dv">0</span>, <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="op">/</span><span class="er">//</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> <span class="st">`</span><span class="dt">varname&#39;==1, mc(%70) mlc(black) mlw(vthin) ///</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true"></a><span class="dt">, legend(order(1 &quot;</span><span class="st">`</span>lab0<span class="st">&#39;&quot; 2 &quot;`lab1&#39;&quot;))</span></span></code></pre></div>
<p><em>Graphique 26</em><br />
<img src="imgf/g18.png" style="width:50.0%" /></p>
<p>En changeant <strong><code>local varname rep</code></strong> par <strong><code>local varname foreign</code></strong></p>
<p><em>Graphique 27</em><br />
<img src="imgf/g19.png" style="width:50.0%" /></p>
<ul>
<li><strong>Mofication du format d’une valeur numérique (changement du nombre de décimale)</strong>
<ul>
<li>On peut utiliser les objets types <strong><code>r()</code></strong> ou <strong><code>e()</code></strong> dans un graphique (voir plus bas)</li>
<li>Certaines valeurs en mémoire comporte un nombre élévé de decimales</li>
<li>On peut modifier le format d’affichage de ces valeurs avec une macro: **<code>di format valeur**</code></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true"></a>local dec2<span class="op">:</span><span class="st"> </span>di %<span class="fl">6.2</span>f <span class="fl">10.64654654654</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true"></a>di <span class="st">`</span><span class="dt">dec2&#39;</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true"></a><span class="dt">10.65</span></span></code></pre></div>
<ul>
<li><strong>Expression numérique calculée dans une macro</strong>: <strong><code>local nom_macro = expression</code></strong></li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true"></a>local a=<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true"></a>di <span class="st">`</span><span class="dt">a&#39;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true"></a><span class="dt">2</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true"></a><span class="dt">local b= </span><span class="st">`</span>a<span class="st">&#39;^2</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true"></a><span class="st">di `b&#39;</span>  </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true"></a><span class="dv">4</span></span></code></pre></div>
</div>
<div id="objets-type-return-et-ereturn" class="section level3" number="3.1.2">
<h3 number="3.1.2"><span class="header-section-number">3.1.2</span> Objets type return et ereturn</h3>
<p>Après l’exécution d’une commande, un certains nombre d’objets sont conservé en mémoire jusqu’à l’exécution de la commande suivante</p>
<ul>
<li><strong>objet return</strong> [result] : <strong><code>r()</code></strong>
<ul>
<li>Affichage liste: <strong><code>return list</code></strong></li>
</ul></li>
<li><strong>objet ereturn</strong> [estimation]: <strong><code>e()</code></strong>
<ul>
<li>Affichage liste: <strong><code>ereturn list</code></strong></li>
</ul></li>
<li><strong>Autres</strong>
<ul>
<li>Matrices: <strong><code>matrix list</code></strong></li>
</ul></li>
</ul>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true"></a>sum price, d</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true"></a>                            Price</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true"></a><span class="op">-------------------------------------------------------------</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true"></a><span class="st">      </span>Percentiles      Smallest</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true"></a> <span class="dv">1</span>%         <span class="dv">3291</span>           <span class="dv">3291</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true"></a> <span class="dv">5</span>%         <span class="dv">3748</span>           <span class="dv">3299</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true"></a><span class="dv">10</span>%         <span class="dv">3895</span>           <span class="dv">3667</span>       Obs                  <span class="dv">74</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true"></a><span class="dv">25</span>%         <span class="dv">4195</span>           <span class="dv">3748</span>       Sum of Wgt.          <span class="dv">74</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true"></a><span class="dv">50</span>%       <span class="fl">5006.5</span>                      Mean           <span class="fl">6165.257</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true"></a>                        Largest       Std. Dev.      <span class="fl">2949.496</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true"></a><span class="dv">75</span>%         <span class="dv">6342</span>          <span class="dv">13466</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true"></a><span class="dv">90</span>%        <span class="dv">11385</span>          <span class="dv">13594</span>       Variance        <span class="dv">8699526</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true"></a><span class="dv">95</span>%        <span class="dv">13466</span>          <span class="dv">14500</span>       Skewness       <span class="fl">1.653434</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true"></a><span class="dv">99</span>%        <span class="dv">15906</span>          <span class="dv">15906</span>       Kurtosis       <span class="fl">4.819188</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true"></a></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true"></a>return list</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true"></a>scalars<span class="op">:</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true"></a><span class="st">                  </span><span class="kw">r</span>(N) =<span class="st">  </span><span class="dv">74</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true"></a>              <span class="kw">r</span>(sum_w) =<span class="st">  </span><span class="dv">74</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true"></a>               <span class="kw">r</span>(mean) =<span class="st">  </span><span class="fl">6165.256756756757</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true"></a>                <span class="kw">r</span>(Var) =<span class="st">  </span><span class="fl">8699525.97426879</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true"></a>                 <span class="kw">r</span>(sd) =<span class="st">  </span><span class="fl">2949.495884768919</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true"></a>           <span class="kw">r</span>(skewness) =<span class="st">  </span><span class="fl">1.653433511704859</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true"></a>           <span class="kw">r</span>(kurtosis) =<span class="st">  </span><span class="fl">4.819187528464004</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true"></a>                <span class="kw">r</span>(sum) =<span class="st">  </span><span class="dv">456229</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true"></a>                <span class="kw">r</span>(min) =<span class="st">  </span><span class="dv">3291</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true"></a>                <span class="kw">r</span>(max) =<span class="st">  </span><span class="dv">15906</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true"></a>                 <span class="kw">r</span>(p1) =<span class="st">  </span><span class="dv">3291</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true"></a>                 <span class="kw">r</span>(p5) =<span class="st">  </span><span class="dv">3748</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true"></a>                <span class="kw">r</span>(p10) =<span class="st">  </span><span class="dv">3895</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true"></a>                <span class="kw">r</span>(p25) =<span class="st">  </span><span class="dv">4195</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true"></a>                <span class="kw">r</span>(p50) =<span class="st">  </span><span class="fl">5006.5</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true"></a>                <span class="kw">r</span>(p75) =<span class="st">  </span><span class="dv">6342</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true"></a>                <span class="kw">r</span>(p90) =<span class="st">  </span><span class="dv">11385</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true"></a>                <span class="kw">r</span>(p95) =<span class="st">  </span><span class="dv">13466</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true"></a>                <span class="kw">r</span>(p99) =<span class="st">  </span><span class="dv">15906</span></span></code></pre></div>
<ul>
<li>Ces résultats peuvent être utilisés, tels quels, lors de l’exécution de la commande suivante</li>
<li>Ces résultats peuvent être conservé en mémoire dans une macro, et être utilisés tout du long du programme</li>
</ul>
<p>Exemple</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true"></a>local varlist price mpg</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true"></a>foreach v of loc varlist {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true"></a>qui sum <span class="st">`</span><span class="dt">v&#39;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true"></a><span class="dt">local m</span><span class="st">`</span>v<span class="st">&#39; : di %6.2f `r(mean)&#39;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true"></a>di <span class="st">&quot;Moyenne `v&#39;= `m`v&#39;&#39;&quot;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true"></a>}</span></code></pre></div>
<ul>
<li>Niveau graphique:
<ul>
<li>Permet d’afficher des valeurs dans le graphique</li>
<li>Permet de générer automatiquement des éléments de type <strong><code>xline</code></strong> <strong><code>yline</code></strong></li>
<li>Permet de généré des graphiques de type <strong>scatteri</strong> ou <strong>pci</strong> [on entre directement les coordonnées des axes et non des variables]</li>
</ul></li>
</ul>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true"></a>xtile qprice =<span class="st"> </span>price, <span class="kw">n</span>(<span class="dv">4</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true"></a>local varlist price mpg</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true"></a>foreach v of loc varlist {</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true"></a>qui sum <span class="st">`</span><span class="dt">v&#39;</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true"></a><span class="dt">local  m</span><span class="st">`</span>v<span class="st">&#39; : di %6.2f `r(mean)&#39;</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true"></a>}</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true"></a>tw scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true"></a><span class="kw">yline</span>(<span class="st">`</span><span class="dt">mprice&#39;, lw(vthin) lc(black)) xline(</span><span class="st">`</span>mmpg<span class="st">&#39;, lw(vthin) lc(black))      msiz(large) ///</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true"></a><span class="st">note(&quot;Moyenne Price = `mprice&#39;&quot; ///</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true"></a><span class="st">     &quot;</span>Moyenne <span class="dt">Mpg   =</span> <span class="st">`</span><span class="dt">mmpg&#39;&quot;  ) legend(off)</span></span></code></pre></div>
<p><em>Graphique 28</em><br />
<img src="imgf/g20.png" style="width:50.0%" /></p>
</div>
<div id="autres-1" class="section level3" number="3.1.3">
<h3 number="3.1.3"><span class="header-section-number">3.1.3</span> Autres</h3>
<p><strong>Token</strong></p>
<ul>
<li>Plutôt utilisé dans la programmation de routines (.ado) mais peut s’avérer utile pour transformer les variables du graphique en macro.</li>
<li><strong>Token</strong> est une macro qui prend comme noms une suite de nombre (un numéro)</li>
<li>On transforme une expression en token avec la commande <strong><code>tokenize</code></strong></li>
</ul>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true"></a>tokenize price mpg</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true"></a>sum <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39;</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true"></a><span class="st">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true"></a><span class="st">-------------+---------------------------------------------------------</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true"></a><span class="st">       price |         74    6165.257    2949.496       3291      15906</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true"></a><span class="st">         mpg |         74     21.2973    5.785503         12         41</span></span></code></pre></div>
<p>Ou avec une expression sous forme de macro</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true"></a>local varlist price mpg</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true"></a>tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true"></a><span class="dt">sum </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true"></a>    Variable <span class="op">|</span><span class="st">        </span>Obs        Mean    Std. Dev.       Min        Max</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true"></a><span class="op">-------------+---------------------------------------------------------</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true"></a><span class="st">       </span>price <span class="op">|</span><span class="st">         </span><span class="dv">74</span>    <span class="fl">6165.257</span>    <span class="fl">2949.496</span>       <span class="dv">3291</span>      <span class="dv">15906</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true"></a>         mpg <span class="op">|</span><span class="st">         </span><span class="dv">74</span>     <span class="fl">21.2973</span>    <span class="fl">5.785503</span>         <span class="dv">12</span>         <span class="dv">41</span></span></code></pre></div>
<p><strong>Application pour un graphique</strong></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true"></a>local varlist price mpg foreign </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true"></a>tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true"></a><span class="dt">tw scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==0 ||</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true"></a><span class="dt">tw scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==1 </span></span></code></pre></div>
<p><strong>Compteur i++</strong></p>
<ul>
<li>Utile dans les boucles <code>foreach</code> pour générer un compteur type macro qui fonctionne comme dans une boucle <code>forvalue</code></li>
<li>Dans une boucle de type <code>forvalue</code> permet de générer un compteur dont les valeurs de départ et d’arrivée diffèrent des valeurs de la boucle<br />
</li>
<li>On initialise sa valeur initiale par une macro: <strong><code>local i=valeur</code></strong></li>
</ul>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true"></a>local i =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true"></a>forvalue v=<span class="dv">10</span><span class="op">/</span><span class="dv">15</span> {</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true"></a>di <span class="st">`</span><span class="dt">i++&#39;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true"></a><span class="dt">1</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true"></a><span class="dt">2</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true"></a><span class="dt">3</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true"></a><span class="dt">4</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true"></a><span class="dt">5</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true"></a><span class="dt">6</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true"></a>local i =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true"></a>local varlist price mpg turn length</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true"></a>foreach v of local varlist {</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true"></a>di <span class="st">&quot;var`i++&#39; = `v&#39;&quot;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true"></a>}</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true"></a>var1 =<span class="st"> </span>price</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true"></a>var2 =<span class="st"> </span>mpg</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true"></a>var3 =<span class="st"> </span>turn</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true"></a>var4 =<span class="st"> </span>length</span></code></pre></div>
<p>Application au graphique précédent: Le nom des macros qui enregistre les valeur des moyennes de price et rpg s’appelent maintenant <strong>m1</strong> et <strong>m2</strong></p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true"></a>local varlist price mpg</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true"></a>foreach v of loc varlist {</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true"></a>qui sum <span class="st">`</span><span class="dt">v&#39;</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true"></a><span class="dt">local  m</span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39; : di %6.2f `r(mean)&#39;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true"></a>}</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true"></a>tw scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true"></a><span class="kw">yline</span>(<span class="st">`</span><span class="dt">m1&#39;, lw(vthin) lc(black)) xline(</span><span class="st">`</span>m2<span class="st">&#39;, lw(vthin) lc(black))               ///</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true"></a><span class="st">note(&quot;Moyenne Price = `m1&#39;&quot; ///</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true"></a><span class="st">     &quot;</span>Moyenne <span class="dt">Mpg   =</span> <span class="st">`</span><span class="dt">m2&#39;&quot;  ) legend(off)</span></span></code></pre></div>
<p>On peut maintenant, avec les <strong>tokens</strong> créer un graphique qui n’appelle qu’un fois les variables du graphique. On peut donc changer les variables en ne modifiant qu’une ligne</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true"></a>local varlist price mpg qprice</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true"></a>tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true"></a><span class="dt">xtile q</span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; = `1&#39;</span>, <span class="kw">n</span>(<span class="dv">4</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true"></a>foreach v of loc varlist {</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true"></a>qui sum <span class="st">`</span><span class="dt">v&#39;</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true"></a><span class="dt">local  m</span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39; : di %6.2f `r(mean)&#39;</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true"></a>}</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true"></a>tw scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true"></a><span class="kw">yline</span>(<span class="st">`</span><span class="dt">m1&#39;, lw(vthin) lc(black)) xline(</span><span class="st">`</span>m2<span class="st">&#39;, lw(vthin) lc(black))           ///</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true"></a><span class="st">note(&quot;Moyenne `1&#39;</span> =<span class="st"> `</span><span class="dt">m1&#39;&quot; ///</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true"></a><span class="dt">     &quot;Moyenne </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; = `m2&#39;&quot;  ) legend(off)</span></span></code></pre></div>
<p>Avec la variable <em>displacement</em> au lieu de <em>price</em>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true"></a>local varlist displacement mpg qdisplacement</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true"></a>tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true"></a><span class="dt">xtile q</span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; = `1&#39;</span>, <span class="kw">n</span>(<span class="dv">4</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true"></a>foreach v of loc varlist {</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true"></a>qui sum <span class="st">`</span><span class="dt">v&#39;</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true"></a><span class="dt">local  m</span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39; : di %6.2f `r(mean)&#39;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true"></a>}</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true"></a>tw scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true"></a><span class="kw">yline</span>(<span class="st">`</span><span class="dt">m1&#39;, lw(vthin) lc(black)) xline(</span><span class="st">`</span>m2<span class="st">&#39;, lw(vthin) lc(black))           ///</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true"></a><span class="st">note(&quot;Moyenne `1&#39;</span> =<span class="st"> `</span><span class="dt">m1&#39;&quot; ///</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true"></a><span class="dt">     &quot;Moyenne </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; = `m2&#39;&quot;  ) legend(off)</span></span></code></pre></div>
<p><em>Graphique 29</em><br />
<img src="imgf/g21.png" style="width:50.0%" /></p>
<p><em>Spoil alert</em>: il ne reste plus qu’à se débarasser de la répétition des options dans le graphique [section suivante]</p>
<p>** Pour info: autres compteurs</p>
<ul>
<li><strong><code>++i</code></strong></li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true"></a>  forvalue j=<span class="dv">1</span><span class="op">/</span><span class="dv">5</span> {</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true"></a>   di <span class="st">`</span><span class="dt">++i&#39;</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true"></a><span class="dt">   }</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true"></a><span class="dt">* Renvoi la liste: 2 3 4 5 6</span></span></code></pre></div>
<p>Remarque: pour retrouver les valeurs du compteur <code>i++</code>, il suffit s’initialiser <code>i</code> à 0</p>
<ul>
<li><strong><code>i--</code></strong></li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true"></a>local i=<span class="dv">10</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true"></a>forvalue j=<span class="dv">1</span><span class="op">/</span><span class="dv">5</span> {</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true"></a>   di <span class="st">`</span><span class="dt">i--&#39;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true"></a><span class="dt">   }</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true"></a><span class="dt">* renvoi la liste: 10 9 8 7 6</span></span></code></pre></div>
<ul>
<li><strong><code>--i</code></strong></li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true"></a>local i=<span class="dv">10</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true"></a>forvalue j=<span class="dv">1</span><span class="op">/</span><span class="dv">5</span> {</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true"></a>   di <span class="st">`</span><span class="dt">--i&#39;</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true"></a><span class="dt">   }</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true"></a><span class="dt">* renvoi la liste: 9 8 7 6 5</span></span></code></pre></div>
<p><strong>Objet temporaire: tempvar, tempfile, tempname….</strong></p>
<ul>
<li><strong>tempvar</strong>: très utile.
<ul>
<li>Evite de créer des variables qui entre en conflit avec des variables existantes dans la base</li>
<li>La variable temporaire est conservée en mémoire, mais n’apparait pas dans la base.</li>
<li>Une nouvelle variable est créée lorsque le programme est exécuté à nouveau</li>
<li>syntaxe: <strong><code>tempvar nom_variable</code></strong></li>
<li>Lecture: Stata va créer une variable dont le nom est **_0000#**</li>
<li>Appel de la variable dans le programme: <strong><code>nom_variable</code></strong></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true"></a>tempvar qprice</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true"></a>local varlist price mpg <span class="st">`</span><span class="dt">qprice&#39;</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true"></a><span class="dt">tokenize </span><span class="st">`</span>varlist<span class="st">&#39;</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true"></a><span class="st">xtile `qprice&#39;</span> =<span class="st"> `</span><span class="dt">1&#39;, n(4)</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true"></a><span class="dt">local i=1</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true"></a><span class="dt">foreach v of loc varlist {</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true"></a><span class="dt">qui sum </span><span class="st">`</span>v<span class="st">&#39;</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true"></a><span class="st">local  m`i++&#39;</span> <span class="op">:</span><span class="st"> </span>di %<span class="fl">6.2</span>f <span class="st">`</span><span class="dt">r(mean)&#39;</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true"></a><span class="dt">tw scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==1, mlc(black) mlw(vthin) mc(%70) msiz(medlarge) ///</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true"></a><span class="dt">|| scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==2, mlc(black) mlw(vthin) mc(%70) msiz(medlarge) ///</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true"></a><span class="dt">|| scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==3, mlc(black) mlw(vthin) mc(%70) msiz(medlarge) ///</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true"></a><span class="dt">|| scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==4, mlc(black) mlw(vthin) mc(%70) msiz(medlarge) ///</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true"></a><span class="dt">yline(</span><span class="st">`</span>m1<span class="st">&#39;, lw(vthin) lc(black)) xline(`m2&#39;</span>, <span class="kw">lw</span>(vthin) <span class="kw">lc</span>(black)<span class="er">)</span>           <span class="op">/</span><span class="er">//</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true"></a><span class="kw">note</span>(<span class="st">&quot;Moyenne `1&#39; = `m1&#39;&quot;</span> <span class="op">/</span><span class="er">//</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true"></a><span class="st">     &quot;Moyenne `2&#39; = `m2&#39;&quot;</span>  ) <span class="kw">legend</span>(off)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true"></a>describe</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true"></a></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true"></a>                                              (_dta has notes)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true"></a><span class="op">-----------------------------------------------------------------------------------------------------</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true"></a><span class="st">              </span>storage   display    value</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true"></a>variable name   type    format     label      variable label</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true"></a><span class="op">-----------------------------------------------------------------------------------------------------</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true"></a>make            str18   %<span class="op">-</span>18s                 Make and Model</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true"></a>price           int     %<span class="fl">8.0</span>gc                Price</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true"></a>mpg             int     %<span class="fl">8.0</span>g                 <span class="kw">Mileage</span> (mpg)</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true"></a>rep78           int     %<span class="fl">8.0</span>g                 Repair Record <span class="dv">1978</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true"></a>headroom        float   %<span class="fl">6.1</span>f                 <span class="kw">Headroom</span> (in.)</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true"></a>trunk           int     %<span class="fl">8.0</span>g                 Trunk <span class="kw">space</span> (cu. ft.)</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true"></a>weight          int     %<span class="fl">8.0</span>gc                <span class="kw">Weight</span> (lbs.)</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true"></a>length          int     %<span class="fl">8.0</span>g                 <span class="kw">Length</span> (in.)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true"></a>turn            int     %<span class="fl">8.0</span>g                 Turn <span class="kw">Circle</span> (ft.)</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true"></a>displacement    int     %<span class="fl">8.0</span>g                 <span class="kw">Displacement</span> (cu. in.)</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true"></a>gear_ratio      float   %<span class="fl">6.2</span>f                 Gear Ratio</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true"></a>foreign         byte    %<span class="fl">8.0</span>g      origin     Car type</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true"></a>__<span class="dv">000000</span>        byte    %<span class="fl">8.0</span>g                 <span class="dv">4</span> quantiles of price</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true"></a><span class="op">-----------------------------------------------------------------------------------------------------</span></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true"></a></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true"></a>sum __<span class="dv">000000</span></span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true"></a>variable __<span class="dv">000000</span> not found</span></code></pre></div>
<p><img src="imgf/g21_b.PNG" /></p>
<ul>
<li><strong>tempfile</strong>: utile seulement si une base doit être générée, pas d’application trouvée pour le document</li>
</ul>
</div>
</div>
<div id="alleger-la-syntaxe-dun-graphique" class="section level2" number="3.2">
<h2 number="3.2"><span class="header-section-number">3.2</span> Alleger la syntaxe d’un graphique…</h2>
<p>… et surtout faciliter les changements d’options</p>
<p>Mêmes options pour les 4 éléments du graphique</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true"></a>tw scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge)  <span class="op">/</span><span class="er">//</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge)  <span class="op">/</span><span class="er">//</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge)  <span class="op">/</span><span class="er">//</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge)  <span class="op">/</span><span class="er">//</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">5</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true"></a><span class="kw">legend</span>(off)   </span></code></pre></div>
<p><em>Graphique 30</em><br />
<img src="imgf/g22.png" style="width:75.0%" /></p>
<p>Avec les options sous forme de macro</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true"></a>local ops <span class="st">&quot;mlc(black) mlw(vthin) mc(%70) msiz(medlarge)&quot;</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true"></a>tw scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span>, <span class="st">`</span><span class="dt">ops&#39; ///</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true"></a><span class="dt">|| scatter price mpg if rep78==2, </span><span class="st">`</span>ops<span class="st">&#39; ///</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true"></a><span class="st">|| scatter price mpg if rep78==3, `ops&#39;</span> <span class="op">/</span><span class="er">//</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span>, <span class="st">`</span><span class="dt">ops&#39; ///</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true"></a><span class="dt">|| scatter price mpg if rep78==5, </span><span class="st">`</span>ops<span class="st">&#39; ///</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true"></a><span class="st">legend(off)</span></span></code></pre></div>
<p>Si on réduit l’opacicité à 60% et qu’on perturbe légèrement les coordonnées <strong><code>jitter(2)</code></strong></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true"></a>local ops <span class="st">&quot;mlc(black) mlw(vthin) mc(%60) msiz(medlarge) jitter(2)&quot;</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true"></a>tw scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span>, <span class="st">`</span><span class="dt">ops&#39; ///</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true"></a><span class="dt">|| scatter price mpg if rep78==2, </span><span class="st">`</span>ops<span class="st">&#39; ///</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true"></a><span class="st">|| scatter price mpg if rep78==3, `ops&#39;</span> <span class="op">/</span><span class="er">//</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span>, <span class="st">`</span><span class="dt">ops&#39; ///</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true"></a><span class="dt">|| scatter price mpg if rep78==5, </span><span class="st">`</span>ops<span class="st">&#39;  </span></span></code></pre></div>
<p><em>Graphique 31</em><br />
<img src="imgf/g23.png" style="width:75.0%" /></p>
</div>
<div id="macro-élargie" class="section level2" number="3.3">
<h2 number="3.3"><span class="header-section-number">3.3</span> Macro élargie</h2>
<div id="définition-dune-macro-élargie" class="section level3" number="3.3.1">
<h3 number="3.3.1"><span class="header-section-number">3.3.1</span> Définition d’une macro élargie</h3>
<ul>
<li><strong>Macro simple</strong></li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true"></a>local l objetA objetB objetC </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true"></a>foreach i of local l {</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true"></a>local ms <span class="st">`</span><span class="dt">i&#39;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true"></a><span class="dt"> }</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true"></a><span class="dt">objetA</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true"></a><span class="dt">objetB</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true"></a><span class="dt">objetC</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true"></a><span class="dt">* expression de la macro après l&#39;exécution de la boucle</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true"></a><span class="dt">di &quot;</span><span class="st">`</span>ms<span class="st">&#39;&quot;</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true"></a><span class="st">objetC</span></span></code></pre></div>
<ul>
<li><p><strong>Macro élargie</strong></p></li>
<li><p>Conserve l’expression de la macro de la boucle précédente</p></li>
<li><p>Syntaxe:</p></li>
</ul>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true"></a>local nom_macro <span class="st">`</span><span class="dt">nom_macro</span><span class="st">`</span> expression_macro</span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true"></a>local l objetA objetB objetC </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true"></a>foreach i of local l {</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true"></a>local ms <span class="st">`</span><span class="dt">ms&#39; </span><span class="st">`</span>i<span class="st">&#39;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true"></a><span class="st">di &quot;`ms&#39;&quot;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true"></a><span class="st">objetA</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true"></a><span class="st">objetA objetB</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true"></a><span class="st">objetA objetB objetC</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true"></a><span class="st">di &quot;`</span><span class="dt">ms&#39;&quot;</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true"></a><span class="dt">objetA objetB objetC</span></span></code></pre></div>
<ul>
<li>Boucle 1: (macro boucle 1)</li>
<li>Boucle 2: (macro boucle 1) + (macro boucle 2)</li>
<li>Boucle 3: (macro boucle 1) + (macro boucle 2) + (macro boucle 3)</li>
<li>etc….</li>
</ul>
</div>
<div id="créer-un-graphique-avec-une-macro-élargie" class="section level3" number="3.3.2">
<h3 number="3.3.2"><span class="header-section-number">3.3.2</span> Créer un graphique avec une macro élargie</h3>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true"></a>levelsof rep78, <span class="kw">local</span>(l)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true"></a>foreach i of local l {</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true"></a>  local scat <span class="st">`</span><span class="dt">scat&#39; scatter price mpg if rep78==</span><span class="st">`</span>i<span class="st">&#39; ||</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true"></a><span class="st">  di &quot;`scat&#39;&quot;</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true"></a><span class="st">  }</span></span></code></pre></div>
<p>Lecture dans l’output:</p>
<p><strong>Boucle 1: rep78=(1)</strong></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true"></a>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span></span></code></pre></div>
<p><strong>Boucle 2: rep78=(1,2)</strong></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true"></a>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span> <span class="op">||</span></span></code></pre></div>
<p><strong>Boucle 3: rep78=(1,2,3)</strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true"></a>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">3</span> <span class="op">||</span></span></code></pre></div>
<p><strong>Boucle 4: rep78=(1,2,3,4)</strong></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true"></a>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">3</span> <span class="op">||</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true"></a>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span> <span class="op">||</span></span></code></pre></div>
<p><strong>Boucle 5: rep78=(1,2,3,4,5)</strong></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true"></a>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">3</span> <span class="op">||</span><span class="st"> </span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true"></a>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">5</span> <span class="op">||</span></span></code></pre></div>
<p>On adonc de générer un graphique dans une boucle. Pour l’exécuter:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true"></a>tw <span class="st">`</span><span class="dt">scat&#39;, legend(off)</span></span></code></pre></div>
</div>
<div id="générer-une-légende-avec-une-macro-élargie" class="section level3" number="3.3.3">
<h3 number="3.3.3"><span class="header-section-number">3.3.3</span> Générer une légende avec une macro élargie</h3>
<p>Utiliser la bonne expression pour les macros simple car les doubles quotes doivent être apparentes dans la définition de la légende</p>
<p><strong>Application 1 </strong></p>
<ul>
<li>on utilise pas les fonction pour générer les labels (cf Application 2)</li>
<li>On génére également le graphique avec une macro élargie comme ci-dessus. La macro de la définition y est associée</li>
</ul>
<p><strong>On génère la légende avec une macro élargie</strong></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true"></a>sysuse auto</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true"></a>local l1 <span class="st">`</span><span class="dt">&quot;&quot;Domestic&quot;&quot;&#39;</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true"></a><span class="dt">local l2 </span><span class="st">`&quot;&quot;</span>Foreign<span class="st">&quot;&quot;&#39;</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true"></a><span class="st">forvalue i=1(1)2 {</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true"></a><span class="st">local ord `ord&#39;</span> <span class="st">`</span><span class="dt">i&#39; </span><span class="st">`</span>l<span class="st">`</span><span class="dt">i&#39;&#39; </span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true"></a></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true"></a><span class="dt">macro list _ord</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true"></a></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true"></a><span class="dt">_ord:  1 &quot;Domestic&quot; 2 &quot;Foreign&quot;</span></span></code></pre></div>
<p><strong>On génère les éléments du graphique avec une macro élargie</strong></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true"></a>levelsof foreign, <span class="kw">local</span>(l)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true"></a>local ops <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true"></a>foreach i of local l {</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true"></a>local scat <span class="st">`</span><span class="dt">scat&#39; scatter price mpg if foreign==</span><span class="st">`</span>i<span class="st">&#39;, `ops&#39;</span> <span class="op">||</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true"></a>}</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true"></a>macro list _scat</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true"></a>_scat<span class="op">:</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="op">||</span></span></code></pre></div>
<p><strong>On génère le graphique avec la légende</strong></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true"></a>tw <span class="st">`</span><span class="dt">scat&#39;, legend(order(</span><span class="st">`</span>ord<span class="st">&#39;))</span></span></code></pre></div>
<p><strong>Application 2 </strong></p>
<ul>
<li>Même graphique mais on va automatiser sa création avec:
<ul>
<li>des tokens pour les variables</li>
<li>les fonctions associées aux macros pour récurérer les labels automatiquement (voir plus haut)
<ul>
<li>Fonction <strong><code>value label</code></strong> ^pour récupérer le nom du label</li>
<li>Fonction <strong><code>label</code></strong> dans une boucle pour récupérér les libellés</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true"></a>local varlist price weight foreign</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true"></a>tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true"></a><span class="dt">* Légende</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true"></a><span class="dt">local labn: value label </span><span class="st">`</span><span class="dv">3</span><span class="st">&#39;</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true"></a><span class="st">levelsof `3&#39;</span>, <span class="kw">local</span>(l)</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true"></a>foreach l2 of local l {</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true"></a>local lab<span class="st">`</span><span class="dt">l2&#39;: label </span><span class="st">`</span>labn<span class="st">&#39;  `l2&#39;</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true"></a>local lab<span class="st">`</span><span class="dt">l2&#39; </span><span class="st">`&quot;&quot;`</span><span class="dt">lab</span><span class="st">`</span>l2<span class="st">&#39;&#39;&quot;&quot;&#39; </span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true"></a><span class="st">local ord `ord&#39;</span> <span class="st">`</span><span class="dt">i++&#39; </span><span class="st">`</span>lab<span class="st">`</span><span class="dt">l2&#39;&#39; </span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true"></a></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true"></a><span class="dt">* Graphique</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true"></a><span class="dt">local ops mlc(black) mlw(vthin)</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true"></a><span class="dt">foreach i of local l {</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true"></a><span class="dt">local scat </span><span class="st">`</span>scat<span class="st">&#39; scatter `1&#39;</span> <span class="st">`</span><span class="dt">2&#39; if </span><span class="st">`</span><span class="dv">3</span><span class="st">&#39;==`i&#39;</span>, <span class="st">`</span><span class="dt">ops&#39; ||</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true"></a><span class="dt">macro list _scat</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true"></a></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true"></a><span class="dt">tw </span><span class="st">`</span>scat<span class="st">&#39;, legend(order(`ord&#39;</span><span class="er">))</span>  </span></code></pre></div>
<p>Ci-dessous une transformation très simple en routine, appelée <strong><code>sgraph</code></strong> [syntaxe: <strong><code>sgraph varlist</code></strong> ]</p>
</div>
</div>
<div id="routine---commande" class="section level2" number="3.4">
<h2 number="3.4"><span class="header-section-number">3.4</span> Routine - Commande</h2>
<p><strong>Aide Stata</strong></p>
<ul>
<li><p>Manuel Stata <em>programming</em>: <a href="https://www.stata.com/manuals/p.pdf#ppProgramming" class="uri">https://www.stata.com/manuals/p.pdf#ppProgramming</a> [entrée <strong>syntax</strong>]</p></li>
<li><p>principe des programmes qui exécutent des commande (<strong>.ado</strong>)</p></li>
<li><p>la routine peut être programmée dans le programme principe (<strong>.do) ou enregistré comme </strong>.ado** dans le répertoire où sont enregistré les commandes externes (répertoire <em>ado</em>). Il est conseillé de les enregistrer dans un sous répertoire appelé <em>personal</em></p></li>
<li><p>Syntaxe:</p>
<ul>
<li>Si la routine est programmée dans le .do:</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true"></a>capture program drop nom_routine</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true"></a>program define nom_routine [options]</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true"></a>syntax [arguments]</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true"></a>....programme de la routine...</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true"></a>end</span></code></pre></div>
<ul>
<li>Si la routine est enregistrée, la première ligne n’est pas pas obligatoire</li>
</ul>
<p>Exemple simple: une soustraction</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true"></a>capture program drop soustraction </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true"></a>program define soustraction</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true"></a>syntax anything</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true"></a>tokenize <span class="st">`</span><span class="dt">anything&#39;</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true"></a><span class="dt">di &quot;&quot;</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true"></a><span class="dt">di as result &quot;Le résultat de ma soustraction est: &quot;  </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; - `2&#39;</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true"></a>end</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true"></a>soustraction <span class="dv">1245</span> <span class="dv">722</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true"></a><span class="dv">523</span></span></code></pre></div>
<p>Exemple “simple” pour un graphique</p>
<ul>
<li>On reprend le programme précédent (macro élargie et légendes), avec quelques options modifiées (une ligne pour la légende, perturvation des coordonnées (<code>jitter(#)</code>), couleur de la bulle)</li>
<li>On fixe les arguments de la commande: <code>varlist(min=3 max=3)</code></li>
</ul>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true"></a>capture program drop sgraph </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true"></a>program define sgraph</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true"></a>syntax <span class="kw">varlist</span>(<span class="dt">min=</span><span class="dv">3</span> <span class="dt">max=</span><span class="dv">3</span>),  [<span class="kw">title</span>(string)] [<span class="kw">palette</span>(string)] [<span class="kw">gops</span>(string)]</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>installation de colorpalette et grstyle si nécessaire (rarement fait dans les ado <span class="dt">externe =</span><span class="op">&gt;</span><span class="st"> </span>installation automatique des dépendances)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true"></a>local packg colorpalette grstyle</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true"></a>foreach p of local packg {</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true"></a>capture which <span class="st">`</span><span class="dt">p&#39;</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true"></a><span class="dt">if _rc==111 ssc install </span><span class="st">`</span>p<span class="st">&#39;</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true"></a><span class="st">} </span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true"></a><span class="st">tokenize `varlist&#39;</span></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>légendes</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true"></a>qui levelsof region2, <span class="kw">local</span>(l)</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true"></a>local n<span class="op">:</span><span class="st"> </span>word <span class="kw">count</span>(<span class="st">`</span><span class="dt">l&#39;)</span></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true"></a><span class="dt">local i=1</span></span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true"></a><span class="dt">local labn: value label </span><span class="st">`</span><span class="dv">3</span><span class="st">&#39;</span></span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true"></a><span class="st">foreach l2 of local l {</span></span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true"></a><span class="st">local lab`l2&#39;</span><span class="op">:</span><span class="st"> </span>label <span class="st">`</span><span class="dt">labn&#39;  </span><span class="st">`</span>l2<span class="st">&#39;</span></span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true"></a><span class="st">local lab`l2&#39;</span> <span class="st">`</span><span class="dt">&quot;&quot;</span><span class="st">`</span>lab<span class="st">`</span><span class="dt">l2&#39;&#39;&quot;&quot;&#39; </span></span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true"></a><span class="dt">local ord </span><span class="st">`</span>ord<span class="st">&#39; `i++&#39;</span> <span class="st">`</span><span class="dt">lab</span><span class="st">`</span>l2<span class="st">&#39;&#39;</span> </span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true"></a></span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true"></a>grstyle init</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true"></a>grstyle set mesh, compact</span>
<span id="cb73-28"><a href="#cb73-28" aria-hidden="true"></a></span>
<span id="cb73-29"><a href="#cb73-29" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Option palette</span>
<span id="cb73-30"><a href="#cb73-30" aria-hidden="true"></a><span class="cf">if</span> <span class="st">&quot;`palette&#39;&quot;</span><span class="op">==</span><span class="st">&quot;&quot;</span> {</span>
<span id="cb73-31"><a href="#cb73-31" aria-hidden="true"></a>colorpalette viridis, <span class="kw">n</span>(<span class="st">`</span><span class="dt">n&#39;) opacity(70) nograph</span></span>
<span id="cb73-32"><a href="#cb73-32" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb73-33"><a href="#cb73-33" aria-hidden="true"></a></span>
<span id="cb73-34"><a href="#cb73-34" aria-hidden="true"></a><span class="dt">if &quot;</span><span class="st">`</span>palette<span class="st">&#39;&quot;!=&quot;&quot; {</span></span>
<span id="cb73-35"><a href="#cb73-35" aria-hidden="true"></a><span class="st">colorpalette `palette&#39;</span>, <span class="kw">n</span>(<span class="st">`</span><span class="dt">n&#39;) opacity(70) nograph</span></span>
<span id="cb73-36"><a href="#cb73-36" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb73-37"><a href="#cb73-37" aria-hidden="true"></a></span>
<span id="cb73-38"><a href="#cb73-38" aria-hidden="true"></a><span class="dt">forv  i=1/</span><span class="st">`</span>n<span class="st">&#39; {</span></span>
<span id="cb73-39"><a href="#cb73-39" aria-hidden="true"></a><span class="st">local ops mlc(black) mlw(vthin) jitter(3) mc(%80) msiz(medsmall) mlc(`mlc&#39;</span>) <span class="kw">mc</span>(<span class="st">&quot;`r(p`i&#39;)&#39;&quot;</span>)</span>
<span id="cb73-40"><a href="#cb73-40" aria-hidden="true"></a>local scat <span class="st">`</span><span class="dt">scat&#39; scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==</span><span class="st">`</span>i<span class="st">&#39;, `ops&#39;</span> <span class="op">||</span></span>
<span id="cb73-41"><a href="#cb73-41" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb73-42"><a href="#cb73-42" aria-hidden="true"></a></span>
<span id="cb73-43"><a href="#cb73-43" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Graphique selon modification ou non des options générales</span>
<span id="cb73-44"><a href="#cb73-44" aria-hidden="true"></a><span class="cf">if</span> <span class="st">&quot;`gops&#39;&quot;</span><span class="op">==</span><span class="st">&quot;&quot;</span>{</span>
<span id="cb73-45"><a href="#cb73-45" aria-hidden="true"></a>tw <span class="st">`</span><span class="dt">scat&#39;, legend(order(</span><span class="st">`</span>ord<span class="st">&#39;) rows(1) pos(7)) title(&quot;`title&#39;&quot;, pos(11))</span></span>
<span id="cb73-46"><a href="#cb73-46" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb73-47"><a href="#cb73-47" aria-hidden="true"></a><span class="st">if &quot;`</span><span class="dt">gops&#39;&quot;!=&quot;&quot;{</span></span>
<span id="cb73-48"><a href="#cb73-48" aria-hidden="true"></a><span class="dt">tw </span><span class="st">`</span>scat<span class="st">&#39;, legend(order(`ord&#39;</span><span class="er">)</span> <span class="kw">rows</span>(<span class="dv">1</span>) <span class="kw">pos</span>(<span class="dv">7</span>)<span class="er">)</span> <span class="kw">title</span>(<span class="st">&quot;`title&#39;&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>)) <span class="st">`</span><span class="dt">gops&#39;</span></span>
<span id="cb73-49"><a href="#cb73-49" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb73-50"><a href="#cb73-50" aria-hidden="true"></a><span class="dt">end</span></span></code></pre></div>
<p>On exécute la commande <strong><code>sgraph</code></strong></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true"></a>sysuse auto, clear</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true"></a>sgraph price mpg foreign</span></code></pre></div>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true"></a>sysuse citytemp4.dta, clear</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true"></a>replace tempjan =<span class="st">   </span>(tempjan <span class="op">-</span><span class="st"> </span><span class="dv">32</span> )<span class="op">*</span><span class="dv">5</span><span class="op">/</span><span class="dv">9</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true"></a>replace tempjuly  =<span class="st"> </span>(tempjuly <span class="op">-</span><span class="st"> </span><span class="dv">32</span> )<span class="op">*</span><span class="dv">5</span><span class="op">/</span><span class="dv">9</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true"></a>gen     region2 =<span class="st"> </span>region</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true"></a>recode <span class="kw">region2</span> (<span class="dv">1</span>=<span class="dv">4</span>) (<span class="dv">4</span>=<span class="dv">1</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true"></a>label define r <span class="dv">1</span> <span class="st">&quot;West&quot;</span> <span class="dv">2</span> <span class="st">&quot;North-Central&quot;</span> <span class="dv">3</span> <span class="st">&quot;South&quot;</span> <span class="dv">4</span> <span class="st">&quot;North-East&quot;</span>, modify</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true"></a>label value region2 r</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true"></a></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true"></a>sgraph tempjuly tempjan region2, <span class="kw">mlc</span>(black) <span class="kw">title</span>(<span class="st">&quot;Températures moyennes [sans l&#39;option palette()]&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true"></a><span class="kw">gops</span>(<span class="kw">ytitle</span>(<span class="st">&quot;Juillet&quot;</span>) <span class="kw">xtitle</span>(<span class="st">&quot;Janvier&quot;</span>))</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true"></a></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true"></a>sgraph tempjuly tempjan region2, <span class="kw">mlc</span>(black) <span class="kw">title</span>(<span class="st">&quot;Températures moyennes [avec l&#39;option palette(magma)]&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true"></a><span class="kw">gops</span>(<span class="kw">ytitle</span>(<span class="st">&quot;Juillet&quot;</span>) <span class="kw">xtitle</span>(<span class="st">&quot;Janvier&quot;</span>))</span></code></pre></div>
<p><em>Graphique 32</em><br />
<img src="imgf/g27.png" style="width:75.0%" /></p>
</div>
<div id="un-festival-de-macros" class="section level2" number="3.5">
<h2 number="3.5"><span class="header-section-number">3.5</span> Un festival de macros</h2>
<p><strong>La macro dans (presque) tous ses états</strong><br />
<br> Presque car:</p>
<ul>
<li>Pas de variable temporaire (oblige ici à dropper des variables en fin de programme)</li>
<li>Pas de macro avec une expression étendue (inutile ici)</li>
</ul>
<p><strong>Graphique généré</strong></p>
<ul>
<li>Graphique de type <strong>violon</strong> (variable continue). Sans la boxplot, ce type de graphique est appelé <strong>bean plot</strong></li>
<li>Compare la distribution d’une variable variable pour deux modalités d’une variable catégorielle)</li>
</ul>
<p><strong>Principales étapes</strong></p>
<ul>
<li>Paramètres du graphique sous forme de macro (<code>local</code>)</li>
<li>Estimation de la densité avec création des variables associées</li>
<li>Récupération des valeurs pour les boxplots (Q1 - Q2 - Q3)</li>
<li>Légende</li>
<li>Style et couleur (anticipe un peu une partie suivante)</li>
<li>Graphique
<ul>
<li>type <strong><code>area</code></strong> pour les densites</li>
<li>type <strong><code>pci</code></strong> pour les boxplot</li>
<li>type <strong><code>scatter</code></strong> pour les outliers des boxplots</li>
</ul></li>
</ul>
<p>On compare la pression sanguine des hommes et des femmes (base <em>nhanes2.dta</em>): variables <em>bpsystol</em> et <em>sex</em>:</p>
<p><em>Graphique 33</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true"></a>webuse nhanes2, clear</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>définition des variables et des options pour density dans une macro</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true"></a>local y bpsystol</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true"></a>local z sex</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true"></a>local bw <span class="dv">5</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true"></a>local ker gau</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Création des variables pour la densité et normalisation des échelles</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true"></a>levelsof <span class="st">`</span><span class="dt">z&#39;, local(l)</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true"></a><span class="dt">local i=1</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true"></a><span class="dt">foreach s of local l {</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true"></a><span class="dt">local j </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true"></a><span class="st">qui kdensity `y&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">z&#39;==</span><span class="st">`</span>s<span class="st">&#39;, gen(x`j&#39;</span> d<span class="st">`</span><span class="dt">j&#39;) nograph  kernel(</span><span class="st">`</span>kernel<span class="st">&#39;) bw(`bw&#39;</span><span class="er">)</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true"></a>qui sum d<span class="st">`</span><span class="dt">j&#39;, d</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true"></a><span class="dt">local min</span><span class="st">`</span>j<span class="st">&#39;  `r(min)&#39;</span></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true"></a>local max<span class="st">`</span><span class="dt">j&#39;  </span><span class="st">`</span><span class="kw">r</span>(max)<span class="st">&#39;</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true"></a><span class="st">qui replace d`j&#39;</span>  =<span class="st"> </span>d<span class="st">`</span><span class="dt">j&#39;*(.3/(</span><span class="st">`</span>max<span class="st">`</span><span class="dt">j&#39;&#39;- </span><span class="st">`</span>min<span class="st">`</span><span class="dt">j&#39;&#39;))</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true"></a></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true"></a></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true"></a><span class="dt">* variable miroir pour la densité dans l&#39;axe négatif</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true"></a><span class="dt">replace d1=-d1</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true"></a></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true"></a><span class="dt">* translation de la densité avec valeur min à 0</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true"></a><span class="dt">local i=1</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true"></a><span class="dt">foreach s of local l {</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true"></a><span class="dt">local j </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true"></a><span class="st">qui sum d`j&#39;</span>, d</span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true"></a>local min<span class="st">`</span><span class="dt">j&#39;   </span><span class="st">`</span><span class="kw">r</span>(min)<span class="st">&#39;</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true"></a><span class="st">local max`j&#39;</span>   <span class="st">`</span><span class="dt">r(max)&#39;</span></span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true"></a><span class="dt">qui replace d1 = d1 + (-1)*</span><span class="st">`</span>max1<span class="st">&#39;</span></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true"></a><span class="st">qui replace d2 = d2 - `min2&#39;</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true"></a></span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true"></a></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true"></a><span class="op">**</span><span class="er">****</span><span class="st"> </span>valeurs pour boxplot</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true"></a></span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true"></a><span class="op">**</span><span class="st"> </span>coordonnées<span class="op">:</span><span class="st"> </span>q25<span class="op">/</span><span class="dv">50</span><span class="op">/</span><span class="dv">75</span> et bornes inf et sup des moustaches</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true"></a>foreach s of local l {</span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true"></a>local j <span class="st">`</span><span class="dt">i++&#39;</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true"></a><span class="dt">qui sum </span><span class="st">`</span>y<span class="st">&#39; if `z&#39;</span><span class="op">==</span><span class="st">`</span><span class="dt">s&#39;, d</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true"></a><span class="dt">local q2</span><span class="st">`</span>j<span class="st">&#39;: di %6.1f  `r(p50)&#39;</span></span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true"></a>local q1<span class="st">`</span><span class="dt">j&#39; : di %6.1f  </span><span class="st">`</span><span class="kw">r</span>(p25)<span class="st">&#39;</span></span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true"></a><span class="st">local q3`j&#39;</span> <span class="op">:</span><span class="st"> </span>di %<span class="fl">6.1</span>f  <span class="st">`</span><span class="dt">r(p75)&#39;</span></span>
<span id="cb76-47"><a href="#cb76-47" aria-hidden="true"></a><span class="dt">scalar min = </span><span class="st">`</span>q1<span class="st">`</span><span class="dt">j&#39;&#39; - 1.5*(</span><span class="st">`</span>q3<span class="st">`</span><span class="dt">j&#39;&#39; - </span><span class="st">`</span>q1<span class="st">`</span><span class="dt">j&#39;&#39;)</span></span>
<span id="cb76-48"><a href="#cb76-48" aria-hidden="true"></a><span class="dt">local  inf</span><span class="st">`</span>j<span class="st">&#39; = scalar(min)</span></span>
<span id="cb76-49"><a href="#cb76-49" aria-hidden="true"></a><span class="st">scalar max = `q3`j&#39;&#39; + 1.5*(`q3`j&#39;&#39; - `q1`j&#39;&#39;) </span></span>
<span id="cb76-50"><a href="#cb76-50" aria-hidden="true"></a><span class="st">local  sup`j&#39;</span> =<span class="st"> </span><span class="kw">scalar</span>(max)</span>
<span id="cb76-51"><a href="#cb76-51" aria-hidden="true"></a>}</span>
<span id="cb76-52"><a href="#cb76-52" aria-hidden="true"></a></span>
<span id="cb76-53"><a href="#cb76-53" aria-hidden="true"></a><span class="op">**</span><span class="st"> </span>outliers</span>
<span id="cb76-54"><a href="#cb76-54" aria-hidden="true"></a>qui gen _yo1 =<span class="st"> </span><span class="fl">-.02</span></span>
<span id="cb76-55"><a href="#cb76-55" aria-hidden="true"></a>qui gen _yo2 =<span class="st">  </span><span class="fl">.02</span> </span>
<span id="cb76-56"><a href="#cb76-56" aria-hidden="true"></a></span>
<span id="cb76-57"><a href="#cb76-57" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb76-58"><a href="#cb76-58" aria-hidden="true"></a>foreach s of local l {</span>
<span id="cb76-59"><a href="#cb76-59" aria-hidden="true"></a>local j <span class="st">`</span><span class="dt">i++&#39;</span></span>
<span id="cb76-60"><a href="#cb76-60" aria-hidden="true"></a><span class="dt">qui gen _out</span><span class="st">`</span>j<span class="st">&#39;= `y&#39;</span> <span class="cf">if</span>  (<span class="st">`</span><span class="dt">y&#39;&gt;</span><span class="st">`</span>sup<span class="st">`</span><span class="dt">j&#39;&#39; | </span><span class="st">`</span>y<span class="st">&#39;&lt;`inf`j&#39;&#39;) &amp; `z&#39;</span><span class="op">==</span><span class="st">`</span><span class="dt">s&#39;</span></span>
<span id="cb76-61"><a href="#cb76-61" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb76-62"><a href="#cb76-62" aria-hidden="true"></a></span>
<span id="cb76-63"><a href="#cb76-63" aria-hidden="true"></a><span class="dt">* Génération automatique de la légende (fixe à 2 labels)</span></span>
<span id="cb76-64"><a href="#cb76-64" aria-hidden="true"></a><span class="dt">* legend: order(...)</span></span>
<span id="cb76-65"><a href="#cb76-65" aria-hidden="true"></a><span class="dt">local labn: value label </span><span class="st">`</span>z<span class="st">&#39;</span></span>
<span id="cb76-66"><a href="#cb76-66" aria-hidden="true"></a><span class="st">local i=1</span></span>
<span id="cb76-67"><a href="#cb76-67" aria-hidden="true"></a><span class="st">foreach s of local l {</span></span>
<span id="cb76-68"><a href="#cb76-68" aria-hidden="true"></a><span class="st">local j `i++&#39;</span></span>
<span id="cb76-69"><a href="#cb76-69" aria-hidden="true"></a>capture local lab<span class="st">`</span><span class="dt">j&#39;: label </span><span class="st">`</span>labn<span class="st">&#39;  `s&#39;</span></span>
<span id="cb76-70"><a href="#cb76-70" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb76-71"><a href="#cb76-71" aria-hidden="true"></a></span>
<span id="cb76-72"><a href="#cb76-72" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>On anticipe un peu avec la section suivante pour style et couleur</span>
<span id="cb76-73"><a href="#cb76-73" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>installer grstyle et colorpalette si nécessaire</span>
<span id="cb76-74"><a href="#cb76-74" aria-hidden="true"></a>grstyle init</span>
<span id="cb76-75"><a href="#cb76-75" aria-hidden="true"></a>grstyle set plain, horizontal grid compact</span>
<span id="cb76-76"><a href="#cb76-76" aria-hidden="true"></a>grstyle set mesh,  horizontal</span>
<span id="cb76-77"><a href="#cb76-77" aria-hidden="true"></a>grstyle set color viridis,  <span class="kw">select</span>(<span class="dv">3</span> <span class="dv">13</span>)  </span>
<span id="cb76-78"><a href="#cb76-78" aria-hidden="true"></a>colorpalette      viridis , <span class="kw">select</span>(<span class="dv">3</span> <span class="dv">13</span> nograph</span>
<span id="cb76-79"><a href="#cb76-79" aria-hidden="true"></a></span>
<span id="cb76-80"><a href="#cb76-80" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>création du graphique</span>
<span id="cb76-81"><a href="#cb76-81" aria-hidden="true"></a>tw area d1 x1,   horizontal        <span class="kw">fc</span>(%<span class="dv">60</span>)  <span class="kw">lc</span>(<span class="op">*</span><span class="fl">0.5</span>) <span class="kw">lw</span>(thin)                       <span class="op">/</span><span class="er">//</span></span>
<span id="cb76-82"><a href="#cb76-82" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>area d2 x2,   horizontal        <span class="kw">fc</span>(%<span class="dv">60</span>)  <span class="kw">lc</span>(<span class="op">*</span><span class="fl">0.5</span>) <span class="kw">lw</span>(thin)                       <span class="op">/</span><span class="er">//</span></span>
<span id="cb76-83"><a href="#cb76-83" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q11&#39;  -.04  </span><span class="st">`</span>q11<span class="st">&#39;     0,      lc(&quot;`r(p1)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                  ///</span></span>
<span id="cb76-84"><a href="#cb76-84" aria-hidden="true"></a><span class="st">|| pci  `q21&#39;  -.04  `q21&#39;     0,      lc(&quot;`</span><span class="dt">r(p1)&#39;*1.3&quot;) lw(vthin)                  ///</span></span>
<span id="cb76-85"><a href="#cb76-85" aria-hidden="true"></a><span class="dt">|| pci  </span><span class="st">`</span>q31<span class="st">&#39;  -.04  `q31&#39;</span>     <span class="dv">0</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p1)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                  <span class="op">/</span><span class="er">//</span><span class="st">     </span></span>
<span id="cb76-86"><a href="#cb76-86" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q11&#39;  -.04  </span><span class="st">`</span>q31<span class="st">&#39;  -.04,      lc(&quot;`r(p1)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                  ///</span></span>
<span id="cb76-87"><a href="#cb76-87" aria-hidden="true"></a><span class="st">|| pci  `q11&#39;  -.0003 `q31&#39;  -.0003,   lc(&quot;`</span><span class="dt">r(p1)&#39;*1.3&quot;) lw(vthin)                  ///</span></span>
<span id="cb76-88"><a href="#cb76-88" aria-hidden="true"></a><span class="dt">|| pci  </span><span class="st">`</span>inf1<span class="st">&#39; -.02  `q11&#39;</span>  <span class="fl">-.02</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p1)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                  <span class="op">/</span><span class="er">//</span><span class="st"> </span></span>
<span id="cb76-89"><a href="#cb76-89" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q31&#39;  -.02  </span><span class="st">`</span>sup1<span class="st">&#39; -.02,      lc(&quot;`r(p1)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                  /// </span></span>
<span id="cb76-90"><a href="#cb76-90" aria-hidden="true"></a><span class="st">|| scatter _out1 _yo1, msize(vsmall) mlc(black) mlw(vvthin) mc(&quot;`</span><span class="dt">r(p1)&#39;&quot;) jitter(1) /// </span></span>
<span id="cb76-91"><a href="#cb76-91" aria-hidden="true"></a><span class="dt">|| pci  </span><span class="st">`</span>q12<span class="st">&#39;   .04  `q12&#39;</span>    <span class="dv">0</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p2)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                   <span class="op">/</span><span class="er">//</span></span>
<span id="cb76-92"><a href="#cb76-92" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q22&#39;   .04  </span><span class="st">`</span>q22<span class="st">&#39;    0,      lc(&quot;`r(p2)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                   ///</span></span>
<span id="cb76-93"><a href="#cb76-93" aria-hidden="true"></a><span class="st">|| pci  `q32&#39;   .04  `q32&#39;    0,      lc(&quot;`</span><span class="dt">r(p2)&#39;*1.3&quot;) lw(vthin)                   ///                         </span></span>
<span id="cb76-94"><a href="#cb76-94" aria-hidden="true"></a><span class="dt">|| pci  </span><span class="st">`</span>q12<span class="st">&#39;   .04  `q32&#39;</span>  <span class="fl">.04</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p2)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                   <span class="op">/</span><span class="er">//</span></span>
<span id="cb76-95"><a href="#cb76-95" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q12&#39;   .0003 </span><span class="st">`</span>q32<span class="st">&#39; .0003,    lc(&quot;`r(p2)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                   /// </span></span>
<span id="cb76-96"><a href="#cb76-96" aria-hidden="true"></a><span class="st">|| pci  `inf2&#39;  .02  `q12&#39;  .02,      lc(&quot;`</span><span class="dt">r(p2)&#39;*1.3&quot;) lw(vthin)                   /// </span></span>
<span id="cb76-97"><a href="#cb76-97" aria-hidden="true"></a><span class="dt">|| pci  </span><span class="st">`</span>q32<span class="st">&#39;   .02  `sup2&#39;</span> <span class="fl">.02</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p2)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                   <span class="op">/</span><span class="er">//</span><span class="st"> </span></span>
<span id="cb76-98"><a href="#cb76-98" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter _out2 _yo2, <span class="kw">msize</span>(vsmall) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vvthin) <span class="kw">mc</span>(<span class="st">&quot;`r(p2)&#39;&quot;</span>) <span class="kw">jitter</span>(<span class="dv">1</span>) <span class="op">/</span><span class="er">//</span><span class="st"> </span></span>
<span id="cb76-99"><a href="#cb76-99" aria-hidden="true"></a>, <span class="kw">ytitle</span>(<span class="st">&quot;`y&#39;&quot;</span>) <span class="kw">xlab</span>(<span class="dv">0</span> <span class="st">&quot;0&quot;</span>)  <span class="kw">xtitle</span>(<span class="st">&quot;Densité&quot;</span>, <span class="kw">size</span>(small))                         <span class="op">/</span><span class="er">//</span></span>
<span id="cb76-100"><a href="#cb76-100" aria-hidden="true"></a><span class="st">  </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;`lab1&#39;&quot;</span>  <span class="dv">2</span> <span class="st">&quot;`lab2&#39;&quot;</span>) stack <span class="kw">region</span>(<span class="kw">lw</span>(vvthin) <span class="kw">lc</span>(%<span class="dv">0</span>)))          </span>
<span id="cb76-101"><a href="#cb76-101" aria-hidden="true"></a></span>
<span id="cb76-102"><a href="#cb76-102" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>à défaut d<span class="st">&#39;avoir généré des variables temporaire</span></span>
<span id="cb76-103"><a href="#cb76-103" aria-hidden="true"></a><span class="st">drop d1 d2 x1 x2 _y*  _out*</span></span></code></pre></div>
</details>
<p><img src="imgf/g24.png" style="width:75.0%" /></p>
</div>
</div>
<div id="palettes-de-couleurs-thèmes" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Palettes de couleurs &amp; thèmes</h1>
<ul>
<li>Les graphiques lorsqu’ils sont générés appliquent un thème/style par défaut:
<ul>
<li>Ces thèmes sont appelés <strong>scheme</strong></li>
<li>Les options entrées dans la commande graphique visent à modifier les paramètres du thème</li>
<li>Les paramètres du style thèmes appliquées aux couleurs, tailles/épaisseurs, positions des éléments de texte, définitions des axes….</li>
<li>Stata dispose de 5 thèmes officiels</li>
<li>Des thèmes externes peuvent être installés</li>
</ul></li>
<li>Les thèmes graphiques utilisent des palettes de couleurs
<ul>
<li>Trois types de palettes:
<ul>
<li>Palettes qualitatives</li>
<li>Palettes séquentielles</li>
<li>Palettes divergentes</li>
</ul></li>
</ul></li>
<li>Des commandes externes permettent d’augmenter le nombre de palettes, de les modifier ou d’en créer
<ul>
<li>Pour la cartographie, la commande <strong><code>spmap</code></strong> (<em>Pisatti</em>) intégre une quarantaine de palettes, principalement séquentielles</li>
<li>La librairie <strong><code>brewscheme</code></strong> (<em>W.Buchanan</em>) dispose de plusieurs commande pour générer des palettes de couleurs.</li>
<li>La commande <strong><code>colorpalette</code></strong> (B.Jann) charge plusieurs dizaine de palettes de couleurs, de tout type, et permet de les modifier et permet de les utiliser très facilement dans la création de graphique. Adopté!</li>
</ul></li>
</ul>
<div id="les-palettes-de-couleurs-stata" class="section level2" number="4.1">
<h2 number="4.1"><span class="header-section-number">4.1</span> Les Palettes de couleurs Stata</h2>
<p>Résumé de la page: <a href="https://mthevenin.github.io/stata_fr/couleurs.html" class="uri">https://mthevenin.github.io/stata_fr/couleurs.html</a></p>
<div id="les-palettes-stata" class="section level3" number="4.1.1">
<h3 number="4.1.1"><span class="header-section-number">4.1.1</span> Les palettes Stata</h3>
<p>Stata dispose de 5 palettes de couleurs qui sont associées à des thèmes graphiques: la palette <strong>s2</strong> est associée au thème <strong>s2color</strong> par exemple</p>
<p><img src="imgc/g15.png" style="width:50.0%" /></p>
<ul>
<li>Les palettes sont de type qualitative
<ul>
<li>Remarque On peut les utiliser de manière séquentielle en sélectionnant une couleur et en baissant ou en augmentant l’intensité <code>(couleur*#)</code></li>
<li>la palette mono peut(être partiellement utilisée de manière séquentielle: ordre des couleurs 7 à 11 par exemple)</li>
</ul></li>
<li>Elles sont composées de 15 couleurs</li>
<li>Toutes les couleurs ont un nom et un code RGB qui lui est associé</li>
<li>Dans un graphique, les couleurs utilisées par défaut suivent leur ordre dans la palette</li>
</ul>
<p><img src="imgf/g28.png" style="width:50.0%" /></p>
<p><img src="imgf/g29.png" style="width:50.0%" /></p>
<p>Exemple avec la palette S2<br />
<em>Graphique 34</em></p>
<p><img src="imgc/e1.png" style="width:50.0%" /></p>
<p><em>Graphique de gauche n(2) - graphique de droite n(3)</em></p>
<p>On est clairement vite limité par l’utilisation des palettes avec Stata</p>
<p>A mon sens la commande <strong>colorpalette</strong> de <em>Ben Jann</em> permet de démultiplier les possibilités dans l’utilisation des couleurs avec Stata. Un grand merci à lui</p>
</div>
</div>
<div id="colorpalette-de-ben-jann" class="section level2" number="4.2">
<h2 number="4.2"><span class="header-section-number">4.2</span> Colorpalette de Ben Jann</h2>
<div id="syntaxe-et-options" class="section level3" number="4.2.1">
<h3 number="4.2.1"><span class="header-section-number">4.2.1</span> Syntaxe et options</h3>
<p><strong>Installation `colorpalette</strong></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true"></a>    ssc install palettes,  replace</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true"></a>    ssc install colrspace, replace</span></code></pre></div>
<p><strong>syntaxe</strong>: <strong>colorpalette nom_palette [, nom_sous_palette options]</strong></p>
<p>Exemple</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Charge et affiche la palette hue</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true"></a>  colorpalette hue</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true"></a>  </span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Charge et affiche la palette viridis</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true"></a>  colorpalette viridis</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Charge et affiche la sous palette summer de <span class="kw">matplotlib</span> (palette Python)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true"></a>  colorpalette matplotlib, summer  </span></code></pre></div>
<p><strong>Visualiser des palettes disponibles dans l’aide</strong>: <strong><code>help colorpalette</code></strong></p>
<p><strong>Principales options</strong></p>
<ul>
<li><strong>Modifier la taille de la palette</strong>: <strong><code>n(#)</code></strong>
<ul>
<li>Important car la réduction de la taille pour certaines palette ne consiste pas à prendre les # premiers éléments de la palette par défaut (cf palette <strong>hue</strong> ou <strong>viridis</strong>)</li>
</ul></li>
<li><strong>Modifier l’intensité et l’opacité</strong>: <strong><code>intensity(#)</code></strong> et <strong><code>opacity(#)</code></strong>
<ul>
<li>Remarque: on peut créer une palette avec séquentielle à partir d’une couleur avec <strong><code>intensity</code></strong></li>
</ul></li>
<li><strong>Créer une palette divergente</strong>: ipolate(#)</li>
<li><strong>Sélectionner des couleurs d’une palette</strong>: <strong><code>select(numlist)</code></strong></li>
<li><strong>Inverse les couleurs de la palette</strong>: <strong><code>reverse</code></strong></li>
<li><strong>Ne pas afficher la palette</strong>: <strong><code>nograph</code></strong>. Utile pour charger la palette avant son utilisation dans un graphique</li>
</ul>
<p><strong>Remarque</strong>: la commande identifie également une couleur (par son nom Stata ou son code RGB) comme une palette de couleur</p>
<p>Exemple 1:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true"></a><span class="st">`</span><span class="dt">colorpalette s2, n(5) intensity(.4 1 .4 1 .4) reverse</span></span></code></pre></div>
<p><img src="imgf/g30.png" style="width:50.0%" /></p>
<ul>
<li>On a sélectionné la palette <em>s2</em></li>
<li>On a réduit la taille de la palette à 5 couleurs: <strong><code>n(5)</code></strong></li>
<li>On a alterné les intensités: une sur deux à .5: <strong><code>intensity(.4 1 .4 1 .4)</code></strong></li>
<li>On a inverse l’ordre des couleurs (<em>navy</em> en dernier) <strong><code>reverse</code></strong></li>
</ul>
<p>Exemple 2: création d’une palette séquentielle avec <code>intensity</code> à partir de la couleur stata <em>navy</em></p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true"></a>colorpalette navy, <span class="kw">intensity</span>(<span class="fl">0.1</span>(.<span class="dv">1</span>)<span class="dv">1</span>)</span></code></pre></div>
<p><img src="imgf/g31.png" style="width:50.0%" /></p>
<p>Exemple3 : création d’une palette divergente avec <code>ipolate</code> avec les couleurs <em>navy</em> (couleur de départ) et la couleur <em>cranberry</em> pues (couleur d’arrivée)</p>
<p>3b: sans couleur intermédiaire</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true"></a>colorpalette navy cranberry, <span class="kw">ipolate</span>(<span class="dv">10</span>)</span></code></pre></div>
<p><img src="imgf/g32.png" style="width:50.0%" /></p>
<p>avec une couleur de transition (ici white)</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true"></a>colorpalette navy white cranberry, <span class="kw">ipolate</span>(<span class="dv">10</span>)</span></code></pre></div>
<p><img src="imgf/g33.png" style="width:50.0%" /></p>
</div>
<div id="utilisation-pour-un-graphique" class="section level3" number="4.2.2">
<h3 number="4.2.2"><span class="header-section-number">4.2.2</span> Utilisation pour un graphique</h3>
</div>
<div id="colorpalette-et-graphique" class="section level3" number="4.2.3">
<h3 number="4.2.3"><span class="header-section-number">4.2.3</span> colorpalette et graphique</h3>
<ul>
<li>Utilisation des macros générées par colorpalette
<ul>
<li>la commande génère une liste de macro permettant de récupérer les codes et les noms des couleurs
<ul>
<li>la macro <strong>r(p)</strong> permet d’utiliser les couleurs de la palette dans un graphique à un seul bloc d’élements</li>
<li>les macros <strong>r(p#)</strong> permettent d’utiliser les couleurs dans un graphique composé de plusieurs élements</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true"></a>colorpalette navy cranberry, <span class="kw">ipolate</span>(<span class="dv">5</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true"></a>return list</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true"></a>scalars<span class="op">:</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true"></a><span class="st">                  </span><span class="kw">r</span>(n) =<span class="st">  </span><span class="dv">5</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true"></a></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true"></a>macros<span class="op">:</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true"></a><span class="st">              </span><span class="kw">r</span>(ptype) <span class="op">:</span><span class="st"> &quot;color&quot;</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true"></a>              <span class="kw">r</span>(pname) <span class="op">:</span><span class="st"> &quot;custom&quot;</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true"></a>              <span class="kw">r</span>(pnote) <span class="op">:</span><span class="st"> &quot;interpolated&quot;</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true"></a>                  <span class="kw">r</span>(p) <span class="op">:</span><span class="st"> &quot;&quot;</span><span class="dv">26</span> <span class="dv">71</span> <span class="dv">111</span><span class="st">&quot; &quot;</span><span class="dv">76</span> <span class="dv">73</span> <span class="dv">96</span><span class="st">&quot; &quot;</span><span class="dv">111</span> <span class="dv">71</span> <span class="dv">92</span><span class="st">&quot; &quot;</span><span class="dv">151</span> <span class="dv">58</span> <span class="dv">78</span><span class="st">&quot; &quot;</span><span class="dv">193</span> <span class="dv">5</span> <span class="dv">52</span><span class="st">&quot;&quot;</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true"></a>             <span class="kw">r</span>(p5info) <span class="op">:</span><span class="st"> &quot;Jab 46 36 12&quot;</span></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true"></a>                 <span class="kw">r</span>(p5) <span class="op">:</span><span class="st"> &quot;193 5 52&quot;</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true"></a>             <span class="kw">r</span>(p4info) <span class="op">:</span><span class="st"> &quot;Jab 42 25 5&quot;</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true"></a>                 <span class="kw">r</span>(p4) <span class="op">:</span><span class="st"> &quot;151 58 78&quot;</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true"></a>             <span class="kw">r</span>(p3info) <span class="op">:</span><span class="st"> &quot;Jab 38 14 -3&quot;</span></span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true"></a>                 <span class="kw">r</span>(p3) <span class="op">:</span><span class="st"> &quot;111 71 92&quot;</span></span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true"></a>             <span class="kw">r</span>(p2info) <span class="op">:</span><span class="st"> &quot;Jab 34 2 -11&quot;</span></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true"></a>                 <span class="kw">r</span>(p2) <span class="op">:</span><span class="st"> &quot;76 73 96&quot;</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true"></a>             <span class="kw">r</span>(p1info) <span class="op">:</span><span class="st"> &quot;Jab 30 -9 -19&quot;</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true"></a>                 <span class="kw">r</span>(p1) <span class="op">:</span><span class="st"> &quot;26 71 111&quot;</span></span></code></pre></div>
<p>Exemple</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true"></a>local opw <span class="kw">lw</span>(medthick medthick medthick medthick medthick) </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true"></a>tw line le_w le_wmale le_b le_bmale year, <span class="st">`</span><span class="dt">opw&#39; ///</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true"></a><span class="dt">title(&quot;couleur s2&quot;)  name(g1, replace) nodraw</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true"></a><span class="dt">colorpalette midblue, n(4) intensity(1.25 1 .75 .5)  nograph</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true"></a><span class="dt">local opc lc(</span><span class="st">`</span><span class="kw">r</span>(p)<span class="st">&#39;)</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true"></a><span class="st">tw line le_w le_wmale le_b le_bmale year, `opw&#39;</span> <span class="st">`</span><span class="dt">opc&#39; ///</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true"></a><span class="dt">title(&quot;couleur générée avec colorpalette&quot;) name(g2, replace) nodraw</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true"></a><span class="dt">graph combine g1 g2, iscale(.5)</span></span></code></pre></div>
<p><em>Graphique 35</em></p>
<p><img src="imgf/g42.png" style="width:50.0%" /></p>
<ul>
<li>La syntaxe de <strong>colorpalette</strong> est transposable à la commande <strong>grstyle</strong>. Cela faciletera l’intégration des couleurs dans le graphique.</li>
</ul>
</div>
<div id="exemples-de-palettes" class="section level3" number="4.2.4">
<h3 number="4.2.4"><span class="header-section-number">4.2.4</span> Exemples de palettes</h3>
<div id="qualitatives" class="section level4" number="4.2.4.1">
<h4 number="4.2.4.1"><span class="header-section-number">4.2.4.1</span> Qualitatives</h4>
<p><strong>Palette HUE</strong></p>
<ul>
<li>Il s’agit de la palette par défaut de <strong>ggplot2</strong> (<strong>R</strong>)</li>
<li>De plus en plus remplacée par la palette <em>Viridis</em> (voir plus bas)</li>
</ul>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true"></a>colorpalette hue [,options]</span></code></pre></div>
<p><img src="imgc/g10.png" style="width:50.0%" /></p>
<ul>
<li><p>Elle a plusieurs cycles de couleurs: Un “rouge” =&gt; un “vert =&gt; un”bleu" =&gt; un rose</p></li>
<li><p>Si on utilise donc cette palette à 10 couleurs pour un graphique composée de deux éléments, par exemple deux courbes, le rendu ne sera pas satisfaisant car les deux premières couleurs seront sélectionnées (une couleur plutôt “rouge” et une couleur plutôt"orange. Il convient dont de réduire la taille de la palette (<code>n2</code>)</p></li>
<li><p>Couleurs selon la taille de la palette</p></li>
</ul>
<p><img src="imgc/g13.png" style="width:50.0%" /></p>
<p>Exemple 1<br />
<em>Graphique 36</em></p>
<p><img src="imgf/g34.png" style="width:50.0%" /></p>
<p>Exemple 2 <em>Graphique 37</em><br />
<img src="imgc/e2.png" style="width:50.0%" /></p>
<p><em>Graphique de gauche n(2) - graphique de droite n(3)</em></p>
<p>Remarque: voir également la palette du thème externe <em><code>plottig</code></em></p>
<p><strong>Les palettes qualitatives de brewcolors</strong></p>
<p><img src="imgc/g26.png" style="width:50.0%" /></p>
<p>Exemple<br />
<em>Graphique 37</em></p>
<p><img src="imgc/e3.png" style="width:50.0%" /></p>
<p><em>Graphique de gauche n(2) - graphique de droite n(3)</em></p>
<p><strong>Palette séquentielle à taille réduite: viridis</strong></p>
<p>En réduisant la taille de certaines palettes séquentielles ou divergentes, on peut obtenir une palette plutôt qualitative. C’est le cas de la palette <em>star</em> <strong>viridis</strong></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true"></a>colorpalette viridis, <span class="kw">n</span>(<span class="dv">3</span>)</span></code></pre></div>
<p><img src="imgf/g35.PNG" style="width:50.0%" /></p>
<p>Exemple<br />
<em>Graphique 38</em></p>
<p><img src="imgc/e4.png" style="width:50.0%" /></p>
</div>
<div id="séquentielles" class="section level4" number="4.2.4.2">
<h4 number="4.2.4.2"><span class="header-section-number">4.2.4.2</span> Séquentielles</h4>
<ul>
<li>Utilisées massivement en cartographie et, plus généralement pour représenter des fréquences (graphique type barre) ou des valeurs ordonnées</li>
<li>Couleurs allant du plus clair au plus foncé (ou inversement)
<ul>
<li>Modification de l’intensité d’une couleur</li>
<li>Un ou plusieurs cycles de couleurs: par exemples du jaune au rouge, du jaune au noire…..</li>
</ul></li>
</ul>
<p><strong>Spmap</strong></p>
<p><img src="imgf/g36.png" style="width:50.0%" /></p>
<p>Exemple <em>Graphique 39</em><br />
<img src="imgf/g37.png" style="width:50.0%" /></p>
<p><strong>Colorbrewer</strong></p>
<p><img src="imgc/g28.png" style="width:50.0%" /></p>
<p>Exemple<br />
<em>Graphique 40</em><br />
<img src="imgf/g38.png" style="width:50.0%" /></p>
<p><strong>matplotlib</strong></p>
<ul>
<li>Palettes du même que la librairie graphique de Python</li>
<li>Implémenté dans de nombreux logiciels</li>
<li>Remplacée par la palette <em>Viridis</em></li>
</ul>
<p><img src="imgf/g39.png" style="width:50.0%" /></p>
<p>Exemple: les 4 saisons<br />
<em>Graphique 41</em><br />
<img src="imgc/e7.png" style="width:75.0%" /></p>
<p><strong>Viridis</strong></p>
<ul>
<li>La palette Viridis et les 4 palettes associées, est la palette <em>star</em> du moment</li>
<li>Développée pour Python pour données une palette alternative à Matplotlib, elle est devenu la palette par défaut de la librairie graphique</li>
<li>Avantages:
<ul>
<li>Même rendu, ou très proche, des couleurs sur toutes les parties d’un écran (uniformité)</li>
<li>Différences de couleurs maintenue à l’impression n&amp;b</li>
<li>Gère la plupart des formes de daltonisme</li>
<li>Elle est franchement belle</li>
</ul></li>
<li>Les autres palettes: <em>plasma</em> est également très utilisée, en particulier pour le remplissage de surface</li>
</ul>
<p><img src="imgf/g40.png" style="width:50.0%" /></p>
<p>Exemple<br />
<em>Graphique 42</em></p>
<p><img src="imgf/g41.png" style="width:75.0%" /></p>
<p><em>Comparaison Viridis et Matplotlib Jet</em><br />
Source: <a href="https://rtask.thinkr.fr/fr/ggplot2-welcome-viridis/" class="uri">https://rtask.thinkr.fr/fr/ggplot2-welcome-viridis/</a></p>
<p><strong>Matplotlib Jet</strong></p>
<p><img src="https://rtask.thinkr.fr/wp-content/uploads/unnamed-chunk-2-1.png" /></p>
<p><strong>Viridis</strong></p>
<p><img src="https://rtask.thinkr.fr/wp-content/uploads/unnamed-chunk-3-1.png" /></p>
<p>Il y a photo ou pas pas photo?</p>
</div>
<div id="palettes-divergentes" class="section level4" number="4.2.4.3">
<h4 number="4.2.4.3"><span class="header-section-number">4.2.4.3</span> Palettes divergentes</h4>
<ul>
<li>Un peu le même principe que les palettes séquentielles, en mettant en avant un point central (de transition) représenté par une couleur de transition, souvent très clair. Typiquement:
<ul>
<li>Du bleu (negatif/faible/inférieur à la moyenne…) - vers le blanc (nul/moyen/proche moyenne) - vers le rouge (positif/élevé/supérieur à la moyenne…) avec une partie séquentielle du bleu vers le blanc, et une autre du blanc vers le rouge.</li>
</ul></li>
<li>Pour certains type de graphique, lorsque la couleur centrale est proche du blanc, la couleur de fond du graphique doit être prise en considération</li>
</ul>
<p>[ Pour les exemples je partirais bien sur une carto (spmap): mais help pour les données]</p>
<p><strong>Colorbrewer</strong></p>
<p><img src="imgc/g29.png" style="width:50.0%" /></p>
</div>
</div>
</div>
<div id="styles---scheme" class="section level2" number="4.3">
<h2 number="4.3"><span class="header-section-number">4.3</span> Styles - scheme</h2>
</div>
<div id="principes---thèmes-internes-et-externe" class="section level2" number="4.4">
<h2 number="4.4"><span class="header-section-number">4.4</span> Principes - thèmes internes et externe</h2>
<ul>
<li>Tous les graphiques ont un thème, appelé <strong>scheme</strong> qui paramètre tous les éléments composant graphiques: palette de couleurs, épaisseurs/tailles, positions, contour, marges….</li>
<li>Les options entrées dans le graphique visent à modifier ce paramétrage</li>
<li>Stata dispose de 11 thèmes internes, celui utilisé par défaut est <strong>s2color</strong> (factory scheme)</li>
<li>Sans modifier des options, un thème graphique peut ne pas être adapté à une représentation graphique</li>
</ul>
<p><strong>Changer de thème</strong></p>
<ul>
<li>Par les boîtes de dialogue: <strong>Edit</strong> =&gt; <strong>Préférences</strong> =&gt; <strong>Graph preferences</strong></li>
<li>Ligne de commande
<ul>
<li>On peut indique le thème en option du graphique le thème à appliquer: <strong><code>scheme(nom_scheme)</code></strong></li>
<li>On peut dans un fichier .do ou .ado charger un thème de façon temporaire (session) ou permanente un thème: <strong>`set scheme nom_scheme [,permanently]</strong></li>
<li>Le choix du thème peut-être également intégré au fichier profile (charge le thème au début de chaque programme)</li>
</ul></li>
</ul>
<p><strong>Thèmes internes</strong></p>
<p>A partir d’un exemple donné dans l’aide Stata pour un graphique type <strong>spike</strong> (<code>help spike</code>)</p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true"></a>sysuse sp500, clear</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true"></a></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true"></a>local scheme  s2color s2mono s2gcolor s2manual s2gmanual s1rcolor s1color <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true"></a><span class="st">              </span>s1mono s1manual economist sj</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true"></a>foreach s of local scheme {</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true"></a>twoway  line close date, <span class="kw">yaxis</span>(<span class="dv">1</span>)                                           <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true"></a><span class="st">        </span><span class="er">||</span><span class="st">  </span>spike change date, <span class="kw">yaxis</span>(<span class="dv">2</span>)                                     <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true"></a><span class="st">        </span><span class="er">||</span>,  <span class="kw">ysca</span>(<span class="kw">axis</span>(<span class="dv">1</span>) <span class="kw">r</span>(<span class="dv">700</span>  <span class="dv">1400</span>)) <span class="kw">ylab</span>(<span class="dv">1000</span>(<span class="dv">100</span>)<span class="dv">1400</span>, <span class="kw">axis</span>(<span class="dv">1</span>))        <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true"></a><span class="st">             </span><span class="kw">ysca</span>(<span class="kw">axis</span>(<span class="dv">2</span>) <span class="kw">r</span>(<span class="op">-</span><span class="dv">50</span> <span class="dv">300</span>))   <span class="kw">ylab</span>(<span class="op">-</span><span class="dv">50</span> <span class="dv">0</span> <span class="dv">50</span>, <span class="kw">axis</span>(<span class="dv">2</span>))             <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true"></a><span class="st">             </span><span class="kw">ytick</span>(<span class="op">-</span><span class="dv">50</span>(<span class="dv">25</span>)<span class="dv">50</span>, <span class="kw">axis</span>(<span class="dv">2</span>) grid)                                 <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true"></a><span class="st">                </span><span class="kw">legend</span>(off)                                                 <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true"></a><span class="st">                </span><span class="kw">xtitle</span>(<span class="st">&quot;Date&quot;</span>)                                              <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true"></a><span class="st">                </span><span class="kw">title</span>(<span class="st">&quot;S&amp;P 500&quot;</span>)                                            <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true"></a><span class="st">                </span><span class="kw">subtitle</span>(<span class="st">&quot;Scheme = `s&#39;&quot;</span>)                                    <span class="op">/</span><span class="er">//</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true"></a><span class="st">                </span><span class="kw">yline</span>(<span class="dv">950</span>, <span class="kw">axis</span>(<span class="dv">1</span>) <span class="kw">lc</span>(black)) <span class="kw">scheme</span>(<span class="st">`</span><span class="dt">s&#39;) name(</span><span class="st">`</span>s<span class="st">&#39;, replace) nodraw</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true"></a></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true"></a><span class="st">* graph combine ......                </span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true"></a><span class="st">                </span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true"></a><span class="st">}</span></span></code></pre></div>
</details>
<p><em>Graphique 43</em><br />
<img src="imgf/scheme1.png" /></p>
<p><em>Graphique 44</em><br />
<img src="imgf/scheme2.png" /></p>
<p><strong>Thèmes externes</strong></p>
<ul>
<li>Plusieurs thèmes et collection de thèmes externe sont instalables: <strong><code>search scheme</code></strong> <strong><code>ssc instal nom scheme</code></strong></li>
<li>Exemples: La collection de François Briatte (Burd) et la collection de Daniel Bischoff (plottig, plotplainblind…)…</li>
</ul>
<p><em>Graphique 45</em><br />
<img src="imgf/scheme3.png" /></p>
</div>
<div id="grstyle" class="section level2" number="4.5">
<h2 number="4.5"><span class="header-section-number">4.5</span> grstyle</h2>
<ul>
<li>Auteur: Ben Jann</li>
<li>Autre générateur de thèmes: <strong>brewscheme</strong> de W.Buchanan, mais à mon sens beaucoup plus complexe</li>
<li>Ici utilisation minimale, par l’exemple de <strong>grstyle</strong> avec <strong><code>grstyle set</code></strong> avec seulement 4-5 lignes de paramètres réutilisables et facilement modificable avec seulement <strong><code>grstyle set</code></strong>.</li>
<li>Il est possible de générer un thème complet pour tous les types de graphiques</li>
<li>Pour voir l’ensemble des possibilités : <strong><code>help grstyle</code></strong> <strong><code>help grstyle set</code></strong></li>
</ul>
<p><strong>Installation <code>grstyle</code></strong></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true"></a>    ssc install grstyle</span></code></pre></div>
</div>
<div id="initialisation-et-enregistrement" class="section level2" number="4.6">
<h2 number="4.6"><span class="header-section-number">4.6</span> Initialisation et enregistrement</h2>
<ul>
<li>Dans un programme on initialise le générateur avec <strong><code>grstyle init</code></strong></li>
<li>Enregistrement du thème: <strong><code>grstyle init nom_thème, [path] [replace]</code></strong></li>
<li>Si le thème a été enregistré, on peut le charger dans un graphique avec scheme(nom_scheme). Visiblement on ne peut pas le charger à l’extérieur du graphique avec <strong><code>set scheme</code></strong></li>
</ul>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true"></a>set scheme t1, <span class="kw">path</span>(D<span class="op">:</span>\stata_temp) replace</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true"></a>[grstyle set ....]</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true"></a>tw line y x, <span class="kw">scheme</span>(t1)</span></code></pre></div>
</div>
<div id="exemple-1" class="section level2" number="4.7">
<h2 number="4.7"><span class="header-section-number">4.7</span> Exemple 1</h2>
<p>Graphique proposé dans l’aide de <strong>line</strong>, légèrement simplifié</p>
<p>Avec le thème Stata <strong>s2color</strong></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true"></a>sysuse uslifeexp, clear</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true"></a>gen difference =<span class="st"> </span>le_wm <span class="op">-</span><span class="st"> </span>le_bm</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true"></a><span class="op">*</span>[graphique]</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true"></a>tw line le_wm year, <span class="kw">yaxis</span>(<span class="dv">1</span> <span class="dv">2</span>)                                       <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>line le_bm year                                                   <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>line diff  year                                                   <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>lfit diff  year,                                                  <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true"></a><span class="st">             </span><span class="kw">ylabel</span>(<span class="dv">0</span>(<span class="dv">5</span>)<span class="dv">20</span>, <span class="kw">axis</span>(<span class="dv">2</span>) gmin )                           <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true"></a><span class="st">             </span><span class="kw">ylabel</span>(<span class="dv">0</span> <span class="dv">20</span>(<span class="dv">10</span>)<span class="dv">80</span>,     gmax )                           <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true"></a><span class="st">             </span><span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>, <span class="kw">axis</span>(<span class="dv">2</span>))                                     <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true"></a><span class="st">             </span><span class="kw">ylabel</span>(, <span class="kw">axis</span>(<span class="dv">2</span>) grid)                                  <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true"></a><span class="st">             </span><span class="kw">ytitle</span>(<span class="st">&quot;Life expectancy at birth (years)&quot;</span>)              <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true"></a><span class="st">             </span><span class="kw">title</span>(<span class="st">&quot;White and black life expectancy&quot;</span>)                <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true"></a><span class="st">             </span><span class="kw">subtitle</span>(<span class="st">&quot;USA, 1900-1999&quot;</span>)                              <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true"></a><span class="st">             </span><span class="kw">note</span>(<span class="st">&quot;Source: National Vital Statistics, Vol 50, No. 6&quot;</span> <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true"></a><span class="st">                  &quot;(1918 dip caused by 1918 Influenza Pandemic)&quot;</span>)    <span class="op">/</span><span class="er">//</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true"></a><span class="st">             </span><span class="kw">legend</span>(<span class="kw">label</span>(<span class="dv">1</span> <span class="st">&quot;White males&quot;</span>) <span class="kw">label</span>(<span class="dv">2</span> <span class="st">&quot;Black males&quot;</span>)) </span></code></pre></div>
</details>
<p><em>Graphique 46</em><br />
<img src="imgf/scheme4.png" style="width:50.0%" /></p>
<ul>
<li><strong>Background du graphique, grid…</strong>
<ul>
<li><strong>grstyle set plain [options]</strong></li>
<li><strong>grstyle set [i]mesh [options]</strong></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true"></a>grstyle init </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>grstyle set plain, horizontal grid  <span class="op">/</span><span class="er">/</span><span class="st"> </span>option dotted pour des pointillés sur le grid</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>grstyle set mesh, horizontal compact</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>grstyle set imesh, horizontal compact  minor</span></code></pre></div>
<p><em>Graphique 47</em><br />
<img src="imgf/scheme5.png" /></p>
<p>Pour la suite, on conservera comme paramètres la deuxième ligne: <strong><code>grstyle set mesh, horizontal compact</code></strong></p>
<ul>
<li><strong>Légende</strong>: position et box</li>
</ul>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true"></a>grstyle init </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true"></a>grstyle set mesh, horizontal compact</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true"></a>grstyle set legend <span class="dv">2</span>, nobox</span></code></pre></div>
<p><em>Graphique 48</em><br />
<img src="imgf/scheme6.png" style="width:75.0%" /></p>
<ul>
<li><p><strong>Autres paramètres généraux</strong>: taille du graphique <strong><code>grstyle set graphsize</code></strong> et marges <strong><code>grstyle set margins</code></strong></p></li>
<li><p><strong>Paramètres sur les objets graphiques</strong></p>
<ul>
<li><strong>Couleurs</strong>: <strong><code>grstyle set color [options] [: type objet]</code></strong>
<ul>
<li>Plusieurs paramétrages possibles en définissant les objets pour lesquels la palette s’applique</li>
<li>Même syntaxe que colorpalette, la palette s’applique directement aux objets.</li>
<li>Les codes couleurs peuvent être directement appliqué au graphique sans utiliser les macros `rp(p#))<br />
</li>
<li><code>grstyle set color viridis, n(5)</code> = <code>colorpalette viridis, n(5)</code></li>
</ul></li>
</ul></li>
</ul>
<p><em>Graphique 49</em><br />
<img src="imgf/scheme7.png" style="width:75.0%" /></p>
<p><strong>Comparaisons s2color et mini thème généré par grstyle en 3 lignes</strong></p>
<p><em>Graphique 50</em><br />
<img src="imgf/scheme8.png" style="width:75.0%" /></p>
<ul>
<li><strong>Intervalles de confiance</strong>: permet d’appliquer directement aux intervalles de confiance présents dans le graphique. La coulmeur et le degré d’intensité peuvent être modifiés: <strong><code>grstyle set ci [couleur], [opacity()]</code></strong>.</li>
<li><strong>Autres</strong>: l’intensité des couleurs (également paramétrable avec les couleurs en général), tailles et épaisseurs, type de symbol (pour scatter, connected…), type de courbe (pour line, connected, spike…)</li>
</ul>
</div>
<div id="exemple-2" class="section level2" number="4.8">
<h2 number="4.8"><span class="header-section-number">4.8</span> Exemple 2</h2>
<ul>
<li>Pour un graphique à première vue relativement simple (ici scatter + lfitci) le paramétrage devient assez gourmant</li>
<li>Passer ses options directement par les macros reste un méthode pertinente</li>
</ul>
<p><em>Graphique 51</em><br />
<img src="imgf/scheme9.png" style="width:75.0%" /></p>
<p><strong>Avec s2color</strong></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true"></a>sysuse auto, clear</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true"></a>set scheme s2color</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true"></a>tw lfitci  price length  <span class="cf">if</span> <span class="op">!</span>foreign,     <span class="op">/</span><span class="er">//</span><span class="st">         </span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>lfitci  price length  <span class="cf">if</span> foreign,      <span class="op">/</span><span class="er">//</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price length  <span class="cf">if</span> <span class="op">!</span>foreign,     <span class="op">/</span><span class="er">//</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price length  <span class="cf">if</span>  foreign,     <span class="op">/</span><span class="er">//</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true"></a><span class="st"> </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">5</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">6</span> <span class="st">&quot;Foreign&quot;</span>))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true"></a><span class="st"> </span><span class="kw">ytitle</span>(<span class="st">&quot;price&quot;</span>) <span class="kw">xtitle</span>(<span class="st">&quot;mpg&quot;</span>) </span></code></pre></div>
<p><strong>Avec grstyle seulement</strong></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true"></a>grstyle init</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true"></a>grstyle set mesh, horizontal compact</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true"></a>grstyle set legend <span class="dv">7</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true"></a>grstyle set color plasma, <span class="kw">select</span>(<span class="dv">4</span> <span class="dv">14</span>) <span class="kw">opacity</span>(<span class="dv">50</span>) <span class="kw">plots</span>(<span class="dv">5</span> <span class="dv">6</span>)<span class="op">:</span><span class="st"> </span>p<span class="co">#markfill</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true"></a>grstyle set color plasma, <span class="kw">select</span>(<span class="dv">4</span> <span class="dv">14</span>)             <span class="kw">plots</span>(<span class="dv">1</span> <span class="dv">3</span>)<span class="op">:</span><span class="st"> </span>p<span class="co">#lineplot</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true"></a>grstyle set color black,                   <span class="kw">plots</span>(<span class="dv">5</span> <span class="dv">6</span>)<span class="op">:</span><span class="st"> </span>p<span class="co">#markline</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true"></a>grstyle set linewidth <span class="fl">.2</span>pt,                <span class="kw">plots</span>(<span class="dv">5</span> <span class="dv">6</span>)<span class="op">:</span><span class="st"> </span>p<span class="co">#mark</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true"></a>grstyle set symbolsize 5pt</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true"></a>grstyle set ci, <span class="kw">opacity</span>(<span class="dv">20</span>)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true"></a></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true"></a>tw lfitci  price length <span class="cf">if</span> foreign                                              <span class="op">/</span><span class="er">//</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>lfitci  price length <span class="cf">if</span> <span class="op">!</span>foreign                                             <span class="op">/</span><span class="er">//</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price length <span class="cf">if</span> foreign,  <span class="kw">jitter</span>(<span class="dv">2</span>)                                  <span class="op">/</span><span class="er">//</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>scatter price length <span class="cf">if</span> <span class="op">!</span>foreign, <span class="kw">jitter</span>(<span class="dv">2</span>)                                  <span class="op">/</span><span class="er">//</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>, <span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">4</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">5</span> <span class="st">&quot;Foreign&quot;</span>) <span class="kw">region</span>(<span class="kw">lw</span>(vvthin))) <span class="kw">ytitle</span>(<span class="st">&quot;Price&quot;</span>) </span></code></pre></div>
<p><strong>Grstyle + macro</strong></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true"></a>grstyle init</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true"></a>grstyle set mesh, horizontal compact</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true"></a>grstyle set legend <span class="dv">7</span>, </span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true"></a>grstyle set ci, <span class="kw">opacity</span>(<span class="dv">20</span>) </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true"></a>     </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true"></a>colorpalette plasma, <span class="kw">select</span>(<span class="dv">4</span> <span class="dv">14</span>) <span class="kw">opacity</span>(<span class="dv">50</span>) nograph</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true"></a>local osca1 <span class="kw">mc</span>(<span class="st">&quot;`r(p1)&#39;&quot;</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">msiz</span>(5pt)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true"></a>local osca2 <span class="kw">mc</span>(<span class="st">&quot;`r(p2)&#39;&quot;</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">msiz</span>(5pt)   </span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true"></a>colorpalette plasma, <span class="kw">select</span>(<span class="dv">4</span> <span class="dv">14</span>)  nograph</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true"></a><span class="kw">tw</span> (lfitci price length <span class="cf">if</span> foreign,  <span class="kw">clc</span>(<span class="st">&quot;`r(p1)&#39;&quot;</span>))          <span class="op">/</span><span class="er">//</span></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true"></a><span class="st">   </span>(lfitci price length <span class="cf">if</span> <span class="op">!</span>foreign, <span class="kw">clc</span>(<span class="st">&quot;`r(p2)&#39;&quot;</span>))          <span class="op">/</span><span class="er">//</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true"></a><span class="st">   </span>(sca    price length <span class="cf">if</span> foreign,  <span class="kw">jitter</span>(<span class="dv">2</span>) <span class="st">`</span><span class="dt">osca1&#39;)       ///</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true"></a><span class="dt">   (sca    price length if !foreign, jitter(2) </span><span class="st">`</span>osca2<span class="st">&#39;),      ///</span></span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true"></a><span class="st">   legend(order(5 &quot;Domestic&quot; 6 &quot;Foreign&quot;) region(lw(vvthin)))</span></span></code></pre></div>
</div>
<div id="application-inferno" class="section level2" number="4.9">
<h2 number="4.9"><span class="header-section-number">4.9</span> Application: Inferno…</h2>
<p>… Car oui c’était un peu l’enfer</p>
<ul>
<li><p>Objectif: affecter une palette séquentielle à une aire (ici densité), les couleurs changeant pour chaque valeur de (x,y).</p></li>
<li><p>Données: Gapminder (à utiliser avec précaution). Les densités des espérances de vie calculées des pays, donc sur un nombre restreint d’observations.</p></li>
<li><p><strong>Problèmes identifiés rapidement</strong>:</p></li>
<li><p>Comment appliquée une couleur différéente à chaque valeurs de x (espérance de vie)</p>
<ul>
<li>Impossible d’utiliser directement <code>rarea</code>, une seule couleur peut-être est appliquée à l’aire</li>
<li>Solution : refaire l’aire à partir de droites (<em>spike</em> <strong><code>tw spike</code></strong>)</li>
<li>Appliquée une palette séquentielle sur chaque ligne du graphique</li>
<li>Faire concorder la palette à tous les points d’observations (années) qui ne débutent et ne finissent pas sur les mêmes valeurs de x</li>
</ul></li>
<li><p><strong>Problèmes rencontrés durant la programmation…et j’ai pas forcément compris pourquoi</strong></p>
<ul>
<li>Si on affecte une seule couleur au densités avec <strong><code>rarea</code></strong>, les graphiques pour les différentes années peuvent être générées directement en translatant les valeurs de Y (offset). Là, ça ne fonctionne visiblement pas avec <strong><code>rspike</code></strong>. Les différents graphiques ont du être combinés, ce qui augmente fortement le temps d’exécution.</li>
<li>La macro élargie pour générer les couleurs de transition ne comporte que des chaines de caractères (code rgb). Le premier code couleur n’a pas de double quotes…. et je ne comprends pas pourquoi. Le problème a été réglé sans faire appel à la raison.</li>
</ul></li>
</ul>
<p>Bref, c’est vraiment un peu l’enfer…et j’ai docn tout naturellement appliqué une palette de couleur adaptée: <strong>inferno</strong> (collection <em>viridis</em>)</p>
<p>L’idée est de présenter une visualisation différente du “treemap” généré plus haut avec python</p>
<p><strong>Treemap espérance de vie dans le monde en 2007</strong> [cf partie Python]</p>
<iframe width="600" height="400" src="imgf/g29.html">
</iframe>
<p><strong>Graphique</strong></p>
<p><em>Graphique 52</em><br />
<img src="imgf/g51.png" style="width:75.0%" /></p>
<p><strong>Programme</strong></p>
<ul>
<li><strong>Partie 1</strong>: Estimation des densités et récupération des couleurs de transition</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true"></a>use life_exp, clear</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true"></a>keep <span class="cf">if</span> <span class="kw">inlist</span>(year,<span class="dv">1957</span>, <span class="dv">2007</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true"></a>keep <span class="cf">if</span> continent<span class="op">!=</span><span class="st">&quot;&quot;</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true"></a>local l <span class="dv">1957</span> <span class="dv">2007</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true"></a>foreach i of local l {</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true"></a>kdensity lifeexp <span class="cf">if</span>  year<span class="op">==</span><span class="st">`</span><span class="dt">i&#39;, gen(_x</span><span class="st">`</span>i<span class="st">&#39; _d`i&#39;</span><span class="er">)</span> nograph <span class="kw">bwidth</span>(<span class="dv">0</span>) <span class="kw">n</span>(<span class="dv">300</span>) <span class="kw">kernel</span>(gauss)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true"></a>gen x<span class="st">`</span><span class="dt">i&#39; = round(_x</span><span class="st">`</span>i<span class="st">&#39; - 28)</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true"></a><span class="st">}</span></span></code></pre></div>
<p>La première partie vise à générer les variables pour le graphique * les coordonnées (x,y) (espérance de vie, densité). On a pris 200 valeurs, pour cacher au maximun l’effet d’escalier * Les variables x1957 et x2007: * Elles vont permettre de générer une palette de couleurs de transition * On a besoin de valeurs entières pour utiliser les macros <code>r(p(#))</code> de colorpalette * On translate les valeurs pour démarrer la palette avec la macro <code>r(p1)</code></p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true"></a>    Variable <span class="op">|</span><span class="st">        </span>Obs        Mean    Std. Dev.       Min        Max</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true"></a><span class="op">-------------+---------------------------------------------------------</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true"></a><span class="st">       </span>x1957 <span class="op">|</span><span class="st">        </span><span class="dv">200</span>        <span class="fl">25.2</span>    <span class="fl">13.98923</span>          <span class="dv">1</span>         <span class="dv">49</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true"></a>       x2007 <span class="op">|</span><span class="st">        </span><span class="dv">200</span>        <span class="fl">35.5</span>    <span class="fl">13.22059</span>         <span class="dv">13</span>         <span class="dv">58</span></span></code></pre></div>
<ul>
<li>La palette de transition à donc une longueur de 58
<ul>
<li>En 1957, la première couleur sera donc celle qui correspont à <code>r(p1)</code>, la dernière à <code>r(p49)</code></li>
<li>En 2007, la première couleur sera donc celle qui correspond à <code>r(p13)</code>, la dernière à <code>r(p58)</code></li>
</ul></li>
</ul>
<p><strong>Pourquoi autant de couleurs de transition?</strong><br />
Si on prend seulement la couleur de départ (<code>r(p1)</code>: rgb=“0 0 4”) et la couleur d’arrivée(<code>r(p58)</code>: rgb=“252 255” “165”), la palette finale sur 200 couleurs ne serait plus calée sur la palette inferno [voir plus bas].</p>
<ul>
<li><strong>Partie 2</strong>: la palette de transition</li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true"></a><span class="op">**</span><span class="st"> </span><span class="dv">1957</span> <span class="op">**</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true"></a>levelsof x1957, <span class="kw">local</span>(l)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true"></a>colorpalette plasma,  <span class="kw">n</span>(<span class="dv">58</span>)  nograph</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true"></a>foreach l2 of local l {</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true"></a>local c<span class="st">`</span><span class="dt">l2&#39;  &quot;</span><span class="st">`</span><span class="kw">r</span>(p<span class="st">`</span><span class="dt">l2&#39;)&#39;&quot; </span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true"></a><span class="dt">local coul X </span><span class="st">`</span>coul<span class="st">&#39;   &quot;`c`l2&#39;&#39;&quot;</span></span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true"></a><span class="st">local z: subinstr local coul &quot;X&quot; &quot; &quot;, all</span></span></code></pre></div>
<ul>
<li>Pour récupérer les couleurs de transition, on programme une macro élargie dans une boucle</li>
<li>Et c’est là qu’un mystère apparait, et c’est également ici qu’on comprend la nécessité de toujours visualiser le contenu de ce genre de macro avec <strong><code>mac list _nom macro</code></strong>
<ul>
<li>Pour mettre à la suite les codes couleurs de la matrice de transition, normalement la macro devrait s’écrire:</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true"></a>  <span class="st">`</span><span class="dt">local coul coul &quot;</span><span class="st">`</span>c<span class="st">`</span><span class="dt">l2&#39;&#39;&quot;</span></span></code></pre></div>
<ul>
<li>Sauf que les doubles quotes du premier code couleur ont disparu (13 8 135):</li>
</ul>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true"></a>. mac list _coul</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true"></a>_coul<span class="op">:</span><span class="st">          </span><span class="dv">13</span> <span class="dv">8</span> <span class="dv">135</span> <span class="st">&quot;26 6 140&quot;</span> <span class="st">&quot;36 6 145&quot;</span> <span class="st">&quot;45 5 148&quot;</span> <span class="st">&quot;53 4 152&quot;</span> <span class="st">&quot;60 4 155&quot;</span> <span class="st">&quot;68 3 158&quot;</span> <span class="st">&quot;75 3 161&quot;</span> <span class="st">&quot;83 2</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true"></a><span class="st">                163&quot;</span> <span class="st">&quot;90 1 165&quot;</span> <span class="st">&quot;97 0 166&quot;</span> <span class="st">&quot;104 0 168&quot;</span> <span class="st">&quot;111 0 168&quot;</span> <span class="st">&quot;117 1 168&quot;</span> <span class="st">&quot;124 2 168&quot;</span> <span class="st">&quot;131 5 167&quot;</span> <span class="st">&quot;137 9</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true"></a><span class="st">                166&quot;</span> <span class="st">&quot;144 13 164&quot;</span> <span class="st">&quot;150 18 161&quot;</span> <span class="st">&quot;156 23 158&quot;</span> <span class="st">&quot;162 28 155&quot;</span> <span class="st">&quot;167 33 151&quot;</span> <span class="st">&quot;173 38 147&quot;</span> <span class="st">&quot;178 43</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true"></a><span class="st">                143&quot;</span> <span class="st">&quot;183 48 139&quot;</span> <span class="st">&quot;188 53 135&quot;</span> <span class="st">&quot;192 58 131&quot;</span> <span class="st">&quot;197 63 126&quot;</span> <span class="st">&quot;201 68 122&quot;</span> <span class="st">&quot;205 73 118&quot;</span> <span class="st">&quot;209 78</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true"></a><span class="st">                114&quot;</span> <span class="st">&quot;213 84 110&quot;</span> <span class="st">&quot;217 89 106&quot;</span> <span class="st">&quot;221 94 102&quot;</span> <span class="st">&quot;224 99 98&quot;</span> <span class="st">&quot;227 104 95&quot;</span> <span class="st">&quot;231 110 91&quot;</span> <span class="st">&quot;234 115</span></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true"></a><span class="st">                87&quot;</span> <span class="st">&quot;237 121 83&quot;</span> <span class="st">&quot;239 126 79&quot;</span> <span class="st">&quot;242 132 75&quot;</span> <span class="st">&quot;244 138 72&quot;</span> <span class="st">&quot;246 144 68&quot;</span> <span class="st">&quot;248 150 64&quot;</span> <span class="st">&quot;250 156</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true"></a><span class="st">                60&quot;</span> <span class="st">&quot;251 162 56&quot;</span> <span class="st">&quot;252 169 52&quot;</span> <span class="st">&quot;253 176 49&quot;</span> <span class="st">&quot;254 182 45&quot;</span></span></code></pre></div>
<ul>
<li>Solution:
<ul>
<li>Visiblement pour retrouver les premières doubles quotes il faut ajouter une expression au début de la macro, ici la lettre X [solution du désespoir: éessayons ça pour voir ce que ça donne]:</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true"></a>    <span class="op">**</span><span class="st">`</span><span class="dt">local coul X </span><span class="st">`</span>coul<span class="st">&#39; &quot;`c`l2&#39;&#39;&quot;`**</span></span></code></pre></div>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true"></a>mac list _coul</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true"></a>_coul<span class="op">:</span><span class="st">          </span>X X X X X X X X X X X [<span class="dv">58</span> en tout] X X X X X X X X X X X <span class="st">&quot;13 8 135&quot;</span> <span class="st">&quot;26 6 140&quot;</span> <span class="st">&quot;36 6 145&quot;</span> <span class="st">&quot;45 5 148&quot;</span> <span class="st">&quot;53 4 152&quot;</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true"></a>                <span class="st">&quot;60 4 155&quot;</span> <span class="st">&quot;68 3 158&quot;</span> <span class="st">&quot;75 3 161&quot;</span> <span class="st">&quot;83 2 163&quot;</span> <span class="st">&quot;90 1 165&quot;</span> <span class="st">&quot;97 0 166&quot;</span> <span class="st">&quot;104 0 168&quot;</span> <span class="st">&quot;111 0 168&quot;</span> <span class="st">&quot;117 1 168&quot;</span> </span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true"></a>                <span class="st">&quot;124 2 168&quot;</span> <span class="st">&quot;131 5 167&quot;</span> <span class="st">&quot;137 9 166&quot;</span> <span class="st">&quot;144 13 164&quot;</span> <span class="st">&quot;150 18 161&quot;</span> <span class="st">&quot;156 23 158&quot;</span> <span class="st">&quot;162 28 155&quot;</span> <span class="st">&quot;167 33 151&quot;</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true"></a>                <span class="st">&quot;173 38 147&quot;</span> <span class="st">&quot;178 43 143&quot;</span> <span class="st">&quot;183 48 139&quot;</span> <span class="st">&quot;188 53 135&quot;</span> <span class="st">&quot;192 58 131&quot;</span> <span class="st">&quot;197 63 126&quot;</span> <span class="st">&quot;201 68 122&quot;</span> <span class="st">&quot;205 73 118&quot;</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true"></a>                <span class="st">&quot;209 78 114&quot;</span> <span class="st">&quot;213 84 110&quot;</span> <span class="st">&quot;217 89 106&quot;</span> <span class="st">&quot;221 94 102&quot;</span> <span class="st">&quot;224 99 98&quot;</span> <span class="st">&quot;227 104 95&quot;</span> <span class="st">&quot;231 110 91&quot;</span> <span class="st">&quot;234 115 87&quot;</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true"></a>                <span class="st">&quot;237 121 83&quot;</span> <span class="st">&quot;239 126 79&quot;</span> <span class="st">&quot;242 132 75&quot;</span> <span class="st">&quot;244 138 72&quot;</span> <span class="st">&quot;246 144 68&quot;</span> <span class="st">&quot;248 150 64&quot;</span> <span class="st">&quot;250 156 60&quot;</span> <span class="st">&quot;251 162 56&quot;</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true"></a>                <span class="st">&quot;252 169 52&quot;</span> <span class="st">&quot;253 176 49&quot;</span> <span class="st">&quot;254 182 45&quot;</span></span></code></pre></div>
<ul>
<li>Les double quotes sont bien affiché pour le premier code couleur <strong>“13 8 135”</strong></li>
<li>Il ne reste plus qu’à se débarasser des X qui ont été générés avec la fonction <strong><code>subinstr</code></strong>.</li>
</ul>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true"></a>local z<span class="op">:</span><span class="st"> </span>subinstr local coul <span class="st">&quot;X&quot;</span> <span class="st">&quot; &quot;</span>, all</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true"></a>mac list _z</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true"></a>_z<span class="op">:</span><span class="st">              &quot;13 8 135&quot;</span> <span class="st">&quot;26 6 140&quot;</span> <span class="st">&quot;36 6 145&quot;</span> <span class="st">&quot;45 5 148&quot;</span> <span class="st">&quot;53 4 152&quot;</span> <span class="st">&quot;60 4 155&quot;</span> <span class="st">&quot;68 3 158&quot;</span> <span class="st">&quot;75 3 161&quot;</span> <span class="st">&quot;83</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true"></a><span class="st">                2 163&quot;</span> <span class="st">&quot;90 1 165&quot;</span> <span class="st">&quot;97 0 166&quot;</span> <span class="st">&quot;104 0 168&quot;</span> <span class="st">&quot;111 0 168&quot;</span> <span class="st">&quot;117 1 168&quot;</span> <span class="st">&quot;124 2 168&quot;</span> <span class="st">&quot;131 5 167&quot;</span> <span class="st">&quot;137</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true"></a><span class="st">                9 166&quot;</span> <span class="st">&quot;144 13 164&quot;</span> <span class="st">&quot;150 18 161&quot;</span> <span class="st">&quot;156 23 158&quot;</span> <span class="st">&quot;162 28 155&quot;</span> <span class="st">&quot;167 33 151&quot;</span> <span class="st">&quot;173 38 147&quot;</span> <span class="st">&quot;178 43</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true"></a><span class="st">                143&quot;</span> <span class="st">&quot;183 48 139&quot;</span> <span class="st">&quot;188 53 135&quot;</span> <span class="st">&quot;192 58 131&quot;</span> <span class="st">&quot;197 63 126&quot;</span> <span class="st">&quot;201 68 122&quot;</span> <span class="st">&quot;205 73 118&quot;</span> <span class="st">&quot;209 78</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true"></a><span class="st">                114&quot;</span> <span class="st">&quot;213 84 110&quot;</span> <span class="st">&quot;217 89 106&quot;</span> <span class="st">&quot;221 94 102&quot;</span> <span class="st">&quot;224 99 98&quot;</span> <span class="st">&quot;227 104 95&quot;</span> <span class="st">&quot;231 110 91&quot;</span> <span class="st">&quot;234 115</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true"></a><span class="st">                87&quot;</span> <span class="st">&quot;237 121 83&quot;</span> <span class="st">&quot;239 126 79&quot;</span> <span class="st">&quot;242 132 75&quot;</span> <span class="st">&quot;244 138 72&quot;</span> <span class="st">&quot;246 144 68&quot;</span> <span class="st">&quot;248 150 64&quot;</span> <span class="st">&quot;250 156</span></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true"></a><span class="st">                60&quot;</span> <span class="st">&quot;251 162 56&quot;</span> <span class="st">&quot;252 169 52&quot;</span> <span class="st">&quot;253 176 49&quot;</span> <span class="st">&quot;254 182 45&quot;</span></span></code></pre></div>
<p><strong>Partie 3: le graphique</strong></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true"></a>grstyle init w57, replace </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true"></a>grstyle set legend, nobox stack</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true"></a>grstyle set mesh,  horizontal</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true"></a>grstyle set color <span class="st">`</span><span class="dt">z&#39;, n(200)</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true"></a><span class="dt">forvalue i=1/200 {</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true"></a><span class="dt">local sp </span><span class="st">`</span>sp<span class="st">&#39; spike _d1957  _x1957 in `i&#39;</span>  <span class="cf">if</span> _x1957<span class="op">&gt;</span><span class="dv">30</span> <span class="op">&amp;</span><span class="st">  </span>_x1957<span class="op">&lt;</span><span class="dv">83</span>, <span class="kw">lw</span>(vthick) <span class="kw">lc</span>(<span class="st">&quot;`r(p`i&#39;)&#39;&quot;</span>) <span class="op">||</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true"></a>tw <span class="st">`</span><span class="dt">sp&#39;  , legend(order(1 &quot;30 ans&quot; 41 &quot;40 ans&quot; 81 &quot;50 ans&quot; 121 &quot;60 ans&quot; 161 &quot;70 ans&quot; 200 &quot;80 ans&quot;) pos(2) col(1)   /// </span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true"></a><span class="dt">            xlabel(30 40 50 60 70 80 85) ylabel(0(.02).05, nogrid labc(%0))                                        ///</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true"></a><span class="dt">            xtitle(&quot;Espérance de vie&quot;) ytitle(&quot;&quot;) title(&quot;1957&quot;, pos(11)) scheme(w57) save(w1, replace)             ///</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true"></a></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true"></a><span class="dt">** 2007 **</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true"></a><span class="dt">[Idem 2007]: on change la variable de la ligne levelsof... 2007 au lieu de 1957, et l&#39;année dans le titre [peut-être automatisé dans une boucle]</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true"></a></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true"></a><span class="dt">** Graphique combiné</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true"></a></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true"></a><span class="dt">graph combine  w2 w1, col(1) xcommon ycommon xsize(20) ysize(10)        ///</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true"></a><span class="dt">         legendfrom(w1) pos(3)                                          ///</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true"></a><span class="dt">         title(&quot;Monde&quot;, pos(11)) graphr(color(white)) scheme(w07 w57)</span></span></code></pre></div>
<ul>
<li>Pas de difficulté particulière pour le graphique:
<ul>
<li>On utilise la palette de transition pour récupérer 300 couleurs (nombre de coordonnées estimées avec <strong><code>kdensity</code></strong>) <strong><code>grstyle set color couleurs_de_transition, n(300)</code></strong><br />
</li>
<li>On génère 300 droites avec <em><code>spike</code></em>, en appliquant la couleur de l’option <em>lc()</em> avec l’expression de la macro <strong>r(p#)</strong></li>
<li>Je ne vois pas l’intérêt d’afficher une légende, les couleurs étant directement gradées sur l’axe x.</li>
<li>Je conseille de sauvegarder le graph en dur. J’ai eu des problèmes de mémoire en répétant l’exécution avec <strong><code>name()</code></strong></li>
</ul></li>
<li>Graphique combiné
<ul>
<li>Temps d’exécution forcément très long. J’espère quand même trouver un jour une solution avec <strong><code>rspike</code></strong> appliquant un seuil différent à chaque graphique</li>
<li>Au bout de certains</li>
<li>La combinaison par un logiciel type <strong>irfan</strong> est également une solution rationnelle</li>
</ul></li>
</ul>
<p><strong>Avec la palette viridis</strong></p>
<p><img src="imgf/g51b.png" style="width:75.0%" /></p>
<p><strong>Niveau continents</strong></p>
<ul>
<li>Faire un <code>clear serset</code> régulièrement, Stata fatigue rapidement</li>
<li>Enregistrer en dur les graphiques individuels avec <code>saving()</code>, le rendu peut partir un peu en sucette avec <code>name()</code></li>
</ul>
<p><em>Graphique 53</em><br />
<img src="imgf/g49.png" style="width:75.0%" /></p>
<p><strong>Graphiques sans couleurs de transition</strong></p>
<p><em>Graphique 54</em><br />
Plus simple à programmer, car on a besoin seulement d’une couleur de départ et d’une couleur d’arrivée, la seconde partie du programme n’est pas nécessaire <img src="imgf/g54.png" /></p>
</div>
</div>
<div id="visualisation-des-données-avec-stata" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Visualisation des données avec Stata</h1>
<p><strong>Principe de la section</strong>:</p>
<ul>
<li>Reprendre les principales représentations graphiques: <a href="https://www.data-to-viz.com" class="uri">https://www.data-to-viz.com</a></li>
<li>Commande(s) Stata internes ou externes</li>
<li>Rappel sur des points de vigilance et limites, et lorsque c’est possibles les solutions ou les moyens de les contourner</li>
<li>Plusieurs exemples programmés avec Stata s’appuient sur les visualisations du site <a href="https://www.data-to-viz.com" class="uri">https://www.data-to-viz.com</a> [liens vers code <code>ggplot2</code>]</li>
</ul>
<p><strong>Liens sites Stata</strong> <strong>Stata sheets</strong>: <a href="https://www.stata.com/links/resources-for-learning-stata/cheat-sheets/StataCheatSheet_visualization_2016_June-REV.pdf" class="uri">https://www.stata.com/links/resources-for-learning-stata/cheat-sheets/StataCheatSheet_visualization_2016_June-REV.pdf</a> <br> <strong>Galerie Sdas</strong> [programmes courts]: <a href="https://www.surveydesign.com.au/tipsgraphs.html" class="uri">https://www.surveydesign.com.au/tipsgraphs.html</a> <br> <strong>Galerie Maarten Buis</strong>: <a href="http://www.maartenbuis.nl/workshops/graphs_in_stata/workshop.html" class="uri">http://www.maartenbuis.nl/workshops/graphs_in_stata/workshop.html</a> <br> <strong>Site de Demetris Christodoulou</strong> [Référence]<br />
<a href="https://graphworkflow.com/" class="uri">https://graphworkflow.com/</a></p>
<ul>
<li>Partie dédiée à la sémiologie graphique</li>
<li>Galerie de graphiques Stata
<ul>
<li>Explication des objectifs</li>
<li>Justification des choix</li>
<li>Mise à disposition du programme</li>
</ul></li>
</ul>
<div id="histogrammes-et-densités" class="section level2" number="5.1">
<h2 number="5.1"><span class="header-section-number">5.1</span> Histogrammes et densités</h2>
<p><span class="badge badge-info">variable(s) continues(s)</span> <span class="badge badge-info">Croisement avec variables catégorielles</span></p>
<ul>
<li>Analyse des distributions: une ou plusieurs variables numériques, croisement avec une ou plusieurs variables catégorielles</li>
<li>Vue de face</li>
<li>Limite: Nombre d’objets empilés sur un même graphique</li>
<li>Combinaison possible avec les visualisation vue de dessus (nuages - contourplot - heatplot) pour faire apparaitre les distributions marginales dans le graphique</li>
<li>Warning pour les histogrammes: la définition des bornes des peut différées d’un logiciel à l’autre, c’est le cas avec R (voir exemple ci-dessous)</li>
</ul>
<p><strong>Exemple</strong></p>
<p>Données:</p>
<ul>
<li>Prix des nuitées des logements proposés par “Airbnb” sur la côte d’Azur</li>
<li>N=10000</li>
<li>Exemple avec codes R: <a href="https://www.data-to-viz.com/story/OneNum.html" class="uri">https://www.data-to-viz.com/story/OneNum.html</a></li>
</ul>
<div id="histogramme" class="section level3" number="5.1.1">
<h3 number="5.1.1"><span class="header-section-number">5.1.1</span> Histogramme</h3>
<ul>
<li>Commande <code>histogram</code> si une variable ou <code>tw histogram</code> si plusieurs variables ou croisément dans un même graphique avec une variable catégorielle</li>
<li><strong><code>help histogram</code></strong></li>
</ul>
<p>Syntaxe avec 2 variables [graph non reporté]</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true"></a>tw histogram var1, <span class="kw">fc</span>(couleur) <span class="kw">lc</span>(couleur) <span class="op">||</span><span class="st"> </span>histogram var2, <span class="kw">fc</span>(couleur) <span class="kw">lc</span>(couleur)</span></code></pre></div>
<em>Graphique 55</em>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true"></a>clear</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true"></a>import delimited <span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/1_OneNum.csv&quot;</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>intervalle=<span class="dv">10</span> =<span class="er">&gt;</span><span class="st"> </span>ici intervalles par défaut</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true"></a>sort price</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true"></a>tw histogram price2 <span class="cf">if</span> price2<span class="op">&lt;</span><span class="dv">300</span>, freq <span class="kw">fc</span>(<span class="st">&quot;105 179 162%80&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;233 236 239&quot;</span>) <span class="kw">lw</span>(vvthin)  <span class="op">/</span><span class="er">//</span></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true"></a><span class="kw">title</span>(<span class="st">&quot;{bf:Night price distribution of Airbnb appartements}&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>))                      <span class="op">/</span><span class="er">//</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true"></a><span class="kw">start</span>(<span class="dv">0</span>) <span class="kw">width</span>(<span class="dv">10</span>)  <span class="op">/</span><span class="er">//</span></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true"></a><span class="kw">xlabel</span>(<span class="dv">0</span>(<span class="dv">50</span>)<span class="dv">300</span>)    <span class="op">/</span><span class="er">//</span><span class="st">  </span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true"></a><span class="kw">ylabel</span>(<span class="dv">0</span>(<span class="dv">250</span>)<span class="dv">800</span>) </span></code></pre></div>
</details>
<p><img src="imgf/g55.png" style="width:50.0%" /></p>
<p>Avec ggplot (R)</p>
<p><em>Graphique 56</em><br />
<img src="imgf/g56.png" style="width:50.0%" /></p>
<p>La définition des bornes des intervalles n’est donc pas la même: <strong>Stata</strong> <span class="math inline">\([lb;ub[\)</span> et <strong>R</strong> <span class="math inline">\(]lb;ub]\)</span>.<br />
Pour obtenir le même histogramme: <code>gen price2 = price - 1</code></p>
<p><em>Graphique 57</em><br />
<img src="imgf/g57.png" style="width:50.0%" /></p>
</div>
<div id="densité" class="section level3" number="5.1.2">
<h3 number="5.1.2"><span class="header-section-number">5.1.2</span> Densité</h3>
<ul>
<li>Commande <strong><code>kdensity</code></strong> [interne] <strong><code>kdens</code></strong> [externe - Ben Jann] pour tracer une courbe seulement</li>
<li>Pour reporter une aire on génère les coordonnées sous forme de variables avec l’option <code>gen(x d)</code> et on utilise les graphiques type <strong><code>area</code></strong> ou <strong><code>rarea</code></strong></li>
<li>options principales
<ul>
<li><strong><code>kernel()</code></strong> pour le type de smoothing.</li>
<li><strong><code>bw(#)</code></strong> pour le fenêtrage. Préférer <code>kernel(gauss)</code> pour un bon rendu.</li>
<li><strong><code>n(#)</code></strong> pour le nombre de coordonnées générées.</li>
<li><strong><code>nograph</code></strong> pour une densité sous forme d’aire, et gagner du temps d’exécution</li>
</ul></li>
</ul>
<em>Graphique 58</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true"></a>capt drop d x</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true"></a>kdensity price <span class="cf">if</span> price<span class="op">&lt;</span><span class="dv">300</span>, <span class="kw">gen</span>(x d) nogr</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true"></a>tw area  d x,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%90&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true"></a><span class="st">   </span><span class="kw">title</span>(<span class="st">&quot;Par défaut&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>) <span class="kw">size</span>(medium))  <span class="kw">name</span>(g1,replace) nodraw</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true"></a></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true"></a>capt drop d x</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true"></a>kdensity price <span class="cf">if</span> price<span class="op">&lt;</span><span class="dv">300</span>, <span class="kw">gen</span>(x d) nogr <span class="kw">kernel</span>(gauss) </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true"></a>tw area  d x,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%90&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true"></a><span class="st">   </span><span class="kw">title</span>(<span class="st">&quot;kernel(gauss)&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>) <span class="kw">size</span>(medium)) <span class="kw">name</span>(g2,replace) nodraw</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true"></a></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true"></a>capt drop d x</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true"></a>kdensity price <span class="cf">if</span> price<span class="op">&lt;</span><span class="dv">300</span>, <span class="kw">gen</span>(x d) nogr <span class="kw">kernel</span>(gauss) <span class="kw">n</span>(<span class="dv">200</span>) </span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true"></a>tw area  d x,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%90&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true"></a><span class="st">   </span><span class="kw">title</span>(<span class="st">&quot;kernel(gauss) + n(200)&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>) <span class="kw">size</span>(medium)) <span class="kw">name</span>(g3,replace) nodraw</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true"></a></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true"></a>capt drop d x</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true"></a>kdensity price <span class="cf">if</span> price<span class="op">&lt;</span><span class="dv">300</span>, <span class="kw">gen</span>(x d) nogr <span class="kw">kernel</span>(gauss) <span class="kw">bw</span>(<span class="dv">10</span>) <span class="kw">n</span>(<span class="dv">200</span>) </span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true"></a>tw area  d x,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%90&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true"></a><span class="kw">title</span>(<span class="st">&quot;kernel(gauss) + n(200) + bw(10)&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>) <span class="kw">size</span>(medium)) <span class="kw">name</span>(g4,replace) nodraw</span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true"></a></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true"></a>graph combine g1 g2 g3 g4</span></code></pre></div>
</details>
<p><em>Graphique 58</em><br />
<img src="imgf/g58.png" style="width:75.0%" /></p>
</div>
</div>
<div id="boxplot-et-violin-plot" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Boxplot et violin plot</h2>
<p><span class="badge badge-info">variable(s) continues(s)</span> <span class="badge badge-info">Croisement avec variables catégorielles</span></p>
<div id="boxplot" class="section level3" number="5.2.1">
<h3 number="5.2.1"><span class="header-section-number">5.2.1</span> Boxplot</h3>
<ul>
<li><p>Commande <strong><code>graph box</code></strong>. La syntaxe peut s’avérer pénible avec, au final, de grosses limitations (voir application plus bas)</p>
<ul>
<li>Pour changer les options des box [sans l’option <code>over</code>]: <strong><code>box(1, options) box(2, options)...</code></strong></li>
<li>Pour changer les options des markers (outliers) [sans l’option <code>over</code>]: <strong><code>m(1, options) m(2, options)...</code></strong></li>
<li>Sans l’option <code>over()</code> impossible de passer le libellé des box sur un axe (obligatoirement une légende)</li>
<li>Avec l’option <code>over()</code> les options <code>box(#,..)</code>* et *<code>marker(#,...). Aller savoir pourquoi. On peut de nouveau appliquer des couleurs différentes recréant des vartiables avec **</code>separate`**….lourd</li>
<li>Graphique de type oneway, on ne peut pas superposer d’autres information via un autre objet graphique</li>
</ul></li>
<li><p>Analyse des distributions: une ou plusieurs variables numériques ou une variable numérique par niveau d’une variable catégorielle</p></li>
<li><p>Résume la distribution de la variable numérique: Quartiles (la boite - box) - limites jusqu’à outliers (moustaches - whiskers) - outliers reportés par un nuage (option)</p></li>
<li><p>Limites:</p>
<ul>
<li>Ne permet pas de visualiser la forme de la distribution (unimodale, multimodale…)</li>
<li>Ne permet pas de visualiser si les différences d’effectifs</li>
</ul></li>
<li><p>Si deux variables, combinaison possible avec une visualisation vue de haut (<em>nuages</em> - <em>contourplot</em> - <em>heatplot</em>) pour regarder les distributions marginales dans le graphique</p></li>
<li><p>Amélioration de la box: retrait au niveau de la valeur médiane pour mieux la faire apparaître (<em>notches</em>): Non implémenté dans Stata</p></li>
<li><p>Ajout d’un nuage de point, d’un histogramme ou de spike pour vizualiser les distributions et les tailles des effectifs : Non implémenté dans Stata, mais on peut passer par des graphiques combiné Voir l’exemple ci-dessous</p></li>
</ul>
<p><strong>Exemple</strong></p>
<ul>
<li>Voir <a href="https://www.data-to-viz.com/caveat/boxplot.html" class="uri">https://www.data-to-viz.com/caveat/boxplot.html</a></li>
<li>Données: 4 variables générées aléatoirement</li>
<li>On utilisera la palette de couleur <strong>Spectral</strong> (collection <em>colorbrewer</em>)</li>
</ul>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true"></a>clear</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true"></a>set obs <span class="dv">1000</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true"></a></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true"></a>gen A =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">10</span>,<span class="dv">5</span>)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true"></a>gen B =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">13</span>,<span class="dv">1</span>) <span class="cf">in</span> <span class="dv">1</span><span class="op">/</span><span class="dv">500</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true"></a>replace B =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">18</span>,<span class="dv">1</span>) <span class="cf">in</span> <span class="dv">501</span><span class="op">/</span><span class="dv">1000</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true"></a>gen C =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">25</span>,<span class="dv">5</span>) <span class="cf">in</span> <span class="dv">1</span><span class="op">/</span><span class="dv">20</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true"></a>gen D =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">12</span>,<span class="dv">2</span>) <span class="cf">in</span> <span class="dv">1</span><span class="op">/</span><span class="dv">100</span></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true"></a></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true"></a>grstyle init</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true"></a>grstyle set mesh, compact </span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true"></a>grstyle set legend <span class="dv">6</span>, nobox</span></code></pre></div>
<strong>Box plot</strong><br />
<br> <em>Graphique 59</em>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true"></a>local varlist A B C D</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true"></a>colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true"></a>forvalue i=<span class="dv">1</span><span class="op">/</span><span class="dv">4</span> {</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true"></a>local box <span class="st">`</span><span class="dt">box&#39; box(</span><span class="st">`</span>i<span class="st">&#39;, fc(&quot;`r(p`i&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) lc(black) lw(vthin)) m(`i&#39;</span>, <span class="kw">mc</span>(<span class="st">&quot;`r(p`i&#39;)&#39;&quot;</span>) <span class="kw">mlw</span>(vthin) <span class="kw">mlc</span>(black) <span class="kw">msiz</span>(vsmall)<span class="er">)</span></span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true"></a>} </span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true"></a>graph box <span class="st">`</span><span class="dt">varlist&#39; , </span><span class="st">`</span>box<span class="st">&#39; legend(col(4))  name(g1,replace) </span></span></code></pre></div>
</details>
<p><img src="imgf/g64.png" style="width:75.0%" /></p>
<ul>
<li>Avantage: résume bien l’information niveau quantiles et présence potentielle d’outliers</li>
<li>Limite: pas d’information sur la forme des distributions et la taille des effectifs</li>
</ul>
<p><strong>Box plot + Histogramme</strong></p>
<p><em>Graphique 60</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true"></a>local k=<span class="dv">1</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>local varlist A B C D</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true"></a>foreach v of local varlist {</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true"></a>colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph </span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true"></a>local j=<span class="st">`</span><span class="dt">k++&#39;</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true"></a><span class="dt">tw histogram </span><span class="st">`</span>v<span class="st">&#39;, xlabel(,nogrid) ylabel(0(.05).25) xtitle(&quot;&quot;) ytitle(&quot;&quot;) ///</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true"></a><span class="st">fc(&quot;`r(p`j&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) lc(&quot;`r(p`j&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) name(`v&#39;</span>, replace<span class="er">)</span> nodraw</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true"></a>} </span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true"></a>graph combine <span class="st">`</span><span class="dt">varlist&#39;, col(4) name(g2,replace) ysize(10) xsize(20)</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true"></a><span class="dt">graph combine g1 g2, col(1) ysize(20) xsize(20)</span></span></code></pre></div>
</details>
<p><img src="imgf/g65.png" style="width:75.0%" /></p>
<ul>
<li><strong>Avantage</strong>: la variable B apparaît bien comme bimodale, la largeur des barres permet de visualiser la taille des effectifs, par exemple faible pour la variable B</li>
<li><strong>Limite</strong>: la commande <code>histogram</code> ne permet pas de mettre l’histogramme à l’horizontal….balot</li>
</ul>
<p><strong>Box plot + scatter</strong></p>
<p><em>Graphique 61</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true"></a>capt drop y</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true"></a>gen y =<span class="st"> </span><span class="kw">runiform</span>(<span class="dv">400</span>,<span class="dv">600</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true"></a>local k=<span class="dv">1</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true"></a><span class="op">*</span>local varlist A B C D</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true"></a>foreach v of local varlist {</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true"></a>colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph </span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true"></a>local j=<span class="st">`</span><span class="dt">k++&#39;</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true"></a><span class="dt">tw scatter   </span><span class="st">`</span>v<span class="st">&#39;  y,  xlabel(200(200)800) ylabel(-10(10)40) xlabel(,nogrid labc(%0)) ///</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true"></a><span class="st">xtitle(&quot;&quot;) ytitle(&quot;&quot;) jitter(1)                                                      ///                                                      </span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true"></a><span class="st">mc(&quot;`r(p`j&#39;</span><span class="er">)</span><span class="st">&#39;&quot;)  mlw(vvthin) msiz(tiny) name(`v&#39;</span><span class="dv">2</span>, replace<span class="er">)</span> nodraw</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true"></a>}</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true"></a></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true"></a>graph combine A2 B2 C2 D2 , <span class="kw">col</span>(<span class="dv">4</span>) <span class="kw">name</span>(g3,replace) </span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true"></a>graph combine g1 g3, <span class="kw">col</span>(<span class="dv">1</span>) <span class="kw">ysize</span>(<span class="dv">20</span>) <span class="kw">xsize</span>(<span class="dv">20</span>)</span></code></pre></div>
</details>
<p><img src="imgf/g66.png" style="width:75.0%" /></p>
<ul>
<li><strong>Avantages</strong>:
<ul>
<li>Idem qu’avac les histogrammes, on peut visualiser la bimodalité de B et les différences d’effectifs</li>
<li>lecture dans le même sens que les box</li>
</ul></li>
<li><strong>Limites/à prévoir</strong>:
<ul>
<li>Couleurs vraiment nécessaires???</li>
<li>Prévoir un nuage sur un sous-échantillon (problème d’overplotting). C’est limite pour les variables A et B</li>
</ul></li>
</ul>
<p><strong>Box plot + spike</strong> [variante du nuage]</p>
<p><em>Graphique 62</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true"></a>local k=<span class="dv">1</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>local varlist A B C D</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true"></a>foreach v of local varlist {</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true"></a>colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph <span class="kw">intensity</span>(<span class="dv">1</span>) </span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true"></a>local j=<span class="st">`</span><span class="dt">k++&#39;</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true"></a><span class="dt">spikeplot </span><span class="st">`</span>v<span class="st">&#39; ,  horizontal lc(&quot;`r(p`j&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) lw(vvthin) ///</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true"></a><span class="st">xlabel(0 1, labc(%0)) ylabel(-10(10)40) ytitle(&quot;&quot;) name(`v&#39;</span><span class="dv">3</span>, replace<span class="er">)</span> nodraw</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true"></a>}</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true"></a></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true"></a>graph combine A3 B3 C3 D3 , <span class="kw">col</span>(<span class="dv">4</span>) <span class="kw">name</span>(g4,replace) </span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true"></a>graph combine g1 g4, <span class="kw">col</span>(<span class="dv">1</span>) <span class="kw">ysize</span>(<span class="dv">20</span>) <span class="kw">xsize</span>(<span class="dv">20</span>)</span></code></pre></div>
</details>
<p><img src="imgf/g67.png" style="width:75.0%" /></p>
<p><strong>Avantages</strong> et <strong>limites</strong> identiques que pour le nuage de points</p>
</div>
<div id="violin-plot" class="section level3" number="5.2.2">
<h3 number="5.2.2"><span class="header-section-number">5.2.2</span> Violin plot</h3>
<p>Le graphique de type <em>violon</em> ajoute aux box plot un graphique de type aire représentant la densité d’une variable</p>
<ul>
<li>Seulement une commande externe <strong><code>vioplot</code></strong> de <strong>Nick Winter</strong> [<strong><code>ssc install vioplot</code></strong>]
<ul>
<li>On garde la main sur l’estimation de la densité avec les option <code>bw()</code> <code>kernel()</code> et <code>n()</code></li>
<li>Les échelles de la densité sont standardisée: affecte le rendu, et donc différence avec des fonctions issues d’autres logiciels. Ce n’est pas forcément une critique, mais il faut le savoir</li>
</ul></li>
<li>Principe du violon: Densité reportée en mirroir + boxplot</li>
<li>Si seulement les densités: <strong>bean plot</strong></li>
<li>Combinaison possible avec les visualisation de haut (nuages - contourplot - heatplot) pour faire apparaitre les distributions marginales dans le graphique</li>
<li>Pas dans la commande <code>vioplot</code>
<ul>
<li>Ajout de jitters ou d’un histogramme sur des intervalles très fins pour faire apparaître les sample size. On peut représenter un demi violon d’un côté et un histogramme de l’autre</li>
<li>Voir le dernier exemple de la section <strong>macro</strong> pour visualiser une variante, croisant 2 valeurs d’une variable catégorielle (pas possible avec vioplot) sur 2 demi violon</li>
</ul></li>
</ul>
<p><em>Graphique 63</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true"></a>grstyle init v, replace</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true"></a>grstyle set mesh, compact </span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true"></a>grstyle set legend <span class="dv">6</span>, nobox</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true"></a>grstyle set color Spectral, <span class="kw">n</span>(<span class="dv">4</span>)</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true"></a>local k=<span class="dv">1</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true"></a>local varlist A B C D</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true"></a>foreach v of local varlist {</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true"></a><span class="op">**</span>colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph </span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true"></a>local j=<span class="st">`</span><span class="dt">k++&#39;</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true"></a><span class="dt">tw scatter   </span><span class="st">`</span>v<span class="st">&#39;  y,  xlabel(200(200)800) ylabel(-10(10)40) xlabel(,nogrid labc(%0)) ///</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true"></a><span class="st">   xtitle(&quot;&quot;) ytitle(&quot;&quot;) jitter(1)  mc(black)  mlw(vvthin) msiz(tiny)                ///</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true"></a><span class="st">   name(`v&#39;</span><span class="dv">4</span>, replace<span class="er">)</span> nodraw</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true"></a>}</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true"></a>graph combine A4 B4 C4 D4 , <span class="kw">col</span>(<span class="dv">4</span>) <span class="kw">name</span>(g5,replace)</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true"></a></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true"></a>vioplot A B C D, <span class="kw">kernel</span>(gauss) <span class="kw">ygap</span>(<span class="dv">120</span>)       <span class="op">/</span><span class="er">//</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true"></a><span class="kw">median</span>(<span class="kw">m</span>(pipe) <span class="kw">msa</span>(<span class="dv">90</span>) <span class="kw">mc</span>(white) <span class="kw">mlw</span>(vvthin))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true"></a><span class="kw">density</span>(<span class="kw">lc</span>(black) <span class="kw">lw</span>(vthin))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true"></a><span class="kw">scheme</span>(v) <span class="kw">name</span>(g6,replace)</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true"></a></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true"></a>graph combine  g6 g5, <span class="kw">col</span>(<span class="dv">1</span>)</span></code></pre></div>
</details>
<p><img src="imgf/g68.png" style="width:75.0%" /></p>
<p>Ici on a ajouté le nuage en couleur noir, bien plus lisible pour les deux variables avec petit nombre d’observations</p>
<p><strong>Application Densités - Box Plot - Violin (bean) plot avec plusieurs variables (17)</strong></p>
<p><em>Comment représenter un nombre important de densités (ou histogramme) sur un même graphique [densité - box plot - violin plot - ridge line]</em></p>
<p><em>Données</em>: Question posée sur un forum de <em>Reddit</em> (N=49): quelle probabilité vous affectez à des expressions telles que “almostnochance” “unlikely” “abouteven” “probably” “almostcertainly”….En tout 17 expressions. La base comporte 17 variables (les expressions) et 46 observations.</p>
<p>Application données par le site <strong>data to viz</strong>. Code R disponible: <a href="https://www.data-to-viz.com/caveat/multi_distribution.html" class="uri">https://www.data-to-viz.com/caveat/multi_distribution.html</a></p>
<p><em>Préparation des données</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true"></a>clear</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true"></a>import delimited <span class="st">&quot;https://raw.githubusercontent.com/zonination/perceptions/master/probly.csv&quot;</span> </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true"></a>set obs <span class="st">`</span><span class="dt">=_N+200&#39;</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true"></a><span class="dt">order almostnochance highlyunlikely chancesareslight improbable /// </span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true"></a><span class="dt">      littlechance unlikely wedoubt probablynot abouteven betterthaneven ///</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true"></a><span class="dt">      likely probable webelieve probably verygoodchance highlylikely almostcertainly</span></span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true"></a></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true"></a><span class="dt">qui ds    </span></span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true"></a><span class="dt">local varlist </span><span class="st">`</span><span class="kw">r</span>(varlist)<span class="st">&#39;</span></span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true"></a><span class="st">*local varlist almostnochance unlikely abouteven probable almostcertainly</span></span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true"></a></span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true"></a><span class="st">sum `varlist&#39;</span></span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true"></a><span class="op">/</span><span class="er">*</span></span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true"></a><span class="st">  </span>Variable <span class="op">|</span><span class="st">        </span>Obs        Mean    Std. Dev.       Min        Max</span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true"></a><span class="op">-------------+---------------------------------------------------------</span></span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true"></a>almostnoch<span class="op">~</span>e <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">5.631522</span>    <span class="fl">13.81477</span>        <span class="fl">.05</span>         <span class="dv">95</span></span>
<span id="cb114-19"><a href="#cb114-19" aria-hidden="true"></a>highlyunli<span class="op">~</span>y <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">10.13043</span>      <span class="fl">13.523</span>          <span class="dv">2</span>         <span class="dv">90</span></span>
<span id="cb114-20"><a href="#cb114-20" aria-hidden="true"></a>chancesare<span class="op">~</span>t <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">14.08696</span>    <span class="fl">8.948808</span>          <span class="dv">5</span>         <span class="dv">40</span></span>
<span id="cb114-21"><a href="#cb114-21" aria-hidden="true"></a>  improbable <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">18.02176</span>    <span class="fl">14.38436</span>          <span class="dv">0</span>         <span class="dv">50</span></span>
<span id="cb114-22"><a href="#cb114-22" aria-hidden="true"></a>littlechance <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">15.97826</span>    <span class="fl">14.32091</span>          <span class="dv">2</span>        <span class="dv">100</span></span>
<span id="cb114-23"><a href="#cb114-23" aria-hidden="true"></a><span class="op">-------------+---------------------------------------------------------</span></span>
<span id="cb114-24"><a href="#cb114-24" aria-hidden="true"></a><span class="st">    </span>unlikely <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">19.93478</span>    <span class="fl">10.04745</span>          <span class="dv">2</span>         <span class="dv">36</span></span>
<span id="cb114-25"><a href="#cb114-25" aria-hidden="true"></a>     wedoubt <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">27.86957</span>    <span class="fl">20.17546</span>          <span class="dv">1</span>        <span class="dv">100</span></span>
<span id="cb114-26"><a href="#cb114-26" aria-hidden="true"></a> probablynot <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">29.47609</span>    <span class="fl">14.85888</span>         <span class="dv">10</span>        <span class="dv">100</span></span>
<span id="cb114-27"><a href="#cb114-27" aria-hidden="true"></a>   abouteven <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">49.56522</span>    <span class="fl">1.857743</span>         <span class="dv">40</span>         <span class="dv">52</span></span>
<span id="cb114-28"><a href="#cb114-28" aria-hidden="true"></a>betterthan<span class="op">~</span>n <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">58.39348</span>    <span class="fl">11.78821</span>          <span class="dv">5</span>         <span class="dv">98</span></span>
<span id="cb114-29"><a href="#cb114-29" aria-hidden="true"></a><span class="op">-------------+---------------------------------------------------------</span></span>
<span id="cb114-30"><a href="#cb114-30" aria-hidden="true"></a><span class="st">      </span>likely <span class="op">|</span><span class="st">         </span><span class="dv">46</span>          <span class="dv">72</span>    <span class="fl">9.874771</span>         <span class="dv">40</span>         <span class="dv">90</span></span>
<span id="cb114-31"><a href="#cb114-31" aria-hidden="true"></a>    probable <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">71.45652</span>    <span class="fl">10.24306</span>         <span class="dv">50</span>         <span class="dv">90</span></span>
<span id="cb114-32"><a href="#cb114-32" aria-hidden="true"></a>   webelieve <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">68.52174</span>    <span class="fl">16.73418</span>          <span class="dv">5</span>        <span class="dv">100</span></span>
<span id="cb114-33"><a href="#cb114-33" aria-hidden="true"></a>    probably <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">71.52174</span>    <span class="fl">10.97419</span>         <span class="dv">45</span>         <span class="dv">90</span></span>
<span id="cb114-34"><a href="#cb114-34" aria-hidden="true"></a>verygoodch<span class="op">~</span>e <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">79.76087</span>    <span class="fl">6.467645</span>         <span class="dv">65</span>         <span class="dv">91</span></span>
<span id="cb114-35"><a href="#cb114-35" aria-hidden="true"></a><span class="op">-------------+---------------------------------------------------------</span></span>
<span id="cb114-36"><a href="#cb114-36" aria-hidden="true"></a>highlylikely <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">86.21739</span>    <span class="fl">12.87877</span>         <span class="dv">15</span>         <span class="dv">99</span></span>
<span id="cb114-37"><a href="#cb114-37" aria-hidden="true"></a>almostcert<span class="op">~</span>y <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">92.64565</span>    <span class="fl">7.103542</span>         <span class="dv">60</span>         <span class="dv">99</span></span>
<span id="cb114-38"><a href="#cb114-38" aria-hidden="true"></a><span class="op">*</span><span class="er">/</span></span></code></pre></div>
</details>
<em>Densités sur un même graphique: illisible</em><br />
<br> <em>Graphique 64</em>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true"></a>qui ds    </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true"></a>local varlist <span class="st">`</span><span class="dt">r(varlist)&#39;</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true"></a><span class="dt">local w: word count(</span><span class="st">`</span>varlist<span class="st">&#39;)      </span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true"></a><span class="st">grstyle init</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true"></a><span class="st">grstyle set plain, horizontal grid</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true"></a><span class="st">grstyle set mesh</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true"></a><span class="st">grstyle set legend, nobox</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true"></a><span class="st">grstyle set color viridis, n(`w&#39;</span><span class="er">)</span> <span class="kw">opacity</span>(<span class="dv">60</span>) </span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true"></a>capt drop _x<span class="op">*</span><span class="st"> </span>_d<span class="op">*</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true"></a></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true"></a>local i =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true"></a>foreach v of local varlist {</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true"></a>colorpalette viridis, <span class="kw">n</span>(<span class="st">`</span><span class="dt">w&#39;) nograph opacity(50)</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true"></a><span class="dt">local j = </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true"></a></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true"></a><span class="st">local lab`j&#39;</span><span class="op">:</span><span class="st"> </span>variable label <span class="st">`</span><span class="dt">v&#39;</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true"></a><span class="dt">local leg </span><span class="st">`</span>leg<span class="st">&#39; `j&#39;</span> <span class="st">&quot;`lab`j&#39;&#39;&quot;</span></span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true"></a></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true"></a>local coul<span class="st">`</span><span class="dt">j&#39; &quot;&quot;</span><span class="st">`</span><span class="kw">r</span>(p<span class="st">`</span><span class="dt">j&#39;)&#39;&quot;&quot;</span></span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true"></a><span class="dt">qui kdensity </span><span class="st">`</span>v<span class="st">&#39;, generate(_x`j&#39;</span> _d<span class="st">`</span><span class="dt">j&#39;) nogr kernel(gauss) n(200)</span></span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true"></a><span class="dt">qui replace _x</span><span class="st">`</span>j<span class="st">&#39;=100 if _x`j&#39;</span><span class="op">&gt;</span><span class="dv">100</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true"></a>qui replace _x<span class="st">`</span><span class="dt">j&#39;=0 if _x</span><span class="st">`</span>j<span class="st">&#39;&lt;0</span></span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true"></a><span class="st">local area `area&#39;</span> area _d<span class="st">`</span><span class="dt">j&#39; _x</span><span class="st">`</span>j<span class="st">&#39;, xscale(r(0 100)) xlabel(0(10)100) fc(`coul`j&#39;&#39;) lc(`coul`j&#39;&#39;)   ||</span></span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true"></a><span class="st">tw `area&#39;</span>, <span class="kw">legend</span>(<span class="kw">order</span>(<span class="st">`</span><span class="dt">leg&#39;) pos(2) col(1)) xtitle(&quot;Probabilité assignée&quot;) scale(.6)</span></span></code></pre></div>
</details>
<p><img src="imgf/g60.png" style="width:75.0%" /></p>
<em>Solution 1: faceting</em><br />
<br> Densité [pas d’échelle commune pour l’axe y]<br />
<br> <em>Graphique 65</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true"></a>capt drop _x<span class="op">*</span><span class="st"> </span>_d<span class="op">*</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true"></a>qui ds</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true"></a>local varlist <span class="st">`</span><span class="dt">r(varlist)&#39;</span></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true"></a><span class="dt">local i = 1</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true"></a><span class="dt">foreach v of local varlist {</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true"></a><span class="dt">colorpalette viridis, n(17) nograph  opacity(80)</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true"></a><span class="dt">local j = </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true"></a><span class="st">local coul`j&#39;</span> <span class="st">&quot;&quot;`</span><span class="dt">r(p</span><span class="st">`</span>j<span class="st">&#39;)&#39;&quot;&quot;</span></span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true"></a>qui kdensity <span class="st">`</span><span class="dt">v&#39;, generate(_x</span><span class="st">`</span>j<span class="st">&#39; _d`j&#39;</span><span class="er">)</span> nogr <span class="kw">kernel</span>(gauss) <span class="kw">n</span>(<span class="dv">200</span>)</span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true"></a>qui replace _x<span class="st">`</span><span class="dt">j&#39;=100 if _x</span><span class="st">`</span>j<span class="st">&#39;&gt;100</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true"></a><span class="st">qui replace _x`j&#39;</span>=<span class="dv">0</span> <span class="cf">if</span> _x<span class="st">`</span><span class="dt">j&#39;&lt;0</span></span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true"></a><span class="dt">tw area _d</span><span class="st">`</span>j<span class="st">&#39; _x`j&#39;</span>, <span class="kw">xscale</span>(<span class="kw">r</span>(<span class="dv">0</span> <span class="dv">100</span>)) <span class="kw">xlabel</span>(<span class="dv">0</span>(<span class="dv">25</span>)<span class="dv">100</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="kw">fc</span>(<span class="st">`</span><span class="dt">coul</span><span class="st">`</span>j<span class="st">&#39;&#39;</span>) <span class="kw">lc</span>(<span class="st">`</span><span class="dt">coul</span><span class="st">`</span>j<span class="st">&#39;&#39;</span>) <span class="kw">name</span>(g<span class="st">`</span><span class="dt">j&#39;, replace) nodraw  </span></span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true"></a><span class="dt">local comb </span><span class="st">`</span>comb<span class="st">&#39; g`j&#39;</span></span>
<span id="cb116-15"><a href="#cb116-15" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb116-16"><a href="#cb116-16" aria-hidden="true"></a>graph combine <span class="st">`</span><span class="dt">comb&#39; , col(5)  title(&quot;Probabilité assignée&quot;, pos(11)) // xcommon ycommon</span></span></code></pre></div>
</details>
<p><img src="imgf/g61.png" style="width:75.0%" /></p>
<p><em>Graphique 66</em> Histogramme [échelle commune pour l’axe y] [A faire]</p>
<em>Solution 2: Box plot</em><br />
<br> <em>Graphique 67</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true"></a>grstyle init</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true"></a>grstyle set legend, nobox</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true"></a>grstyle set mesh, compact</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true"></a>grstyle set color viridis, <span class="kw">n</span>(<span class="dv">17</span>) <span class="kw">opacity</span>(<span class="dv">100</span>) </span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true"></a>forvalue i=<span class="dv">1</span><span class="op">/</span><span class="dv">17</span> {</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true"></a>colorpalette viridis, <span class="kw">n</span>(<span class="dv">17</span>)  nograph</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true"></a>local coul<span class="st">`</span><span class="dt">i&#39; &quot;&quot;</span><span class="st">`</span><span class="kw">r</span>(p<span class="st">`</span><span class="dt">i&#39;)&#39;&quot;&quot;</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true"></a><span class="dt">local barc </span><span class="st">`</span>barc<span class="st">&#39; bar(`i&#39;</span>, <span class="kw">fc</span>(<span class="st">`</span><span class="dt">coul</span><span class="st">`</span>i<span class="st">&#39;&#39;</span>) <span class="kw">lc</span>(black) <span class="kw">lw</span>(vthin))</span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true"></a>local marc <span class="st">`</span><span class="dt">marc&#39; m(</span><span class="st">`</span>i<span class="st">&#39;, mc(`coul`i&#39;&#39;) msiz(small) mlc(black) mlw(vthin))</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true"></a></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true"></a><span class="st">graph hbox almostnochance-almostcertainly, legend(pos(2) col(1) size(vsmall))  ///</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true"></a><span class="st"> `barc&#39;</span> <span class="st">`</span><span class="dt">marc&#39; </span></span></code></pre></div>
</details>
<p><img src="imgf/g62.png" style="width:75.0%" /> *Maudits graphiques oneway, obligé de passer par une légende</p>
<em>Solution 3: Violin plot</em> <br> <em>Graphique 68</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true"></a>capt drop _x<span class="op">*</span><span class="st"> </span>_d<span class="op">*</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true"></a>capt drop _md<span class="op">*</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true"></a>grstyle init</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true"></a>grstyle set plain</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true"></a>grstyle set legend, nobox</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true"></a>grstyle set mesh</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true"></a></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true"></a>qui ds</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true"></a>local varlist <span class="st">`</span><span class="dt">r(varlist)&#39;</span></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true"></a><span class="dt">local i = 1</span></span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true"></a><span class="dt">foreach v of local varlist {</span></span>
<span id="cb118-13"><a href="#cb118-13" aria-hidden="true"></a><span class="dt">colorpalette viridis, n(17) nograph </span></span>
<span id="cb118-14"><a href="#cb118-14" aria-hidden="true"></a><span class="dt">local j = </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></span>
<span id="cb118-15"><a href="#cb118-15" aria-hidden="true"></a><span class="st">local k = (`j&#39;</span><span class="op">-</span><span class="dv">1</span><span class="er">)</span><span class="op">*</span>.<span class="dv">7</span></span>
<span id="cb118-16"><a href="#cb118-16" aria-hidden="true"></a>local coul<span class="st">`</span><span class="dt">j&#39; &quot;&quot;</span><span class="st">`</span><span class="kw">r</span>(p<span class="st">`</span><span class="dt">j&#39;)&#39;&quot;&quot;</span></span>
<span id="cb118-17"><a href="#cb118-17" aria-hidden="true"></a><span class="dt">local lab</span><span class="st">`</span>j<span class="st">&#39;: variable label `v&#39;</span></span>
<span id="cb118-18"><a href="#cb118-18" aria-hidden="true"></a>local ylab <span class="st">`</span><span class="dt">ylab&#39; </span><span class="st">`</span>k<span class="st">&#39; &quot;`lab`j&#39;&#39;&quot;</span></span>
<span id="cb118-19"><a href="#cb118-19" aria-hidden="true"></a><span class="st">qui kdensity `v&#39;</span>, <span class="kw">generate</span>(_x<span class="st">`</span><span class="dt">j&#39; _d</span><span class="st">`</span>j<span class="st">&#39;) nogr kernel(gauss) bw(2) n(200) </span></span>
<span id="cb118-20"><a href="#cb118-20" aria-hidden="true"></a><span class="st">qui replace _x`j&#39;</span>=<span class="dv">100</span> <span class="cf">if</span> _x<span class="st">`</span><span class="dt">j&#39;&gt;100</span></span>
<span id="cb118-21"><a href="#cb118-21" aria-hidden="true"></a><span class="dt">qui replace _x</span><span class="st">`</span>j<span class="st">&#39;=0 if _x`j&#39;</span><span class="op">&lt;</span><span class="dv">0</span></span>
<span id="cb118-22"><a href="#cb118-22" aria-hidden="true"></a>qui sum _d<span class="st">`</span><span class="dt">j&#39;, d</span></span>
<span id="cb118-23"><a href="#cb118-23" aria-hidden="true"></a><span class="dt">local min</span><span class="st">`</span>j<span class="st">&#39;  `r(min)&#39;</span></span>
<span id="cb118-24"><a href="#cb118-24" aria-hidden="true"></a>local max<span class="st">`</span><span class="dt">j&#39;  </span><span class="st">`</span><span class="kw">r</span>(max)<span class="st">&#39;</span></span>
<span id="cb118-25"><a href="#cb118-25" aria-hidden="true"></a><span class="st">*qui replace _d`j&#39;</span>  =<span class="st"> </span>_d<span class="st">`</span><span class="dt">j&#39;*(.3/(</span><span class="st">`</span>max<span class="st">`</span><span class="dt">j&#39;&#39;- </span><span class="st">`</span>min<span class="st">`</span><span class="dt">j&#39;&#39;))</span></span>
<span id="cb118-26"><a href="#cb118-26" aria-hidden="true"></a><span class="dt">qui gen _md</span><span class="st">`</span>j<span class="st">&#39; = `k&#39;</span> <span class="op">-</span><span class="st"> </span>_d<span class="st">`</span><span class="dt">j&#39; </span></span>
<span id="cb118-27"><a href="#cb118-27" aria-hidden="true"></a><span class="dt">qui gen _d0</span><span class="st">`</span>j<span class="st">&#39;= `k&#39;</span></span>
<span id="cb118-28"><a href="#cb118-28" aria-hidden="true"></a>qui replace _d<span class="st">`</span><span class="dt">j&#39; = _d</span><span class="st">`</span>j<span class="st">&#39; + `k&#39;</span></span>
<span id="cb118-29"><a href="#cb118-29" aria-hidden="true"></a>local ops  <span class="kw">xscale</span>(<span class="kw">r</span>(<span class="dv">0</span> <span class="dv">100</span>)) <span class="kw">fc</span>(<span class="st">`</span><span class="dt">coul</span><span class="st">`</span>j<span class="st">&#39;&#39;</span>) <span class="kw">lc</span>(<span class="st">`</span><span class="dt">coul</span><span class="st">`</span>j<span class="st">&#39;&#39;</span>) <span class="kw">lw</span>(vvthin) </span>
<span id="cb118-30"><a href="#cb118-30" aria-hidden="true"></a>local rarea <span class="st">`</span><span class="dt">rarea&#39; rarea _d</span><span class="st">`</span>j<span class="st">&#39; _d0`j&#39;</span> _x<span class="st">`</span><span class="dt">j&#39;, </span><span class="st">`</span>ops<span class="st">&#39; || rarea _md`j&#39;</span> _d0<span class="st">`</span><span class="dt">j&#39; _x</span><span class="st">`</span>j<span class="st">&#39;, `ops&#39;</span> <span class="op">||</span></span>
<span id="cb118-31"><a href="#cb118-31" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb118-32"><a href="#cb118-32" aria-hidden="true"></a></span>
<span id="cb118-33"><a href="#cb118-33" aria-hidden="true"></a>tw <span class="st">`</span><span class="dt">rarea&#39;, legend(off)  xtitle(&quot;Probabilités assignées&quot;) ///</span></span>
<span id="cb118-34"><a href="#cb118-34" aria-hidden="true"></a><span class="dt">yscale(r(0 </span><span class="st">`</span>k<span class="st">&#39;)) xtitle(&quot;Probabilités assignées&quot;) ylabel(`ylab&#39;</span>, nogrid <span class="kw">angle</span>(<span class="dv">0</span>)) <span class="kw">title</span>(<span class="st">&quot;Violin Plots&quot;</span>) </span></code></pre></div>
</details>
<p><img src="imgf/g63.png" style="width:75.0%" /></p>
<p><em>Solution 4: Ridge line</em></p>
<ul>
<li>Appelé également <strong>Joy plot</strong>, en référence à la pochette de album de <strong>Joy Division</strong> <em>Unkown Pleasure</em>.</li>
<li>Beaucoup plus difficile, et plus long, à programmer si on veut appliquer proprement la théorie car on ne part pas d’une estimation des densités une à une. Sinon, on peut se contenter les densités du graphique précédent en excluant les densités en mirroir et en reparamétrant l’offset (différence entre les minimums des axes y pour chaque densité)</li>
<li>Solution dans R [<strong><code>ggridges</code></strong>] et Python. A faire avec Stata</li>
</ul>
</div>
</div>
<div id="nuages-scatter-et-densités-2d" class="section level2" number="5.3">
<h2 number="5.3"><span class="header-section-number">5.3</span> Nuages (scatter) et Densités 2d</h2>
<p><span class="badge badge-info">variables numériques</span> <span class="badge badge-info">Croisement avec variables catégorielles</span></p>
<ul>
<li>Représentation des distributions vues du dessus. La commande Stata est <strong>scatter</strong> [<strong>scatteri</strong> si on applique directement des coordonnées]</li>
<li>On peut ajouter dans un graphique combiné les représentations précédentes pour visualiser simultanément les distributions marginales</li>
<li>Le principal point de vigilance sur ce type de graphique est l’<strong>overplotting</strong> qui peut rendre le graphique difficile à lire: Solutions: ajouter des contours, réduire la taille des bulles, sélectionner un sous-échantillon, estimer et représenter les densités croisées</li>
<li>Densités croisées: plus il y a de bulles dans une zône, plus la densité est élevée.
<ul>
<li>Représentation empruntée à la topologie: des courbes de niveau. Plus la densité s’élève, plus l’écart entre deux courbes se ressère
<ul>
<li>Commande <strong>contourline</strong> et <strong>contourline</strong> après avoir estimé les densités avec la commande externe <strong>kdens2</strong> [Christopher J Baum]</li>
</ul></li>
<li>Histrogrammes vue de haut. On applique une palette de couleur séquentielle à la surface supérieure de l’histogramme
<ul>
<li>Commandes externe <strong>heatplot</strong> et <strong>hexplot</strong> [Ben Jann] =&gt; solution la plus simple et rendu efficace avec <strong>hexplot</strong></li>
</ul></li>
</ul></li>
</ul>
<div id="scatter" class="section level3" number="5.3.1">
<h3 number="5.3.1"><span class="header-section-number">5.3.1</span> Scatter</h3>
<p><span class="badge badge-info">Au moins deux variables continues</span> <span class="badge badge-info">Croisement avec variables catégorielles</span></p>
<ul>
<li>Distribution croisée vue du haut de deux variables. Avec une variable catégorielles, les différentes valeurs sont identifiées par des couleurs différentes</li>
<li>Limite: <strong>overplotting</strong></li>
<li>Combinaison possible avec les histogrammes, densités, boxplot et violin plot pour visualiser les distributions marginales des deux variables</li>
<li>Extension: <strong>bubble plot</strong> avec un poids pour chaque coordonnées</li>
</ul>
<p><strong>Exemple</strong></p>
<ul>
<li>Données sur les prix de vente des appartements à New-York selon la surface d’habitation ()</li>
<li>N = 1460</li>
<li>Variables <em>grlivarea</em> (surface d’habitation) et <em>saleprice</em> (prix)</li>
<li>Source: <a href="https://www.data-to-viz.com/story/TwoNum.html" class="uri">https://www.data-to-viz.com/story/TwoNum.html</a></li>
</ul>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true"></a>clear</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true"></a>import delimited  <span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/2_TwoNum.csv&quot;</span></span></code></pre></div>
<ul>
<li>Overplotting manifeste, graphique peu lisible</li>
</ul>
<p><em>Graphique 69</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true"></a>local ylab  <span class="dv">200000</span> <span class="st">&quot;20K&quot;</span> <span class="dv">400000</span> <span class="st">&quot;40k&quot;</span> <span class="dv">600000</span> <span class="st">&quot;60k&quot;</span> <span class="dv">800000</span> <span class="st">&quot;80k&quot;</span>, <span class="kw">angle</span>(<span class="dv">0</span>)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true"></a>tw scatter saleprice grlivarea, <span class="kw">mc</span>(<span class="st">&quot;105 179 162&quot;</span>)  <span class="kw">ylabel</span>(<span class="st">`</span><span class="dt">ylab&#39;) </span></span></code></pre></div>
</details>
<p><img src="imgf/g69.png" style="width:50.0%" /></p>
<ul>
<li><strong>Réduction/suppression de l’overplotting</strong>
<ul>
<li>Contour</li>
<li>Taille des bulles</li>
<li>Sous-échantilllon</li>
</ul></li>
</ul>
<p><em>Graphique 70</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true"></a>local ylab  <span class="dv">200000</span> <span class="st">&quot;20K&quot;</span> <span class="dv">400000</span> <span class="st">&quot;40k&quot;</span> <span class="dv">600000</span> <span class="st">&quot;60k&quot;</span> <span class="dv">800000</span> <span class="st">&quot;80k&quot;</span>, <span class="kw">angle</span>(<span class="dv">0</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true"></a><span class="op">*</span>Contour</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true"></a>tw scatter saleprice grlivarea, <span class="kw">mc</span>(<span class="st">&quot;105 179 162&quot;</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vvthin) <span class="kw">ylabel</span>(<span class="st">`</span><span class="dt">ylab&#39;) ///</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true"></a><span class="dt">title(&quot;contour noir vvthin&quot;, pos(1)) name(g1,replace)</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true"></a><span class="dt">tw scatter saleprice grlivarea, mc(&quot;105 179 162&quot;) mlc(white) mlw(vvthin) ylabel(</span><span class="st">`</span>ylab<span class="st">&#39;) ///</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true"></a><span class="st">title(&quot;contour blanc vvthin&quot;, pos(1)) name(g2,replace) </span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true"></a></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true"></a><span class="st">*Taille</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true"></a><span class="st">tw scatter saleprice grlivarea, mc(&quot;105 179 162&quot;) msiz(tiny) mlc(black) mlw(vvthin) /// </span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true"></a><span class="st">ylabel(`ylab&#39;</span>)  <span class="kw">title</span>(<span class="st">&quot;size tiny + contour 1&quot;</span>, <span class="kw">pos</span>(<span class="dv">1</span>)) <span class="kw">name</span>(g3,replace)</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true"></a></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true"></a>tw scatter saleprice grlivarea, <span class="kw">mc</span>(<span class="st">&quot;105 179 162&quot;</span>) <span class="kw">msiz</span>(vtiny) <span class="op">/</span><span class="er">//</span></span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true"></a><span class="kw">ylabel</span>(<span class="st">`</span><span class="dt">ylab&#39;)  title(&quot;size vtiny&quot;, pos(1)) name(g4,replace)</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true"></a></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true"></a><span class="dt">*Sample</span></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true"></a><span class="dt">capt gen u=runiform()</span></span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true"></a><span class="dt">tw scatter saleprice grlivarea if u&lt;.2, mc(&quot;105 179 162&quot;) mlc(black) mlw(vvthin) ///</span></span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true"></a><span class="dt">ylabel(</span><span class="st">`</span>ylab<span class="st">&#39;) xlabel(0(2000)6000) title(&quot;Sample 1: 20%&quot;, pos(1)) name(g5,replace)</span></span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true"></a></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true"></a><span class="st">tw scatter saleprice grlivarea if u&lt;.1, mc(&quot;105 179 162&quot;) mlc(black) mlw(vvthin) ///</span></span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true"></a><span class="st">ylabel(`ylab&#39;</span>) <span class="kw">xlabel</span>(<span class="dv">0</span>(<span class="dv">2000</span>)<span class="dv">6000</span>) <span class="kw">title</span>(<span class="st">&quot;Sample 2: 10%&quot;</span>, <span class="kw">pos</span>(<span class="dv">1</span>)) <span class="kw">name</span>(g6,replace)</span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true"></a></span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true"></a></span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true"></a>graph combine g1 g2 g3 g4 g5 g6, <span class="kw">col</span>(<span class="dv">2</span>) <span class="kw">xsize</span>(<span class="dv">20</span>) <span class="kw">ysize</span>(<span class="dv">20</span>) <span class="kw">scale</span>(.<span class="dv">6</span>)</span></code></pre></div>
</details>
<p><img src="imgf/g70.png" /></p>
</div>
<div id="densités-2d" class="section level3" number="5.3.2">
<h3 number="5.3.2"><span class="header-section-number">5.3.2</span> Densités 2d</h3>
<ul>
<li>On reporte la densité croisée des deux variables</li>
<li>Résoud le problème de l’overplotting</li>
<li><strong>Coutour plot</strong>:
<ul>
<li>Si seulement les lignes sont reportées: principe des courbes de niveau, plus les courbes se resserrent et plus la densité augente</li>
<li>On peut afecter une palette de couleuraux surfaces entre les lignes</li>
</ul></li>
<li><strong>Heatplot</strong>: principe d’un histogramme vu du dessus, avec une palette de couleurs séquentielle associée à la valeur de la densité. La surface est souvent représenté sous forme d’héxagone</li>
</ul>
<p><strong>Contourline et contour</strong></p>
<ul>
<li>On estime les densités avec la commande externe <strong><code>kdens2</code></strong> [<code>scc install kdens2</code>]</li>
<li>Un représentation graphique est directement possible avec la commande (idem <code>kdensity</code>), cependant je vais générer les variables dans une nouvelle base</li>
<li><strong>contour</strong> et <strong>contourline</strong>
<ul>
<li><strong><code>contourline</code></strong>: seulement les courbes de niveau sont reportées</li>
<li><strong><code>contour</code></strong>: une palette de couleurs, plutôt séquentielle, est affectée entre les courbes de niveau</li>
</ul></li>
<li>Le nombre de courbes de niveau est généré avec l’option n(#). Ne pas en abuser avec <code>contour</code> pour eviter les effets de flou</li>
<li>Options pour générer une palette de couleur: <code>scolor()</code> [start color] et <code>ecolor</code> [exit color], <code>cc()</code> [les n couleurs]. la palette générée par grstyle ou colorpalette est utilisable avec les macro <code>r(p(1))</code> (start color), <code>r(p(#))</code> (exit color) ou <code>r(p)</code> (palette de l’option cc())</li>
<li>Option pour les légendes: <strong><code>clengend()</code></strong> pour <strong><code>contouline</code></strong> et <strong><code>plegend()</code></strong> pour <code>contour</code></li>
</ul>
<p><strong>Exemple</strong></p>
<p>On reprend les données sur le prix de vente des appartements à New-York selon la surface d’habitation</p>
<em>Contourline</em> <br> <em>Graphique 71</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>estimation de la densité</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true"></a>kdens2 grlivarea saleprice, <span class="kw">saving</span>(k2d, replace) <span class="kw">n</span>(<span class="dv">100</span>) nodraw</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true"></a>use k2d, clear</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>couleur par défaut</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true"></a>tw contourline d  _saleprice _grlivarea, <span class="kw">plegend</span>(off)  <span class="kw">levels</span>(<span class="dv">15</span>) </span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>couleur  <span class="st">&quot;105 179 162&quot;</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true"></a>grstyle init</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true"></a>grstyle set mesh,  horizontal compact</span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true"></a>grstyle set color  <span class="st">&quot;105 179 162&quot;</span>, <span class="kw">n</span>(<span class="dv">15</span>)</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true"></a>tw contourline d  _saleprice _grlivarea, <span class="kw">plegend</span>(off)  <span class="kw">levels</span>(<span class="dv">15</span>) <span class="kw">cc</span>(<span class="st">`</span><span class="dt">r(p)&#39;) </span></span></code></pre></div>
</details>
<p><img src="imgf/g71.png" style="width:75.0%" /></p>
<ul>
<li>Il semble ici préférable ici de ne sélectionner qu’une partie des observation (&lt;3000 et &lt;400000)</li>
<li>On peut affecter une couleur par courbe (ici palette viridis avec n=15)</li>
</ul>
<em>Graphique 72</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true"></a>grstyle init</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true"></a>grstyle set mesh,  horizontal compact</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true"></a>grstyle set color  <span class="st">&quot;105 179 162&quot;</span>, <span class="kw">n</span>(<span class="dv">15</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true"></a>tw contourline d  _saleprice _grlivarea, <span class="kw">plegend</span>(off) <span class="kw">levels</span>(<span class="dv">15</span>) <span class="kw">cc</span>(<span class="st">`</span><span class="dt">r(p)&#39;)  ///</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true"></a><span class="dt">title(&quot;Une seule couleur&quot;) </span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true"></a></span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true"></a><span class="dt">* Avec une couleur par courbe de niveau </span></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true"></a><span class="dt">grstyle init</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true"></a><span class="dt">grstyle set mesh,  horizontal compact</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true"></a><span class="dt">grstyle set color  viridis, n(15)</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true"></a><span class="dt">tw contourline d  _saleprice _grlivarea, plegend(off) levels(15) cc(</span><span class="st">`</span><span class="kw">r</span>(p)<span class="st">&#39;) ///</span></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true"></a><span class="st">title(&quot;Une couleur par courbe&quot;)</span></span></code></pre></div>
</details>
<p><img src="imgf/g72.png" style="width:75.0%" /></p>
<p><em>Contour</em></p>
<ul>
<li>Appliquer une palette séquentielle simple avec une couleur d’arrivée peu intense donne un effet de flou qui ne rend pas la lecture du graphique agréable</li>
<li>Les palettes séquentielles plus complexe donne un résultat bien plus satisfaisant (ici viridis)</li>
</ul>
<p><em>Graphiques 73 et 74</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Palettes simples</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true"></a>grstyle init</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true"></a>grstyle set mesh,  horizontal</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true"></a>grstyle set color white <span class="st">&quot;105 179 162&quot;</span> , <span class="kw">n</span>(<span class="dv">15</span>) </span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true"></a>tw contour d  _saleprice _grlivarea , <span class="kw">levels</span>(<span class="dv">15</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true"></a><span class="kw">clegend</span>(off) <span class="kw">cc</span>(<span class="st">`</span><span class="dt">r(p)&#39;) </span></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true"></a></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true"></a><span class="dt">grstyle init</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true"></a><span class="dt">grstyle set mesh,  horizontal</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true"></a><span class="dt">grstyle set color white &quot;105 179 162&quot; , n(15) reverse</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true"></a><span class="dt">tw contour d  _saleprice _grlivarea , levels(15) ///</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true"></a><span class="dt">clegend(off) cc(</span><span class="st">`</span><span class="kw">r</span>(p)<span class="st">&#39;) </span></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true"></a></span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true"></a><span class="st">grstyle init</span></span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true"></a><span class="st">grstyle set mesh,  horizontal</span></span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true"></a><span class="st">grstyle set color white green , n(15) </span></span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true"></a><span class="st">tw contour d  _saleprice _grlivarea , levels(15) ///</span></span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true"></a><span class="st">clegend(off) cc(`r(p)&#39;</span>) </span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true"></a></span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true"></a>grstyle init</span>
<span id="cb124-21"><a href="#cb124-21" aria-hidden="true"></a>grstyle set mesh,  horizontal</span>
<span id="cb124-22"><a href="#cb124-22" aria-hidden="true"></a>grstyle set color white green , <span class="kw">n</span>(<span class="dv">15</span>) reverse </span>
<span id="cb124-23"><a href="#cb124-23" aria-hidden="true"></a>tw contour d  _saleprice _grlivarea , <span class="kw">levels</span>(<span class="dv">15</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb124-24"><a href="#cb124-24" aria-hidden="true"></a><span class="kw">clegend</span>(off) <span class="kw">cc</span>(<span class="st">`</span><span class="dt">r(p)&#39;)</span></span>
<span id="cb124-25"><a href="#cb124-25" aria-hidden="true"></a></span>
<span id="cb124-26"><a href="#cb124-26" aria-hidden="true"></a><span class="dt">* Palette viridis</span></span>
<span id="cb124-27"><a href="#cb124-27" aria-hidden="true"></a><span class="dt">grstyle init</span></span>
<span id="cb124-28"><a href="#cb124-28" aria-hidden="true"></a><span class="dt">grstyle set mesh,  horizontal</span></span>
<span id="cb124-29"><a href="#cb124-29" aria-hidden="true"></a><span class="dt">grstyle set color viridis , n(15) </span></span>
<span id="cb124-30"><a href="#cb124-30" aria-hidden="true"></a><span class="dt">tw contour d  _saleprice _grlivarea , levels(15) ///</span></span>
<span id="cb124-31"><a href="#cb124-31" aria-hidden="true"></a><span class="dt">clegend(off) cc(</span><span class="st">`</span><span class="kw">r</span>(p)<span class="st">&#39;) </span></span>
<span id="cb124-32"><a href="#cb124-32" aria-hidden="true"></a><span class="st">grstyle init</span></span>
<span id="cb124-33"><a href="#cb124-33" aria-hidden="true"></a><span class="st">grstyle set mesh,  horizontal</span></span>
<span id="cb124-34"><a href="#cb124-34" aria-hidden="true"></a><span class="st">grstyle set color viridis , n(15) reverse</span></span>
<span id="cb124-35"><a href="#cb124-35" aria-hidden="true"></a><span class="st">tw contour d  _saleprice _grlivarea , levels(15) ///</span></span>
<span id="cb124-36"><a href="#cb124-36" aria-hidden="true"></a><span class="st">clegend(off) cc(`r(p)&#39;</span>) </span></code></pre></div>
</details>
<p><img src="imgf/g73.png" style="width:75.0%" /></p>
<p><img src="imgf/g74.png" style="width:75.0%" /></p>
<ul>
<li>L’effet image dissociée et en superposition des axes peut être corrigé avec xlab() et ylab()</li>
</ul>
<em>Graphique 75</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true"></a>grstyle init</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true"></a>grstyle set mesh,  horizontal</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true"></a>grstyle set color  viridis, <span class="kw">n</span>(<span class="dv">15</span>)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true"></a>tw contour d  _saleprice _grlivarea , <span class="op">/</span><span class="er">//</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true"></a><span class="kw">xlabel</span>(<span class="dv">200</span> <span class="dv">1000</span> <span class="dv">2000</span> <span class="dv">2500</span> <span class="dv">3000</span>,nogrid) <span class="kw">ylabel</span>(<span class="dv">50000</span>(<span class="dv">50000</span>)<span class="dv">400000</span>, nogrid) <span class="kw">levels</span>(<span class="dv">15</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true"></a><span class="kw">clegend</span>(off)<span class="kw">xlabel</span>(,) <span class="kw">cc</span>(<span class="st">`</span><span class="dt">r(p)&#39;)  </span></span></code></pre></div>
</details>
<p><img src="imgf/g75.png" style="width:50.0%" /></p>
<p><strong>Heatplot et hexplot (Ben Jann)</strong></p>
<ul>
<li>Encore une commande <em>magique</em> de B.Jann (<code>ssc install heatplot</code>): <a href="https://www.stata.com/meeting/germany19/slides/germany19_Jann.pdf" class="uri">https://www.stata.com/meeting/germany19/slides/germany19_Jann.pdf</a></li>
<li>Principe: on représente un histogramme bivarié en appliquant une palette de couleur séquentielle sur la surface du dessus. On perçoit donc la hauteur des barres.</li>
<li>La représentation avec des hexagones est supérieure</li>
<li>Par défaut, syntaxe très simple. A préférer donc aux représentations précédente avec Stata</li>
</ul>
<p><em>Graphique 76</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true"></a>heatplot saleprice  grlivarea, <span class="kw">title</span>(<span class="st">&quot;heatplot&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>)) <span class="kw">name</span>(g1,replace) <span class="kw">color</span>(plasma)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true"></a>hexplot saleprice  grlivarea,  <span class="kw">title</span>(<span class="st">&quot;hexplot&quot;</span>,  <span class="kw">pos</span>(<span class="dv">11</span>)) <span class="kw">name</span>(g2,replace) <span class="kw">color</span>(plasma)</span></code></pre></div>
</details>
<p><img src="imgf/g76.png" style="width:75.0%" /></p>
</div>
<div id="les-graphiques-bulles" class="section level3" number="5.3.3">
<h3 number="5.3.3"><span class="header-section-number">5.3.3</span> Les graphiques bulles</h3>
<ul>
<li>On ajoute un poids aux observation</li>
<li>La surface de la bulle est relative à ce poids</li>
<li>Utile avec des données démographiques pour tenir compte de la taille de la population</li>
</ul>
<p><strong>Exemple</strong></p>
<ul>
<li>Espérance de vie et revenu par tête (échelle log)</li>
<li>Données regroupées par continent (cf le graphique de l’enfer)</li>
<li>Pondération sur la population des pays</li>
<li>Graphique populaire en version animée: <a href="https://www.gapminder.org/tools/#$state$time$value=2019" class="uri">https://www.gapminder.org/tools/#$state$time$value=2019</a>;;&amp;chart-type=bubbles</li>
<li>Une version interactive permet d’améliorer la visualisation (nom des pays et valeurs de l’expérance de vie, du revenu et taille de la population)</li>
<li>Version du graphique sur data-viz:
<ul>
<li>Pourquoi ne pas avoir utiiser une échelle log pour le revenu?</li>
</ul></li>
<li>Attention à l’ordre des variables et aux choix des couleurs
<ul>
<li>Mettre l’Asie en arrière plan en raison de la taille des population des l’Inde et de la Chine</li>
<li>Eviter les stéréotypes comme l’Asie en jaune</li>
</ul></li>
<li>Limite Stata: la taille des bulles dans une légende avec la valeur correspondante de la pondération (voir second graphique pour une solution manuelle)</li>
</ul>
<p><em>Graphique 77</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true"></a>local y <span class="dv">1952</span> <span class="dv">2007</span></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true"></a>foreach y2 of local y {</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true"></a></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true"></a>grstyle init </span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true"></a>grstyle set legend <span class="dv">2</span>, nobox stack</span>
<span id="cb127-7"><a href="#cb127-7" aria-hidden="true"></a>grstyle set mesh,  horizontal compact</span>
<span id="cb127-8"><a href="#cb127-8" aria-hidden="true"></a>grstyle set color viridis, <span class="kw">n</span>(<span class="dv">5</span>) <span class="kw">opacity</span>(<span class="dv">60</span>) <span class="kw">select</span>(<span class="dv">2</span> <span class="dv">3</span> <span class="dv">1</span> <span class="dv">4</span> <span class="dv">5</span>)</span>
<span id="cb127-9"><a href="#cb127-9" aria-hidden="true"></a></span>
<span id="cb127-10"><a href="#cb127-10" aria-hidden="true"></a>local leg  <span class="st">&quot;order(1 &quot;</span>Asia<span class="st">&quot; 2 &quot;</span>Americas<span class="st">&quot; 3 &quot;</span>Africa<span class="st">&quot; 4 &quot;</span>Europe<span class="st">&quot; 5 &quot;</span>Oceania<span class="st">&quot;)&quot;</span></span>
<span id="cb127-11"><a href="#cb127-11" aria-hidden="true"></a>local mc  <span class="kw">mc</span>(<span class="st">`</span><span class="dt">r(p)&#39;)  </span></span>
<span id="cb127-12"><a href="#cb127-12" aria-hidden="true"></a><span class="dt">local mlc  mlc(</span><span class="st">`</span><span class="kw">r</span>(p)<span class="st">&#39;)</span></span>
<span id="cb127-13"><a href="#cb127-13" aria-hidden="true"></a><span class="st">local mlw  &quot;mlw(vthin vthin vthin vthin)&quot;</span></span>
<span id="cb127-14"><a href="#cb127-14" aria-hidden="true"></a></span>
<span id="cb127-15"><a href="#cb127-15" aria-hidden="true"></a><span class="st">tw scatter as_lf am_lf af_lf eu_lf oc_lf gdppercap [w=pop] if year==`y2&#39;</span>,   <span class="op">/</span><span class="er">//</span></span>
<span id="cb127-16"><a href="#cb127-16" aria-hidden="true"></a><span class="st">`</span><span class="dt">mlc&#39; </span><span class="st">`</span>mlw<span class="st">&#39; `mc&#39;</span>                                                            <span class="op">/</span><span class="er">//</span></span>
<span id="cb127-17"><a href="#cb127-17" aria-hidden="true"></a><span class="kw">ylabel</span>(<span class="dv">20</span>(<span class="dv">10</span>)<span class="dv">90</span>) <span class="kw">ytitle</span>(<span class="st">&quot;Espérance de vie&quot;</span>)                                 <span class="op">/</span><span class="er">//</span></span>
<span id="cb127-18"><a href="#cb127-18" aria-hidden="true"></a><span class="kw">xlabel</span>(<span class="dv">300</span> <span class="dv">1000</span> <span class="dv">10000</span> <span class="dv">25000</span> <span class="dv">110000</span>          )   <span class="kw">xtitle</span>(<span class="st">&quot;&quot;</span>)                  <span class="op">/</span><span class="er">//</span></span>
<span id="cb127-19"><a href="#cb127-19" aria-hidden="true"></a><span class="kw">legend</span>(<span class="kw">pos</span>(<span class="dv">3</span>) <span class="kw">col</span>(<span class="dv">1</span>)<span class="st">`</span><span class="dt">leg&#39;)  ysize(10) xsize(20) xscale(log)                 ///</span></span>
<span id="cb127-20"><a href="#cb127-20" aria-hidden="true"></a><span class="dt">title(&quot;</span><span class="st">`</span>y2<span class="st">&#39;&quot;, pos(11)) xtitle(&quot;Revenu par habitant&quot;)  name(g`i++&#39;</span>, replace) </span>
<span id="cb127-21"><a href="#cb127-21" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb127-22"><a href="#cb127-22" aria-hidden="true"></a></span>
<span id="cb127-23"><a href="#cb127-23" aria-hidden="true"></a>grc1leg  g1 g2, <span class="kw">col</span>(<span class="dv">1</span>) <span class="kw">leg</span>(g1) <span class="kw">pos</span>(<span class="dv">3</span>)</span></code></pre></div>
</details>
<p><em>Remarque: les deux graphiques étant générés dans une boucle, je n’ai pas enlevé le label de x pour 1952</em></p>
<p><img src="imgf/g86.png" style="width:75.0%" /></p>
<p><em>Ajout d’une légende pour la taille des bulles</em><br />
Il y a surement mieux à faire, et voir si on peut automatiser</p>
<p><em>Graphique 78</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true"></a>gen     w=<span class="dv">1000000</span>  <span class="cf">in</span> <span class="dv">1</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true"></a>replace w=<span class="dv">10000000</span> <span class="cf">in</span> <span class="dv">2</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true"></a>replace w=<span class="dv">50000000</span> <span class="cf">in</span> <span class="dv">3</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true"></a>replace w=<span class="dv">100000000</span> <span class="cf">in</span> <span class="dv">4</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true"></a>replace w=<span class="dv">500000000</span> <span class="cf">in</span> <span class="dv">5</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true"></a>replace w=<span class="dv">1000000000</span> <span class="cf">in</span> <span class="dv">6</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true"></a></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true"></a>gen x=.</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true"></a>gen y=.</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true"></a>forvalue i=<span class="dv">1</span><span class="op">/</span><span class="dv">6</span> {</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true"></a>replace y=<span class="dv">0</span> <span class="cf">in</span> <span class="st">`</span><span class="dt">i&#39;</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true"></a><span class="dt">replace x=</span><span class="st">`</span>i<span class="st">&#39; in `i&#39;</span></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true"></a>}</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true"></a></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true"></a>tw scatter y x [w=w], <span class="kw">xlab</span>(<span class="dv">0</span>(<span class="dv">1</span>)<span class="dv">7</span>,nogrid <span class="kw">labc</span>(<span class="op">%0)) ylab(,nogrid labc(%</span><span class="dv">0</span>)) <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true"></a><span class="st"> </span><span class="kw">xtitle</span>(<span class="st">&quot;&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true"></a><span class="kw">mc</span>(white) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true"></a><span class="kw">text</span>(.<span class="dv">3</span> <span class="dv">1</span> <span class="st">&quot;1M&quot;</span>, <span class="kw">color</span>(black))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true"></a><span class="kw">text</span>(.<span class="dv">4</span> <span class="dv">2</span> <span class="st">&quot;10M&quot;</span>, <span class="kw">color</span>(black))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true"></a><span class="kw">text</span>(.<span class="dv">5</span> <span class="dv">3</span> <span class="st">&quot;50M&quot;</span>, <span class="kw">color</span>(black))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true"></a><span class="kw">text</span>(.<span class="dv">6</span> <span class="dv">4</span> <span class="st">&quot;100M&quot;</span>, <span class="kw">color</span>(black))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true"></a><span class="kw">text</span>(.<span class="dv">8</span> <span class="dv">5</span> <span class="st">&quot;500M&quot;</span>, <span class="kw">color</span>(black))  <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true"></a><span class="kw">text</span>( <span class="dv">1</span> <span class="dv">6</span> <span class="st">&quot;1000M&quot;</span>, <span class="kw">color</span>(black))  <span class="op">/</span><span class="er">//</span><span class="st">  </span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true"></a><span class="kw">fxsize</span>(<span class="dv">100</span>) <span class="kw">fysize</span>(<span class="dv">20</span>) <span class="kw">name</span>(g3,replace) <span class="op">/</span><span class="er">//</span></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true"></a><span class="kw">title</span>(<span class="st">&quot;Population size&quot;</span>, <span class="kw">pos</span>(<span class="dv">9</span>))</span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true"></a></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true"></a>grc1leg g1 g2 g3, <span class="kw">col</span>(<span class="dv">1</span>) <span class="kw">leg</span>(g1) <span class="kw">pos</span>(<span class="dv">3</span>) <span class="kw">ring</span>(<span class="dv">1</span>) <span class="kw">graphr</span>(<span class="kw">margin</span>(vsmall))</span></code></pre></div>
</details>
<p><img src="imgf/g87.png" style="width:75.0%" /></p>
</div>
</div>
<div id="courbes-et-associés" class="section level2" number="5.4">
<h2 number="5.4"><span class="header-section-number">5.4</span> Courbes et associés</h2>
<p><span class="badge badge-info">variables continues</span> <span class="badge badge-info">Croisement avec variables catégorielles</span></p>
<div id="line---connected" class="section level3" number="5.4.1">
<h3 number="5.4.1"><span class="header-section-number">5.4.1</span> line - connected</h3>
<ul>
<li>Commande <strong><code>line</code></strong> ou <strong><code>tsline</code></strong> en mode série chronologique (<code>help tsset</code>)</li>
<li>Commande <strong><code>connected</code></strong> pour faire apparaitre les points d’intersection des coordonnées (si point d’observation peu nombreux)</li>
<li>On peut utiliser l’option recast pour transformer le graphique en un graphique d’un autre type, en particulier en ajoutant une aire: <strong><code>recast(area</code>)</strong></li>
<li>On peut générer des graphiques type <em>facet</em> avec l’option <code>by(nom_variable)</code>. Mais on ne pourra pas affecter une couleur différente pour chaque courbe</li>
<li>Point de vigilance: si plus de 4-5 courbes, il est difficile de les suivre: <strong>effet spaghetti</strong>
<ul>
<li>Solutions:
<ul>
<li>Mettre la ou quelques courbes en highlight</li>
<li>Un graphique par courbe (facet)</li>
<li>Mixer les deux approches</li>
</ul></li>
</ul></li>
<li>Pensez également à jouer sur la taille du graphique en particulier sur le ratio des longueurs des axes x et y avec <code>xsize(#)</code> et <code>ysize(#)</code> (max#=20)</li>
</ul>
<p><strong>Exemple</strong></p>
<ul>
<li>Exemple et codes R: <a href="https://www.data-to-viz.com/story/TwoNumOrdered.html" class="uri">https://www.data-to-viz.com/story/TwoNumOrdered.html</a></li>
<li>Sur un graphique, Stata s’en sort mieux que R…Enjoy!…mais ça ne risque pas de se reproduire</li>
<li>Evolution du cours du bitcoin entre avril 2013 et avril 2018</li>
<li>Je n’ai pas utilisé la commande <em><code>tsline</code></em> bien que l’on soit clairement avec une série chronologique (observation hebdomadaires)<br />
</li>
<li>Je ne m’étendrai pas sur la manipulation des variables date et la modification de leur format, dont j’ai horreur</li>
</ul>
<p><em>Courbe</em></p>
<em>Graphique 79</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true"></a>clear</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true"></a>import delimited <span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/3_TwoNumOrdered.csv&quot;</span>, <span class="op">/</span><span class="er">//</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true"></a><span class="kw">delimiter</span>(space) </span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true"></a>gen Date =<span class="st"> </span><span class="kw">date</span>(date, <span class="st">&quot;YMD&quot;</span>)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true"></a>format Date %td</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true"></a></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true"></a>tw line value Date, <span class="kw">lc</span>(<span class="st">&quot;105 179 162&quot;</span>) <span class="kw">tlabel</span>(, <span class="kw">format</span>(%tdCy)) <span class="kw">xsize</span>(<span class="dv">12</span>) <span class="kw">ysize</span>(<span class="dv">7</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true"></a><span class="kw">ytitle</span>(<span class="st">&quot;bitcoin price ($)&quot;</span>) <span class="kw">title</span>(<span class="st">&quot;Evolution of Bitcoin price&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>))</span></code></pre></div>
</details>
<p><img src="imgf/g77.png" style="width:50.0%" /></p>
<em>Avec une aire (option recast)</em><br />
<br> <em>Graphique 80</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true"></a>tw line value Date, <span class="kw">lc</span>(<span class="st">&quot;105 179 162&quot;</span>) <span class="kw">tlabel</span>(, <span class="kw">format</span>(<span class="op">%tdCy)) recast(area) fcolor(&quot;105 179 162%</span><span class="dv">70</span><span class="st">&quot;) ///</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true"></a><span class="st">xsize(15) ysize(7) ytitle(&quot;</span>bitcoin <span class="kw">price</span> (<span class="op">$</span>)<span class="st">&quot;) title(&quot;</span>Evolution of Bitcoin price<span class="st">&quot;, pos(11))</span></span></code></pre></div>
</details>
<p><img src="imgf/g78.png" style="width:50.0%" /></p>
<p><em>Connected</em></p>
<ul>
<li>On prend seulement les 10 dernières observations</li>
<li>Visiblement, on ne peut pas utiliser <code>connected</code> avec l’option <code>recast(area)</code> en gardant les markers, ajout d’un graphique <code>rarea</code>.</li>
</ul>
<em>Graphique 81</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true"></a>local o <span class="kw">tlabel</span>(, <span class="kw">format</span>(%tddm)) <span class="kw">ylab</span>(<span class="dv">8000</span>(<span class="dv">250</span>)<span class="dv">9000</span>)</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true"></a>tw area value Date   <span class="cf">if</span> Date[_n]<span class="op">&gt;</span>Date[_N<span class="dv">-10</span>],   <span class="kw">lc</span>(<span class="op">%0)             fcolor(&quot;105 179 162%</span><span class="dv">70</span><span class="st">&quot;) `o&#39; ||   ///</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true"></a><span class="st">connected value Date if Date[_n]&gt;Date[_N-10],   mc(&quot;</span><span class="dv">105</span> <span class="dv">179</span> <span class="dv">162</span><span class="st">&quot;)  lcolor(&quot;</span><span class="dv">105</span> <span class="dv">179</span> <span class="dv">162</span>%<span class="dv">70</span><span class="st">&quot;) `o&#39; || , /// </span></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true"></a><span class="st">legend(off)   xsize(15) ysize(7)</span></span></code></pre></div>
</details>
<p><img src="imgf/g79.png" style="width:50.0%" /></p>
<p><em>2 sous-aires à partir d’une valeur de référence</em></p>
<ul>
<li>Visiblement ça bloque un peu du côté de ggplot2, plutôt facile avec Stata (ça ne risque pas de se reproduire souvent)</li>
</ul>
<em>Graphique 82</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true"></a>gen x =<span class="st"> </span>value<span class="op">&gt;</span><span class="dv">7500</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true"></a></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true"></a>gen val0 =<span class="st"> </span>value        <span class="cf">if</span> x<span class="op">==</span><span class="dv">0</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true"></a>replace val0 =<span class="st"> </span><span class="dv">7500</span>     <span class="cf">if</span> x<span class="op">==</span><span class="dv">1</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true"></a>gen val1 =<span class="st"> </span>value        <span class="cf">if</span> x<span class="op">==</span><span class="dv">1</span></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true"></a>replace val1 =<span class="st"> </span><span class="dv">7500</span>     <span class="cf">if</span> x<span class="op">==</span><span class="dv">0</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true"></a></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true"></a>gen ref=<span class="dv">7500</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true"></a></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true"></a>tw rarea ref val1 Date <span class="cf">if</span> Date<span class="op">&gt;</span><span class="kw">td</span>(1jul2017) ,  <span class="kw">fc</span>(<span class="st">&quot;39 21 105%60&quot;</span>)   <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">lw</span>(vthin) <span class="op">/</span><span class="er">//</span></span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true"></a><span class="er">||</span><span class="st"> </span>rarea val0 ref Date <span class="cf">if</span> Date<span class="op">&gt;</span><span class="kw">td</span>(1jul2017) ,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%60&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">lw</span>(vthin) <span class="op">/</span><span class="er">//</span></span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true"></a>, <span class="kw">legend</span>(off)  <span class="kw">xsize</span>(<span class="dv">15</span>) <span class="kw">ysize</span>(<span class="dv">10</span>) <span class="kw">xlab</span>(,<span class="kw">format</span>(%td_my)) <span class="kw">ylab</span>(,<span class="kw">angle</span>(<span class="dv">0</span>)) <span class="op">/</span><span class="er">//</span></span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true"></a><span class="kw">ytitle</span>(<span class="st">&quot;bitcoin price ($)&quot;</span>) <span class="kw">title</span>(<span class="st">&quot;Evolution of Bitcoin price&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>))</span></code></pre></div>
</details>
<p><img src="imgf/g80.png" style="width:50.0%" /></p>
<p><em>Spike</em></p>
<ul>
<li>Ajout d’un graphique, ici combiné vue les valeurs prises, qui donne la différence entre la valeur journalière du bitcoin et sa moyenne des 30 jours précédents</li>
<li>Encore quelques soucis pour bien caler les axes entre les deux graphiques, même si cela ne se voit pas trop</li>
</ul>
<p><em>Graphique 83</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true"></a>qui keep <span class="cf">if</span> Date<span class="op">&gt;</span><span class="kw">td</span>(1jul2017)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true"></a>qui levelsof Date, <span class="kw">local</span>(d)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true"></a>local N<span class="op">:</span><span class="st"> </span>word <span class="kw">count</span>(<span class="st">`</span><span class="dt">d&#39;)</span></span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true"></a></span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true"></a><span class="dt">* Calcul des moyennes entre t-1 et t-30</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true"></a><span class="dt">gen x=_n</span></span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true"></a><span class="dt">gen m=.</span></span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true"></a><span class="dt">local j=1</span></span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true"></a><span class="dt">forv i=31/</span><span class="st">`</span>N<span class="st">&#39; {</span></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true"></a><span class="st">local k = `j++&#39;</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true"></a>qui gen <span class="dt">n=</span>_n<span class="dv">-30</span> <span class="op">-</span><span class="st"> `</span><span class="dt">k&#39;  if x&lt;=</span><span class="st">`</span>i<span class="st">&#39;</span></span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true"></a><span class="st">qui sum value if n&gt;=-30 &amp; n&lt;1</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true"></a><span class="st">qui replace m = `r(mean)&#39;</span> <span class="cf">in</span> <span class="st">`</span><span class="dt">i&#39;</span></span>
<span id="cb133-14"><a href="#cb133-14" aria-hidden="true"></a><span class="dt">qui drop n</span></span>
<span id="cb133-15"><a href="#cb133-15" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb133-16"><a href="#cb133-16" aria-hidden="true"></a></span>
<span id="cb133-17"><a href="#cb133-17" aria-hidden="true"></a><span class="dt">gen diff =  value - m</span></span>
<span id="cb133-18"><a href="#cb133-18" aria-hidden="true"></a></span>
<span id="cb133-19"><a href="#cb133-19" aria-hidden="true"></a><span class="dt">tw line value Date, lc(&quot;105 179 162&quot;) recast(area) fc(&quot;105 179 162&quot;)              ///</span></span>
<span id="cb133-20"><a href="#cb133-20" aria-hidden="true"></a><span class="dt">tlabel(, format(%tdCy)) xsize(20) ysize(7) xtitle(&quot;&quot;) xlab(, format(%td_Cy) labc(%0))  ylab(,angle(0))  ///</span></span>
<span id="cb133-21"><a href="#cb133-21" aria-hidden="true"></a><span class="dt">ytitle(&quot;&quot;) title(&quot;Valeur du bitcoin ($)&quot;, color(&quot;105 179 162&quot;) pos(11))  name(g1,replace) fysize(100) fxsize(200)</span></span>
<span id="cb133-22"><a href="#cb133-22" aria-hidden="true"></a></span>
<span id="cb133-23"><a href="#cb133-23" aria-hidden="true"></a><span class="dt">tw spike diff Date, lc(&quot;39 21 105%60&quot;) lwidth(.55)  xsize(20) ysize(3)  xlab(,format(%td_Cy)) ylab(,angle(0)) name(g2,replace) fysize(35) fxsize(200) ytitle(&quot;&quot;) xtitle(&quot;&quot;) title(&quot;Valeur journalière - Moyenne des 30 jours précédents&quot;, pos(11) color(&quot;39 21 105&quot;))</span></span>
<span id="cb133-24"><a href="#cb133-24" aria-hidden="true"></a></span>
<span id="cb133-25"><a href="#cb133-25" aria-hidden="true"></a><span class="dt">graph combine g1 g2, col(1) imargin(0 0 0 0) xcommon</span></span></code></pre></div>
</details>
<p><img src="imgf/g81.png" style="width:75.0%" /></p>
</div>
<div id="effet-spaghetti" class="section level3" number="5.4.2">
<h3 number="5.4.2"><span class="header-section-number">5.4.2</span> Effet spaghetti</h3>
<ul>
<li>Exemple et code R: <a href="https://www.data-to-viz.com/caveat/spaghetti.html" class="uri">https://www.data-to-viz.com/caveat/spaghetti.html</a></li>
<li>Données: popularité des prénoms données aux filles de 1880 à 2017</li>
<li>Source: je suis passé par un base R (babynames)</li>
<li><em>Remarque</em>: ici on est plutôt dans un croisement variables numérique*catégorielle</li>
</ul>
<p><em>Préparation des données</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Merci les limitations de <span class="kw">inlist</span>() avec les variables caractère</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true"></a>use <span class="st">&quot;babynames.dta&quot;</span>, clear</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true"></a>keep <span class="cf">if</span> name<span class="op">==</span><span class="st">&quot;Mary&quot;</span> <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st">&quot;Emma&quot;</span>       <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st">&quot;Ida&quot;</span>        <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st">&quot;Ashley&quot;</span>     <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st">&quot;Amanda&quot;</span>     <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st"> &quot;Jessica&quot;</span>   <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st"> &quot;Patricia&quot;</span>  <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st"> &quot;Linda&quot;</span>     <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st"> &quot;Deborah&quot;</span>   <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st">&quot;Betty&quot;</span>      <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st">&quot;Helen&quot;</span>      <span class="op">/</span><span class="er">//</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true"></a><span class="er">|</span><span class="st"> </span>name<span class="op">==</span><span class="st">&quot;Dorothy&quot;</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true"></a></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>Quelques garçons avec des prénoms féminin</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true"></a>keep  <span class="cf">if</span> sex<span class="op">==</span><span class="st">&quot;F&quot;</span></span></code></pre></div>
</details>
<strong>10 courbes = Spaghetti</strong><br />
<br> <em>Graphique 84</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true"></a>levelsof name, <span class="kw">l</span>(name)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true"></a>foreach nom of local name {</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true"></a>local lin  <span class="st">`</span><span class="dt">lin&#39; line n year if name==&quot;</span><span class="st">`</span>nom<span class="st">&#39;&quot; ||</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true"></a><span class="st">local leg `leg&#39;</span> <span class="st">`</span><span class="dt">i++&#39; &quot;</span><span class="st">`</span>nom<span class="st">&#39;&quot;</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true"></a></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true"></a><span class="st">grstyle init,</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true"></a><span class="st">grstyle set mesh, horizontal compact</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true"></a><span class="st">grstyle set legend 2, nobox</span></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true"></a><span class="st">grstyle set color viridis, n(12)</span></span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true"></a></span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true"></a><span class="st">tw `lin&#39;</span>, <span class="kw">xlabel</span>(<span class="dv">1880</span>(<span class="dv">40</span>)<span class="dv">2017</span>) <span class="kw">leg</span>(<span class="kw">order</span>(<span class="st">`</span><span class="dt">leg&#39;)) xsize(20) ysize(10) ///</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true"></a><span class="dt">title(&quot;A spaghetti chart of baby names popularity&quot;, pos(11))</span></span></code></pre></div>
</details>
<p><img src="imgf/g82.png" style="width:75.0%" /></p>
<p><strong>Facets</strong></p>
<ul>
<li>Avec by(nom de variables), les sous graphiques sont générés automatiquement mais pas modifiables un à un</li>
<li>Mise en forme des axes interessante. Voir plus bas pour une programmation laborieuse</li>
<li>Gain de temps considérable azvec by()</li>
</ul>
<em>Graphique 85</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true"></a>tw line n year, <span class="kw">by</span>(name, <span class="kw">note</span>(<span class="st">&quot;Popularity of american names&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>))) <span class="kw">recast</span>(area) <span class="op">/</span><span class="er">//</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true"></a><span class="st">  </span><span class="kw">color</span>(<span class="st">&quot;105 179 162&quot;</span>) <span class="kw">xlabel</span>(<span class="dv">1880</span>(<span class="dv">40</span>)<span class="dv">2017</span>)</span></code></pre></div>
</details>
<p><img src="imgf/g84.png" style="width:75.0%" /></p>
<p><strong>Amanda</strong></p>
<ul>
<li>A la différence l’exemple sur data-to-viz, j’ai mis en valeur l’année où le prénom a observé son maximum</li>
</ul>
<em>Graphique 86</em><br />

<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true"></a>qui sum n <span class="cf">if</span> name<span class="op">==</span><span class="st">&quot;Amanda&quot;</span>, d</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true"></a>local nmax =<span class="st"> `</span><span class="dt">r(max)&#39;</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true"></a><span class="dt">local nmax2 = </span><span class="st">`</span>nmax<span class="st">&#39; + 5000</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true"></a><span class="st">qui sum year if name==&quot;Amanda&quot; &amp; n==`nmax&#39;</span>, d</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true"></a>local ymax =<span class="st"> `</span><span class="dt">r(max)&#39;</span></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true"></a></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true"></a><span class="dt">levelsof name, l(name)</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true"></a><span class="dt">local other: subinstr local name &quot;Amanda&quot; &quot;&quot;</span></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true"></a><span class="dt">foreach o of local other {</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true"></a><span class="dt">local lin  </span><span class="st">`</span>lin<span class="st">&#39; line n year if name==&quot;`o&#39;&quot;, lc(gray*.35) lw(vthin) ||</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true"></a><span class="st">tw `lin&#39; line n year if name==&quot;</span>Amanda<span class="st">&quot;, lc(&quot;</span><span class="dv">105</span> <span class="dv">179</span> <span class="dv">162</span><span class="st">&quot;) lw(thick) legend(off) ///</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true"></a><span class="st">xsize(20) ysize(10) xlabel(1880(40)2017) ///  </span></span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true"></a><span class="st">text(`nmax2&#39; `ymax&#39; &quot;</span>Amanda reached <span class="st">`</span><span class="dt">nmax&#39;&quot; &quot;babies in </span><span class="st">`</span>ymax<span class="st">&#39;&quot;, ///</span></span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true"></a><span class="st">color(&quot;105 179 162&quot;) bc(&quot;105 179 162&quot;)) ///</span></span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true"></a><span class="st">title(&quot;A spaghetti chart of baby names popularity&quot;, pos(11))</span></span></code></pre></div>
</details>
<p><img src="imgf/g83.png" style="width:75.0%" /></p>
<p><strong>Facets + highlight</strong></p>
<ul>
<li>4 mises en forme pour les graphiques selon leur position
<ul>
<li>9: labels des deux axes</li>
<li>1 et 5: labels de y seulement</li>
<li>10 à 12: labels de x seulement</li>
<li>2 à 4 et 6 à 8: aucun label sur les deux axes</li>
</ul></li>
<li>Temps d’exécution: près d’une minute</li>
</ul>
<p><em>Graphique 87</em></p>
<details>
<summary>
<B><font color="#178ACC">PROGRAMME</B></font>
</summary>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true"></a>levelsof name, <span class="kw">l</span>(name)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true"></a>local i=<span class="dv">1</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true"></a>foreach nom of local name {</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true"></a>local other<span class="op">:</span><span class="st"> </span>subinstr local name <span class="st">&quot;`nom&#39;&quot;</span> <span class="st">&quot;&quot;</span></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true"></a>local j=<span class="st">`</span><span class="dt">i++&#39;</span></span>
<span id="cb138-6"><a href="#cb138-6" aria-hidden="true"></a></span>
<span id="cb138-7"><a href="#cb138-7" aria-hidden="true"></a><span class="dt">foreach o of local other {</span></span>
<span id="cb138-8"><a href="#cb138-8" aria-hidden="true"></a><span class="dt">local olin  </span><span class="st">`</span>olin<span class="st">&#39; line n year if name==&quot;`o&#39;&quot;, lc(gray*.25) lw(vthin)  ||</span></span>
<span id="cb138-9"><a href="#cb138-9" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb138-10"><a href="#cb138-10" aria-hidden="true"></a><span class="st">local lin line n year if name==&quot;`</span><span class="dt">nom&#39;&quot;, lc(&quot;105 179 162&quot;) lw(thick) title(&quot;</span><span class="st">`</span>nom<span class="st">&#39;&quot;, pos(11)) ||</span></span>
<span id="cb138-11"><a href="#cb138-11" aria-hidden="true"></a><span class="st">if `j&#39;</span><span class="op">==</span><span class="dv">1</span> <span class="op">|</span><span class="st"> `</span><span class="dt">j&#39;==5 {</span></span>
<span id="cb138-12"><a href="#cb138-12" aria-hidden="true"></a><span class="dt">tw </span><span class="st">`</span>olin<span class="st">&#39; `lin&#39;</span>, <span class="op">/</span><span class="er">//</span></span>
<span id="cb138-13"><a href="#cb138-13" aria-hidden="true"></a><span class="kw">xtitle</span>(<span class="st">&quot;&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="kw">legend</span>(off) <span class="kw">xlabel</span>(,nogrid <span class="kw">labc</span>(%<span class="dv">0</span>)) <span class="kw">ylabel</span>(,nogrid) <span class="op">/</span><span class="er">//</span></span>
<span id="cb138-14"><a href="#cb138-14" aria-hidden="true"></a><span class="kw">name</span>(_<span class="st">`</span><span class="dt">j&#39;, replace) nodraw</span></span>
<span id="cb138-15"><a href="#cb138-15" aria-hidden="true"></a><span class="dt">}</span></span>
<span id="cb138-16"><a href="#cb138-16" aria-hidden="true"></a><span class="dt">if </span><span class="st">`</span>j<span class="st">&#39;==9 {</span></span>
<span id="cb138-17"><a href="#cb138-17" aria-hidden="true"></a><span class="st">tw `olin&#39;</span> <span class="st">`</span><span class="dt">lin&#39;, ///</span></span>
<span id="cb138-18"><a href="#cb138-18" aria-hidden="true"></a><span class="dt">xtitle(&quot;&quot;) ytitle(&quot;&quot;) legend(off) xlabel(,nogrid) ylabel(,nogrid) ///</span></span>
<span id="cb138-19"><a href="#cb138-19" aria-hidden="true"></a><span class="dt">name(_</span><span class="st">`</span>j<span class="st">&#39;, replace) nodraw</span></span>
<span id="cb138-20"><a href="#cb138-20" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb138-21"><a href="#cb138-21" aria-hidden="true"></a><span class="st">if `j&#39;</span><span class="op">==</span><span class="dv">2</span> <span class="op">|</span><span class="st"> `</span><span class="dt">j&#39;==3 | </span><span class="st">`</span>j<span class="st">&#39;==4 | `j&#39;</span><span class="op">==</span><span class="dv">6</span> <span class="op">|</span><span class="st"> `</span><span class="dt">j&#39;==7 | </span><span class="st">`</span>j<span class="st">&#39;==8    {</span></span>
<span id="cb138-22"><a href="#cb138-22" aria-hidden="true"></a><span class="st">tw `olin&#39;</span> <span class="st">`</span><span class="dt">lin&#39;, ///</span></span>
<span id="cb138-23"><a href="#cb138-23" aria-hidden="true"></a><span class="dt">xtitle(&quot;&quot;) ytitle(&quot;&quot;) legend(off) xlabel(,nogrid labc(%0)) ylabel(,nogrid labc(%0)) ///</span></span>
<span id="cb138-24"><a href="#cb138-24" aria-hidden="true"></a><span class="dt">name(_</span><span class="st">`</span>j<span class="st">&#39;, replace) nodraw</span></span>
<span id="cb138-25"><a href="#cb138-25" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb138-26"><a href="#cb138-26" aria-hidden="true"></a><span class="st">if `j&#39;</span><span class="op">==</span><span class="dv">10</span> <span class="op">|</span><span class="st"> `</span><span class="dt">j&#39;==11 | </span><span class="st">`</span>j<span class="st">&#39;==12 {</span></span>
<span id="cb138-27"><a href="#cb138-27" aria-hidden="true"></a><span class="st">tw `olin&#39;</span> <span class="st">`</span><span class="dt">lin&#39;, ///</span></span>
<span id="cb138-28"><a href="#cb138-28" aria-hidden="true"></a><span class="dt">xtitle(&quot;&quot;) ytitle(&quot;&quot;) legend(off) xlabel(,nogrid ) ylabel(,nogrid labc(%0)) ///</span></span>
<span id="cb138-29"><a href="#cb138-29" aria-hidden="true"></a><span class="dt">name(_</span><span class="st">`</span>j<span class="st">&#39;, replace) nodraw</span></span>
<span id="cb138-30"><a href="#cb138-30" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb138-31"><a href="#cb138-31" aria-hidden="true"></a></span>
<span id="cb138-32"><a href="#cb138-32" aria-hidden="true"></a><span class="st">*global g $g _`j&#39;</span> <span class="op">/</span><span class="er">/</span>refaire la macro pour le combine</span>
<span id="cb138-33"><a href="#cb138-33" aria-hidden="true"></a><span class="er">}</span></span>
<span id="cb138-34"><a href="#cb138-34" aria-hidden="true"></a></span>
<span id="cb138-35"><a href="#cb138-35" aria-hidden="true"></a>graph combine _<span class="dv">1</span> _<span class="dv">2</span> _<span class="dv">3</span> _<span class="dv">4</span> _<span class="dv">5</span> _<span class="dv">6</span> _<span class="dv">7</span> _<span class="dv">8</span> _<span class="dv">9</span> _<span class="dv">10</span> _<span class="dv">11</span> _<span class="dv">12</span>, <span class="kw">col</span>(<span class="dv">4</span>) <span class="kw">title</span>(<span class="st">&quot;A spaghetti chart of baby names popularity&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>)) <span class="op">/</span><span class="er">//</span></span>
<span id="cb138-36"><a href="#cb138-36" aria-hidden="true"></a><span class="kw">xsize</span>(<span class="dv">20</span>) <span class="kw">ysize</span>(<span class="dv">15</span>)</span></code></pre></div>
</details>
<p><img src="imgf/g85.png" style="width:75.0%" /></p>
</div>
</div>
<div id="barres-lollipop-et-parallel-lines" class="section level2" number="5.5">
<h2 number="5.5"><span class="header-section-number">5.5</span> Barres, lollipop et parallel lines</h2>
<p><span class="badge badge-info">variable numérique croisées avec variables catégorielles </span> <span class="badge badge-info">Variables catégorielles</span></p>
<div id="barres-et-lollipop" class="section level3" number="5.5.1">
<h3 number="5.5.1"><span class="header-section-number">5.5.1</span> Barres et lollipop</h3>
<ul>
<li><p>Les graphiques de types barres sont utilisés pour les variables types continues ou catégorielles</p></li>
<li><p><strong>graph bar</strong> (<strong>hbar</strong>), commande de type oneway, qui fait que je ne l’apprécie que très moyennement: beaucoup d’options et finalement peu souple</p>
<ul>
<li>Pour les variables discrètes, NJ.Cox a programmé la commande **<code>catplot</code>*, plus de souple</li>
<li>Critique des graphiques barres:
<ul>
<li>Signification de la largeur des barres? Rien si ce n’est qu’elle s’adapte au nombre d’objet entrant dans le graphique (voir les graphiques mosaïque - spineplot - pour les variables discretes)</li>
</ul></li>
<li>Comparaisons des valeurs si plus d’un croisement pas facile</li>
</ul></li>
<li><p>De plus en plus délaissés pour les visualisations dites <strong>lollipop</strong> ou <strong>haltères</strong> selon l’épaisseur de la barre<br />
</p></li>
<li><p><strong>Lollipop/haltère</strong>: Pas de commande avec Stata, mais principe des <code>dots chart</code> de type <em>connected</em></p>
<ul>
<li>Facilement programmable: <strong><code>collapse</code></strong> pour les générer les statistiques + combinaison de graphiques types <code>scatter</code> et <code>spike</code></li>
<li>Facilite les comparaisons si plus d’une variable discrete</li>
</ul></li>
</ul>
<p><strong>Exemple</strong> * Données issues de l’aide de la commande <code>graph bar</code> * On compare le salaire horaires moyen de plusieurs professions * On compare le salaire moyen de ces professions selon que les personnes soient syndiquées ou non</p>
<p><strong>Salaire moyen des professions</strong></p>
<p><em>Barres</em></p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true"></a>sysuse nlsw88, clear</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true"></a>grstyle init</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true"></a>grstyle set mesh, compact</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true"></a>grstyle set color viridis, <span class="kw">select</span>(<span class="dv">4</span> <span class="dv">12</span>)</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true"></a></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true"></a>graph <span class="kw">hbar</span> (mean) wage, <span class="kw">over</span>(occupation, <span class="kw">sort</span>(<span class="dv">1</span>) descending) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true"></a><span class="kw">title</span>(<span class="st">&quot;{bf:Hourly wage}&quot;</span>, <span class="kw">color</span>(<span class="st">&quot;39 127 142&quot;</span>) <span class="kw">pos</span>(<span class="dv">11</span>))  <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>)  </span></code></pre></div>
<p><em>Graphique 88</em></p>
<p><img src="imgf/g88.png" style="width:50.0%" /></p>
<p><em>Lollipop</em></p>
<ul>
<li>Le passage vers un graphique de type two-way, laisse plus de souplesse niveau couleurs. On a appliqué ici une palette séquentielle aux salaire horaire moyen de chaque type de profession.</li>
<li>Le programme qui suit est facilement automatisable pour le faire exécuter dan</li>
<li>Le graphique est facilement modifiable pour faire apparaitre des barres au lieu de droites, en jouant seulement sur leur épaisseur (graphique 90)</li>
</ul>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true"></a>sysuse nlsw88, clear</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true"></a>preserve</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>collapse et tri des professions</span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true"></a>collapse wage, <span class="kw">by</span>(occ)</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true"></a>drop <span class="cf">if</span> occ<span class="op">==</span>.</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true"></a>decode occ, <span class="kw">gen</span>(occ2) </span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true"></a></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true"></a>capt drop i x0</span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true"></a>gen x0=<span class="dv">0</span></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true"></a>sort wage</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true"></a>drop <span class="cf">if</span> wage<span class="op">==</span>.</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true"></a>gen i=_n</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true"></a>gsort <span class="op">-</span>i</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true"></a></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true"></a><span class="op">*</span><span class="st"> </span>ylabel [attention levelsof ordre alphabétique]</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true"></a>qui des</span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true"></a>local i =<span class="st"> </span><span class="dv">1</span></span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true"></a>forvalues j =<span class="st"> </span><span class="dv">1</span><span class="op">/</span><span class="st">`</span><span class="dt">r(N)&#39; {</span></span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true"></a><span class="dt">     local o </span><span class="st">`</span>o<span class="st">&#39; &quot;`=occ2[`j&#39;</span>]<span class="st">&#39;&quot;</span></span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true"></a></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true"></a><span class="st">* graph lollipop</span></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true"></a></span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true"></a><span class="st">qui des</span></span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true"></a><span class="st">local j = `r(N)&#39;</span></span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true"></a>grstyle init</span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true"></a>grstyle set mesh, compact</span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true"></a>grstyle set legend <span class="dv">1</span>, nobox</span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true"></a>grstyle set color viridis, <span class="kw">n</span>(<span class="st">`</span><span class="dt">r(N)&#39;) </span></span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true"></a></span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true"></a><span class="dt">local lw 2pt</span></span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true"></a><span class="dt">local mopts msiz(6.3pt) mlw(0pt) mlc(black) mlw(vthin)</span></span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true"></a></span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true"></a><span class="dt">foreach o2 of local o {</span></span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true"></a><span class="dt">local k  </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true"></a><span class="st">local ylab `ylab&#39;</span> <span class="st">`</span><span class="dt">j--&#39; &quot;</span><span class="st">`</span>o2<span class="st">&#39;&quot;</span></span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true"></a><span class="st">local spik `spik &#39;</span> pcspike i x0  i wage <span class="cf">in</span> <span class="st">`</span><span class="dt">k&#39;, lw(</span><span class="st">`</span>lw<span class="st">&#39;) lc(&quot;`r(p`k&#39;</span>)<span class="st">&#39;&quot;)||</span></span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true"></a><span class="st">local scat `scat&#39;</span>  scatter i wage       <span class="cf">in</span> <span class="st">`</span><span class="dt">k&#39;, </span><span class="st">`</span>mopts<span class="st">&#39;  mc(&quot;`r(p`k&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) ||</span></span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true"></a><span class="st">}</span></span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true"></a></span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true"></a><span class="st">tw `spik&#39;</span>  <span class="st">`</span><span class="dt">scat&#39;   ///</span></span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true"></a><span class="dt">, ylabel(</span><span class="st">`</span>ylab<span class="st">&#39;, angle(0)) ///</span></span>
<span id="cb140-45"><a href="#cb140-45" aria-hidden="true"></a><span class="st">title(&quot;Hourly wage&quot;, pos(11))  ytitle(&quot;&quot;) ylabel(,nogrid)  legend(off)</span></span>
<span id="cb140-46"><a href="#cb140-46" aria-hidden="true"></a><span class="st">restore</span></span></code></pre></div>
<p><em>Graphique 89</em></p>
<p><img src="imgf/g89.png" style="width:50.0%" /></p>
<p>En modifiant la taille des spikes, on peut obtenir un graphique barre</p>
<p><em>Graphique 90</em></p>
<p><img src="imgf/g90.png" style="width:75.0%" /></p>
<p>Le passage vers un graphique de type two-way, laisse plus de souplesse niveau couleurs</p>
<p><strong>Salaire moyen des professions par statut syndical</strong></p>
<p><em>Barres</em></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true"></a>sysuse nlsw88, clear</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true"></a>grstyle init</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true"></a>grstyle set mesh, compact</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true"></a>grstyle set legend <span class="dv">5</span>, nobox</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true"></a>grstyle set color plasma, <span class="kw">select</span>(<span class="dv">3</span> <span class="dv">13</span>)</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true"></a>local col <span class="st">&quot;203 71 120&quot;</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true"></a></span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true"></a></span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true"></a>separate wage, <span class="kw">by</span>(union)</span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true"></a></span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true"></a>graph <span class="kw">hbar</span> (mean) wage0 wage1, <span class="kw">over</span>(occ, <span class="kw">sort</span>(<span class="dv">1</span>) descending)  <span class="op">/</span><span class="er">//</span></span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true"></a><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Non Union&quot;</span> <span class="dv">2</span> <span class="st">&quot;Union&quot;</span>) <span class="kw">color</span>(<span class="st">`</span><span class="dt">col&#39;) ) ///</span></span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true"></a><span class="dt">title(&quot;{bf:Hourly wage}&quot; &quot; &quot;, color(</span><span class="st">`</span>col<span class="st">&#39;) pos(11))</span></span></code></pre></div>
<p><em>Graphique 91</em></p>
<p>Graphique trié par le salaire moyen pour <em>non union</em>. Rendu pas super car pas d’information pour les “household workers” non syndiqué.e.s.</p>
<p><img src="imgf/g91.png" style="width:50.0%" /></p>
<p><em>Lollipop</em></p>
<p>Les professions ont été triées par la moyenne des salaires horaires moyens d’union=0 et d’union=1</p>
<p><img src="imgf/g92.png" style="width:75.0%" /></p>
<p>Ce type de représentation apparait supérieur au graphique barre du dessus</p>
<ul>
<li>Gère bien l’absence d’information pour un des niveaux de la variable union</li>
<li>Les salaires moyens apparaissent clairement sur une même ligne, ainsi que les différences</li>
<li>Le graphique de gauche est appelé <strong>graphique haltère</strong> (épaisseur de la spike)</li>
</ul>
</div>
<div id="parallel-lines" class="section level3" number="5.5.2">
<h3 number="5.5.2"><span class="header-section-number">5.5.2</span> Parallel lines</h3>
<ul>
<li>Pourquoi <em>parallel</em> ????</li>
</ul>
<p><strong>Exemple: gender wage gape</strong></p>
<p>Source: <a href="https://www.data-to-viz.com/story/OneNumSevCatSubgroupOneObsPerGroup.html" class="uri">https://www.data-to-viz.com/story/OneNumSevCatSubgroupOneObsPerGroup.html</a></p>
<p><em>Sur les valeurs</em></p>
<p><img src="imgf/g93.png" style="width:50.0%" /></p>
<ul>
<li>Limites: sensible à l’effet spaghetti. J’ai du composé pour labelliser les pays de manière automatique (un pays sur deux pour 2000 et 2015), avec un rendu finalement pas super</li>
</ul>
<p><em>Sur les rangs</em></p>
<ul>
<li>Limite l’effet spaghetti</li>
<li>Elimine les superpositions des labels des pays</li>
<li>Les valeurs peuvent être reportés facilement</li>
</ul>
<p><img src="imgf/g94.png" style="width:50.0%" /></p>
<p>**Application: parallel lines sur données individuelles</p>
<ul>
<li>Voir le graphique de <em>Dimitri Christodoulou</em></li>
<li>Limiter à 4-5 variables maximum</li>
<li>Tester l’ordre des variables, cela affecte le rendu final</li>
<li>Si on compare le <em>variables pattern</em> pour plusieurs niveaux d’une variable discrete, il est préférables que les effectifs soit relativement proches pour ces niveaux. Eviter un niveau ou un évènement est rare.</li>
</ul>
<p><em>Exemple</em> [A faire]</p>
<p><em>Programme tiré pour ne pas dire copié-collé de: <a href="https://graphworkflow.com/2019/07/30/nba-shots/" class="uri">https://graphworkflow.com/2019/07/30/nba-shots/</a> [Demetris Christodoulou] </em> Les variables doivent être sur une échelle commune (la méthode utilisée par D.Christodoulou est la plus pertinente [0,1])</p>
</div>
</div>
<div id="catplot-et-splineplot" class="section level2" number="5.6">
<h2 number="5.6"><span class="header-section-number">5.6</span> catplot et splineplot</h2>
<p><strong>Catplot</strong> * Wrapper de graph bar programmé par N.Cox</p>
<p><strong>spineplot</strong> * Programmé par N.Cox * Proche du treemap, permet de représenter un tableau croisé les surfaces représentant la taille relative des cellules avec prise en compte des marges</p>
</div>
<div id="section" class="section level2" number="5.7">
<h2 number="5.7"><span class="header-section-number">5.7</span> </h2>
<ul>
<li>Perception des angles avec un axe</li>
<li>A limiter à 2 catégories?</li>
</ul>
</div>
<div id="résultats-de-régression" class="section level2" number="5.8">
<h2 number="5.8"><span class="header-section-number">5.8</span> Résultats de régression</h2>
<ul>
<li>Coef regression: type forest plot</li>
<li>Effet marginaux: marginsplot et contour….what else</li>
</ul>
</div>
<div id="graph-interactifs-et-dynamiques" class="section level2" number="5.9">
<h2 number="5.9"><span class="header-section-number">5.9</span> Graph interactifs et dynamiques</h2>
<ul>
<li><a href="https://www.francetvinfo.fr/sante/maladie/coronavirus/infographies-covid-19-morts-hospitalisations-age-malades-l-evolution-de-l-epidemie-en-france-et-dans-le-monde-en-cartes-et-graphiques.html">France Info</a></li>
<li><a href="https://www.ined.fr/fr/tout-savoir-population/graphiques-cartes/population-cartes-interactives/">Site Ined</a></li>
</ul>
</div>
</div>
<div id="références-bibliographie" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Références &amp; bibliographie</h1>
<div id="stata-journal" class="section level2" number="6.1">
<h2 number="6.1"><span class="header-section-number">6.1</span> Stata Journal</h2>
<p><strong>2019</strong></p>
<ul>
<li>Some simple devices to ease the spaghetti problem - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X19893641" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X19893641</a></li>
</ul></li>
<li>Stata tip 133: Box plots that show median and quartilesonly - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X19893643" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X19893643</a></li>
</ul></li>
<li>Added-variable plots with confidence intervals - John Luke Gallup
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X19874236" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X19874236</a></li>
</ul></li>
<li>Stata tip 132: Tiny tricks and tips on ticks - Nicholas J. Cox &amp; Vince Wiggins
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X19874264" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X19874264</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2018</strong></p>
<ul>
<li>Color Palettes for Stata Graphics - Ben Jann
<ul>
<li><a href="https://journals-sagepub-com.ezproxy.campus-condorcet.fr/doi/pdf/10.1177/1536867X1801800402" class="uri">https://journals-sagepub-com.ezproxy.campus-condorcet.fr/doi/pdf/10.1177/1536867X1801800402</a></li>
</ul></li>
<li>Customizing Stata graphs made easy (part 2) - Ben Jann
<ul>
<li><a href="https://journals-sagepub-com.ezproxy.campus-condorcet.fr/doi/pdf/10.1177/1536867X1801800403" class="uri">https://journals-sagepub-com.ezproxy.campus-condorcet.fr/doi/pdf/10.1177/1536867X1801800403</a></li>
</ul></li>
<li>Customizing Stata Graphs made Easy (Part 1) - Ben Jann</li>
<li><a href="https://journals-sagepub-com.ezproxy.campus-condorcet.fr/doi/pdf/10.1177/1536867X1801800301" class="uri">https://journals-sagepub-com.ezproxy.campus-condorcet.fr/doi/pdf/10.1177/1536867X1801800301</a></li>
</ul>
<p><br></p>
<p><strong>2017</strong></p>
<ul>
<li>New graphic schemes for Stata: plotplain andplottig - Daniel Bischof
<ul>
<li><a href="https://journals-sagepub-com.ezproxy.campus-condorcet.fr/doi/pdf/10.1177/1536867X1701700313" class="uri">https://journals-sagepub-com.ezproxy.campus-condorcet.fr/doi/pdf/10.1177/1536867X1701700313</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2016</strong></p>
<ul>
<li>Shading zones on time seriesand other plotsNicholas - J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1601600315" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1601600315</a></li>
</ul></li>
<li>Multiple bar charts in tableform - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1601600214" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1601600214</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2015</strong></p>
<ul>
<li>A note on adding objects to an existing twowaygraph - Ben Jann
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1501500308" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1501500308</a></li>
</ul></li>
<li>Stata tip 122: Variable bar widths in two-waygraphs - Ben Jann
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1501500120" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1501500120</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2014</strong></p>
<ul>
<li>Plotting regression coefficients and other estimates - Ben Jann
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400402" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400402</a></li>
</ul></li>
<li>Design plots for graphicalsummary of a response given factors - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400416" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400416</a></li>
</ul></li>
<li>Box plots side by side - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400417" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400417</a></li>
</ul></li>
<li>Graph combine—Combining graphs - Lars ̈Angquist
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400115" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400115</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2013</strong></p>
<ul>
<li>Expanding datasets for graphical endsNicholas - J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400117" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1401400117</a></li>
</ul></li>
<li>marginscontplot: Plotting the marginal effectsof continuous predictors - Patrick Royston
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1301300305" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1301300305</a></li>
</ul></li>
</ul>
<p><strong>2012</strong></p>
<ul>
<li>Speaking Stata: Axis practice, or what goeswhere on a graph - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1201200314" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1201200314</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2011</strong></p>
<ul>
<li>Expressing confidence with gradations - Ulrich Kohler &amp; Stephanie Eckman
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1201100409" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1201100409</a></li>
</ul></li>
<li>Highlighting specific barsNicholas - J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1101100310" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1101100310</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2010</strong></p>
<ul>
<li>Handling multiple y axes on twoway graphs - Vince Wiggins
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X1101000411" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X1101000411</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2009</strong></p>
<ul>
<li>Speaking Stata: Paired, parallel, or profile plotsfor changes, correlations, and other comparisons - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X0900900408" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X0900900408</a></li>
</ul></li>
<li>Grounds for grids on graphs - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X0900900411" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X0900900411</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>2000 à 2008</strong></p>
<ul>
<li>Graphing categorical andcompositional data - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X0400400209" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X0400400209</a></li>
</ul></li>
<li>Speaking Stata: Spineplots and their kin - J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X0800800107" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X0800800107</a></li>
</ul></li>
<li>Graphing distributions - Nicholas J. Cox
<ul>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X0100400106" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X0100400106</a></li>
</ul></li>
<li>Graphing categorical and compositional data - Nicholas J. Cox</li>
<li><a href="https://journals.sagepub.com/doi/pdf/10.1177/1536867X0400400209" class="uri">https://journals.sagepub.com/doi/pdf/10.1177/1536867X0400400209</a></li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
