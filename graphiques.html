<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Marc Thevenin" />

<meta name="date" content="2020-10-07" />

<title>Visualisation des données</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cerulean.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Stata</a>
</li>
<li>
  <a href="utils.html">Tips &amp; utilitaires</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Graphiques
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="graphiques.html">Graphiques</a>
    </li>
    <li>
      <a href="couleurs.html">Couleurs</a>
    </li>
    <li>
      <a href="programmes.html">Programmes</a>
    </li>
  </ul>
</li>
<li>
  <a href="python.html">Python</a>
</li>
<li>
  <a href="commandes.html">Commandes</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Visualisation des données</h1>
<h4 class="author">Marc Thevenin</h4>
<h4 class="date">10/07/2020</h4>

</div>


<style>
hide {
  background-color: #d6d6d6;
  color: #d6d6d6;
}
hide:hover {
  background-color: white;
  color: black;
}
</style>
<div id="plan" class="section level1">
<h1><span class="header-section-number">1</span> Plan</h1>
<ul>
<li><strong>Visualisation de la progression</strong>:
<ul>
<li><span style="color:rgb(97, 156, 255)"><strong>Bien avancée</strong></span></li>
<li><span style="color:rgb(0, 191, 125)"><strong>Avancée</strong></span></li>
<li><span style="color:rgb(201, 152, 0)"><strong>Un peu avancée</strong></span><br />
</li>
<li><span style="color:rgb(255, 103, 164)"><strong>A faire</strong></span></li>
</ul></li>
</ul>
<p><BR></p>
<ul>
<li><strong><span style="color:rgb(97, 156, 255)">Générer des graphiques</span></strong>
<ul>
<li><span style="color:rgb(97, 156, 255)">Les graphiques Stata</span></li>
<li><span style="color:rgb(97, 156, 255)">Générer et éditer un graphique</span></li>
<li><span style="color:rgb(97, 156, 255)">Les options graphiques</span>
<ul>
<li><span style="color:rgb(97, 156, 255)">Options d’un objet graphique</span></li>
<li><span style="color:rgb(97, 156, 255)">Options générales d’un graphique</span></li>
</ul></li>
<li><span style="color:rgb(97, 156, 255)">Graphiques combinés</span></li>
<li><span style="color:rgb(97, 156, 255)">Stata 16 et Python</red></li>
</ul></li>
<li><strong><span style="color:rgb(97, 156, 255)">Utilisation des macros</span></strong>
<ul>
<li><span style="color:rgb(97, 156, 255)"> Rappel sur les macro</span>
<ul>
<li><span style="color:rgb(97, 156, 255)"> global/local - levelsof - fonctions associées</span></li>
<li><span style="color:rgb(97, 156, 255)"> return et ereturn</span></li>
<li><span style="color:rgb(97, 156, 255)"> Autres: token, compteur++, tempvar</span><br />
</li>
</ul></li>
<li><span style="color:rgb(97, 156, 255)">Alleger la syntaxe et automatiser les modifications</span></li>
<li><span style="color:rgb(97, 156, 255)">Macro étendue pour générer un graphique à plusieurs composantes et une légende</span></li>
<li><span style="color:rgb(97, 156, 255)">Programmation d’une routine</span></li>
</ul></li>
<li><strong><span style="color:rgb(97, 156, 255)">Couleurs et thèmes</span></strong>
<ul>
<li><span style="color:rgb(97, 156, 255)">Les palettes de couleurs</span>
<ul>
<li><span style="color:rgb(97, 156, 255)">Les palettes Stata</span></li>
<li><span style="color:rgb(97, 156, 255)">Colorpalette de Ben Jann</span></li>
</ul></li>
<li><span style="color:rgb(97, 156, 255)">Les thèmes graphiques</span>
<ul>
<li><span style="color:rgb(97, 156, 255)">Les thèmes Stata et externes</span></li>
<li><span style="color:rgb(97, 156, 255)">Grstyle de Ben Jann</span></li>
</ul></li>
<li><span style="color:rgb(97, 156, 255)">Application</span><br />
</li>
</ul></li>
<li><strong><span style="color:rgb(201, 152, 0)">Visualisation des données avec Stata</span></strong>
<ul>
<li><span style="color:rgb(201, 152, 0)">Graphiques statiques</span>
<ul>
<li><span style="color:rgb(0, 191, 125)">Variable(s) continues: une/plusieurs</span>
<ul>
<li><span style="color:rgb(97, 156, 255)">Histogramme et densité</span><br />
</li>
<li><span style="color:rgb(97, 156, 255)">Box plot et violon</span><br />
</li>
<li><span style="color:rgb(0, 191, 125)">Nuages et densité 2d</span><br />
</li>
<li><span style="color:rgb(255, 103, 164)">Courbes</span><br />
</li>
<li><span style="color:rgb(255, 103, 164)">Barres</span><br />
</li>
</ul></li>
<li><span style="color:rgb(255, 103, 164)">Variable(s) catégorielles: une/plusieurs</span></li>
<li><span style="color:rgb(255, 103, 164)">Variables continues et catégorielles</span><br />
</li>
<li><span style="color:rgb(255, 103, 164)">Résultats d’analyses</span></li>
</ul></li>
</ul></li>
<li><strong><span style="color:rgb(255, 103, 164)">Graphiques intéractifs &amp; animés: Python</span></strong>
<ul>
<li><span style="color:rgb(255, 103, 164)">Exemples de graphiques intéractifs</span></li>
<li><span style="color:rgb(255, 103, 164)">Exemple de graphiques animés</span></li>
</ul></li>
<li><strong><span style="color:rgb(255, 103, 164)">Bibliographie &amp; sources</span></strong></li>
</ul>
<p><strong>La taille des graphiques a été réduite: clic droit + view image" pour les visualiser en taille réelle</strong></p>
</div>
<div id="générer-et-modifier-des-graphiques" class="section level1">
<h1><span class="header-section-number">2</span> Générer et modifier des graphiques</h1>
<div id="les-graphiques-stata" class="section level2">
<h2><span class="header-section-number">2.1</span> Les graphiques Stata</h2>
<ul>
<li>Graphiques de type statiques et non intéractifs</li>
<li>Graphiques de type <strong>one way</strong> (Y)) ou <strong>two way</strong> (X Y)</li>
<li>Une syntaxe de base plutôt simple</li>
<li>Des graphiques critiqués pour leur aspect rustre par défaut, loin des standards actuels
<ul>
<li>Mauvaise communication officielle : www.stata.com/stata-news/news33-4/spotlight/</li>
<li>Alors que…: <a href="https://graphworkflow.com/?fbclid=IwAR30KGud-TWYLlvpZ1OPNrCeKN01hqPbIIoZ-GTAaoiS90xuE8G8WHwDh3w">graphworkflow.com</a></li>
</ul></li>
</ul>
<p><br> <strong>Améliorations récentes</strong>:</p>
<ul>
<li>Depuis Stata 15, l’opacité/transparence des couleurs peut être modifiée.</li>
<li>Des commandes externes qui permettent de démultiplier les possibilités en termes de couleurs et de styles, en particulier les deux commandes de <strong>Ben Jann</strong>: <em>colorpalette</em> et <em>grstyle</em></li>
<li>Depuis la version 16 on peut utiliser intéractivement <strong>Python</strong> sous Stata, ce qui ouvre de nombreuses possibilités au niveau de la visualisation des données [graphiques intéractifs et dynamiques]</li>
</ul>
</div>
<div id="générer-et-éditer-un-graphique" class="section level2">
<h2><span class="header-section-number">2.2</span> Générer et éditer un graphique</h2>
<div id="par-les-boites-de-dialogue" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Par les boites de dialogue</h3>
<p><strong>Générer un graphique</strong>:</p>
<ul>
<li>Ouverture d’une boite directement dans la fenêtre <em>command</em> avec la commande <em>db</em>: <code>db command</code></li>
<li>Préférer <em>submit`</em> à <em>OK</em> pour laisser la boîte ouverte</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">db tw</a>
<a class="sourceLine" id="cb1-2" title="2">db histogram</a></code></pre></div>
<p><strong>Editer un graphique</strong>:</p>
<ul>
<li>On peut éditer manuellement le graphique après sa création dans la boîte d’édition du graphique, ou en le chargeant après sauvegarde</li>
<li>On peut enregistrer les modifications avec <em>record</em> - <em>play</em> pour une édition ultérieure. Un fichier au format <em>.grec</em> est enregistrée. Il peut être édité</li>
<li>Quelques améliorations de l’interface d’édition avec stata 16 [mettre image]</li>
</ul>
<p>exemple:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">sysuse auto, clear</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="op">*</span><span class="st"> </span>sauvegarde en mémoire</a>
<a class="sourceLine" id="cb2-3" title="3">tw scatter price mpg, <span class="kw">name</span>(g1, replace)</a>
<a class="sourceLine" id="cb2-4" title="4">graph display g1 [, <span class="kw">scheme</span>() <span class="kw">play</span>()....]</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="op">*</span><span class="st"> </span>sauvegarde en dur</a>
<a class="sourceLine" id="cb2-6" title="6">tw scatter price mpg, <span class="kw">save</span>(g1, replace)</a>
<a class="sourceLine" id="cb2-7" title="7">graph display g1 [, <span class="kw">scheme</span>() <span class="kw">play</span>()....]</a></code></pre></div>
</div>
<div id="syntaxe" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Syntaxe</h3>
<div id="un-seul-objet-graphique" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> Un seul objet graphique</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">[tw<span class="op">/</span>graph] type_graph Y1 Y2 Y3.... [X] [Z] [, <span class="kw">option1</span>(Y1 Y2 Y3... X Z)....options_generales] </a></code></pre></div>
<p><strong>Important</strong>: si plusieurs éléments graphiques, le contenu des options suit l’ordre Y1,Y2,Y3….. <BR> <strong>Remarque 1</strong>: Yi - X peuvent-être des variables ou des coordonnées (graphique type <strong>scatteri</strong> - <strong>pci</strong> - <strong>pcarrowi</strong>) <strong>Remarque 2</strong>: on peut genérer des graphiques sur des fonctions: <strong><code>tw function Y=f(X)</code></strong></p>
<p><strong>Exemple [graph gauche]</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">sysuse uslifeexp.dta , clear</a>
<a class="sourceLine" id="cb4-2" title="2">tw line le year, <span class="kw">title</span>(<span class="st">&quot;Espérance de vie&quot;</span>) </a></code></pre></div>
<ul>
<li>Options:
<ul>
<li>Option générale: <em><code>title()</code></em> titre du graphique avec aspect par défaut</li>
</ul></li>
</ul>
<p><strong>Exemple [graph droite]</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">tw line  le le_male le_female year,                                        <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="st">   </span><span class="kw">lc</span>(<span class="op">*</span>.<span class="dv">3</span>)                                                                 <span class="op">/</span><span class="er">//</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">   </span><span class="kw">title</span>(<span class="st">&quot;Espérance de vie&quot;</span>)                                               <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Ensemble&quot;</span> <span class="dv">2</span> <span class="st">&quot;Hommes&quot;</span> <span class="dv">3</span> <span class="st">&quot;Femmes&quot;</span>) <span class="kw">pos</span>(<span class="dv">4</span>) <span class="kw">col</span>(<span class="dv">1</span>) <span class="kw">ring</span>(<span class="dv">0</span>)) <span class="op">/</span><span class="er">//</span></a></code></pre></div>
<ul>
<li>Options:
<ul>
<li>Options des courbes: intensité de la couleur des courbes réduite pour la variable <em>le</em> <strong><code>lc(*.2)</code></strong> et augmentée pour <em>le_male</em> et <em>le_female</em> <strong><code>lc(1.3)</code></strong></li>
<li>Options générales:
<ul>
<li>Titre: positionné à 11 heures à l’exterieur du graphique <strong><code>pos(11)</code></strong></li>
<li>modification de la légende
<ul>
<li>Labels: <strong><code>order(1 "Ensemble" 2 "Hommes" 3 "femmes")</code></strong></li>
<li>A l’intérieur du graphique <strong><code>ring(0)</code></strong></li>
<li>Positionnée à 4 heures <strong><code>pos(11</code>)`</strong></li>
<li>Affichée en une seule colonne <strong><code>col(1</code>)`</strong></li>
</ul></li>
</ul></li>
</ul></li>
<li><strong>Remarque</strong>: la courbe pour l’ensemble de la population a éte mise en arrière plan (première position des Y dans la commande)</li>
</ul>
<p><em>Graphique 1</em><br />
<img src="imgf/g1.png" style="width:75.0%" /></p>
</div>
<div id="plusieurs-objets-graphiques" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> Plusieurs objets graphiques</h4>
<ul>
<li>Chaque composante est séparée par <strong>()</strong> ou <strong>||</strong></li>
<li>Elle contient ses options</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">[tw<span class="op">/</span>graph] (type_graph1 Y1 [Y2] [X] [Z] [, <span class="kw">option</span>(Y1 [Y2] ) <span class="kw">option</span>(X) <span class="kw">option</span>(Z)...])   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">           </span>(type_graph2 Y2 [Y2] [X] [Z] [, <span class="kw">optio1</span>(Y1 [Y2] ) <span class="kw">option</span>(X) <span class="kw">option</span>(Z)...])   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="st">          </span>[(type_graph3...)]                                                           <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="st">          </span>[(type_graph4...)] ...                                                       <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb6-5" title="5"><span class="st">          </span>[, options_generales]   </a></code></pre></div>
<p>ou</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">[tw<span class="op">/</span>graph]  type_graph1 Y1 [Y2] [X] [Z] [, <span class="kw">option</span>(Y1 [Y2]) <span class="kw">option1</span>(X) <span class="kw">option1</span>(Z)...]   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="st">        </span><span class="er">||</span><span class="st">  </span>type_graph2 Y2 [Y2] [Z] [Z] [, <span class="kw">option</span>(Y1 [Y2]) <span class="kw">option1</span>(X) <span class="kw">option1</span>(Z)...]   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="st">        </span><span class="er">||</span><span class="st"> </span>[type_graph3...]                                                            <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="st">        </span><span class="er">||</span><span class="st"> </span>[type_graph4...] ...                                                        <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="st">           </span>[, options_generales]   </a></code></pre></div>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">sysuse auto, clear</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="op">*</span><span class="st"> </span>sans option</a>
<a class="sourceLine" id="cb8-4" title="4">tw scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span>          <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span>          <span class="op">/</span><span class="er">//</span><span class="st">  </span></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="st"> </span>, <span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">2</span> <span class="st">&quot;Foreign&quot;</span>))  </a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="op">*</span><span class="st"> </span>avec option</a>
<a class="sourceLine" id="cb8-9" title="9">tw scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span> , <span class="kw">msiz</span>(large) <span class="kw">mc</span>(red%<span class="dv">50</span>)  <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin)      <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span> , <span class="kw">msiz</span>(large) <span class="kw">mc</span>(blue%<span class="dv">50</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin)      <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="st"> </span>, <span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">2</span> <span class="st">&quot;Foreign&quot;</span>) <span class="kw">region</span>(<span class="kw">lcolor</span>(%<span class="dv">0</span>)))                           <span class="op">/</span><span class="er">//</span></a></code></pre></div>
<p><em>Graphique 2</em><br />
<img src="imgf/g2.png" style="width:75.0%" /></p>
<ul>
<li><strong>Options sur les cercles/bulles</strong>:
<ul>
<li>Modification de la couleur de remplissage de la bulle avec l’option <strong><code>mc()</code></strong> [<strong><code>mcolor</code></strong>: marker-color). L’opacité à été réduite à 50% pour laisser apparaitre les bulles superposées en arrière plan: <strong><code>blue%50</code></strong> et <strong><code>red%50</code></strong></li>
<li>Modification du contour des bulles avec <strong><code>mlc(black)</code></strong> (marker-line-color) et <strong><code>mlw(vthin)</code></strong> (marker-line-width)</li>
<li>Augmentation de la taille des bulles avec <strong><code>msiz(large)</code></strong> (marker-size)</li>
</ul></li>
<li><strong>Option générale</strong>:
<ul>
<li>Ajout d’une légende et suppression du contour: <strong><code>legend(order(1 "Domestic" 2 "Foreign") region(lcolor(%0)))</code></strong></li>
</ul></li>
</ul>
<p><strong>Cas particuliers</strong>: pour les graphiques de type barres, les options des barres pour chaque variable sont renseignées en précisant le numéro de la barre (yi)</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">  graph bar  y1 y2, <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="st">  </span><span class="kw">bar</span>(<span class="dv">1</span>, options)   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb9-3" title="3"><span class="st">  </span><span class="kw">bar</span>(<span class="dv">2</span>, options)  </a></code></pre></div>
<p><strong>Préférer un graphique à un bloc d’éléments ??</strong><br />
Plutôt que de multiplier le nombre d’objets et d’options, il peut être judicieux de créer une variable pour chaque strate (ici <em>foreign</em>) et de générer un graphique à un seul bloc</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">gen price0 =<span class="st"> </span>price <span class="cf">if</span>  foreign<span class="op">==</span><span class="dv">0</span></a>
<a class="sourceLine" id="cb10-2" title="2">gen price1 =<span class="st"> </span>price <span class="cf">if</span>  foreign<span class="op">==</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4">tw scatter price0 price1 mpg  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb10-5" title="5"><span class="st"> </span>, <span class="kw">msiz</span>(large large) <span class="kw">mc</span>(red<span class="op">%50 blue%</span><span class="dv">50</span>) <span class="kw">mlc</span>(black black) <span class="kw">mlw</span>(vthin vthin) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">2</span> <span class="st">&quot;Foreign&quot;</span>) <span class="kw">region</span>(<span class="kw">lcolor</span>(%<span class="dv">0</span>)))             <span class="op">/</span><span class="er">//</span></a></code></pre></div>
</div>
</div>
</div>
<div id="quelques-options-graphiques" class="section level2">
<h2><span class="header-section-number">2.3</span> [Quelques] Options graphiques</h2>
<p>Il s’agit d’un tour d’horizon forcément imcomplet des options graphiques…bienvenue dans une piscine sans fond.</p>
<p>Un très bon pense bête: <a href="https://geocenter.github.io/StataTraining/pdf/StataCheatSheet_visualization15_Syntax_2016_June-REV.pdf" class="uri">https://geocenter.github.io/StataTraining/pdf/StataCheatSheet_visualization15_Syntax_2016_June-REV.pdf</a></p>
<div id="options-dun-objet-graphique" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Options d’un objet graphique</h3>
<p><strong>COULEURS ET TAILLES/EPAISSEURS</strong></p>
<div id="couleurs" class="section level4">
<h4><span class="header-section-number">2.3.1.1</span> Couleurs</h4>
<ul>
<li>3 Eléments dans les options couleurs
<ul>
<li><p><strong>Un nom ou un code numérique</strong>: la couleur <em>navy</em> (première couleur de la palette Stata <strong>s2</strong>) à pour code RGB [Red-Green-Blue] <strong><code>"26 71 11"</code></strong></p></li>
<li><strong>Modification de l’intensité</strong>: par défaut la couleur d’une palette a une intensité de 1, on tire vers le blanc en la réduisant, vers le noir en l’augmentant
<ul>
<li>Valeur minimale 0 (blanc ou quasi blanc), pas de valeur maximale.</li>
<li>Après le nom ou le code couleur, l’intensité est modifiée par <strong><code>*#</code></strong></li>
<li>Exemples:
<ul>
<li><strong><code>option_couleur(*.5)</code></strong> réduit l’intensité de 50% de la couleur utilisée par défaut</li>
<li><strong><code>option_couleur(*1.2)</code></strong> augmente l’intensité de 20% de la couleur utilisée par défaut<br />
<br></li>
</ul></li>
</ul></li>
<li><strong>Réduction de l’opacité</strong> (depuis Stata 15): par défaut le niveau d’opacité est de 100% [transparence = 0%]
<ul>
<li>Valeur minimale 0, valeur maximale 100</li>
<li>Après le nom ou le code de la couleur, l’opacité est réduite par <strong><code>%#</code></strong> avec # compris entre 0 et 100-]</li>
<li>Une transparence totale <strong>optionc(<code>%0</code>)</strong> permet de cacher des éléments d’un graphique</li>
<li>Exemples <strong><code>option_couleurc(%50)</code></strong> donne 50% de transparence à la couleur utilisée par défaut</li>
</ul></li>
<li>On peut <strong>combiner les deux modifications</strong>:
<ul>
<li>Baisser l’intensité et réduire l’opacité n’a pas d’intérêt (voir graphique sur les barres plus bas)</li>
<li>Augmenter l’intensité et baisser l’opacité modifiera le rendu de la couleur dans le graphique <strong><code>optionc([couleur]*1.5%50)</code></strong>: ici intensité multiplié par 1.5 avec 50% de transparence<br />
<br> <br></li>
</ul></li>
</ul></li>
</ul>
<p><strong>Exemples de syntaxes</strong></p>
<p><em>Objets graphiques</em></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">tw scatter Y X,  <span class="kw">mc</span>(blue%<span class="dv">30</span>)    <span class="kw">mlc</span>(black)</a>
<a class="sourceLine" id="cb11-2" title="2">tw line    Y X,  <span class="kw">lc</span>(blue<span class="op">*</span><span class="fl">1.2</span>) </a>
<a class="sourceLine" id="cb11-3" title="3">graph box Y1 Y2, <span class="kw">box</span>(<span class="dv">1</span>,<span class="kw">fc</span>(red<span class="op">%50)) box(2,fc(blue%</span><span class="dv">50</span>))</a></code></pre></div>
<p><em>Options</em></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">title</span>(<span class="st">&quot;MON TITRE&quot;</span>, <span class="kw">c</span>(red) box <span class="kw">fc</span>(blue) <span class="kw">lc</span>(black)   )  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">legend</span>(<span class="kw">region</span>(<span class="kw">fc</span>(blue<span class="op">*</span>.<span class="dv">2</span>) <span class="kw">lc</span>(black)))</a></code></pre></div>
<p><strong>EXEMPLES</strong><br />
<br> <strong>Nuages - bulles [scatter]</strong><br />
<em>Graphique 3</em><br />
<img src="imgf/g4.png" style="width:75.0%" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">clear</a>
<a class="sourceLine" id="cb13-2" title="2">set obs <span class="dv">200</span></a>
<a class="sourceLine" id="cb13-3" title="3">gen x1=<span class="kw">runiform</span>(<span class="dv">0</span>,<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb13-4" title="4">gen y1=<span class="kw">runiform</span>(<span class="dv">0</span>,<span class="dv">8</span>)</a>
<a class="sourceLine" id="cb13-5" title="5">gen x2=<span class="kw">runiform</span>(<span class="dv">8</span>,<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb13-6" title="6">gen y2=<span class="kw">runiform</span>(<span class="dv">12</span>,<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb13-7" title="7"></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="op">*</span><span class="st"> </span>graph NE</a>
<a class="sourceLine" id="cb13-9" title="9"><span class="kw">tw</span> (scatter y2 x1, <span class="kw">mc</span>(<span class="st">&quot;248 118 109*0.5&quot;</span>) <span class="kw">mlc</span>(black))  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="er">||</span><span class="st"> </span>(scatter y2 x2, <span class="kw">mc</span>(<span class="st">&quot;0 191 196*0.5&quot;</span>)   <span class="kw">mlc</span>(black))  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="er">*</span><span class="st"> </span>graph SE</a>
<a class="sourceLine" id="cb13-12" title="12"><span class="kw">tw</span> (scatter y2 x1, <span class="kw">mc</span>(<span class="st">&quot;248 118 109%50&quot;</span>) <span class="kw">mlc</span>(black))  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="er">||</span><span class="st"> </span>(scatter y2 x2, <span class="kw">mc</span>(<span class="st">&quot;0 191 196%50&quot;</span>)   <span class="kw">mlc</span>(black))  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb13-14" title="14"></a>
<a class="sourceLine" id="cb13-15" title="15"><span class="er">*</span><span class="st"> </span>remarque<span class="op">:</span><span class="st"> </span>les tailles des markers ont également été modifiées dans ces graphiques</a></code></pre></div>
<p><strong>Barres [bar - histogram - box - area - rarea]</strong><br />
<em>Graphique 4</em><br />
<img src="imgf/g5.png" style="width:75.0%" /></p>
<p><em>Graphique 5</em><br />
<img src="imgf/g6.png" style="width:75.0%" /></p>
</div>
<div id="taille---epaisseurs" class="section level4">
<h4><span class="header-section-number">2.3.1.2</span> Taille - Epaisseurs</h4>
<div id="taillesépaisseurs-prédéfinies" class="section level5">
<h5><span class="header-section-number">2.3.1.2.1</span> Tailles/épaisseurs prédéfinies</h5>
<ul>
<li>Les tailles et épaisseurs prédéfinies ont un nom (small, large…)</li>
<li>Selon l’élément (symbole, courbe, texte), les noms et la liste changent</li>
</ul>
<p><strong>Types marker</strong><br />
<em>Graphique 6</em><br />
<img src="imgf/g7.png" style="width:75.0%" /></p>
<p><em>Graphique 7</em><br />
<img src="imgf/g8.png" style="width:75.0%" /></p>
<p><em>Graphique 8</em><br />
<img src="imgf/g10.png" style="width:75.0%" /></p>
<p><em>Graphique 9</em><br />
<img src="imgf/g9.png" style="width:75.0%" /></p>
<p><strong>Types line</strong><br />
<em>Graphique 10</em> <img src="imgf/g11.png" style="width:75.0%" /></p>
<p><em>Graphique 11</em><br />
<img src="imgf/g12.png" style="width:75.0%" /></p>
<p><em>Graphique 12</em><br />
<img src="imgf/g13.png" style="width:75.0%" /></p>
</div>
<div id="tailles-paramétrées" class="section level5">
<h5><span class="header-section-number">2.3.1.2.2</span> Tailles paramétrées</h5>
<ul>
<li>Les tailles et épaisseurs peuvent être paramétrées manuellement:
<ul>
<li>par unité de mesure: <strong>#pt</strong> (printer point) <strong>#in</strong> (pouce) <strong>#cm</strong> (centimètre ) <strong>#rs</strong><br />
</li>
<li>par un degré relatif de la taille du graph <strong>#rs(#)</strong></li>
<li>par un coefficient multiplicateur d’une taille de référence =1:<strong><code>option_couleur(*#)</code></strong></li>
</ul></li>
</ul>
<p><em>Graphique 13</em><br />
<img src="imgf/g13b.png" style="width:75.0%" /></p>
<p><strong>Exercices</strong><br />
<br> Avec la base <em>auto</em> [<em><code>sysuse auto.dta</code></em>] <br> * <strong>Graphique(s) I</strong></p>
<ul>
<li>Reproduiser l’un et/ou l’autre de ces graphiques</li>
<li>Les densités sont estimées avec la fonction <strong><code>kdensity</code></strong> [<strong><code>help kdensity</code></strong>]</li>
</ul>
<p><em>Graphique 14</em><br />
<img src="imgf/g3.png" style="width:75.0%" /></p>
<p><strong>Programme en mode alerte spoil!!!!</strong></p>
<p><hide> <strong><code>kdensity price if foreign==1, g(x1 d1) nograph</code></strong><br />
<strong><code>kdensity price if foreign==0, g(x0 d0) nograph</code></strong><br />
<code></code><br />
<strong><code>tw histogram price0, freq fcolor(blue%50) lc(%0)                 ///</code></strong><br />
<strong><code>|| histogram price1, freq fcolor(red%50) lc(%0)                  ///</code></strong><br />
<strong><code>legend(order(1 "Domestic" 2 "Foreign")  region(lcolor(%0)))      ///</code></strong><br />
<strong><code>xlabel(000(5000)20000)  graphr(color(white)) plotr(color(white))</code></strong><br />
<code></code><br />
<strong><code>tw area d1 d0 x0, fc(blue%50 red%50) lc(%0 %0)              ///</code></strong><br />
<strong><code>legend(order(1 "Domestic" 2 "Foreign")  region(lcolor(%0))) ///</code></strong> <strong><code>xlabel(0000(5000)20000)  ylabel(0(0.0001)0.0004)            ///</code></strong> <strong><code>xtitle("") graphr(color(white)) plotr(color(white))</code></strong> </hide></p>
<ul>
<li><ul>
<li><p><strong>Graphique(s) II</strong></p></li>
<li>Reproduir le graphique suivant:</li>
<li>La droite de l’OLS est générée avec le type de graphique <strong><code>lfitci</code></strong>:
<ul>
<li>Couleur de la droite: option <strong><code>clcolor()</code></strong></li>
<li>Couleur de l’intervalle de confiance: option <strong><code>flcolor()</code></strong></li>
<li>Couleur du contour de l’intervalle de confiance: option <strong><code>alcolor()</code></strong></li>
</ul></li>
<li><p>Légende facultative (voir section suivante)</p></li>
</ul></li>
</ul>
<p><em>Graphique 15</em><br />
<img src="imgf/g14.png" style="width:75.0%" /></p>
<p><strong>Programme en mode alerte spoil!!!!</strong><br />
<hide> <strong><code>tw  lfitci  price mpg  if foreign==0,  clcolor(blue*1.2) fcolor(blue%10) alcolor(%0)             ///</code></strong> <strong><code>|| lfitci  price mpg  if foreign==1,  clcolor(red*1.2)  fcolor(red%10)  alcolor(%0)             ///</code></strong> <strong><code>|| scatter price mpg  if foreign==0,  msize(medlarge)   mlc(black)      mlw(vthin) mc(blue*.5)  ///</code></strong> <strong><code>|| scatter price mpg  if foreign==1,  msize(medlarge)   mlc(black)      mlw(vthin) mc(red*.5)   ///</code></strong> <strong><code>, legend(order(5 "Domestic" 6 "Foreign"))                                                      ///</code></strong> <strong><code>ytitle("price") xtitle("mpg")</code></strong><br />
</hide></p>
</div>
</div>
</div>
<div id="axes---légendes---titres" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Axes - Légendes - Titres</h3>
<div id="axes" class="section level4">
<h4><span class="header-section-number">2.3.2.1</span> Axes</h4>
<p>4 sous ensembles d’options: <em>titre</em>, <em>label</em>, <em>échelles</em> et <em>choix</em> pour les axes multiples (non traité)</p>
<p><strong>Titres</strong></p>
<ul>
<li><strong>xtitle()</strong> <strong>ytitle()</strong>: <strong><code>xtitle(["titres"] [, options]</code></strong>
<ul>
<li>Si seulement des option(s) en conservant le titre par défaut (label de la variable): <strong><code>xtitle(, options)</code></strong></li>
<li>Principales options: taille <strong><code>size()</code></strong>, couleur <strong><code>color()</code></strong></li>
<li>Titres sur plusieurs lignes: <strong><code>xtitle("ligne1" ligne2"....[, options]</code></strong></li>
</ul></li>
</ul>
<p><strong>Labels</strong></p>
<ul>
<li><strong>xlabel()</strong> <strong>ylabel()</strong>: <strong><code>xlabel([coordonnées] [,options])</code></strong>
<ul>
<li>Si seulement des option(s) en conservant les coordonnées par défaut: <strong><code>xlabel(, options)</code></strong></li>
</ul></li>
<li>Modification du label:
<ul>
<li>Avec <strong>min(delta)max</strong>: <strong><code>xlabel(#1([#2]#3))</code></strong>. Exemple <strong><code>xlabel(0(5)10)</code></strong></li>
<li>Manuel: <strong><code>xlabel( #1 "label1" #2 "label2"... )</code></strong>. Exemple <strong><code>xlabel(0 "0" 5 "5" 10 "10"... )</code></strong>. Permet d’ajouter des éléments de texte: <strong><code>xlabel(0 "0X" 5 "5X" 10 "10X"... )</code></strong></li>
</ul></li>
<li>Principales options:
<ul>
<li>taille <strong><code>labsize()</code></strong> [<strong><code>labs</code></strong>] , couleur <strong><code>labcolor()</code></strong> [<strong><code>labc</code></strong>]</li>
<li>Alterner les positions pour éviter les chevauchements: <strong><code>alternate</code></strong> (<strong><code>alt</code></strong>)</li>
<li>Modifier l’angle: <strong><code>angle(#)</code></strong> avec # valeur de l’angle [0 (horizontal), 45, 90 (vertical) …]</li>
</ul></li>
</ul>
<p><strong>Echelles</strong></p>
<ul>
<li><strong>xscale()</strong> <strong>yscale()</strong>
<ul>
<li>Principalement utilisé pour l’option <strong><code>log</code></strong> (voir exemple ci-dessous): utilisation d’une échelle logarithmique (voir exemple ci-dessous)</li>
<li>Echelle en ordre décroissant: <strong><code>reverse</code></strong></li>
<li>Supprimer l’affichage des axes: <strong><code>xscale(off)</code></strong> et/ou <strong><code>yscale(off)</code></strong></li>
</ul></li>
</ul>
<p><em>Graphique 16</em><br />
<img src="imgf/g16.png" style="width:75.0%" /></p>
<p><strong>Attention</strong> pour la dernière option, le label doit-être indiqué par des doubles quotes <strong>" label "</strong> et non par <strong>‘label’</strong>: <strong><code>xlabel(10000 "10k" 20000 "20k" 30000 "30k" 40000 "40k")</code></strong></p>
<p><strong>Graphique options 1</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">tw scatter lexp gnppc <span class="cf">if</span> region<span class="op">==</span><span class="dv">1</span>,                      <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb14-2" title="2"><span class="er">||</span><span class="st"> </span>scatter lexp gnppc <span class="cf">if</span> region<span class="op">==</span><span class="dv">2</span>,                      <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="er">||</span><span class="st"> </span>scatter lexp gnppc <span class="cf">if</span> region<span class="op">==</span><span class="dv">3</span>,                      <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb14-4" title="4">,  <span class="kw">title</span>(<span class="st">&quot;Options 2&quot;</span>)                                    <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;Eur &amp; C.Asia&quot;</span> <span class="dv">2</span> <span class="st">&quot;N.A&quot;</span> <span class="dv">3</span> <span class="st">&quot;S.A&quot;</span>))       <span class="op">/</span><span class="er">//</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="st">   </span><span class="kw">xscale</span>(log) <span class="kw">xlabel</span>(,alt) <span class="kw">xtitle</span>(, <span class="kw">size</span>(small))        <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="st">   </span><span class="kw">ylabel</span>(<span class="dv">50</span>(<span class="dv">5</span>)<span class="dv">80</span>)          <span class="kw">ytitle</span>(, <span class="kw">size</span>(small))                </a></code></pre></div>
<p><strong>AIDES</strong></p>
<ul>
<li><a href="https://www.stata.com/manuals/g-3axis_options.pdf#g-3axis_options" class="uri">https://www.stata.com/manuals/g-3axis_options.pdf#g-3axis_options</a>
<ul>
<li><strong><code>help axis_options</code></strong></li>
<li><strong><code>help axis_title_options</code></strong></li>
<li><strong><code>help axis_label_options</code></strong></li>
<li><strong><code>help axis_scale_options</code></strong></li>
<li><strong><code>help axis_choice_options</code></strong></li>
</ul></li>
</ul>
</div>
<div id="légendes" class="section level4">
<h4><span class="header-section-number">2.3.2.2</span> Légendes</h4>
<ul>
<li><strong>legend()</strong>: <strong><code>legend()</code></strong></li>
<li>Ne pas afficher une légende: <strong><code>legend(off)</code></strong></li>
<li>Position par défaut: 6 heures (Sud) - Extérieur. Modifiable avec <strong><code>pos(#)</code></strong> et <strong><code>ring(#)</code></strong> [voir Annexe plus bas]</li>
<li>Modifier le nombre de lignes et de colonne: <strong><code>row(#)</code></strong> et <strong><code>col(#)</code></strong></li>
<li>Modifier les labels de la légende:
<ul>
<li><strong>order()</strong>: <em><code>order( 1 "label1" 2 "label2" .....)</code></em></li>
<li><strong>lab()</strong>: <em><code>lab(1 "label1") lab(2 "label2") ...)</code></em></li>
<li>L’apparence (gras, itallique…) sont modifiables avec des balises <strong>smcl</strong></li>
</ul></li>
<li>Modifier l’aspect de la région: <strong><code>region(options)</code></strong> ou <strong><code>r(options)</code></strong></li>
<li>Texte sous le symbol: <strong><code>stack</code></strong></li>
</ul>
<p><em>Graphique 17</em><br />
<img src="imgf/g17.png" style="width:75.0%" /></p>
<p><strong>Par défaut</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">tw scatter   mpg price <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span>   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb15-2" title="2"><span class="er">||</span><span class="st"> </span>scatter   mpg price <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span>   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">title</span>(<span class="st">&quot;Legende par défaut&quot;</span>)</a></code></pre></div>
<p><strong>Avec modification</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">tw scatter   mpg price <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span>                <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="er">||</span><span class="st"> </span>scatter   mpg price <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span>                <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb16-3" title="3">,  <span class="kw">title</span>(<span class="st">&quot;Modification de la légende&quot;</span>)              <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;{bf:Domestic}&quot;</span> <span class="dv">2</span> <span class="st">&quot;{bf:Foreign}&quot;</span>) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb16-5" title="5"><span class="st">   </span>pos1) <span class="kw">ring</span>(<span class="dv">0</span>) <span class="kw">col</span>(<span class="dv">1</span>)                             <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="st">   </span><span class="kw">region</span>(<span class="kw">lw</span>(vvthin))                       <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="st">   </span>stack <span class="er">)</span> </a></code></pre></div>
<ul>
<li>Changement des labels de la légende, affichés en gras: <strong><code>order(1 "{bf:Domestic}" 2 "{bf:Foreign}")</code></strong></li>
<li>Position à 1 heure dans le graphique et affichage sur une ligne : <strong><code>pos(1) ring(0) col(1)</code></strong></li>
<li>Modification de la boite avec un contour très fin: <strong><code>region(lw(vvthin)</code></strong></li>
<li>Text sous le symnol: option <strong><code>stack</code></strong></li>
</ul>
<p><strong>AIDES</strong></p>
<ul>
<li><a href="https://www.stata.com/manuals/g-3legend_options.pdf" class="uri">https://www.stata.com/manuals/g-3legend_options.pdf</a></li>
<li><strong><code>help legend_options</code></strong></li>
</ul>
</div>
<div id="titres---notes---texte" class="section level4">
<h4><span class="header-section-number">2.3.2.3</span> Titres - Notes - Texte</h4>
<ul>
<li>Modification de la position
<ul>
<li>Titre par défaut: à 12 heures à l’extérieur</li>
<li>Note par défaut: à 17 heures à l’extérieur</li>
<li>Caption par défaut: sous la note</li>
<li>Titre(s) - Notes - Texte: Modifiable avec <strong><code>pos(#)</code></strong> et <strong><code>ring(#)</code></strong> [voir Annexe plus bas]</li>
<li>Texte libre: positionné sur les coordonnées des axes (x,y)</li>
</ul></li>
<li>L’apparence (gras, italique, polices…) sont modifiables avec des balises <strong>smcl</strong> + ajout de symboles mathématiques + lettres grecques</li>
<li>Tailles et couleurs modifiables avec <strong><code>size</code></strong> et <strong><code>color</code></strong></li>
<li>Plusieurs lignes: <strong><code>"ligne1" "ligne2"....</code></strong></li>
</ul>
<p><br> <strong>ANNEXE: POSITION</strong></p>
<p><strong>Texte positionné au Nord et au Sud</strong><br />
<em>Graphique 18</em><br />
<img src="imgf/g15.png" style="width:75.0%" /></p>
<p><strong>Texte positionné à l’Ouest et à l’Est</strong><br />
<em>Graphique 19</em><br />
<img src="imgf/g15b.png" style="width:75.0%" /></p>
<p><strong>idée du 26/06: Positionner un texte manuellement pour faire apparaitre un point/une zone du graphique [A faire]</strong></p>
</div>
</div>
<div id="autres" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Autres</h3>
<ul>
<li><strong>name</strong>: sauvegarde temporaire sur la session
<ul>
<li>utiliser l’option replace pour écraser le graph, sinon effectuer <strong><code>graph drop noms_graphs</code></strong> ou <strong><code>graph drop _all</code></strong></li>
<li>Exemple: <strong><code>tw line y x, name(g1,replace)</code></strong></li>
</ul></li>
<li><strong>save</strong>: sauvegarde en dur sur le disque
<ul>
<li>Utile de créer un répertoire par défaut avec une macro (type <strong><code>global</code></strong>): <strong><code>global g "D:/stata_graph/"</code></strong> puis <strong><code>tw line y x, save($g/g1, replace)</code></strong></li>
<li>récupérer les infos d’un graph enregistré: <strong><code>graph describe nom_grap.gph</code></strong> (le code est affiché)</li>
</ul></li>
<li><strong>scale(#)</strong>: permet de réduire la taille de tous les éléments générés par le graphique, en particulier le texte. Utile, par exemple, lorsque le texte d’une légende sort du contour.</li>
<li><strong>nodraw</strong>: équivalent de <em><code>quietly</code></em> pour les graphiques. Permet de réduire le temps d’exécution pour les graphiques combinés</li>
</ul>
</div>
</div>
<div id="les-graphiques-combinés" class="section level2">
<h2><span class="header-section-number">2.4</span> Les graphiques combinés</h2>
<ul>
<li>2 commandes:
<ul>
<li>interne: <strong>graph combine</strong></li>
<li>externe: <strong>grc1leg</strong> pour avoir une seule légende, si elle est partagé pour tous les graphiques<br />
<br></li>
</ul></li>
<li>préférer <strong><code>name()</code></strong> à <strong><code>save()</code></strong> pour les graphiques composants le graphique combiné</li>
<li>utiliser <strong><code>nodraw</code></strong> pour raccourcir le temps d’exécution</li>
<li><strong>graph combine</strong> et <strong>gr1leg</strong> (externe: permet d’afficher une seule légende)
<ul>
<li><strong>row(#)</strong> - <strong>cols(#)</strong></li>
<li><strong>iscale(#)</strong>: baisse ou augmente la taille des éléments textes par un coefficient multiplicateur</li>
<li><strong>xsize(#)</strong> - <strong>ysize(#)</strong>: taille du graphique en <em>pt</em> (max # = 20)
<ul>
<li>Pour un graphique à plusieurs colonne et une ligne: on peut augmenter le ratio xsize(#)/ysize(#)</li>
<li>Pour un graphique à plusieurs lignes et une colonne: on peut baisser le ratio xsize(#)/ysize(#)</li>
</ul></li>
<li><strong>xcommon</strong> - <strong>ycommon</strong>: ajuster les axes pour tous les graphiques</li>
<li><strong>legendfrom</strong>: une seule légende avec l’option <strong>legendfrom(name)</strong> de la commande <strong><code>gr1leg</code></strong></li>
<li>gestion des styles: si les graphiques utilisent des thèmes graphiques différents, le dernier sera appliqué à tous les graphiques. Pour conserver les thèmes d’origine: <strong><code>scheme(nom_style1 nom_style2....)</code></strong></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">tw graph1, <span class="kw">name</span>(g1, replace) nodraw </a>
<a class="sourceLine" id="cb17-2" title="2">tw graph2, <span class="kw">name</span>(g2, replace) nodraw </a>
<a class="sourceLine" id="cb17-3" title="3">graph combine g1 g2, <span class="kw">iscale</span>(.<span class="dv">9</span>) <span class="kw">xsize</span>(<span class="dv">20</span>) <span class="kw">ysize</span>(<span class="dv">15</span>) <span class="kw">scheme</span>(style1 style2) <span class="kw">title</span>(<span class="st">&quot;graphique combiné&quot;</span>)</a></code></pre></div>
</div>
<div id="python" class="section level2">
<h2><span class="header-section-number">2.5</span> Python</h2>
<ul>
<li>Implémentation de Python avec la version 16 de Stata:
<ul>
<li>Stata n’intalle pas Python: [Installation de Python] <a href="https://mthevenin.github.io/stata_fr/python.html" class="uri">https://mthevenin.github.io/stata_fr/python.html</a></li>
<li>Implémentation de commandes Stata dédiées pour gérer l’utilisation de Python [<code>python query</code> <code>python describe</code> <code>python clear</code> ….]</li>
<li>Python est exécutable dans la fenêtre <em>command</em> ou dans l’éditeur de programme</li>
<li>Une librairie Python pour faciliter le passage d’une application à une autre</li>
<li>Les macros Stata reconnues lorsqu’on passe en code Python (très intéressant pour les graphiques)</li>
</ul></li>
</ul>
<p><strong>Exemple 1</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">Exemple <span class="dv">1</span></a>
<a class="sourceLine" id="cb18-2" title="2">python<span class="op">:</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="op">-----------------------</span><span class="st"> </span><span class="kw">python</span> (type end to exit) <span class="op">--------------------</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="st"> </span>a=<span class="dv">1</span></a>
<a class="sourceLine" id="cb18-5" title="5"> b=<span class="dv">2</span></a>
<a class="sourceLine" id="cb18-6" title="6"> a<span class="op">+</span>b</a>
<a class="sourceLine" id="cb18-7" title="7"> <span class="dv">3</span></a>
<a class="sourceLine" id="cb18-8" title="8"> end</a>
<a class="sourceLine" id="cb18-9" title="9"><span class="op">----------------------------------------------------------------------</span></a></code></pre></div>
<p><strong>Exemple 2: importation d’une base Stata avec la librarie <code>pandas</code></strong> <strong>Fonction panda</strong>: read_stata(‘path/nom_bas’)</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">python<span class="op">:</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="op">-----------------------</span><span class="st"> </span><span class="kw">python</span> (type end to exit) <span class="op">--------------------</span></a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4">import pandas as pa </a>
<a class="sourceLine" id="cb19-5" title="5">df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;D:/stata_temp/auto.dta&#39;</span>)</a>
<a class="sourceLine" id="cb19-6" title="6"><span class="kw">df.head</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb19-7" title="7">   price  mpg  turn  displacement  gear_ratio   foreign</a>
<a class="sourceLine" id="cb19-8" title="8"><span class="dv">0</span>   <span class="dv">4099</span>   <span class="dv">22</span>    <span class="dv">40</span>           <span class="dv">121</span>        <span class="fl">3.58</span>  Domestic</a>
<a class="sourceLine" id="cb19-9" title="9"><span class="dv">1</span>   <span class="dv">4749</span>   <span class="dv">17</span>    <span class="dv">40</span>           <span class="dv">258</span>        <span class="fl">2.53</span>  Domestic</a>
<a class="sourceLine" id="cb19-10" title="10"><span class="dv">2</span>   <span class="dv">3799</span>   <span class="dv">22</span>    <span class="dv">35</span>           <span class="dv">121</span>        <span class="fl">3.08</span>  Domestic</a>
<a class="sourceLine" id="cb19-11" title="11"><span class="dv">3</span>   <span class="dv">4816</span>   <span class="dv">20</span>    <span class="dv">40</span>           <span class="dv">196</span>        <span class="fl">2.93</span>  Domestic</a>
<a class="sourceLine" id="cb19-12" title="12"><span class="dv">4</span>   <span class="dv">7827</span>   <span class="dv">15</span>    <span class="dv">43</span>           <span class="dv">350</span>        <span class="fl">2.41</span>  Domestic</a>
<a class="sourceLine" id="cb19-13" title="13"><span class="dv">5</span>   <span class="dv">5788</span>   <span class="dv">18</span>    <span class="dv">43</span>           <span class="dv">231</span>        <span class="fl">2.73</span>  Domestic</a>
<a class="sourceLine" id="cb19-14" title="14"><span class="dv">6</span>   <span class="dv">4453</span>   <span class="dv">26</span>    <span class="dv">34</span>           <span class="dv">304</span>        <span class="fl">2.87</span>  Domestic</a>
<a class="sourceLine" id="cb19-15" title="15"><span class="dv">7</span>   <span class="dv">5189</span>   <span class="dv">20</span>    <span class="dv">42</span>           <span class="dv">196</span>        <span class="fl">2.93</span>  Domestic</a>
<a class="sourceLine" id="cb19-16" title="16"><span class="dv">8</span>  <span class="dv">10372</span>   <span class="dv">16</span>    <span class="dv">43</span>           <span class="dv">231</span>        <span class="fl">2.93</span>  Domestic</a>
<a class="sourceLine" id="cb19-17" title="17"><span class="dv">9</span>   <span class="dv">4082</span>   <span class="dv">19</span>    <span class="dv">42</span>           <span class="dv">231</span>        <span class="fl">3.08</span>  Domestic</a>
<a class="sourceLine" id="cb19-18" title="18">end</a>
<a class="sourceLine" id="cb19-19" title="19"><span class="op">----------------------------------------------------------------------</span></a></code></pre></div>
<ul>
<li>Graphiques et data-visualisation</li>
<li>Les trois principales librairies pour les graphiques
<ul>
<li><strong><code>matplotlib</code></strong>: <a href="https://matplotlib.org/" class="uri">https://matplotlib.org/</a></li>
<li><strong><code>seaborn</code></strong>: <a href="https://seaborn.pydata.org/" class="uri">https://seaborn.pydata.org/</a></li>
<li><strong><code>plotly</code></strong> <a href="https://plotly.com/graphing-libraries/" class="uri">https://plotly.com/graphing-libraries/</a></li>
</ul></li>
<li>Autres: <strong><code>ggplot</code></strong> et <strong><code>plotnine</code></strong> pour des graphiques types ggplot2
<ul>
<li><em>ggplot</em>: la librairie n’est plus mise à jour - très imcomplète</li>
<li><em>plotninne</em>: la librairue est mise à jour - incomplète</li>
</ul></li>
</ul>
<div id="librairie-seaborn" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Librairie seaborn</h3>
<ul>
<li>Graphiques statiques</li>
</ul>
<p><strong>Exemple 1</strong></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="op">*</span><span class="st"> </span>Partie Stata</a>
<a class="sourceLine" id="cb20-2" title="2">sysuse auto, clear</a>
<a class="sourceLine" id="cb20-3" title="3">xtile mpg2 =<span class="st"> </span>mpg, <span class="kw">n</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb20-4" title="4">label define mpg <span class="dv">1</span> <span class="st">&quot;mpg&lt;20&quot;</span> <span class="dv">2</span> <span class="st">&quot;mpg&gt;=20&quot;</span>, modify</a>
<a class="sourceLine" id="cb20-5" title="5">label value mpg2 mpg</a>
<a class="sourceLine" id="cb20-6" title="6">keep price mpg weight displacement turn mpg2</a>
<a class="sourceLine" id="cb20-7" title="7">save auto2, replace</a>
<a class="sourceLine" id="cb20-8" title="8"></a>
<a class="sourceLine" id="cb20-9" title="9"><span class="op">*</span><span class="st"> </span>Partie Python</a>
<a class="sourceLine" id="cb20-10" title="10">python<span class="op">:</span></a>
<a class="sourceLine" id="cb20-11" title="11">import pandas as pa </a>
<a class="sourceLine" id="cb20-12" title="12">import seaborn as sns</a>
<a class="sourceLine" id="cb20-13" title="13">df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;auto2.dta&#39;</span>)</a>
<a class="sourceLine" id="cb20-14" title="14">g =<span class="st"> </span><span class="kw">sns.pairplot</span>(df, <span class="dt">hue=</span><span class="st">&quot;mpg2&quot;</span>,<span class="dt">palette=</span><span class="st">&quot;hls&quot;</span>)</a>
<a class="sourceLine" id="cb20-15" title="15"><span class="kw">g.savefig</span>(<span class="st">&quot;graph1.png&quot;</span>)</a>
<a class="sourceLine" id="cb20-16" title="16">end</a>
<a class="sourceLine" id="cb20-17" title="17"><span class="op">!</span><span class="st"> </span>graph1.png</a></code></pre></div>
<p><em>Graphique 20</em><br />
<img src="imgf/g25.png" style="width:75.0%" /></p>
<p><strong>Remarques</strong>:</p>
<ul>
<li>Les labels de la variable <strong>mpg2</strong> ont été lus par la fonction Python <strong><code>pairplot</code></strong></li>
<li>Le graphique a du être enregistré avec la fonction <strong><code>savefig(nom_graph)</code></strong> et ouvert avec l’invite de commande windows: <strong><code>! nom_graph</code></strong> ou <strong><code>shell nom_graph</code></strong>
<ul>
<li>Ce n’est pas une obligation, tout dépend de la fonction.</li>
<li>Si le graphique peut-être affiché directement, on peut utiliser la fonction <strong><code>show()</code></strong></li>
</ul></li>
</ul>
<p>**Exemple 2</p>
<p><strong>Histogrammes et heatplot</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">use nhanes2, clear</a>
<a class="sourceLine" id="cb21-2" title="2">keep height weight</a>
<a class="sourceLine" id="cb21-3" title="3">save pression, replace</a>
<a class="sourceLine" id="cb21-4" title="4"></a>
<a class="sourceLine" id="cb21-5" title="5">python<span class="op">:</span></a>
<a class="sourceLine" id="cb21-6" title="6">import pandas as pa </a>
<a class="sourceLine" id="cb21-7" title="7">import seaborn as sns</a>
<a class="sourceLine" id="cb21-8" title="8">df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;pression.dta&#39;</span>)</a>
<a class="sourceLine" id="cb21-9" title="9"><span class="kw">sns.set</span>(<span class="dt">style=</span><span class="st">&quot;ticks&quot;</span>)</a>
<a class="sourceLine" id="cb21-10" title="10">g =<span class="st"> </span><span class="kw">sns.jointplot</span>(<span class="dt">x=</span><span class="st">&quot;height&quot;</span>, <span class="dt">y=</span><span class="st">&quot;weight&quot;</span>, <span class="dt">kind=</span><span class="st">&quot;hex&quot;</span>, <span class="dt">color=</span><span class="st">&quot;mediumvioletred&quot;</span>, <span class="dt">data=</span>df)</a>
<a class="sourceLine" id="cb21-11" title="11"><span class="kw">g.savefig</span>(<span class="st">&quot;graph2.png&quot;</span>)</a>
<a class="sourceLine" id="cb21-12" title="12">end</a>
<a class="sourceLine" id="cb21-13" title="13"><span class="op">!</span><span class="st"> </span>graph2.png </a></code></pre></div>
<p><em>Graphique 21</em><br />
<img src="imgf/g26.png" style="width:50.0%" /></p>
<p><strong>Lecture/Remarques</strong>: [A FAIRE]</p>
<p><strong>Densité</strong>: en remplaçant l’option <strong><code>kind="hex"</code></strong> par <strong><code>kind="kde"</code></strong><br />
<em>Graphique 22</em><br />
<img src="imgf/g26b.png" style="width:50.0%" /></p>
</div>
<div id="plotly" class="section level3">
<h3><span class="header-section-number">2.5.2</span> Plotly</h3>
<p>Graphiques de type intéractifs et/ou dynamiques - possibilité de programmer des dashboard [A testé d’ici septembre]</p>
<ul>
<li>Graphiques intéractif et dynamique Intéractivité:
<ul>
<li>des informations s’affichent en passant sur le(s) élément(s) du graphique - on peut sélectionner une partie du graphique</li>
<li>On peut choisir de faire apparaître une partie des éléments composant le graphique. Pratique pour les courbes (clic et double clic dans la légende)</li>
<li>Des options en haut et à gauche du graphiques permettent de zoomer/dezoomer…</li>
</ul></li>
<li>Graphique enregistré en format html. Pour une capture <em>png</em>, on peut l’enregistrer directement (voir menu en haut et à gauche)</li>
</ul>
<p><strong>Exemple 1:</strong> <strong>Graphique intéractif de type line</strong><br />
<a href="https://plotly.com/python/line-charts/" class="uri">https://plotly.com/python/line-charts/</a></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">sysuse uslifeexp.dta , clear</a>
<a class="sourceLine" id="cb22-2" title="2">keep year le le_male le_female</a>
<a class="sourceLine" id="cb22-3" title="3">rename le le1</a>
<a class="sourceLine" id="cb22-4" title="4">rename le_male le2</a>
<a class="sourceLine" id="cb22-5" title="5">rename le_female le3</a>
<a class="sourceLine" id="cb22-6" title="6">reshape long le, <span class="kw">i</span>(year) <span class="kw">j</span>(pop)</a>
<a class="sourceLine" id="cb22-7" title="7">label define pop <span class="dv">1</span> <span class="st">&quot;tot&quot;</span> <span class="dv">2</span> <span class="st">&quot;Hommes&quot;</span> <span class="dv">3</span> <span class="st">&quot;Femmes&quot;</span></a>
<a class="sourceLine" id="cb22-8" title="8">label value pop pop </a>
<a class="sourceLine" id="cb22-9" title="9">save uslifeexp.dta , replace</a>
<a class="sourceLine" id="cb22-10" title="10"></a>
<a class="sourceLine" id="cb22-11" title="11">python<span class="op">:</span></a>
<a class="sourceLine" id="cb22-12" title="12">import pandas as pa </a>
<a class="sourceLine" id="cb22-13" title="13">import plotly.express as px</a>
<a class="sourceLine" id="cb22-14" title="14">df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;uslifeexp.dta&#39;</span>)</a>
<a class="sourceLine" id="cb22-15" title="15">fig =<span class="st"> </span><span class="kw">px.line</span>(df, <span class="dt">x=</span><span class="st">&quot;year&quot;</span>, <span class="dt">y=</span><span class="st">&quot;le&quot;</span>, <span class="dt">color=</span><span class="st">&quot;pop&quot;</span>)</a>
<a class="sourceLine" id="cb22-16" title="16"><span class="kw">fig.update_layout</span>( <span class="dt">title=</span><span class="st">&quot;Espérance de vie US de 1900 &amp; 1999&quot;</span>, <span class="dt">yaxis_title=</span><span class="st">&quot;Espérance de vie&quot;</span>)</a>
<a class="sourceLine" id="cb22-17" title="17"><span class="kw">fig.show</span>()</a>
<a class="sourceLine" id="cb22-18" title="18">end</a></code></pre></div>
<p><em>Graphique 23</em><br />
<iframe width="800" height="600"  src="imgf/g27.html"></iframe></p>
<p><em>Options d’intéractivité</em>: [A FAIRE]</p>
<p><strong>Exemple 3 :</strong> <strong>Graphique intéractif de type tree</strong><br />
<a href="https://plotly.com/python/treemaps/" class="uri">https://plotly.com/python/treemaps/</a></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">use <span class="st">&quot;gm2.dta&quot;</span>, clear</a>
<a class="sourceLine" id="cb23-2" title="2">des</a>
<a class="sourceLine" id="cb23-3" title="3"><span class="op">/</span><span class="er">*</span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="op">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="st">              </span>storage   display    value</a>
<a class="sourceLine" id="cb23-6" title="6">variable name   type    format     label      variable label</a>
<a class="sourceLine" id="cb23-7" title="7"><span class="op">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb23-8" title="8">country         str30   %30s                  </a>
<a class="sourceLine" id="cb23-9" title="9">continent       str14   %14s                  </a>
<a class="sourceLine" id="cb23-10" title="10">lifeexp         double  %<span class="fl">6.2</span>f                 </a>
<a class="sourceLine" id="cb23-11" title="11">year            float   %<span class="fl">9.0</span>g                 </a>
<a class="sourceLine" id="cb23-12" title="12">pop             long    %<span class="fl">12.0</span>g                </a>
<a class="sourceLine" id="cb23-13" title="13">world           str5    %9s                   </a>
<a class="sourceLine" id="cb23-14" title="14"><span class="op">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb23-15" title="15"><span class="er">*/</span></a>
<a class="sourceLine" id="cb23-16" title="16"></a>
<a class="sourceLine" id="cb23-17" title="17">python<span class="op">:</span></a>
<a class="sourceLine" id="cb23-18" title="18">import pandas as pa </a>
<a class="sourceLine" id="cb23-19" title="19">import plotly.express as px</a>
<a class="sourceLine" id="cb23-20" title="20">df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;gm2.dta&#39;</span>)</a>
<a class="sourceLine" id="cb23-21" title="21">fig =<span class="st"> </span><span class="kw">px.treemap</span>(df, <span class="dt">path=</span>[<span class="st">&#39;world&#39;</span>, <span class="st">&#39;continent&#39;</span>, <span class="st">&#39;country&#39;</span>], <span class="dt">values=</span><span class="st">&#39;pop&#39;</span>, <span class="dt">color=</span><span class="st">&#39;lifeexp&#39;</span>)</a>
<a class="sourceLine" id="cb23-22" title="22"><span class="kw">fig.show</span>()</a>
<a class="sourceLine" id="cb23-23" title="23">end</a></code></pre></div>
<p><em>Graphique 24</em><br />
<iframe width="800" height="600"  src="imgf/g29.html"></iframe></p>
<p><em>Lecture</em>:</p>
<ul>
<li>Les périmètres des boîtes sont relatifs à la taille de la population: taille relative des <em>continents</em> - taille relative des pays dans chaque <em>continent</em></li>
<li>Les différentes couleurs sont relative à la valeur de l’espérance de vie</li>
<li>Pour <em>world</em> et les continents les espérances sont calculés par une moyenne pondérée: avec stata pour l’Europe: <strong><code>sum lifeexp [iw=pop] if continent=Europe"</code></strong></li>
<li>Manque quelques pays dont le continent n’était pas renseigné dans la base d’origine et que je n’ai pas pris la peine et/ou le temps de modifier</li>
</ul>
<p><strong>Exemple 3 :</strong> <strong>Graphique intéractif et dynamique de type barres</strong><br />
<a href="https://plotly.com/python/bar-charts/" class="uri">https://plotly.com/python/bar-charts/</a></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">use gm3, clear</a>
<a class="sourceLine" id="cb24-2" title="2">drop <span class="cf">if</span> year<span class="op">&lt;</span><span class="dv">1960</span></a>
<a class="sourceLine" id="cb24-3" title="3">drop <span class="cf">if</span> continent<span class="op">==</span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb24-4" title="4">replace continent=<span class="st">&quot;Asia &amp; Oceania&quot;</span> <span class="cf">if</span> <span class="kw">inlist</span>(continent, <span class="st">&quot;Asia&quot;</span>, <span class="st">&quot;Oceania&quot;</span>)</a>
<a class="sourceLine" id="cb24-5" title="5">bysort country<span class="op">:</span><span class="st"> </span>gen N=_N</a>
<a class="sourceLine" id="cb24-6" title="6">sort year pop</a>
<a class="sourceLine" id="cb24-7" title="7">drop <span class="cf">if</span> N<span class="op">&lt;</span><span class="dv">61</span>   <span class="op">/</span><span class="er">/</span><span class="st"> </span>On conserve seulement les pays avec toutes les années renseignées</a>
<a class="sourceLine" id="cb24-8" title="8">tostring year, replace</a>
<a class="sourceLine" id="cb24-9" title="9">drop N</a>
<a class="sourceLine" id="cb24-10" title="10">save gm4, replace</a>
<a class="sourceLine" id="cb24-11" title="11">des</a>
<a class="sourceLine" id="cb24-12" title="12"><span class="op">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb24-13" title="13"><span class="st">              </span>storage   display    value</a>
<a class="sourceLine" id="cb24-14" title="14">variable name   type    format     label      variable label</a>
<a class="sourceLine" id="cb24-15" title="15"><span class="op">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb24-16" title="16">country         str30   %30s                  </a>
<a class="sourceLine" id="cb24-17" title="17">continent       str14   %14s                  </a>
<a class="sourceLine" id="cb24-18" title="18">pop             long    %<span class="fl">12.0</span>g                </a>
<a class="sourceLine" id="cb24-19" title="19">year            float   %<span class="fl">6.0</span>f                 </a>
<a class="sourceLine" id="cb24-20" title="20"><span class="op">--------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb24-21" title="21"></a>
<a class="sourceLine" id="cb24-22" title="22">python<span class="op">:</span></a>
<a class="sourceLine" id="cb24-23" title="23">import pandas as pa </a>
<a class="sourceLine" id="cb24-24" title="24">import plotly.express as px</a>
<a class="sourceLine" id="cb24-25" title="25">df =<span class="st"> </span><span class="kw">pa.read_stata</span>(<span class="st">&#39;gm4.dta&#39;</span>)</a>
<a class="sourceLine" id="cb24-26" title="26">fig =<span class="st"> </span><span class="kw">px.bar</span>(df, <span class="dt">x=</span><span class="st">&quot;continent&quot;</span>, <span class="dt">y=</span><span class="st">&quot;pop&quot;</span>, <span class="dt">color=</span><span class="st">&quot;continent&quot;</span>,</a>
<a class="sourceLine" id="cb24-27" title="27"><span class="dt">animation_frame=</span><span class="st">&quot;year&quot;</span>, <span class="dt">animation_group=</span><span class="st">&quot;country&quot;</span>, <span class="dt">range_y=</span>[<span class="dv">0</span>, <span class="dv">5000000000</span>])</a>
<a class="sourceLine" id="cb24-28" title="28"><span class="kw">fig.update_layout</span>( <span class="dt">title=</span><span class="st">&quot;Evolution de la population mondiale  depuis 1960&quot;</span>,</a>
<a class="sourceLine" id="cb24-29" title="29"><span class="dt">yaxis_title=</span><span class="st">&quot;Population&quot;</span>, <span class="dt">xaxis_title=</span><span class="st">&quot;Continents&quot;</span>)</a>
<a class="sourceLine" id="cb24-30" title="30"><span class="kw">fig.show</span>()</a>
<a class="sourceLine" id="cb24-31" title="31">end</a></code></pre></div>
<p><em>Graphique 25</em><br />
<iframe width="800" height="600"  src="imgf/g28.html"></iframe></p>
</div>
</div>
</div>
<div id="utilisation-des-macros" class="section level1">
<h1><span class="header-section-number">3</span> Utilisation des macros</h1>
<div id="types-et-objets-macro" class="section level2">
<h2><span class="header-section-number">3.1</span> Types et objets macro</h2>
<ul>
<li><strong>Rappel important</strong>: (toujours) tester le contenu de la macro avec <strong><code>display</code></strong> (<code>di</code>) ou <strong>[très conseillé]</strong> avec <strong><code>macro list</code></strong>:
<ul>
<li><strong><code>macro list _nom_macro</code></strong></li>
<li><strong>di `nom_macro’</strong></li>
<li><strong>di “`nom_macro’”</strong></li>
</ul></li>
<li><strong>boucles</strong>: pour générer des boucles se reporter à l’aide: <strong><code>help foreach</code></strong> - <strong><code>help forvalue</code></strong></li>
</ul>
<div id="local---global" class="section level3">
<h3><span class="header-section-number">3.1.1</span> local - global</h3>
<ul>
<li><strong>global</strong>: macro en dur (enregistrée)
<ul>
<li>Appelé avec <strong>$</strong></li>
<li><p>Supression: <strong>`macro drop nom_macro1 nom_macro2…``</strong></p></li>
<li><p>Pas de grande utilité à mon sens pour les graphiques, sauf pour utiliser un répertoire par défaut de sauvegarde des graphiques</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">    mkdir <span class="st">&quot;D:/stata_graph&quot;</span></a>
<a class="sourceLine" id="cb25-2" title="2">    global g <span class="st">&quot;D:/stata_graph&quot;</span></a>
<a class="sourceLine" id="cb25-3" title="3">    tw scatter y x, <span class="kw">save</span>(<span class="op">$</span>g<span class="op">/</span>nom_graph)</a></code></pre></div>
<ul>
<li><strong>local</strong>: macro temporaire (à l’exécution)
<ul>
<li>Appelé avec des quotes simples <strong>`<code>nom_macro'</code></strong> (première quote: [alt6])</li>
</ul></li>
</ul>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">sysuse auto, clear</a>
<a class="sourceLine" id="cb26-2" title="2"></a>
<a class="sourceLine" id="cb26-3" title="3">global varlist price mpg </a>
<a class="sourceLine" id="cb26-4" title="4">tw scatter <span class="op">$</span>varlist</a>
<a class="sourceLine" id="cb26-5" title="5">macro drop varlist</a>
<a class="sourceLine" id="cb26-6" title="6"></a>
<a class="sourceLine" id="cb26-7" title="7">local varlist price mpg </a>
<a class="sourceLine" id="cb26-8" title="8">tw scatter <span class="st">`</span><span class="dt">varlist&#39;</span></a></code></pre></div>
<ul>
<li><strong>Macro et doubles quotes apparentes [TRES IMPORTANT]</strong>
<ul>
<li>se fier à <strong><code>macro list</code></strong> et non à <code>di</code> pour vérifier la lecture de la macro</li>
</ul></li>
</ul>
<p>Non lue avec display, utilisable dans une commande</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">local x <span class="st">&quot;A&quot;</span></a>
<a class="sourceLine" id="cb27-2" title="2">di <span class="st">`</span><span class="dt">x&#39;</span></a>
<a class="sourceLine" id="cb27-3" title="3"><span class="dt">A not found</span></a>
<a class="sourceLine" id="cb27-4" title="4"></a>
<a class="sourceLine" id="cb27-5" title="5"><span class="dt">macro list _x</span></a>
<a class="sourceLine" id="cb27-6" title="6"><span class="dt">_x: A</span></a></code></pre></div>
<p>Lue avec des doubles quotes, non utilisable dans une commande<br />
<strong>[A réserver avec <code>display</code>]</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1">local x <span class="st">&quot;`&quot;&quot;A&quot;&quot;&#39;&quot;</span></a>
<a class="sourceLine" id="cb28-2" title="2">di <span class="st">`</span><span class="dt">x&#39;</span></a>
<a class="sourceLine" id="cb28-3" title="3"><span class="dt">&quot;A&quot;</span></a>
<a class="sourceLine" id="cb28-4" title="4"></a>
<a class="sourceLine" id="cb28-5" title="5"><span class="dt">mac list _x</span></a>
<a class="sourceLine" id="cb28-6" title="6"><span class="dt">_x:  </span><span class="st">`&quot;&quot;</span>A<span class="st">&quot;&quot;&#39;</span></a></code></pre></div>
<p>Lue sans les doubles quotes, utilisable dans une commande <strong>[A utiliser avec des commandes ultérieures qui demandent des doubles quotes apprentes]</strong></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">local x <span class="st">`</span><span class="dt">&quot;&quot;A&quot;&quot;&#39;</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="dt">di </span><span class="st">`</span>x<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb29-3" title="3"><span class="st">A</span></a>
<a class="sourceLine" id="cb29-4" title="4"></a>
<a class="sourceLine" id="cb29-5" title="5"><span class="st">mac list _x</span></a>
<a class="sourceLine" id="cb29-6" title="6"><span class="st">_x: &quot;A&quot;</span></a></code></pre></div>
<p>On reviendra plus bas sur cette question avec les macros élargies pour générer, par exemple, des légendes automatiquement</p>
<ul>
<li><strong>La commande magique LEVELSOF</strong>
<ul>
<li>Transforme les valeurs d’une variable en expression macro</li>
<li>Syntaxe: <strong><code>levelsof nom_var [if/in], local(nom_macro)</code></strong></li>
</ul></li>
</ul>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">levelsof foreign, <span class="kw">local</span>(f)</a>
<a class="sourceLine" id="cb30-2" title="2">di <span class="st">&quot;`f&#39;&quot;</span></a>
<a class="sourceLine" id="cb30-3" title="3"></a>
<a class="sourceLine" id="cb30-4" title="4"><span class="dv">0</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb30-5" title="5"></a>
<a class="sourceLine" id="cb30-6" title="6">levelsof rep78, <span class="kw">local</span>(r)</a>
<a class="sourceLine" id="cb30-7" title="7">di <span class="st">&quot;`r&#39;&quot;</span> </a>
<a class="sourceLine" id="cb30-8" title="8"></a>
<a class="sourceLine" id="cb30-9" title="9"><span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span></a></code></pre></div>
<ul>
<li><strong>Fonctions associées au macro</strong>:
<ul>
<li>On peut associer des fonctions aux macros, certaines sont utiles pour les graphiques (<code>help macro</code> - <a href="https://www.stata.com/manuals/pmacro.pdf" class="uri">https://www.stata.com/manuals/pmacro.pdf</a>)</li>
<li>Exemple: <strong><code>word count()</code></strong>, <strong><code>labn</code></strong>, <strong><code>lab</code></strong></li>
</ul></li>
</ul>
<p><em>word count()</em><br />
On compte le nombre d’objets contenus dans une macro (séparé par un espace). Utile pour compter le nombre de boucles a effectuer avec <code>forvalue</code></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">levelsof rep78, <span class="kw">local</span>(r)</a>
<a class="sourceLine" id="cb31-2" title="2">local n<span class="op">:</span><span class="st"> </span>word <span class="kw">count</span>(<span class="st">`</span><span class="dt">r&#39;)</span></a>
<a class="sourceLine" id="cb31-3" title="3"><span class="dt">di </span><span class="st">`</span>n<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb31-4" title="4"></a>
<a class="sourceLine" id="cb31-5" title="5"><span class="st">5</span></a></code></pre></div>
<p><em>value label nom_variable</em> Récupère le nom d’un label</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">local varname foreign</a>
<a class="sourceLine" id="cb32-2" title="2">local labn<span class="op">:</span><span class="st"> </span>value label <span class="st">`</span><span class="dt">varname&#39;</span></a>
<a class="sourceLine" id="cb32-3" title="3"><span class="dt">di &quot;</span><span class="st">`</span>labn<span class="st">&#39;&quot;</span></a>
<a class="sourceLine" id="cb32-4" title="4"></a>
<a class="sourceLine" id="cb32-5" title="5"><span class="st">origin</span></a></code></pre></div>
<p><em>label nom_label valeur</em> Récupère le nom de la modalité associé à une valeur d’un nom de label</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">local lab0<span class="op">:</span><span class="st"> </span>label origin  <span class="dv">0</span></a>
<a class="sourceLine" id="cb33-2" title="2">local lab1<span class="op">:</span><span class="st"> </span>label origin  <span class="dv">1</span></a>
<a class="sourceLine" id="cb33-3" title="3"></a>
<a class="sourceLine" id="cb33-4" title="4">di <span class="st">&quot;`lab0&#39;&quot;</span></a>
<a class="sourceLine" id="cb33-5" title="5">Domestic</a>
<a class="sourceLine" id="cb33-6" title="6">di <span class="st">&quot;`lab1&#39;&quot;</span></a>
<a class="sourceLine" id="cb33-7" title="7">Foreign</a></code></pre></div>
<p><strong>Exemple dans une boucle</strong></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">gen rep=<span class="st"> </span>rep78<span class="op">&lt;</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb34-2" title="2">label define rep <span class="dv">0</span> <span class="st">&quot;rep&lt;4&quot;</span> <span class="dv">1</span> <span class="st">&quot;rep&gt;=4&quot;</span>, modify</a>
<a class="sourceLine" id="cb34-3" title="3">label value rep rep</a>
<a class="sourceLine" id="cb34-4" title="4"></a>
<a class="sourceLine" id="cb34-5" title="5">local varname rep</a>
<a class="sourceLine" id="cb34-6" title="6">local labn<span class="op">:</span><span class="st"> </span>value label <span class="st">`</span><span class="dt">varname&#39;</span></a>
<a class="sourceLine" id="cb34-7" title="7"><span class="dt">levelsof </span><span class="st">`</span>varname<span class="st">&#39;, local(l)</span></a>
<a class="sourceLine" id="cb34-8" title="8"><span class="st">foreach l2 of local l {</span></a>
<a class="sourceLine" id="cb34-9" title="9"><span class="st">local lab`l2&#39;</span><span class="op">:</span><span class="st"> </span>label <span class="st">`</span><span class="dt">labn&#39;  </span><span class="st">`</span>l2<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb34-10" title="10"><span class="st">}</span></a>
<a class="sourceLine" id="cb34-11" title="11"></a>
<a class="sourceLine" id="cb34-12" title="12"><span class="st">tw scatter price mpg if `varname&#39;</span><span class="op">==</span><span class="dv">0</span>, <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb34-13" title="13"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> <span class="st">`</span><span class="dt">varname&#39;==1, mc(%70) mlc(black) mlw(vthin) ///</span></a>
<a class="sourceLine" id="cb34-14" title="14"><span class="dt">, legend(order(1 &quot;</span><span class="st">`</span>lab0<span class="st">&#39;&quot; 2 &quot;`lab1&#39;&quot;))</span></a></code></pre></div>
<p><em>Graphique 26</em><br />
<img src="imgf/g18.png" style="width:75.0%" /></p>
<p>En changeant <strong><code>local varname rep</code></strong> par <strong><code>local varname foreign</code></strong></p>
<p><em>Graphique 27</em><br />
<img src="imgf/g19.png" style="width:75.0%" /></p>
<ul>
<li><strong>Mofication du format d’une valeur numérique (changement du nombre de décimale)</strong>
<ul>
<li>On peut utiliser les objets types <strong><code>r()</code></strong> ou <strong><code>e()</code></strong> dans un graphique (voir plus bas)</li>
<li>Certaines valeurs en mémoire comporte un nombre élévé de decimales</li>
<li>On peut modifier le format d’affichage de ces valeurs avec une macro: **<code>di format valeur**</code></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">local dec2<span class="op">:</span><span class="st"> </span>di %<span class="fl">6.2</span>f <span class="fl">10.64654654654</span></a>
<a class="sourceLine" id="cb35-2" title="2">di <span class="st">`</span><span class="dt">dec2&#39;</span></a>
<a class="sourceLine" id="cb35-3" title="3"></a>
<a class="sourceLine" id="cb35-4" title="4"><span class="dt">10.65</span></a></code></pre></div>
<ul>
<li><strong>Expression numérique calculée dans une macro</strong>: <strong><code>local nom_macro = expression</code></strong></li>
</ul>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">local a=<span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb36-2" title="2">di <span class="st">`</span><span class="dt">a&#39;</span></a>
<a class="sourceLine" id="cb36-3" title="3"><span class="dt">2</span></a>
<a class="sourceLine" id="cb36-4" title="4"></a>
<a class="sourceLine" id="cb36-5" title="5"></a>
<a class="sourceLine" id="cb36-6" title="6"><span class="dt">local b= </span><span class="st">`</span>a<span class="st">&#39;^2</span></a>
<a class="sourceLine" id="cb36-7" title="7"><span class="st">di `b&#39;</span>  </a>
<a class="sourceLine" id="cb36-8" title="8"><span class="dv">4</span></a></code></pre></div>
</div>
<div id="objets-type-return-et-ereturn" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Objets type return et ereturn</h3>
<p>Après l’exécution d’une commande, un certains nombre d’objets sont conservé en mémoire jusqu’à l’exécution de la commande suivante</p>
<ul>
<li><strong>objet return</strong> [result] : <strong><code>r()</code></strong>
<ul>
<li>Affichage liste: <strong><code>return list</code></strong></li>
</ul></li>
<li><strong>objet ereturn</strong> [estimation]: <strong><code>e()</code></strong>
<ul>
<li>Affichage liste: <strong><code>ereturn list</code></strong></li>
</ul></li>
<li><strong>Autres</strong>
<ul>
<li>Matrices: <strong><code>matrix list</code></strong></li>
</ul></li>
</ul>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1">sum price, d</a>
<a class="sourceLine" id="cb37-2" title="2">                            Price</a>
<a class="sourceLine" id="cb37-3" title="3"><span class="op">-------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb37-4" title="4"><span class="st">      </span>Percentiles      Smallest</a>
<a class="sourceLine" id="cb37-5" title="5"> <span class="dv">1</span>%         <span class="dv">3291</span>           <span class="dv">3291</span></a>
<a class="sourceLine" id="cb37-6" title="6"> <span class="dv">5</span>%         <span class="dv">3748</span>           <span class="dv">3299</span></a>
<a class="sourceLine" id="cb37-7" title="7"><span class="dv">10</span>%         <span class="dv">3895</span>           <span class="dv">3667</span>       Obs                  <span class="dv">74</span></a>
<a class="sourceLine" id="cb37-8" title="8"><span class="dv">25</span>%         <span class="dv">4195</span>           <span class="dv">3748</span>       Sum of Wgt.          <span class="dv">74</span></a>
<a class="sourceLine" id="cb37-9" title="9"></a>
<a class="sourceLine" id="cb37-10" title="10"><span class="dv">50</span>%       <span class="fl">5006.5</span>                      Mean           <span class="fl">6165.257</span></a>
<a class="sourceLine" id="cb37-11" title="11">                        Largest       Std. Dev.      <span class="fl">2949.496</span></a>
<a class="sourceLine" id="cb37-12" title="12"><span class="dv">75</span>%         <span class="dv">6342</span>          <span class="dv">13466</span></a>
<a class="sourceLine" id="cb37-13" title="13"><span class="dv">90</span>%        <span class="dv">11385</span>          <span class="dv">13594</span>       Variance        <span class="dv">8699526</span></a>
<a class="sourceLine" id="cb37-14" title="14"><span class="dv">95</span>%        <span class="dv">13466</span>          <span class="dv">14500</span>       Skewness       <span class="fl">1.653434</span></a>
<a class="sourceLine" id="cb37-15" title="15"><span class="dv">99</span>%        <span class="dv">15906</span>          <span class="dv">15906</span>       Kurtosis       <span class="fl">4.819188</span></a>
<a class="sourceLine" id="cb37-16" title="16"></a>
<a class="sourceLine" id="cb37-17" title="17">return list</a>
<a class="sourceLine" id="cb37-18" title="18">scalars<span class="op">:</span></a>
<a class="sourceLine" id="cb37-19" title="19"><span class="st">                  </span><span class="kw">r</span>(N) =<span class="st">  </span><span class="dv">74</span></a>
<a class="sourceLine" id="cb37-20" title="20">              <span class="kw">r</span>(sum_w) =<span class="st">  </span><span class="dv">74</span></a>
<a class="sourceLine" id="cb37-21" title="21">               <span class="kw">r</span>(mean) =<span class="st">  </span><span class="fl">6165.256756756757</span></a>
<a class="sourceLine" id="cb37-22" title="22">                <span class="kw">r</span>(Var) =<span class="st">  </span><span class="fl">8699525.97426879</span></a>
<a class="sourceLine" id="cb37-23" title="23">                 <span class="kw">r</span>(sd) =<span class="st">  </span><span class="fl">2949.495884768919</span></a>
<a class="sourceLine" id="cb37-24" title="24">           <span class="kw">r</span>(skewness) =<span class="st">  </span><span class="fl">1.653433511704859</span></a>
<a class="sourceLine" id="cb37-25" title="25">           <span class="kw">r</span>(kurtosis) =<span class="st">  </span><span class="fl">4.819187528464004</span></a>
<a class="sourceLine" id="cb37-26" title="26">                <span class="kw">r</span>(sum) =<span class="st">  </span><span class="dv">456229</span></a>
<a class="sourceLine" id="cb37-27" title="27">                <span class="kw">r</span>(min) =<span class="st">  </span><span class="dv">3291</span></a>
<a class="sourceLine" id="cb37-28" title="28">                <span class="kw">r</span>(max) =<span class="st">  </span><span class="dv">15906</span></a>
<a class="sourceLine" id="cb37-29" title="29">                 <span class="kw">r</span>(p1) =<span class="st">  </span><span class="dv">3291</span></a>
<a class="sourceLine" id="cb37-30" title="30">                 <span class="kw">r</span>(p5) =<span class="st">  </span><span class="dv">3748</span></a>
<a class="sourceLine" id="cb37-31" title="31">                <span class="kw">r</span>(p10) =<span class="st">  </span><span class="dv">3895</span></a>
<a class="sourceLine" id="cb37-32" title="32">                <span class="kw">r</span>(p25) =<span class="st">  </span><span class="dv">4195</span></a>
<a class="sourceLine" id="cb37-33" title="33">                <span class="kw">r</span>(p50) =<span class="st">  </span><span class="fl">5006.5</span></a>
<a class="sourceLine" id="cb37-34" title="34">                <span class="kw">r</span>(p75) =<span class="st">  </span><span class="dv">6342</span></a>
<a class="sourceLine" id="cb37-35" title="35">                <span class="kw">r</span>(p90) =<span class="st">  </span><span class="dv">11385</span></a>
<a class="sourceLine" id="cb37-36" title="36">                <span class="kw">r</span>(p95) =<span class="st">  </span><span class="dv">13466</span></a>
<a class="sourceLine" id="cb37-37" title="37">                <span class="kw">r</span>(p99) =<span class="st">  </span><span class="dv">15906</span></a></code></pre></div>
<ul>
<li>Ces résultats peuvent être utilisés, tels quels, lors de l’exécution de la commande suivante</li>
<li>Ces résultats peuvent être conservé en mémoire dans une macro, et être utilisés tout du long du programme</li>
</ul>
<p>Exemple</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1">local varlist price mpg</a>
<a class="sourceLine" id="cb38-2" title="2">foreach v of loc varlist {</a>
<a class="sourceLine" id="cb38-3" title="3">qui sum <span class="st">`</span><span class="dt">v&#39;</span></a>
<a class="sourceLine" id="cb38-4" title="4"><span class="dt">local m</span><span class="st">`</span>v<span class="st">&#39; : di %6.2f `r(mean)&#39;</span></a>
<a class="sourceLine" id="cb38-5" title="5">di <span class="st">&quot;Moyenne `v&#39;= `m`v&#39;&#39;&quot;</span></a>
<a class="sourceLine" id="cb38-6" title="6">}</a></code></pre></div>
<ul>
<li>Niveau graphique:
<ul>
<li>Permet d’afficher des valeurs dans le graphique</li>
<li>Permet de générer automatiquement des éléments de type <strong><code>xline</code></strong> <strong><code>yline</code></strong></li>
<li>Permet de généré des graphiques de type <strong>scatteri</strong> ou <strong>pci</strong> [on entre directement les coordonnées des axes et non des variables]</li>
</ul></li>
</ul>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" title="1">xtile qprice =<span class="st"> </span>price, <span class="kw">n</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb39-2" title="2"></a>
<a class="sourceLine" id="cb39-3" title="3">local varlist price mpg</a>
<a class="sourceLine" id="cb39-4" title="4">foreach v of loc varlist {</a>
<a class="sourceLine" id="cb39-5" title="5">qui sum <span class="st">`</span><span class="dt">v&#39;</span></a>
<a class="sourceLine" id="cb39-6" title="6"><span class="dt">local  m</span><span class="st">`</span>v<span class="st">&#39; : di %6.2f `r(mean)&#39;</span></a>
<a class="sourceLine" id="cb39-7" title="7">}</a>
<a class="sourceLine" id="cb39-8" title="8"></a>
<a class="sourceLine" id="cb39-9" title="9">tw scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb39-10" title="10"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb39-11" title="11"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb39-12" title="12"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb39-13" title="13"><span class="kw">yline</span>(<span class="st">`</span><span class="dt">mprice&#39;, lw(vthin) lc(black)) xline(</span><span class="st">`</span>mmpg<span class="st">&#39;, lw(vthin) lc(black))      msiz(large) ///</span></a>
<a class="sourceLine" id="cb39-14" title="14"><span class="st">note(&quot;Moyenne Price = `mprice&#39;&quot; ///</span></a>
<a class="sourceLine" id="cb39-15" title="15"><span class="st">     &quot;</span>Moyenne <span class="dt">Mpg   =</span> <span class="st">`</span><span class="dt">mmpg&#39;&quot;  ) legend(off)</span></a></code></pre></div>
<p><em>Graphique 28</em><br />
<img src="imgf/g20.png" style="width:75.0%" /></p>
</div>
<div id="autres-1" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Autres</h3>
<p><strong>Token</strong></p>
<ul>
<li>Plutôt utilisé dans la programmation de routines (.ado) mais peut s’avérer utile pour transformer les variables du graphique en macro.</li>
<li><strong>Token</strong> est une macro qui prend comme noms une suite de nombre (un numéro)</li>
<li>On transforme une expression en token avec la commande <strong><code>tokenize</code></strong></li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1">tokenize price mpg</a>
<a class="sourceLine" id="cb40-2" title="2">sum <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb40-3" title="3"></a>
<a class="sourceLine" id="cb40-4" title="4"><span class="st">    Variable |        Obs        Mean    Std. Dev.       Min        Max</span></a>
<a class="sourceLine" id="cb40-5" title="5"><span class="st">-------------+---------------------------------------------------------</span></a>
<a class="sourceLine" id="cb40-6" title="6"><span class="st">       price |         74    6165.257    2949.496       3291      15906</span></a>
<a class="sourceLine" id="cb40-7" title="7"><span class="st">         mpg |         74     21.2973    5.785503         12         41</span></a></code></pre></div>
<p>Ou avec une expression sous forme de macro</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" title="1">local varlist price mpg</a>
<a class="sourceLine" id="cb41-2" title="2">tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></a>
<a class="sourceLine" id="cb41-3" title="3"><span class="dt">sum </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span></a>
<a class="sourceLine" id="cb41-4" title="4"></a>
<a class="sourceLine" id="cb41-5" title="5">    Variable <span class="op">|</span><span class="st">        </span>Obs        Mean    Std. Dev.       Min        Max</a>
<a class="sourceLine" id="cb41-6" title="6"><span class="op">-------------+---------------------------------------------------------</span></a>
<a class="sourceLine" id="cb41-7" title="7"><span class="st">       </span>price <span class="op">|</span><span class="st">         </span><span class="dv">74</span>    <span class="fl">6165.257</span>    <span class="fl">2949.496</span>       <span class="dv">3291</span>      <span class="dv">15906</span></a>
<a class="sourceLine" id="cb41-8" title="8">         mpg <span class="op">|</span><span class="st">         </span><span class="dv">74</span>     <span class="fl">21.2973</span>    <span class="fl">5.785503</span>         <span class="dv">12</span>         <span class="dv">41</span></a></code></pre></div>
<p><strong>Application pour un graphique</strong></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1">local varlist price mpg foreign </a>
<a class="sourceLine" id="cb42-2" title="2">tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></a>
<a class="sourceLine" id="cb42-3" title="3"><span class="dt">tw scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==0 ||</span></a>
<a class="sourceLine" id="cb42-4" title="4"><span class="dt">tw scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==1 </span></a></code></pre></div>
<p><strong>Compteur i++</strong></p>
<ul>
<li>Utile dans les boucles <code>foreach</code> pour générer un compteur type macro qui fonctionne comme dans une boucle <code>forvalue</code></li>
<li>Dans une boucle de type <code>forvalue</code> permet de générer un compteur dont les valeurs de départ et d’arrivée diffèrent des valeurs de la boucle<br />
</li>
<li>On initialise sa valeur initiale par une macro: <strong><code>local i=valeur</code></strong></li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" title="1">local i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb43-2" title="2">forvalue v=<span class="dv">10</span><span class="op">/</span><span class="dv">15</span> {</a>
<a class="sourceLine" id="cb43-3" title="3">di <span class="st">`</span><span class="dt">i++&#39;</span></a>
<a class="sourceLine" id="cb43-4" title="4"><span class="dt">}</span></a>
<a class="sourceLine" id="cb43-5" title="5"><span class="dt">1</span></a>
<a class="sourceLine" id="cb43-6" title="6"><span class="dt">2</span></a>
<a class="sourceLine" id="cb43-7" title="7"><span class="dt">3</span></a>
<a class="sourceLine" id="cb43-8" title="8"><span class="dt">4</span></a>
<a class="sourceLine" id="cb43-9" title="9"><span class="dt">5</span></a>
<a class="sourceLine" id="cb43-10" title="10"><span class="dt">6</span></a></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1">local i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb44-2" title="2">local varlist price mpg turn length</a>
<a class="sourceLine" id="cb44-3" title="3">foreach v of local varlist {</a>
<a class="sourceLine" id="cb44-4" title="4">di <span class="st">&quot;var`i++&#39; = `v&#39;&quot;</span></a>
<a class="sourceLine" id="cb44-5" title="5">}</a>
<a class="sourceLine" id="cb44-6" title="6">var1 =<span class="st"> </span>price</a>
<a class="sourceLine" id="cb44-7" title="7">var2 =<span class="st"> </span>mpg</a>
<a class="sourceLine" id="cb44-8" title="8">var3 =<span class="st"> </span>turn</a>
<a class="sourceLine" id="cb44-9" title="9">var4 =<span class="st"> </span>length</a></code></pre></div>
<p>Application au graphique précédent: Le nom des macros qui enregistre les valeur des moyennes de price et rpg s’appelent maintenant <strong>m1</strong> et <strong>m2</strong></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" title="1">local i=<span class="dv">1</span></a>
<a class="sourceLine" id="cb45-2" title="2">local varlist price mpg</a>
<a class="sourceLine" id="cb45-3" title="3">foreach v of loc varlist {</a>
<a class="sourceLine" id="cb45-4" title="4">qui sum <span class="st">`</span><span class="dt">v&#39;</span></a>
<a class="sourceLine" id="cb45-5" title="5"><span class="dt">local  m</span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39; : di %6.2f `r(mean)&#39;</span></a>
<a class="sourceLine" id="cb45-6" title="6">}</a>
<a class="sourceLine" id="cb45-7" title="7"></a>
<a class="sourceLine" id="cb45-8" title="8">tw scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb45-9" title="9"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb45-10" title="10"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb45-11" title="11"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> qprice<span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb45-12" title="12"><span class="kw">yline</span>(<span class="st">`</span><span class="dt">m1&#39;, lw(vthin) lc(black)) xline(</span><span class="st">`</span>m2<span class="st">&#39;, lw(vthin) lc(black))               ///</span></a>
<a class="sourceLine" id="cb45-13" title="13"><span class="st">note(&quot;Moyenne Price = `m1&#39;&quot; ///</span></a>
<a class="sourceLine" id="cb45-14" title="14"><span class="st">     &quot;</span>Moyenne <span class="dt">Mpg   =</span> <span class="st">`</span><span class="dt">m2&#39;&quot;  ) legend(off)</span></a></code></pre></div>
<p>On peut maintenant, avec les <strong>tokens</strong> créer un graphique qui n’appelle qu’un fois les variables du graphique. On peut donc changer les variables en ne modifiant qu’une ligne</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1">local i=<span class="dv">1</span></a>
<a class="sourceLine" id="cb46-2" title="2">local varlist price mpg qprice</a>
<a class="sourceLine" id="cb46-3" title="3">tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></a>
<a class="sourceLine" id="cb46-4" title="4"><span class="dt">xtile q</span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; = `1&#39;</span>, <span class="kw">n</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb46-5" title="5"></a>
<a class="sourceLine" id="cb46-6" title="6">foreach v of loc varlist {</a>
<a class="sourceLine" id="cb46-7" title="7">qui sum <span class="st">`</span><span class="dt">v&#39;</span></a>
<a class="sourceLine" id="cb46-8" title="8"><span class="dt">local  m</span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39; : di %6.2f `r(mean)&#39;</span></a>
<a class="sourceLine" id="cb46-9" title="9">}</a>
<a class="sourceLine" id="cb46-10" title="10"></a>
<a class="sourceLine" id="cb46-11" title="11">tw scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb46-12" title="12"><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb46-13" title="13"><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb46-14" title="14"><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb46-15" title="15"><span class="kw">yline</span>(<span class="st">`</span><span class="dt">m1&#39;, lw(vthin) lc(black)) xline(</span><span class="st">`</span>m2<span class="st">&#39;, lw(vthin) lc(black))           ///</span></a>
<a class="sourceLine" id="cb46-16" title="16"><span class="st">note(&quot;Moyenne `1&#39;</span> =<span class="st"> `</span><span class="dt">m1&#39;&quot; ///</span></a>
<a class="sourceLine" id="cb46-17" title="17"><span class="dt">     &quot;Moyenne </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; = `m2&#39;&quot;  ) legend(off)</span></a></code></pre></div>
<p>Avec la variable <em>displacement</em> au lieu de <em>price</em>:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" title="1">local i=<span class="dv">1</span></a>
<a class="sourceLine" id="cb47-2" title="2">local varlist displacement mpg qdisplacement</a>
<a class="sourceLine" id="cb47-3" title="3">tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></a>
<a class="sourceLine" id="cb47-4" title="4"><span class="dt">xtile q</span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; = `1&#39;</span>, <span class="kw">n</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb47-5" title="5"></a>
<a class="sourceLine" id="cb47-6" title="6">foreach v of loc varlist {</a>
<a class="sourceLine" id="cb47-7" title="7">qui sum <span class="st">`</span><span class="dt">v&#39;</span></a>
<a class="sourceLine" id="cb47-8" title="8"><span class="dt">local  m</span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39; : di %6.2f `r(mean)&#39;</span></a>
<a class="sourceLine" id="cb47-9" title="9">}</a>
<a class="sourceLine" id="cb47-10" title="10"></a>
<a class="sourceLine" id="cb47-11" title="11">tw scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb47-12" title="12"><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb47-13" title="13"><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb47-14" title="14"><span class="er">||</span><span class="st"> </span>scatter <span class="st">`</span><span class="dt">1&#39; </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; if `3&#39;</span><span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb47-15" title="15"><span class="kw">yline</span>(<span class="st">`</span><span class="dt">m1&#39;, lw(vthin) lc(black)) xline(</span><span class="st">`</span>m2<span class="st">&#39;, lw(vthin) lc(black))           ///</span></a>
<a class="sourceLine" id="cb47-16" title="16"><span class="st">note(&quot;Moyenne `1&#39;</span> =<span class="st"> `</span><span class="dt">m1&#39;&quot; ///</span></a>
<a class="sourceLine" id="cb47-17" title="17"><span class="dt">     &quot;Moyenne </span><span class="st">`</span><span class="dv">2</span><span class="st">&#39; = `m2&#39;&quot;  ) legend(off)</span></a></code></pre></div>
<p><em>Graphique 29</em><br />
<img src="imgf/g21.png" style="width:75.0%" /></p>
<p><em>Spoil alert</em>: il ne reste plus qu’à se débarasser de la répétition des options dans le graphique [section suivante]</p>
<p>** Pour info: autres compteurs</p>
<ul>
<li><strong><code>++i</code></strong></li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" title="1">local i=<span class="dv">1</span></a>
<a class="sourceLine" id="cb48-2" title="2">  forvalue j=<span class="dv">1</span><span class="op">/</span><span class="dv">5</span> {</a>
<a class="sourceLine" id="cb48-3" title="3">   di <span class="st">`</span><span class="dt">++i&#39;</span></a>
<a class="sourceLine" id="cb48-4" title="4"><span class="dt">   }</span></a>
<a class="sourceLine" id="cb48-5" title="5"><span class="dt">* Renvoi la liste: 2 3 4 5 6</span></a></code></pre></div>
<p>Remarque: pour retrouver les valeurs du compteur <code>i++</code>, il suffit s’initialiser <code>i</code> à 0</p>
<ul>
<li><strong><code>i--</code></strong></li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">local i=<span class="dv">10</span></a>
<a class="sourceLine" id="cb49-2" title="2">forvalue j=<span class="dv">1</span><span class="op">/</span><span class="dv">5</span> {</a>
<a class="sourceLine" id="cb49-3" title="3">   di <span class="st">`</span><span class="dt">i--&#39;</span></a>
<a class="sourceLine" id="cb49-4" title="4"><span class="dt">   }</span></a>
<a class="sourceLine" id="cb49-5" title="5"><span class="dt">* renvoi la liste: 10 9 8 7 6</span></a></code></pre></div>
<ul>
<li><strong><code>--i</code></strong></li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">local i=<span class="dv">10</span></a>
<a class="sourceLine" id="cb50-2" title="2">forvalue j=<span class="dv">1</span><span class="op">/</span><span class="dv">5</span> {</a>
<a class="sourceLine" id="cb50-3" title="3">   di <span class="st">`</span><span class="dt">--i&#39;</span></a>
<a class="sourceLine" id="cb50-4" title="4"><span class="dt">   }</span></a>
<a class="sourceLine" id="cb50-5" title="5"><span class="dt">* renvoi la liste: 9 8 7 6 5</span></a></code></pre></div>
<p><strong>Objet temporaire: tempvar, tempfile, tempname….</strong></p>
<ul>
<li><strong>tempvar</strong>: très utile.
<ul>
<li>Evite de créer des variables qui entre en conflit avec des variables existantes dans la base</li>
<li>La variable temporaire est conservée en mémoire, mais n’apparait pas dans la base.</li>
<li>Une nouvelle variable est créée lorsque le programme est exécuté à nouveau</li>
<li>syntaxe: <strong><code>tempvar nom_variable</code></strong></li>
<li>Lecture: Stata va créer une variable dont le nom est **_0000#**</li>
<li>Appel de la variable dans le programme: <strong><code>nom_variable</code></strong></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">tempvar qprice</a>
<a class="sourceLine" id="cb51-2" title="2">local varlist price mpg <span class="st">`</span><span class="dt">qprice&#39;</span></a>
<a class="sourceLine" id="cb51-3" title="3"><span class="dt">tokenize </span><span class="st">`</span>varlist<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb51-4" title="4"><span class="st">xtile `qprice&#39;</span> =<span class="st"> `</span><span class="dt">1&#39;, n(4)</span></a>
<a class="sourceLine" id="cb51-5" title="5"></a>
<a class="sourceLine" id="cb51-6" title="6"><span class="dt">local i=1</span></a>
<a class="sourceLine" id="cb51-7" title="7"><span class="dt">foreach v of loc varlist {</span></a>
<a class="sourceLine" id="cb51-8" title="8"><span class="dt">qui sum </span><span class="st">`</span>v<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb51-9" title="9"><span class="st">local  m`i++&#39;</span> <span class="op">:</span><span class="st"> </span>di %<span class="fl">6.2</span>f <span class="st">`</span><span class="dt">r(mean)&#39;</span></a>
<a class="sourceLine" id="cb51-10" title="10"><span class="dt">}</span></a>
<a class="sourceLine" id="cb51-11" title="11"></a>
<a class="sourceLine" id="cb51-12" title="12"><span class="dt">tw scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==1, mlc(black) mlw(vthin) mc(%70) msiz(medlarge) ///</span></a>
<a class="sourceLine" id="cb51-13" title="13"><span class="dt">|| scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==2, mlc(black) mlw(vthin) mc(%70) msiz(medlarge) ///</span></a>
<a class="sourceLine" id="cb51-14" title="14"><span class="dt">|| scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==3, mlc(black) mlw(vthin) mc(%70) msiz(medlarge) ///</span></a>
<a class="sourceLine" id="cb51-15" title="15"><span class="dt">|| scatter </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; `2&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">3&#39;==4, mlc(black) mlw(vthin) mc(%70) msiz(medlarge) ///</span></a>
<a class="sourceLine" id="cb51-16" title="16"><span class="dt">yline(</span><span class="st">`</span>m1<span class="st">&#39;, lw(vthin) lc(black)) xline(`m2&#39;</span>, <span class="kw">lw</span>(vthin) <span class="kw">lc</span>(black)<span class="er">)</span>           <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb51-17" title="17"><span class="kw">note</span>(<span class="st">&quot;Moyenne `1&#39; = `m1&#39;&quot;</span> <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb51-18" title="18"><span class="st">     &quot;Moyenne `2&#39; = `m2&#39;&quot;</span>  ) <span class="kw">legend</span>(off)</a>
<a class="sourceLine" id="cb51-19" title="19">describe</a>
<a class="sourceLine" id="cb51-20" title="20"></a>
<a class="sourceLine" id="cb51-21" title="21">                                              (_dta has notes)</a>
<a class="sourceLine" id="cb51-22" title="22"><span class="op">-----------------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb51-23" title="23"><span class="st">              </span>storage   display    value</a>
<a class="sourceLine" id="cb51-24" title="24">variable name   type    format     label      variable label</a>
<a class="sourceLine" id="cb51-25" title="25"><span class="op">-----------------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb51-26" title="26">make            str18   %<span class="op">-</span>18s                 Make and Model</a>
<a class="sourceLine" id="cb51-27" title="27">price           int     %<span class="fl">8.0</span>gc                Price</a>
<a class="sourceLine" id="cb51-28" title="28">mpg             int     %<span class="fl">8.0</span>g                 <span class="kw">Mileage</span> (mpg)</a>
<a class="sourceLine" id="cb51-29" title="29">rep78           int     %<span class="fl">8.0</span>g                 Repair Record <span class="dv">1978</span></a>
<a class="sourceLine" id="cb51-30" title="30">headroom        float   %<span class="fl">6.1</span>f                 <span class="kw">Headroom</span> (in.)</a>
<a class="sourceLine" id="cb51-31" title="31">trunk           int     %<span class="fl">8.0</span>g                 Trunk <span class="kw">space</span> (cu. ft.)</a>
<a class="sourceLine" id="cb51-32" title="32">weight          int     %<span class="fl">8.0</span>gc                <span class="kw">Weight</span> (lbs.)</a>
<a class="sourceLine" id="cb51-33" title="33">length          int     %<span class="fl">8.0</span>g                 <span class="kw">Length</span> (in.)</a>
<a class="sourceLine" id="cb51-34" title="34">turn            int     %<span class="fl">8.0</span>g                 Turn <span class="kw">Circle</span> (ft.)</a>
<a class="sourceLine" id="cb51-35" title="35">displacement    int     %<span class="fl">8.0</span>g                 <span class="kw">Displacement</span> (cu. in.)</a>
<a class="sourceLine" id="cb51-36" title="36">gear_ratio      float   %<span class="fl">6.2</span>f                 Gear Ratio</a>
<a class="sourceLine" id="cb51-37" title="37">foreign         byte    %<span class="fl">8.0</span>g      origin     Car type</a>
<a class="sourceLine" id="cb51-38" title="38">__<span class="dv">000000</span>        byte    %<span class="fl">8.0</span>g                 <span class="dv">4</span> quantiles of price</a>
<a class="sourceLine" id="cb51-39" title="39"><span class="op">-----------------------------------------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb51-40" title="40"></a>
<a class="sourceLine" id="cb51-41" title="41">sum __<span class="dv">000000</span></a>
<a class="sourceLine" id="cb51-42" title="42">variable __<span class="dv">000000</span> not found</a></code></pre></div>
<p><img src="imgf/g21_b.PNG" /></p>
<ul>
<li><strong>tempfile</strong>: utile seulement si une base doit être générée, pas d’application trouvée pour le document</li>
</ul>
</div>
</div>
<div id="alleger-la-syntaxe-dun-graphique" class="section level2">
<h2><span class="header-section-number">3.2</span> Alleger la syntaxe d’un graphique…</h2>
<p>… et surtout faciliter les changements d’options</p>
<p>Mêmes options pour les 4 éléments du graphique</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">tw scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge)  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb52-2" title="2"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge)  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb52-3" title="3"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">3</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge)  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb52-4" title="4"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge)  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb52-5" title="5"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">5</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">mc</span>(%<span class="dv">70</span>) <span class="kw">msiz</span>(medlarge),</a>
<a class="sourceLine" id="cb52-6" title="6"><span class="kw">legend</span>(off)   </a></code></pre></div>
<p><em>Graphique 30</em><br />
<img src="imgf/g22.png" style="width:75.0%" /></p>
<p>Avec les options sous forme de macro</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1">local ops <span class="st">&quot;mlc(black) mlw(vthin) mc(%70) msiz(medlarge)&quot;</span></a>
<a class="sourceLine" id="cb53-2" title="2"></a>
<a class="sourceLine" id="cb53-3" title="3">tw scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span>, <span class="st">`</span><span class="dt">ops&#39; ///</span></a>
<a class="sourceLine" id="cb53-4" title="4"><span class="dt">|| scatter price mpg if rep78==2, </span><span class="st">`</span>ops<span class="st">&#39; ///</span></a>
<a class="sourceLine" id="cb53-5" title="5"><span class="st">|| scatter price mpg if rep78==3, `ops&#39;</span> <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb53-6" title="6"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span>, <span class="st">`</span><span class="dt">ops&#39; ///</span></a>
<a class="sourceLine" id="cb53-7" title="7"><span class="dt">|| scatter price mpg if rep78==5, </span><span class="st">`</span>ops<span class="st">&#39; ///</span></a>
<a class="sourceLine" id="cb53-8" title="8"><span class="st">legend(off)</span></a></code></pre></div>
<p>Si on réduit l’opacicité à 60% et qu’on perturbe légèrement les coordonnées <strong><code>jitter(2)</code></strong></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1">local ops <span class="st">&quot;mlc(black) mlw(vthin) mc(%60) msiz(medlarge) jitter(2)&quot;</span></a>
<a class="sourceLine" id="cb54-2" title="2"></a>
<a class="sourceLine" id="cb54-3" title="3">tw scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span>, <span class="st">`</span><span class="dt">ops&#39; ///</span></a>
<a class="sourceLine" id="cb54-4" title="4"><span class="dt">|| scatter price mpg if rep78==2, </span><span class="st">`</span>ops<span class="st">&#39; ///</span></a>
<a class="sourceLine" id="cb54-5" title="5"><span class="st">|| scatter price mpg if rep78==3, `ops&#39;</span> <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb54-6" title="6"><span class="er">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span>, <span class="st">`</span><span class="dt">ops&#39; ///</span></a>
<a class="sourceLine" id="cb54-7" title="7"><span class="dt">|| scatter price mpg if rep78==5, </span><span class="st">`</span>ops<span class="st">&#39;  </span></a></code></pre></div>
<p><em>Graphique 31</em><br />
<img src="imgf/g23.png" style="width:75.0%" /></p>
</div>
<div id="macro-élargie" class="section level2">
<h2><span class="header-section-number">3.3</span> Macro élargie</h2>
<div id="définition-dune-macro-élargie" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Définition d’une macro élargie</h3>
<ul>
<li><strong>Macro simple</strong></li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" title="1">local l objetA objetB objetC </a>
<a class="sourceLine" id="cb55-2" title="2">foreach i of local l {</a>
<a class="sourceLine" id="cb55-3" title="3">local ms <span class="st">`</span><span class="dt">i&#39;</span></a>
<a class="sourceLine" id="cb55-4" title="4"><span class="dt"> }</span></a>
<a class="sourceLine" id="cb55-5" title="5"></a>
<a class="sourceLine" id="cb55-6" title="6"><span class="dt">objetA</span></a>
<a class="sourceLine" id="cb55-7" title="7"><span class="dt">objetB</span></a>
<a class="sourceLine" id="cb55-8" title="8"><span class="dt">objetC</span></a>
<a class="sourceLine" id="cb55-9" title="9"></a>
<a class="sourceLine" id="cb55-10" title="10"><span class="dt">* expression de la macro après l&#39;exécution de la boucle</span></a>
<a class="sourceLine" id="cb55-11" title="11"><span class="dt">di &quot;</span><span class="st">`</span>ms<span class="st">&#39;&quot;</span></a>
<a class="sourceLine" id="cb55-12" title="12"><span class="st">objetC</span></a></code></pre></div>
<ul>
<li><p><strong>Macro élargie</strong></p></li>
<li>Conserve l’expression de la macro de la boucle précédente</li>
<li><p>Syntaxe:</p></li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1">local nom_macro <span class="st">`</span><span class="dt">nom_macro</span><span class="st">`</span> expression_macro</a></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" title="1">local l objetA objetB objetC </a>
<a class="sourceLine" id="cb57-2" title="2">foreach i of local l {</a>
<a class="sourceLine" id="cb57-3" title="3">local ms <span class="st">`</span><span class="dt">ms&#39; </span><span class="st">`</span>i<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb57-4" title="4"><span class="st">di &quot;`ms&#39;&quot;</span></a>
<a class="sourceLine" id="cb57-5" title="5"><span class="st">}</span></a>
<a class="sourceLine" id="cb57-6" title="6"></a>
<a class="sourceLine" id="cb57-7" title="7"><span class="st">objetA</span></a>
<a class="sourceLine" id="cb57-8" title="8"><span class="st">objetA objetB</span></a>
<a class="sourceLine" id="cb57-9" title="9"><span class="st">objetA objetB objetC</span></a>
<a class="sourceLine" id="cb57-10" title="10"></a>
<a class="sourceLine" id="cb57-11" title="11"><span class="st">di &quot;`</span><span class="dt">ms&#39;&quot;</span></a>
<a class="sourceLine" id="cb57-12" title="12"><span class="dt">objetA objetB objetC</span></a></code></pre></div>
<ul>
<li>Boucle 1: (macro boucle 1)</li>
<li>Boucle 2: (macro boucle 1) + (macro boucle 2)</li>
<li>Boucle 3: (macro boucle 1) + (macro boucle 2) + (macro boucle 3)</li>
<li>etc….</li>
</ul>
</div>
<div id="créer-un-graphique-avec-une-macro-élargie" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Créer un graphique avec une macro élargie</h3>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1">levelsof rep78, <span class="kw">local</span>(l)</a>
<a class="sourceLine" id="cb58-2" title="2"></a>
<a class="sourceLine" id="cb58-3" title="3">foreach i of local l {</a>
<a class="sourceLine" id="cb58-4" title="4">  local scat <span class="st">`</span><span class="dt">scat&#39; scatter price mpg if rep78==</span><span class="st">`</span>i<span class="st">&#39; ||</span></a>
<a class="sourceLine" id="cb58-5" title="5"><span class="st">  di &quot;`scat&#39;&quot;</span></a>
<a class="sourceLine" id="cb58-6" title="6"><span class="st">  }</span></a></code></pre></div>
<p>Lecture dans l’output:</p>
<p><strong>Boucle 1: rep78=(1)</strong></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span></a></code></pre></div>
<p><strong>Boucle 2: rep78=(1,2)</strong></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1">scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span> <span class="op">||</span></a></code></pre></div>
<p><strong>Boucle 3: rep78=(1,2,3)</strong></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" title="1">scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">3</span> <span class="op">||</span></a></code></pre></div>
<p><strong>Boucle 4: rep78=(1,2,3,4)</strong></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" title="1">scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">3</span> <span class="op">||</span></a>
<a class="sourceLine" id="cb62-2" title="2">scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span> <span class="op">||</span></a></code></pre></div>
<p><strong>Boucle 5: rep78=(1,2,3,4,5)</strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">1</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">2</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">3</span> <span class="op">||</span><span class="st"> </span></a>
<a class="sourceLine" id="cb63-2" title="2">scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">4</span> <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> rep78<span class="op">==</span><span class="dv">5</span> <span class="op">||</span></a></code></pre></div>
<p>On adonc de générer un graphique dans une boucle. Pour l’exécuter:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1">tw <span class="st">`</span><span class="dt">scat&#39;, legend(off)</span></a></code></pre></div>
</div>
<div id="générer-une-légende-avec-une-macro-élargie" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Générer une légende avec une macro élargie</h3>
<p>Utiliser la bonne expression pour les macros simple car les doubles quotes doivent être apparentes dans la définition de la légende</p>
<p><strong>Application 1 </strong></p>
<ul>
<li>on utilise pas les fonction pour générer les labels (cf Application 2)</li>
<li>On génére également le graphique avec une macro élargie comme ci-dessus. La macro de la définition y est associée</li>
</ul>
<p><strong>On génère la légende avec une macro élargie</strong></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">sysuse auto</a>
<a class="sourceLine" id="cb65-2" title="2"></a>
<a class="sourceLine" id="cb65-3" title="3">local l1 <span class="st">`</span><span class="dt">&quot;&quot;Domestic&quot;&quot;&#39;</span></a>
<a class="sourceLine" id="cb65-4" title="4"><span class="dt">local l2 </span><span class="st">`&quot;&quot;</span>Foreign<span class="st">&quot;&quot;&#39;</span></a>
<a class="sourceLine" id="cb65-5" title="5"><span class="st">forvalue i=1(1)2 {</span></a>
<a class="sourceLine" id="cb65-6" title="6"><span class="st">local ord `ord&#39;</span> <span class="st">`</span><span class="dt">i&#39; </span><span class="st">`</span>l<span class="st">`</span><span class="dt">i&#39;&#39; </span></a>
<a class="sourceLine" id="cb65-7" title="7"><span class="dt">}</span></a>
<a class="sourceLine" id="cb65-8" title="8"></a>
<a class="sourceLine" id="cb65-9" title="9"><span class="dt">macro list _ord</span></a>
<a class="sourceLine" id="cb65-10" title="10"></a>
<a class="sourceLine" id="cb65-11" title="11"><span class="dt">_ord:  1 &quot;Domestic&quot; 2 &quot;Foreign&quot;</span></a></code></pre></div>
<p><strong>On génère les éléments du graphique avec une macro élargie</strong></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1">levelsof foreign, <span class="kw">local</span>(l)</a>
<a class="sourceLine" id="cb66-2" title="2"></a>
<a class="sourceLine" id="cb66-3" title="3">local ops <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin)</a>
<a class="sourceLine" id="cb66-4" title="4">foreach i of local l {</a>
<a class="sourceLine" id="cb66-5" title="5">local scat <span class="st">`</span><span class="dt">scat&#39; scatter price mpg if foreign==</span><span class="st">`</span>i<span class="st">&#39;, `ops&#39;</span> <span class="op">||</span></a>
<a class="sourceLine" id="cb66-6" title="6">}</a>
<a class="sourceLine" id="cb66-7" title="7">macro list _scat</a>
<a class="sourceLine" id="cb66-8" title="8">_scat<span class="op">:</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">0</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="op">||</span><span class="st"> </span>scatter price mpg <span class="cf">if</span> foreign<span class="op">==</span><span class="dv">1</span>, <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="op">||</span></a></code></pre></div>
<p><strong>On génère le graphique avec la légende</strong></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">tw <span class="st">`</span><span class="dt">scat&#39;, legend(order(</span><span class="st">`</span>ord<span class="st">&#39;))</span></a></code></pre></div>
<p><strong>Application 2 </strong></p>
<ul>
<li>Même graphique mais on va automatiser sa création avec:
<ul>
<li>des tokens pour les variables</li>
<li>les fonctions associées aux macros pour récurérer les labels automatiquement (voir plus haut)
<ul>
<li>Fonction <strong><code>value label</code></strong> ^pour récupérer le nom du label</li>
<li>Fonction <strong><code>label</code></strong> dans une boucle pour récupérér les libellés</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1">local varlist price weight foreign</a>
<a class="sourceLine" id="cb68-2" title="2">tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></a>
<a class="sourceLine" id="cb68-3" title="3"></a>
<a class="sourceLine" id="cb68-4" title="4"><span class="dt">* Légende</span></a>
<a class="sourceLine" id="cb68-5" title="5"></a>
<a class="sourceLine" id="cb68-6" title="6"><span class="dt">local labn: value label </span><span class="st">`</span><span class="dv">3</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb68-7" title="7"><span class="st">levelsof `3&#39;</span>, <span class="kw">local</span>(l)</a>
<a class="sourceLine" id="cb68-8" title="8">local i=<span class="dv">1</span></a>
<a class="sourceLine" id="cb68-9" title="9"></a>
<a class="sourceLine" id="cb68-10" title="10">foreach l2 of local l {</a>
<a class="sourceLine" id="cb68-11" title="11">local lab<span class="st">`</span><span class="dt">l2&#39;: label </span><span class="st">`</span>labn<span class="st">&#39;  `l2&#39;</span></a>
<a class="sourceLine" id="cb68-12" title="12">local lab<span class="st">`</span><span class="dt">l2&#39; </span><span class="st">`&quot;&quot;`</span><span class="dt">lab</span><span class="st">`</span>l2<span class="st">&#39;&#39;&quot;&quot;&#39; </span></a>
<a class="sourceLine" id="cb68-13" title="13"><span class="st">local ord `ord&#39;</span> <span class="st">`</span><span class="dt">i++&#39; </span><span class="st">`</span>lab<span class="st">`</span><span class="dt">l2&#39;&#39; </span></a>
<a class="sourceLine" id="cb68-14" title="14"><span class="dt">}</span></a>
<a class="sourceLine" id="cb68-15" title="15"></a>
<a class="sourceLine" id="cb68-16" title="16"><span class="dt">* Graphique</span></a>
<a class="sourceLine" id="cb68-17" title="17"><span class="dt">local ops mlc(black) mlw(vthin)</span></a>
<a class="sourceLine" id="cb68-18" title="18"><span class="dt">foreach i of local l {</span></a>
<a class="sourceLine" id="cb68-19" title="19"><span class="dt">local scat </span><span class="st">`</span>scat<span class="st">&#39; scatter `1&#39;</span> <span class="st">`</span><span class="dt">2&#39; if </span><span class="st">`</span><span class="dv">3</span><span class="st">&#39;==`i&#39;</span>, <span class="st">`</span><span class="dt">ops&#39; ||</span></a>
<a class="sourceLine" id="cb68-20" title="20"><span class="dt">}</span></a>
<a class="sourceLine" id="cb68-21" title="21"><span class="dt">macro list _scat</span></a>
<a class="sourceLine" id="cb68-22" title="22"></a>
<a class="sourceLine" id="cb68-23" title="23"><span class="dt">tw </span><span class="st">`</span>scat<span class="st">&#39;, legend(order(`ord&#39;</span><span class="er">))</span>  </a></code></pre></div>
<p>Ci-dessous une transformation très simple en routine, appelée <strong><code>sgraph</code></strong> [syntaxe: <strong><code>sgraph varlist</code></strong> ]</p>
</div>
</div>
<div id="routine---commande" class="section level2">
<h2><span class="header-section-number">3.4</span> Routine - Commande</h2>
<p><strong>Aide Stata</strong></p>
<ul>
<li><p>Manuel Stata <em>programming</em>: <a href="https://www.stata.com/manuals/p.pdf#ppProgramming" class="uri">https://www.stata.com/manuals/p.pdf#ppProgramming</a> [entrée <strong>syntax</strong>]</p></li>
<li>principe des programmes qui exécutent des commande (<strong>.ado</strong>)</li>
<li>la routine peut être programmée dans le programme principe (<strong>.do) ou enregistré comme </strong>.ado** dans le répertoire où sont enregistré les commandes externes (répertoire <em>ado</em>). Il est conseillé de les enregistrer dans un sous répertoire appelé <em>personal</em></li>
<li>Syntaxe:
<ul>
<li>Si la routine est programmée dans le .do:</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1">capture program drop nom_routine</a>
<a class="sourceLine" id="cb69-2" title="2">program define nom_routine [options]</a>
<a class="sourceLine" id="cb69-3" title="3"></a>
<a class="sourceLine" id="cb69-4" title="4">syntax [arguments]</a>
<a class="sourceLine" id="cb69-5" title="5"></a>
<a class="sourceLine" id="cb69-6" title="6">....programme de la routine...</a>
<a class="sourceLine" id="cb69-7" title="7"></a>
<a class="sourceLine" id="cb69-8" title="8">end</a></code></pre></div>
<ul>
<li>Si la routine est enregistrée, la première ligne n’est pas pas obligatoire</li>
</ul>
<p>Exemple simple: une soustraction</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1">capture program drop soustraction </a>
<a class="sourceLine" id="cb70-2" title="2">program define soustraction</a>
<a class="sourceLine" id="cb70-3" title="3"></a>
<a class="sourceLine" id="cb70-4" title="4">syntax anything</a>
<a class="sourceLine" id="cb70-5" title="5">tokenize <span class="st">`</span><span class="dt">anything&#39;</span></a>
<a class="sourceLine" id="cb70-6" title="6"><span class="dt">di &quot;&quot;</span></a>
<a class="sourceLine" id="cb70-7" title="7"><span class="dt">di as result &quot;Le résultat de ma soustraction est: &quot;  </span><span class="st">`</span><span class="dv">1</span><span class="st">&#39; - `2&#39;</span></a>
<a class="sourceLine" id="cb70-8" title="8">end</a>
<a class="sourceLine" id="cb70-9" title="9"></a>
<a class="sourceLine" id="cb70-10" title="10">soustraction <span class="dv">1245</span> <span class="dv">722</span></a>
<a class="sourceLine" id="cb70-11" title="11"><span class="dv">523</span></a></code></pre></div>
<p>Exemple “simple” pour un graphique</p>
<ul>
<li>On reprend le programme précédent (macro élargie et légendes), avec quelques options modifiées (une ligne pour la légende, perturvation des coordonnées (<code>jitter(#)</code>), couleur de la bulle)</li>
<li>On fixe les arguments de la commande: <code>varlist(min=3 max=3)</code></li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1">capture program drop sgraph </a>
<a class="sourceLine" id="cb71-2" title="2">program define sgraph</a>
<a class="sourceLine" id="cb71-3" title="3"></a>
<a class="sourceLine" id="cb71-4" title="4">syntax <span class="kw">varlist</span>(<span class="dt">min=</span><span class="dv">3</span> <span class="dt">max=</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb71-5" title="5"></a>
<a class="sourceLine" id="cb71-6" title="6">tokenize <span class="st">`</span><span class="dt">varlist&#39;</span></a>
<a class="sourceLine" id="cb71-7" title="7"></a>
<a class="sourceLine" id="cb71-8" title="8"><span class="dt">local labn: value label </span><span class="st">`</span><span class="dv">3</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb71-9" title="9"><span class="st">levelsof `3&#39;</span>, <span class="kw">local</span>(l)</a>
<a class="sourceLine" id="cb71-10" title="10">local i=<span class="dv">1</span></a>
<a class="sourceLine" id="cb71-11" title="11"></a>
<a class="sourceLine" id="cb71-12" title="12">foreach l2 of local l {</a>
<a class="sourceLine" id="cb71-13" title="13">local lab<span class="st">`</span><span class="dt">l2&#39;: label </span><span class="st">`</span>labn<span class="st">&#39;  `l2&#39;</span></a>
<a class="sourceLine" id="cb71-14" title="14">local lab<span class="st">`</span><span class="dt">l2&#39; </span><span class="st">`&quot;&quot;`</span><span class="dt">lab</span><span class="st">`</span>l2<span class="st">&#39;&#39;&quot;&quot;&#39; </span></a>
<a class="sourceLine" id="cb71-15" title="15"><span class="st">local ord `ord&#39;</span> <span class="st">`</span><span class="dt">i++&#39; </span><span class="st">`</span>lab<span class="st">`</span><span class="dt">l2&#39;&#39; </span></a>
<a class="sourceLine" id="cb71-16" title="16"><span class="dt">}</span></a>
<a class="sourceLine" id="cb71-17" title="17"><span class="dt">local ops mlc(black) mlw(vthin) jitter(3) mc(%70)</span></a>
<a class="sourceLine" id="cb71-18" title="18"><span class="dt">foreach i of local l {</span></a>
<a class="sourceLine" id="cb71-19" title="19"><span class="dt">local scat </span><span class="st">`</span>scat<span class="st">&#39; scatter `1&#39;</span> <span class="st">`</span><span class="dt">2&#39; if </span><span class="st">`</span><span class="dv">3</span><span class="st">&#39;==`i&#39;</span>, <span class="st">`</span><span class="dt">ops&#39; ||</span></a>
<a class="sourceLine" id="cb71-20" title="20"><span class="dt">}</span></a>
<a class="sourceLine" id="cb71-21" title="21"><span class="dt">macro list _scat</span></a>
<a class="sourceLine" id="cb71-22" title="22"></a>
<a class="sourceLine" id="cb71-23" title="23"><span class="dt">tw </span><span class="st">`</span>scat<span class="st">&#39;, legend(order(`ord&#39;</span><span class="er">)</span> <span class="kw">rows</span>(<span class="dv">1</span>)<span class="er">)</span></a>
<a class="sourceLine" id="cb71-24" title="24"></a>
<a class="sourceLine" id="cb71-25" title="25">end</a></code></pre></div>
<p>On exécute la commande <strong><code>sgraph</code></strong></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" title="1">sgraph price mpg foreign</a></code></pre></div>
<p><strong>Exemple</strong></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" title="1">sysuse citytemp4.dta, clear</a>
<a class="sourceLine" id="cb73-2" title="2"></a>
<a class="sourceLine" id="cb73-3" title="3"><span class="op">*</span><span class="st"> </span>cpnversion des températures en degré Celsus</a>
<a class="sourceLine" id="cb73-4" title="4">replace tempjan =<span class="st">   </span>(tempjan <span class="op">-</span><span class="st"> </span><span class="dv">32</span> )<span class="op">*</span><span class="dv">5</span><span class="op">/</span><span class="dv">9</span></a>
<a class="sourceLine" id="cb73-5" title="5">replace tempjuly  =<span class="st"> </span>(tempjuly <span class="op">-</span><span class="st"> </span><span class="dv">32</span> )<span class="op">*</span><span class="dv">5</span><span class="op">/</span><span class="dv">9</span></a>
<a class="sourceLine" id="cb73-6" title="6"></a>
<a class="sourceLine" id="cb73-7" title="7">sgraph tempjan tempjuly region</a></code></pre></div>
<p><em>Graphique 32</em><br />
<img src="imgf/g27.png" style="width:75.0%" /></p>
</div>
<div id="un-festival-de-macros" class="section level2">
<h2><span class="header-section-number">3.5</span> Un festival de macros</h2>
<p><strong>La macro dans (presque) tous ses états</strong><br />
<br> Presque car:</p>
<ul>
<li>Pas de variable temporaire (oblige ici à dropper des variables en fin de programme)</li>
<li>Pas de macro avec une expression étendue (inutile ici)</li>
</ul>
<p><strong>Graphique généré</strong></p>
<ul>
<li>Graphique de type <strong>violon</strong> (variable continue). Sans la boxplot, ce type de graphique est appelé <strong>bean plot</strong></li>
<li>Compare la distribution d’une variable variable pour deux modalités d’une variable catégorielle)</li>
</ul>
<p><strong>Principales étapes</strong></p>
<ul>
<li>Paramètres du graphique sous forme de macro (<code>local</code>)</li>
<li>Estimation de la densité avec création des variables associées</li>
<li>Récupération des valeurs pour les boxplots (Q1 - Q2 - Q3)</li>
<li>Légende</li>
<li>Style et couleur (anticipe un peu une partie suivante)</li>
<li>Graphique
<ul>
<li>type <strong><code>area</code></strong> pour les densites</li>
<li>type <strong><code>pci</code></strong> pour les boxplot</li>
<li>type <strong><code>scatter</code></strong> pour les outliers des boxplots</li>
</ul></li>
</ul>
<p>On compare la pression sanguine des hommes et des femmes (base <em>nhanes2.dta</em>): variables <em>bpsystol</em> et <em>sex</em>:</p>
<p><em>Graphique 33</em><br />
<img src="imgf/g24.png" style="width:75.0%" /></p>
<p>[Expliquer rapidement le graphique: densites en mirroire + boxplot] [Données quelques éléments d’amélioration: un échantillon pour les outliers, ici c’est trop chargé / problème rencontrés sur le rendu des axes avec des petites échantillons: base auto variable displacement par exemple]</p>
<p><strong>Programme en un bloc</strong></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1">webuse nhanes2, clear</a>
<a class="sourceLine" id="cb74-2" title="2"></a>
<a class="sourceLine" id="cb74-3" title="3"><span class="op">*</span><span class="st"> </span>définition des variables et des options pour density dans une macro</a>
<a class="sourceLine" id="cb74-4" title="4">local y bpsystol</a>
<a class="sourceLine" id="cb74-5" title="5">local z sex</a>
<a class="sourceLine" id="cb74-6" title="6">local bw <span class="dv">5</span></a>
<a class="sourceLine" id="cb74-7" title="7">local ker gau</a>
<a class="sourceLine" id="cb74-8" title="8"></a>
<a class="sourceLine" id="cb74-9" title="9"><span class="op">*</span><span class="st"> </span>Création des variables pour la densité et normalisation des échelles</a>
<a class="sourceLine" id="cb74-10" title="10">levelsof <span class="st">`</span><span class="dt">z&#39;, local(l)</span></a>
<a class="sourceLine" id="cb74-11" title="11"><span class="dt">local i=1</span></a>
<a class="sourceLine" id="cb74-12" title="12"><span class="dt">foreach s of local l {</span></a>
<a class="sourceLine" id="cb74-13" title="13"><span class="dt">local j </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb74-14" title="14"><span class="st">qui kdensity `y&#39;</span> <span class="cf">if</span> <span class="st">`</span><span class="dt">z&#39;==</span><span class="st">`</span>s<span class="st">&#39;, gen(x`j&#39;</span> d<span class="st">`</span><span class="dt">j&#39;) nograph  kernel(</span><span class="st">`</span>kernel<span class="st">&#39;) bw(`bw&#39;</span><span class="er">)</span></a>
<a class="sourceLine" id="cb74-15" title="15">qui sum d<span class="st">`</span><span class="dt">j&#39;, d</span></a>
<a class="sourceLine" id="cb74-16" title="16"><span class="dt">local min</span><span class="st">`</span>j<span class="st">&#39;  `r(min)&#39;</span></a>
<a class="sourceLine" id="cb74-17" title="17">local max<span class="st">`</span><span class="dt">j&#39;  </span><span class="st">`</span><span class="kw">r</span>(max)<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb74-18" title="18"><span class="st">qui replace d`j&#39;</span>  =<span class="st"> </span>d<span class="st">`</span><span class="dt">j&#39;*(.3/(</span><span class="st">`</span>max<span class="st">`</span><span class="dt">j&#39;&#39;- </span><span class="st">`</span>min<span class="st">`</span><span class="dt">j&#39;&#39;))</span></a>
<a class="sourceLine" id="cb74-19" title="19"><span class="dt">}</span></a>
<a class="sourceLine" id="cb74-20" title="20"></a>
<a class="sourceLine" id="cb74-21" title="21"></a>
<a class="sourceLine" id="cb74-22" title="22"><span class="dt">* variable miroir pour la densité dans l&#39;axe négatif</span></a>
<a class="sourceLine" id="cb74-23" title="23"><span class="dt">replace d1=-d1</span></a>
<a class="sourceLine" id="cb74-24" title="24"></a>
<a class="sourceLine" id="cb74-25" title="25"><span class="dt">* translation de la densité avec valeur min à 0</span></a>
<a class="sourceLine" id="cb74-26" title="26"><span class="dt">local i=1</span></a>
<a class="sourceLine" id="cb74-27" title="27"><span class="dt">foreach s of local l {</span></a>
<a class="sourceLine" id="cb74-28" title="28"><span class="dt">local j </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb74-29" title="29"><span class="st">qui sum d`j&#39;</span>, d</a>
<a class="sourceLine" id="cb74-30" title="30">local min<span class="st">`</span><span class="dt">j&#39;   </span><span class="st">`</span><span class="kw">r</span>(min)<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb74-31" title="31"><span class="st">local max`j&#39;</span>   <span class="st">`</span><span class="dt">r(max)&#39;</span></a>
<a class="sourceLine" id="cb74-32" title="32"><span class="dt">qui replace d1 = d1 + (-1)*</span><span class="st">`</span>max1<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb74-33" title="33"><span class="st">qui replace d2 = d2 - `min2&#39;</span></a>
<a class="sourceLine" id="cb74-34" title="34"><span class="er">}</span></a>
<a class="sourceLine" id="cb74-35" title="35"></a>
<a class="sourceLine" id="cb74-36" title="36"></a>
<a class="sourceLine" id="cb74-37" title="37"><span class="op">**</span><span class="er">****</span><span class="st"> </span>valeurs pour boxplot</a>
<a class="sourceLine" id="cb74-38" title="38"></a>
<a class="sourceLine" id="cb74-39" title="39"><span class="op">**</span><span class="st"> </span>coordonnées<span class="op">:</span><span class="st"> </span>q25<span class="op">/</span><span class="dv">50</span><span class="op">/</span><span class="dv">75</span> et bornes inf et sup des moustaches</a>
<a class="sourceLine" id="cb74-40" title="40">local i=<span class="dv">1</span></a>
<a class="sourceLine" id="cb74-41" title="41">foreach s of local l {</a>
<a class="sourceLine" id="cb74-42" title="42">local j <span class="st">`</span><span class="dt">i++&#39;</span></a>
<a class="sourceLine" id="cb74-43" title="43"><span class="dt">qui sum </span><span class="st">`</span>y<span class="st">&#39; if `z&#39;</span><span class="op">==</span><span class="st">`</span><span class="dt">s&#39;, d</span></a>
<a class="sourceLine" id="cb74-44" title="44"><span class="dt">local q2</span><span class="st">`</span>j<span class="st">&#39;: di %6.1f  `r(p50)&#39;</span></a>
<a class="sourceLine" id="cb74-45" title="45">local q1<span class="st">`</span><span class="dt">j&#39; : di %6.1f  </span><span class="st">`</span><span class="kw">r</span>(p25)<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb74-46" title="46"><span class="st">local q3`j&#39;</span> <span class="op">:</span><span class="st"> </span>di %<span class="fl">6.1</span>f  <span class="st">`</span><span class="dt">r(p75)&#39;</span></a>
<a class="sourceLine" id="cb74-47" title="47"><span class="dt">scalar min = </span><span class="st">`</span>q1<span class="st">`</span><span class="dt">j&#39;&#39; - 1.5*(</span><span class="st">`</span>q3<span class="st">`</span><span class="dt">j&#39;&#39; - </span><span class="st">`</span>q1<span class="st">`</span><span class="dt">j&#39;&#39;)</span></a>
<a class="sourceLine" id="cb74-48" title="48"><span class="dt">local  inf</span><span class="st">`</span>j<span class="st">&#39; = scalar(min)</span></a>
<a class="sourceLine" id="cb74-49" title="49"><span class="st">scalar max = `q3`j&#39;&#39; + 1.5*(`q3`j&#39;&#39; - `q1`j&#39;&#39;) </span></a>
<a class="sourceLine" id="cb74-50" title="50"><span class="st">local  sup`j&#39;</span> =<span class="st"> </span><span class="kw">scalar</span>(max)</a>
<a class="sourceLine" id="cb74-51" title="51">}</a>
<a class="sourceLine" id="cb74-52" title="52"></a>
<a class="sourceLine" id="cb74-53" title="53"><span class="op">**</span><span class="st"> </span>outliers</a>
<a class="sourceLine" id="cb74-54" title="54">qui gen _yo1 =<span class="st"> </span><span class="fl">-.02</span></a>
<a class="sourceLine" id="cb74-55" title="55">qui gen _yo2 =<span class="st">  </span><span class="fl">.02</span> </a>
<a class="sourceLine" id="cb74-56" title="56"></a>
<a class="sourceLine" id="cb74-57" title="57">local i=<span class="dv">1</span></a>
<a class="sourceLine" id="cb74-58" title="58">foreach s of local l {</a>
<a class="sourceLine" id="cb74-59" title="59">local j <span class="st">`</span><span class="dt">i++&#39;</span></a>
<a class="sourceLine" id="cb74-60" title="60"><span class="dt">qui gen _out</span><span class="st">`</span>j<span class="st">&#39;= `y&#39;</span> <span class="cf">if</span>  (<span class="st">`</span><span class="dt">y&#39;&gt;</span><span class="st">`</span>sup<span class="st">`</span><span class="dt">j&#39;&#39; | </span><span class="st">`</span>y<span class="st">&#39;&lt;`inf`j&#39;&#39;) &amp; `z&#39;</span><span class="op">==</span><span class="st">`</span><span class="dt">s&#39;</span></a>
<a class="sourceLine" id="cb74-61" title="61"><span class="dt">}</span></a>
<a class="sourceLine" id="cb74-62" title="62"></a>
<a class="sourceLine" id="cb74-63" title="63"><span class="dt">* Génération automatique de la légende (fixe à 2 labels)</span></a>
<a class="sourceLine" id="cb74-64" title="64"><span class="dt">* legend: order(...)</span></a>
<a class="sourceLine" id="cb74-65" title="65"><span class="dt">local labn: value label </span><span class="st">`</span>z<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb74-66" title="66"><span class="st">local i=1</span></a>
<a class="sourceLine" id="cb74-67" title="67"><span class="st">foreach s of local l {</span></a>
<a class="sourceLine" id="cb74-68" title="68"><span class="st">local j `i++&#39;</span></a>
<a class="sourceLine" id="cb74-69" title="69">capture local lab<span class="st">`</span><span class="dt">j&#39;: label </span><span class="st">`</span>labn<span class="st">&#39;  `s&#39;</span></a>
<a class="sourceLine" id="cb74-70" title="70"><span class="er">}</span></a>
<a class="sourceLine" id="cb74-71" title="71"></a>
<a class="sourceLine" id="cb74-72" title="72"><span class="op">*</span><span class="st"> </span>On anticipe un peu avec la section suivante pour style et couleur</a>
<a class="sourceLine" id="cb74-73" title="73"><span class="op">*</span><span class="st"> </span>installer grstyle et colorpalette si nécessaire</a>
<a class="sourceLine" id="cb74-74" title="74">grstyle init</a>
<a class="sourceLine" id="cb74-75" title="75">grstyle set plain, horizontal grid compact</a>
<a class="sourceLine" id="cb74-76" title="76">grstyle set mesh,  horizontal</a>
<a class="sourceLine" id="cb74-77" title="77">grstyle set color hue,  <span class="kw">n</span>(<span class="dv">2</span>)  </a>
<a class="sourceLine" id="cb74-78" title="78">colorpalette  hue ,<span class="kw">n</span>(<span class="dv">2</span>) nograph</a>
<a class="sourceLine" id="cb74-79" title="79"></a>
<a class="sourceLine" id="cb74-80" title="80"><span class="op">*</span><span class="st"> </span>création du graphique</a>
<a class="sourceLine" id="cb74-81" title="81">tw area d1 x1,   horizontal        <span class="kw">fc</span>(%<span class="dv">60</span>)  <span class="kw">lc</span>(<span class="op">*</span><span class="fl">0.5</span>) <span class="kw">lw</span>(thin)                       <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb74-82" title="82"><span class="er">||</span><span class="st"> </span>area d2 x2,   horizontal        <span class="kw">fc</span>(%<span class="dv">60</span>)  <span class="kw">lc</span>(<span class="op">*</span><span class="fl">0.5</span>) <span class="kw">lw</span>(thin)                       <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb74-83" title="83"><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q11&#39;  -.04  </span><span class="st">`</span>q11<span class="st">&#39;     0,      lc(&quot;`r(p1)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                  ///</span></a>
<a class="sourceLine" id="cb74-84" title="84"><span class="st">|| pci  `q21&#39;  -.04  `q21&#39;     0,      lc(&quot;`</span><span class="dt">r(p1)&#39;*1.3&quot;) lw(vthin)                  ///</span></a>
<a class="sourceLine" id="cb74-85" title="85"><span class="dt">|| pci  </span><span class="st">`</span>q31<span class="st">&#39;  -.04  `q31&#39;</span>     <span class="dv">0</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p1)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                  <span class="op">/</span><span class="er">//</span><span class="st">     </span></a>
<a class="sourceLine" id="cb74-86" title="86"><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q11&#39;  -.04  </span><span class="st">`</span>q31<span class="st">&#39;  -.04,      lc(&quot;`r(p1)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                  ///</span></a>
<a class="sourceLine" id="cb74-87" title="87"><span class="st">|| pci  `q11&#39;  -.0003 `q31&#39;  -.0003,   lc(&quot;`</span><span class="dt">r(p1)&#39;*1.3&quot;) lw(vthin)                  ///</span></a>
<a class="sourceLine" id="cb74-88" title="88"><span class="dt">|| pci  </span><span class="st">`</span>inf1<span class="st">&#39; -.02  `q11&#39;</span>  <span class="fl">-.02</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p1)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                  <span class="op">/</span><span class="er">//</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-89" title="89"><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q31&#39;  -.02  </span><span class="st">`</span>sup1<span class="st">&#39; -.02,      lc(&quot;`r(p1)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                  /// </span></a>
<a class="sourceLine" id="cb74-90" title="90"><span class="st">|| scatter _out1 _yo1, msize(vsmall) mlc(black) mlw(vvthin) mc(&quot;`</span><span class="dt">r(p1)&#39;&quot;) jitter(1) /// </span></a>
<a class="sourceLine" id="cb74-91" title="91"><span class="dt">|| pci  </span><span class="st">`</span>q12<span class="st">&#39;   .04  `q12&#39;</span>    <span class="dv">0</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p2)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb74-92" title="92"><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q22&#39;   .04  </span><span class="st">`</span>q22<span class="st">&#39;    0,      lc(&quot;`r(p2)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                   ///</span></a>
<a class="sourceLine" id="cb74-93" title="93"><span class="st">|| pci  `q32&#39;   .04  `q32&#39;    0,      lc(&quot;`</span><span class="dt">r(p2)&#39;*1.3&quot;) lw(vthin)                   ///                         </span></a>
<a class="sourceLine" id="cb74-94" title="94"><span class="dt">|| pci  </span><span class="st">`</span>q12<span class="st">&#39;   .04  `q32&#39;</span>  <span class="fl">.04</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p2)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb74-95" title="95"><span class="er">||</span><span class="st"> </span>pci  <span class="st">`</span><span class="dt">q12&#39;   .0003 </span><span class="st">`</span>q32<span class="st">&#39; .0003,    lc(&quot;`r(p2)&#39;</span><span class="op">*</span><span class="fl">1.3</span><span class="st">&quot;) lw(vthin)                   /// </span></a>
<a class="sourceLine" id="cb74-96" title="96"><span class="st">|| pci  `inf2&#39;  .02  `q12&#39;  .02,      lc(&quot;`</span><span class="dt">r(p2)&#39;*1.3&quot;) lw(vthin)                   /// </span></a>
<a class="sourceLine" id="cb74-97" title="97"><span class="dt">|| pci  </span><span class="st">`</span>q32<span class="st">&#39;   .02  `sup2&#39;</span> <span class="fl">.02</span>,      <span class="kw">lc</span>(<span class="st">&quot;`r(p2)&#39;*1.3&quot;</span>) <span class="kw">lw</span>(vthin)                   <span class="op">/</span><span class="er">//</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-98" title="98"><span class="er">||</span><span class="st"> </span>scatter _out2 _yo2, <span class="kw">msize</span>(vsmall) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vvthin) <span class="kw">mc</span>(<span class="st">&quot;`r(p2)&#39;&quot;</span>) <span class="kw">jitter</span>(<span class="dv">1</span>) <span class="op">/</span><span class="er">//</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-99" title="99">, <span class="kw">ytitle</span>(<span class="st">&quot;`y&#39;&quot;</span>) <span class="kw">xlab</span>(<span class="dv">0</span> <span class="st">&quot;0&quot;</span>)  <span class="kw">xtitle</span>(<span class="st">&quot;Densité&quot;</span>, <span class="kw">size</span>(small))                         <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb74-100" title="100"><span class="st">  </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">1</span> <span class="st">&quot;`lab1&#39;&quot;</span>  <span class="dv">2</span> <span class="st">&quot;`lab2&#39;&quot;</span>) stack <span class="kw">region</span>(<span class="kw">lw</span>(vvthin) <span class="kw">lc</span>(%<span class="dv">0</span>)))          </a>
<a class="sourceLine" id="cb74-101" title="101"></a>
<a class="sourceLine" id="cb74-102" title="102"><span class="op">*</span><span class="st"> </span>à défaut d<span class="st">&#39;avoir généré des variables temporaire</span></a>
<a class="sourceLine" id="cb74-103" title="103"><span class="st">drop d1 d2 x1 x2 _y*  _out*</span></a></code></pre></div>
<p><strong>Programme expliqué par bloc</strong><br />
[A faire]</p>
</div>
</div>
<div id="palettes-de-couleurs-thèmes" class="section level1">
<h1><span class="header-section-number">4</span> Palettes de couleurs &amp; thèmes</h1>
<ul>
<li>Les graphiques lorsqu’ils sont générés appliquent un thème/style par défaut:
<ul>
<li>Ces thèmes sont appelés <strong>scheme</strong></li>
<li>Les options entrées dans la commande graphique visent à modifier les paramètres du thème</li>
<li>Les paramètres du style thèmes appliquées aux couleurs, tailles/épaisseurs, positions des éléments de texte, définitions des axes….</li>
<li>Stata dispose de 5 thèmes officiels</li>
<li>Des thèmes externes peuvent être installés</li>
</ul></li>
<li>Les thèmes graphiques utilisent des palettes de couleurs
<ul>
<li>Trois types de palettes:
<ul>
<li>Palettes qualitatives</li>
<li>Palettes séquentielles</li>
<li>Palettes divergentes</li>
</ul></li>
</ul></li>
<li>Des commandes externes permettent d’augmenter le nombre de palettes, de les modifier ou d’en créer
<ul>
<li>Pour la cartographie, la commande <strong><code>spmap</code></strong> (<em>Pisatti</em>) intégre une quarantaine de palettes, principalement séquentielles</li>
<li>La librairie <strong><code>brewscheme</code></strong> (<em>W.Buchanan</em>) dispose de plusieurs commande pour générer des palettes de couleurs.</li>
<li>La commande <strong><code>colorpalette</code></strong> (B.Jann) charge plusieurs dizaine de palettes de couleurs, de tout type, et permet de les modifier et permet de les utiliser très facilement dans la création de graphique. Adopté!</li>
</ul></li>
</ul>
<div id="les-palettes-de-couleurs-stata" class="section level2">
<h2><span class="header-section-number">4.1</span> Les Palettes de couleurs Stata</h2>
<p>Résumé de la page: <a href="https://mthevenin.github.io/stata_fr/couleurs.html" class="uri">https://mthevenin.github.io/stata_fr/couleurs.html</a></p>
<div id="les-palettes-stata" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Les palettes Stata</h3>
<p>Stata dispose de 5 palettes de couleurs qui sont associées à des thèmes graphiques: la palette <strong>s2</strong> est associée au thème <strong>s2color</strong> par exemple</p>
<p><img src="imgc/g15.png" style="width:50.0%" /></p>
<ul>
<li>Les palettes sont de type qualitative
<ul>
<li>Remarque On peut les utiliser de manière séquentielle en sélectionnant une couleur et en baissant ou en augmentant l’intensité <code>(couleur*#)</code></li>
<li>la palette mono peut(être partiellement utilisée de manière séquentielle: ordre des couleurs 7 à 11 par exemple)</li>
</ul></li>
<li>Elles sont composées de 15 couleurs</li>
<li>Toutes les couleurs ont un nom et un code RGB qui lui est associé</li>
<li>Dans un graphique, les couleurs utilisées par défaut suivent leur ordre dans la palette</li>
</ul>
<p><img src="imgf/g28.png" style="width:50.0%" /></p>
<p><img src="imgf/g29.png" style="width:50.0%" /></p>
<p>Exemple avec la palette S2<br />
<em>Graphique 34</em></p>
<p><img src="imgc/e1.png" style="width:50.0%" /></p>
<p><em>Graphique de gauche n(2) - graphique de droite n(3)</em></p>
<p>On est clairement vite limité par l’utilisation des palettes avec Stata</p>
<p>A mon sens la commande <strong>colorpalette</strong> de <em>Ben Jann</em> permet de démultiplier les possibilités dans l’utilisation des couleurs avec Stata. Un grand merci à lui</p>
</div>
</div>
<div id="colorpalette-de-ben-jann" class="section level2">
<h2><span class="header-section-number">4.2</span> Colorpalette de Ben Jann</h2>
<div id="syntaxe-et-options" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Syntaxe et options</h3>
<p><strong>Installation `colorpalette</strong></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1">    ssc install palettes,  replace</a>
<a class="sourceLine" id="cb75-2" title="2">    ssc install colrspace, replace</a></code></pre></div>
<p><strong>syntaxe</strong>: <strong>colorpalette nom_palette [, nom_sous_palette options]</strong></p>
<p>Exemple</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" title="1"><span class="op">*</span><span class="st"> </span>Charge et affiche la palette hue</a>
<a class="sourceLine" id="cb76-2" title="2">  colorpalette hue</a>
<a class="sourceLine" id="cb76-3" title="3">  </a>
<a class="sourceLine" id="cb76-4" title="4"><span class="op">*</span><span class="st"> </span>Charge et affiche la palette viridis</a>
<a class="sourceLine" id="cb76-5" title="5">  colorpalette viridis</a>
<a class="sourceLine" id="cb76-6" title="6"></a>
<a class="sourceLine" id="cb76-7" title="7"><span class="op">*</span><span class="st"> </span>Charge et affiche la sous palette summer de <span class="kw">matplotlib</span> (palette Python)</a>
<a class="sourceLine" id="cb76-8" title="8">  colorpalette matplotlib, summer  </a></code></pre></div>
<p><strong>Visualiser des palettes disponibles dans l’aide</strong>: <strong><code>help colorpalette</code></strong></p>
<p><strong>Principales options</strong></p>
<ul>
<li><strong>Modifier la taille de la palette</strong>: <strong><code>n(#)</code></strong>
<ul>
<li>Important car la réduction de la taille pour certaines palette ne consiste pas à prendre les # premiers éléments de la palette par défaut (cf palette <strong>hue</strong> ou <strong>viridis</strong>)</li>
</ul></li>
<li><strong>Modifier l’intensité et l’opacité</strong>: <strong><code>intensity(#)</code></strong> et <strong><code>opacity(#)</code></strong>
<ul>
<li>Remarque: on peut créer une palette avec séquentielle à partir d’une couleur avec <strong><code>intensity</code></strong></li>
</ul></li>
<li><strong>Créer une palette divergente</strong>: ipolate(#)</li>
<li><strong>Sélectionner des couleurs d’une palette</strong>: <strong><code>select(numlist)</code></strong></li>
<li><strong>Inverse les couleurs de la palette</strong>: <strong><code>reverse</code></strong></li>
<li><strong>Ne pas afficher la palette</strong>: <strong><code>nograph</code></strong>. Utile pour charger la palette avant son utilisation dans un graphique</li>
</ul>
<p><strong>Remarque</strong>: la commande identifie également une couleur (par son nom Stata ou son code RGB) comme une palette de couleur</p>
<p>Exemple 1:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" title="1"><span class="st">`</span><span class="dt">colorpalette s2, n(5) intensity(.4 1 .4 1 .4) reverse</span></a></code></pre></div>
<p><img src="imgf/g30.png" style="width:50.0%" /></p>
<ul>
<li>On a sélectionné la palette <em>s2</em></li>
<li>On a réduit la taille de la palette à 5 couleurs: <strong><code>n(5)</code></strong></li>
<li>On a alterné les intensités: une sur deux à .5: <strong><code>intensity(.4 1 .4 1 .4)</code></strong></li>
<li>On a inverse l’ordre des couleurs (<em>navy</em> en dernier) <strong><code>reverse</code></strong></li>
</ul>
<p>Exemple 2: création d’une palette séquentielle avec <code>intensity</code> à partir de la couleur stata <em>navy</em></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">colorpalette navy, <span class="kw">intensity</span>(<span class="fl">0.1</span>(.<span class="dv">1</span>)<span class="dv">1</span>)</a></code></pre></div>
<p><img src="imgf/g31.png" style="width:50.0%" /></p>
<p>Exemple3 : création d’une palette divergente avec <code>ipolate</code> avec les couleurs <em>navy</em> (couleur de départ) et la couleur <em>cranberry</em> pues (couleur d’arrivée)</p>
<p>3b: sans couleur intermédiaire</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" title="1">colorpalette navy cranberry, <span class="kw">ipolate</span>(<span class="dv">10</span>)</a></code></pre></div>
<p><img src="imgf/g32.png" style="width:50.0%" /></p>
<p>avec une couleur de transition (ici white)</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1">colorpalette navy white cranberry, <span class="kw">ipolate</span>(<span class="dv">10</span>)</a></code></pre></div>
<p><img src="imgf/g33.png" style="width:50.0%" /></p>
</div>
<div id="utilisation-pour-un-graphique" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Utilisation pour un graphique</h3>
</div>
<div id="colorpalette-et-graphique" class="section level3">
<h3><span class="header-section-number">4.2.3</span> colorpalette et graphique</h3>
<ul>
<li>Utilisation des macros générées par colorpalette
<ul>
<li>la commande génère une liste de macro permettant de récupérer les codes et les noms des couleurs
<ul>
<li>la macro <strong>r(p)</strong> permet d’utiliser les couleurs de la palette dans un graphique à un seul bloc d’élements</li>
<li>les macros <strong>r(p#)</strong> permettent d’utiliser les couleurs dans un graphique composé de plusieurs élements</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1">colorpalette navy cranberry, <span class="kw">ipolate</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb81-2" title="2">return list</a>
<a class="sourceLine" id="cb81-3" title="3"></a>
<a class="sourceLine" id="cb81-4" title="4">scalars<span class="op">:</span></a>
<a class="sourceLine" id="cb81-5" title="5"><span class="st">                  </span><span class="kw">r</span>(n) =<span class="st">  </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb81-6" title="6"></a>
<a class="sourceLine" id="cb81-7" title="7">macros<span class="op">:</span></a>
<a class="sourceLine" id="cb81-8" title="8"><span class="st">              </span><span class="kw">r</span>(ptype) <span class="op">:</span><span class="st"> &quot;color&quot;</span></a>
<a class="sourceLine" id="cb81-9" title="9">              <span class="kw">r</span>(pname) <span class="op">:</span><span class="st"> &quot;custom&quot;</span></a>
<a class="sourceLine" id="cb81-10" title="10">              <span class="kw">r</span>(pnote) <span class="op">:</span><span class="st"> &quot;interpolated&quot;</span></a>
<a class="sourceLine" id="cb81-11" title="11">                  <span class="kw">r</span>(p) <span class="op">:</span><span class="st"> &quot;&quot;</span><span class="dv">26</span> <span class="dv">71</span> <span class="dv">111</span><span class="st">&quot; &quot;</span><span class="dv">76</span> <span class="dv">73</span> <span class="dv">96</span><span class="st">&quot; &quot;</span><span class="dv">111</span> <span class="dv">71</span> <span class="dv">92</span><span class="st">&quot; &quot;</span><span class="dv">151</span> <span class="dv">58</span> <span class="dv">78</span><span class="st">&quot; &quot;</span><span class="dv">193</span> <span class="dv">5</span> <span class="dv">52</span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb81-12" title="12">             <span class="kw">r</span>(p5info) <span class="op">:</span><span class="st"> &quot;Jab 46 36 12&quot;</span></a>
<a class="sourceLine" id="cb81-13" title="13">                 <span class="kw">r</span>(p5) <span class="op">:</span><span class="st"> &quot;193 5 52&quot;</span></a>
<a class="sourceLine" id="cb81-14" title="14">             <span class="kw">r</span>(p4info) <span class="op">:</span><span class="st"> &quot;Jab 42 25 5&quot;</span></a>
<a class="sourceLine" id="cb81-15" title="15">                 <span class="kw">r</span>(p4) <span class="op">:</span><span class="st"> &quot;151 58 78&quot;</span></a>
<a class="sourceLine" id="cb81-16" title="16">             <span class="kw">r</span>(p3info) <span class="op">:</span><span class="st"> &quot;Jab 38 14 -3&quot;</span></a>
<a class="sourceLine" id="cb81-17" title="17">                 <span class="kw">r</span>(p3) <span class="op">:</span><span class="st"> &quot;111 71 92&quot;</span></a>
<a class="sourceLine" id="cb81-18" title="18">             <span class="kw">r</span>(p2info) <span class="op">:</span><span class="st"> &quot;Jab 34 2 -11&quot;</span></a>
<a class="sourceLine" id="cb81-19" title="19">                 <span class="kw">r</span>(p2) <span class="op">:</span><span class="st"> &quot;76 73 96&quot;</span></a>
<a class="sourceLine" id="cb81-20" title="20">             <span class="kw">r</span>(p1info) <span class="op">:</span><span class="st"> &quot;Jab 30 -9 -19&quot;</span></a>
<a class="sourceLine" id="cb81-21" title="21">                 <span class="kw">r</span>(p1) <span class="op">:</span><span class="st"> &quot;26 71 111&quot;</span></a></code></pre></div>
<p>Exemple</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">local opw <span class="kw">lw</span>(medthick medthick medthick medthick medthick) </a>
<a class="sourceLine" id="cb82-2" title="2">tw line le_w le_wmale le_b le_bmale year, <span class="st">`</span><span class="dt">opw&#39; ///</span></a>
<a class="sourceLine" id="cb82-3" title="3"><span class="dt">title(&quot;couleur s2&quot;)  name(g1, replace) nodraw</span></a>
<a class="sourceLine" id="cb82-4" title="4"></a>
<a class="sourceLine" id="cb82-5" title="5"><span class="dt">colorpalette midblue, n(4) intensity(1.25 1 .75 .5)  nograph</span></a>
<a class="sourceLine" id="cb82-6" title="6"><span class="dt">local opc lc(</span><span class="st">`</span><span class="kw">r</span>(p)<span class="st">&#39;)</span></a>
<a class="sourceLine" id="cb82-7" title="7"><span class="st">tw line le_w le_wmale le_b le_bmale year, `opw&#39;</span> <span class="st">`</span><span class="dt">opc&#39; ///</span></a>
<a class="sourceLine" id="cb82-8" title="8"><span class="dt">title(&quot;couleur générée avec colorpalette&quot;) name(g2, replace) nodraw</span></a>
<a class="sourceLine" id="cb82-9" title="9"></a>
<a class="sourceLine" id="cb82-10" title="10"></a>
<a class="sourceLine" id="cb82-11" title="11"><span class="dt">graph combine g1 g2, iscale(.5)</span></a></code></pre></div>
<p><em>Graphique 35</em></p>
<p><img src="imgf/g42.png" style="width:50.0%" /></p>
<ul>
<li>La syntaxe de <strong>colorpalette</strong> est transposable à la commande <strong>grstyle</strong>. Cela faciletera l’intégration des couleurs dans le graphique.</li>
</ul>
</div>
<div id="exemples-de-palettes" class="section level3">
<h3><span class="header-section-number">4.2.4</span> Exemples de palettes</h3>
<div id="qualitatives" class="section level4">
<h4><span class="header-section-number">4.2.4.1</span> Qualitatives</h4>
<p><strong>Palette HUE</strong></p>
<ul>
<li>Il s’agit de la palette utilisée par <strong>ggplot2</strong> (<strong>R</strong>)</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1">colorpalette hue [,options]</a></code></pre></div>
<p><img src="imgc/g10.png" style="width:50.0%" /></p>
<ul>
<li>Elle a plusieurs cycles de couleurs: Un “rouge” =&gt; un “vert =&gt; un”bleu" =&gt; un rose</li>
<li><p>Si on utilise donc cette palette à 10 couleurs pour un graphique composée de deux éléments, par exemple deux courbes, le rendu ne sera pas satisfaisant car les deux premières couleurs seront sélectionnées (une couleur plutôt “rouge” et une couleur plutôt"orange. Il convient dont de réduire la taille de la palette (<code>n2</code>)</p></li>
<li><p>Couleurs selon la taille de la palette</p></li>
</ul>
<p><img src="imgc/g13.png" style="width:50.0%" /></p>
<p>Exemple 1<br />
<em>Graphique 36</em></p>
<p><img src="imgf/g34.png" style="width:50.0%" /></p>
<p>Exemple 2 <em>Graphique 37</em><br />
<img src="imgc/e2.png" style="width:50.0%" /></p>
<p><em>Graphique de gauche n(2) - graphique de droite n(3)</em></p>
<p>Remarque: voir également la palette du thème externe <em><code>plottig</code></em></p>
<p><strong>Les palettes qualitatives de brewcolors</strong></p>
<p><img src="imgc/g26.png" style="width:50.0%" /></p>
<p>Exemple<br />
<em>Graphique 37</em></p>
<p><img src="imgc/e3.png" style="width:50.0%" /></p>
<p><em>Graphique de gauche n(2) - graphique de droite n(3)</em></p>
<p><strong>Palette séquentielle à taille réduite: viridis</strong></p>
<p>En réduisant la taille de certaines palettes séquentielles ou divergentes, on peut obtenir une palette plutôt qualitative. C’est le cas des palettes type <strong>viridis</strong> (populaire)</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1">colorpalette viridis, <span class="kw">n</span>(<span class="dv">3</span>)</a></code></pre></div>
<p><img src="imgf/g35.PNG" style="width:50.0%" /></p>
<p>Exemple<br />
<em>Graphique 38</em></p>
<p><img src="imgc/e4.png" style="width:50.0%" /></p>
</div>
<div id="séquentielles" class="section level4">
<h4><span class="header-section-number">4.2.4.2</span> Séquentielles</h4>
<ul>
<li>Utilisées massivement en cartographie et, plus généralement pour représenter des fréquences (graphique type barre) ou des valeurs ordonnées</li>
<li>Couleurs allant du plus claire au plus foncé (ou inversement)
<ul>
<li>Modification de l’intensité d’une couleur</li>
<li>Un ou plusieurs cycles de couleurs: par exemples du jaune au rouge, du jaune au noire…..</li>
</ul></li>
</ul>
<p><strong>Spmap</strong></p>
<p><img src="imgf/g36.png" style="width:50.0%" /></p>
<p>Exemple <em>Graphique 39</em><br />
<img src="imgf/g37.png" style="width:50.0%" /></p>
<p><strong>Colorbrewer</strong></p>
<p><img src="imgc/g28.png" style="width:50.0%" /></p>
<p>Exemple<br />
<em>Graphique 40</em><br />
<img src="imgf/g38.png" style="width:50.0%" /></p>
<p><strong>matplotlib</strong></p>
<p><img src="imgf/g39.png" style="width:50.0%" /></p>
<p>Exemple: les 4 saisons<br />
<em>Graphique 41</em><br />
<img src="imgc/e7.png" style="width:75.0%" /></p>
<p><strong>Viridis</strong></p>
<p><img src="imgf/g40.png" style="width:50.0%" /></p>
<p>Exemple<br />
<em>Graphique 42</em></p>
<p><img src="imgf/g41.png" style="width:50.0%" /></p>
</div>
<div id="palettes-divergentes" class="section level4">
<h4><span class="header-section-number">4.2.4.3</span> Palettes divergentes</h4>
<ul>
<li>Un peu le même principe que les palettes séquentielles, en mettant en avant un point central (de transition) représenté par une couleur de transition, souvent très clair. Typiquement:
<ul>
<li>Du bleu (negatif/faible/inférieur à la moyenne…) - vers le blanc (nul/moyen/proche moyenne) - vers le rouge (positif/élevé/supérieur à la moyenne…) avec une partie séquentielle du bleu vers le blanc, et une autre du blanc vers le rouge.</li>
</ul></li>
<li>Pour certains type de graphique, lorsque la couleur centrale est proche du blanc, la couleur de fond du graphique doit être prise en considération</li>
</ul>
<p>[ Pour les exemples je partirais bien sur une carto (spmap): mais help pour les données]</p>
<p><strong>Colorbrewer</strong></p>
<p><img src="imgc/g29.png" style="width:50.0%" /></p>
<p>[A finir avec une map en exemple ?]</p>
</div>
</div>
</div>
<div id="styles---scheme" class="section level2">
<h2><span class="header-section-number">4.3</span> Styles - scheme</h2>
</div>
<div id="principes---thèmes-internes-et-externe" class="section level2">
<h2><span class="header-section-number">4.4</span> Principes - thèmes internes et externe</h2>
<ul>
<li>Tous les graphiques ont un thème, appelé <strong>scheme</strong> qui paramètre tous les éléments composant graphiques: palette de couleurs, épaisseurs/tailles, positions, contour, marges….</li>
<li>Les options entrées dans le graphique visent à modifier ce paramétrage</li>
<li>Stata dispose de 11 thèmes internes, celui utilisé par défaut est <strong>s2color</strong> (factory scheme)</li>
<li>Sans modifier des options, un thème graphique peut ne pas être adapté à une représentation graphique</li>
</ul>
<p><strong>Changer de thème</strong></p>
<ul>
<li>Par les boîtes de dialogue: <strong>Edit</strong> =&gt; <strong>Préférences</strong> =&gt; <strong>Graph preferences</strong></li>
<li>Ligne de commande
<ul>
<li>On peut indique le thème en option du graphique le thème à appliquer: <strong><code>scheme(nom_scheme)</code></strong></li>
<li>On peut dans un fichier .do ou .ado charger un thème de façon temporaire (session) ou permanente un thème: <strong>`set scheme nom_scheme [,permanently]</strong></li>
<li>Le choix du thème peut-être également intégré au fichier profile (charge le thème au début de chaque programme)</li>
</ul></li>
</ul>
<p><strong>Thèmes internes</strong></p>
<p>A partir d’un exemple donné dans l’aide Stata pour un graphique type <strong>spike</strong> (<code>help spike</code>)</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" title="1">sysuse sp500, clear</a>
<a class="sourceLine" id="cb85-2" title="2"></a>
<a class="sourceLine" id="cb85-3" title="3">local scheme  s2color s2mono s2gcolor s2manual s2gmanual s1rcolor s1color <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-4" title="4"><span class="st">              </span>s1mono s1manual economist sj</a>
<a class="sourceLine" id="cb85-5" title="5"></a>
<a class="sourceLine" id="cb85-6" title="6">foreach s of local scheme {</a>
<a class="sourceLine" id="cb85-7" title="7">twoway  line close date, <span class="kw">yaxis</span>(<span class="dv">1</span>)                                           <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-8" title="8"><span class="st">        </span><span class="er">||</span><span class="st">  </span>spike change date, <span class="kw">yaxis</span>(<span class="dv">2</span>)                                     <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-9" title="9"><span class="st">        </span><span class="er">||</span>,  <span class="kw">ysca</span>(<span class="kw">axis</span>(<span class="dv">1</span>) <span class="kw">r</span>(<span class="dv">700</span>  <span class="dv">1400</span>)) <span class="kw">ylab</span>(<span class="dv">1000</span>(<span class="dv">100</span>)<span class="dv">1400</span>, <span class="kw">axis</span>(<span class="dv">1</span>))        <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-10" title="10"><span class="st">             </span><span class="kw">ysca</span>(<span class="kw">axis</span>(<span class="dv">2</span>) <span class="kw">r</span>(<span class="op">-</span><span class="dv">50</span> <span class="dv">300</span>))   <span class="kw">ylab</span>(<span class="op">-</span><span class="dv">50</span> <span class="dv">0</span> <span class="dv">50</span>, <span class="kw">axis</span>(<span class="dv">2</span>))             <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-11" title="11"><span class="st">             </span><span class="kw">ytick</span>(<span class="op">-</span><span class="dv">50</span>(<span class="dv">25</span>)<span class="dv">50</span>, <span class="kw">axis</span>(<span class="dv">2</span>) grid)                                 <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-12" title="12"><span class="st">                </span><span class="kw">legend</span>(off)                                                 <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-13" title="13"><span class="st">                </span><span class="kw">xtitle</span>(<span class="st">&quot;Date&quot;</span>)                                              <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-14" title="14"><span class="st">                </span><span class="kw">title</span>(<span class="st">&quot;S&amp;P 500&quot;</span>)                                            <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-15" title="15"><span class="st">                </span><span class="kw">subtitle</span>(<span class="st">&quot;Scheme = `s&#39;&quot;</span>)                                    <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb85-16" title="16"><span class="st">                </span><span class="kw">yline</span>(<span class="dv">950</span>, <span class="kw">axis</span>(<span class="dv">1</span>) <span class="kw">lc</span>(black)) <span class="kw">scheme</span>(<span class="st">`</span><span class="dt">s&#39;) name(</span><span class="st">`</span>s<span class="st">&#39;, replace) nodraw</span></a>
<a class="sourceLine" id="cb85-17" title="17"></a>
<a class="sourceLine" id="cb85-18" title="18"><span class="st">* graph combine ......                </span></a>
<a class="sourceLine" id="cb85-19" title="19"><span class="st">                </span></a>
<a class="sourceLine" id="cb85-20" title="20"><span class="st">}</span></a></code></pre></div>
<p><em>Graphique 43</em><br />
<img src="imgf/scheme1.png" /></p>
<p><em>Graphique 44</em><br />
<img src="imgf/scheme2.png" /></p>
<p><strong>Thèmes externes</strong></p>
<ul>
<li>Plusieurs thèmes et collection de thèmes externe sont instalables: <strong><code>search scheme</code></strong> <strong><code>ssc instal nom scheme</code></strong></li>
<li>Exemples: La collection de François Briatte (Burd) et la collection de Daniel Bischoff (plottig, plotplainblind…)…</li>
</ul>
<p><em>Graphique 45</em><br />
<img src="imgf/scheme3.png" /></p>
</div>
<div id="grstyle" class="section level2">
<h2><span class="header-section-number">4.5</span> grstyle</h2>
<ul>
<li>Auteur: Ben Jann</li>
<li>Autre générateur de thèmes: <strong>brewscheme</strong> de W.Buchanan, mais à mon sens beaucoup plus complexe</li>
<li>Ici utilisation minimale, par l’exemple de <strong>grstyle</strong> avec <strong><code>grstyle set</code></strong> avec seulement 4-5 lignes de paramètres réutilisables et facilement modificable avec seulement <strong><code>grstyle set</code></strong>.</li>
<li>Il est possible de générer un thème complet pour tous les types de graphiques</li>
<li>Pour voir l’ensemble des possibilités : <strong><code>help grstyle</code></strong> <strong><code>help grstyle set</code></strong></li>
</ul>
<p><strong>Installation <code>grstyle</code></strong></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1">    ssc install grstyle</a></code></pre></div>
</div>
<div id="initialisation-et-enregistrement" class="section level2">
<h2><span class="header-section-number">4.6</span> Initialisation et enregistrement</h2>
<ul>
<li>Dans un programme on initialise le générateur avec <strong><code>grstyle init</code></strong></li>
<li>Enregistrement du thème: <strong><code>grstyle init nom_thème, [path] [replace]</code></strong></li>
<li>Si le thème a été enregistré, on peut le charger dans un graphique avec scheme(nom_scheme). Visiblement on ne peut pas le charger à l’extérieur du graphique avec <strong><code>set scheme</code></strong></li>
</ul>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">set scheme t1, <span class="kw">path</span>(D<span class="op">:</span>\stata_temp) replace</a>
<a class="sourceLine" id="cb87-2" title="2">[grstyle set ....]</a>
<a class="sourceLine" id="cb87-3" title="3"></a>
<a class="sourceLine" id="cb87-4" title="4">tw line y x, <span class="kw">scheme</span>(t1)</a></code></pre></div>
</div>
<div id="exemple-1" class="section level2">
<h2><span class="header-section-number">4.7</span> Exemple 1</h2>
<p>Graphique proposé dans l’aide de <strong>line</strong>, légèrement simplifié</p>
<p>Avec le thème Stata <strong>s2color</strong></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1">sysuse uslifeexp, clear</a>
<a class="sourceLine" id="cb88-2" title="2">gen difference =<span class="st"> </span>le_wm <span class="op">-</span><span class="st"> </span>le_bm</a>
<a class="sourceLine" id="cb88-3" title="3"></a>
<a class="sourceLine" id="cb88-4" title="4"><span class="op">*</span>[graphique]</a>
<a class="sourceLine" id="cb88-5" title="5">tw line le_wm year, <span class="kw">yaxis</span>(<span class="dv">1</span> <span class="dv">2</span>)                                       <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-6" title="6"><span class="er">||</span><span class="st"> </span>line le_bm year                                                   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-7" title="7"><span class="er">||</span><span class="st"> </span>line diff  year                                                   <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-8" title="8"><span class="er">||</span><span class="st"> </span>lfit diff  year,                                                  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-9" title="9"><span class="st">             </span><span class="kw">ylabel</span>(<span class="dv">0</span>(<span class="dv">5</span>)<span class="dv">20</span>, <span class="kw">axis</span>(<span class="dv">2</span>) gmin )                           <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-10" title="10"><span class="st">             </span><span class="kw">ylabel</span>(<span class="dv">0</span> <span class="dv">20</span>(<span class="dv">10</span>)<span class="dv">80</span>,     gmax )                           <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-11" title="11"><span class="st">             </span><span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>, <span class="kw">axis</span>(<span class="dv">2</span>))                                     <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-12" title="12"><span class="st">             </span><span class="kw">ylabel</span>(, <span class="kw">axis</span>(<span class="dv">2</span>) grid)                                  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-13" title="13"><span class="st">             </span><span class="kw">ytitle</span>(<span class="st">&quot;Life expectancy at birth (years)&quot;</span>)              <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-14" title="14"><span class="st">             </span><span class="kw">title</span>(<span class="st">&quot;White and black life expectancy&quot;</span>)                <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-15" title="15"><span class="st">             </span><span class="kw">subtitle</span>(<span class="st">&quot;USA, 1900-1999&quot;</span>)                              <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-16" title="16"><span class="st">             </span><span class="kw">note</span>(<span class="st">&quot;Source: National Vital Statistics, Vol 50, No. 6&quot;</span> <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-17" title="17"><span class="st">                  &quot;(1918 dip caused by 1918 Influenza Pandemic)&quot;</span>)    <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb88-18" title="18"><span class="st">             </span><span class="kw">legend</span>(<span class="kw">label</span>(<span class="dv">1</span> <span class="st">&quot;White males&quot;</span>) <span class="kw">label</span>(<span class="dv">2</span> <span class="st">&quot;Black males&quot;</span>)) </a></code></pre></div>
<p><em>Graphique 46</em><br />
<img src="imgf/scheme4.png" style="width:50.0%" /></p>
<ul>
<li><strong>Background du graphique, grid…</strong>
<ul>
<li><strong>grstyle set plain [options]</strong></li>
<li><strong>grstyle set [i]mesh [options]</strong></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" title="1">grstyle init </a>
<a class="sourceLine" id="cb89-2" title="2"><span class="op">*</span><span class="st"> </span>grstyle set plain, horizontal grid  <span class="op">/</span><span class="er">/</span><span class="st"> </span>option dotted pour des pointillés sur le grid</a>
<a class="sourceLine" id="cb89-3" title="3"><span class="op">*</span><span class="st"> </span>grstyle set mesh, horizontal compact</a>
<a class="sourceLine" id="cb89-4" title="4"><span class="op">*</span><span class="st"> </span>grstyle set imesh, horizontal compact  minor</a></code></pre></div>
<p><em>Graphique 47</em><br />
<img src="imgf/scheme5.png" /></p>
<p>Pour la suite, on conservera comme paramètres la deuxième ligne: <strong><code>grstyle set mesh, horizontal compact</code></strong></p>
<ul>
<li><strong>Légende</strong>: position et box</li>
</ul>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1">grstyle init </a>
<a class="sourceLine" id="cb90-2" title="2">grstyle set mesh, horizontal compact</a>
<a class="sourceLine" id="cb90-3" title="3"></a>
<a class="sourceLine" id="cb90-4" title="4">grstyle set legend <span class="dv">2</span>, nobox</a></code></pre></div>
<p><em>Graphique 48</em><br />
<img src="imgf/scheme6.png" style="width:75.0%" /></p>
<ul>
<li><p><strong>Autres paramètres généraux</strong>: taille du graphique <strong><code>grstyle set graphsize</code></strong> et marges <strong><code>grstyle set margins</code></strong></p></li>
<li><strong>Paramètres sur les objets graphiques</strong>
<ul>
<li><strong>Couleurs</strong>: <strong><code>grstyle set color [options] [: type objet]</code></strong>
<ul>
<li>Plusieurs paramétrages possibles en définissant les objets pour lesquels la palette s’applique</li>
<li>Même syntaxe que colorpalette, la palette s’applique directement aux objets.</li>
<li>Les codes couleurs peuvent être directement appliqué au graphique sans utiliser les macros `rp(p#))<br />
</li>
<li><code>grstyle set color viridis, n(5)</code> = <code>colorpalette viridis, n(5)</code></li>
</ul></li>
</ul></li>
</ul>
<p><em>Graphique 49</em><br />
<img src="imgf/scheme7.png" style="width:75.0%" /></p>
<p><strong>Comparaisons s2color et mini thème généré par grstyle en 3 lignes</strong></p>
<p><em>Graphique 50</em><br />
<img src="imgf/scheme8.png" style="width:75.0%" /></p>
<ul>
<li><strong>Intervalles de confiance</strong>: permet d’appliquer directement aux intervalles de confiance présents dans le graphique. La coulmeur et le degré d’intensité peuvent être modifiés: <strong><code>grstyle set ci [couleur], [opacity()]</code></strong>.</li>
<li><strong>Autres</strong>: l’intensité des couleurs (également paramétrable avec les couleurs en général), tailles et épaisseurs, type de symbol (pour scatter, connected…), type de courbe (pour line, connected, spike…)</li>
</ul>
</div>
<div id="exemple-2" class="section level2">
<h2><span class="header-section-number">4.8</span> Exemple 2</h2>
<ul>
<li>Pour un graphique à première vue relativement simple (ici scatter + lfitci) le paramétrage devient assez gourmant</li>
<li>Passer ses options directement par les macros reste un méthode pertinente</li>
</ul>
<p><em>Graphique 51</em><br />
<img src="imgf/scheme9.png" style="width:75.0%" /></p>
<p><strong>Avec s2color</strong></p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1">set scheme s2color</a>
<a class="sourceLine" id="cb91-2" title="2"><span class="kw">tw</span> (lfitci price length <span class="cf">if</span> foreign)                         <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb91-3" title="3"><span class="st">   </span>(lfitci price length <span class="cf">if</span> <span class="op">!</span>foreign)                        <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb91-4" title="4"><span class="st">   </span>(scatter price length <span class="cf">if</span> foreign, <span class="kw">jitter</span>(<span class="dv">2</span>))             <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb91-5" title="5"><span class="st">   </span>(scatter price length <span class="cf">if</span> <span class="op">!</span>foreign, <span class="kw">jitter</span>(<span class="dv">2</span>)),           <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb91-6" title="6"><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">4</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">5</span> <span class="st">&quot;Foreign&quot;</span>)) <span class="kw">name</span>(g1,replace) <span class="op">/</span><span class="er">//</span></a></code></pre></div>
<p><strong>Avec grstyle seulement</strong></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1">grstyle init</a>
<a class="sourceLine" id="cb92-2" title="2">grstyle set mesh, horizontal compact</a>
<a class="sourceLine" id="cb92-3" title="3">grstyle set legend <span class="dv">5</span>, nobox inside</a>
<a class="sourceLine" id="cb92-4" title="4">grstyle set color hue, <span class="kw">n</span>(<span class="dv">2</span>) <span class="kw">opacity</span>(<span class="dv">80</span>) <span class="kw">plots</span>(<span class="dv">5</span> <span class="dv">6</span>)<span class="op">:</span><span class="st"> </span>p<span class="co">#markfill</span></a>
<a class="sourceLine" id="cb92-5" title="5">grstyle set color hue, <span class="kw">n</span>(<span class="dv">2</span>)             <span class="kw">plots</span>(<span class="dv">1</span> <span class="dv">3</span>)<span class="op">:</span><span class="st"> </span>p<span class="co">#lineplot</span></a>
<a class="sourceLine" id="cb92-6" title="6">grstyle set color black,                <span class="kw">plots</span>(<span class="dv">5</span> <span class="dv">6</span>)<span class="op">:</span><span class="st"> </span>p<span class="co">#markline</span></a>
<a class="sourceLine" id="cb92-7" title="7">grstyle set linewidth <span class="fl">.5</span>pt,             <span class="kw">plots</span>(<span class="dv">5</span> <span class="dv">6</span>)<span class="op">:</span><span class="st"> </span>p<span class="co">#mark</span></a>
<a class="sourceLine" id="cb92-8" title="8">grstyle set symbolsize 5pt</a>
<a class="sourceLine" id="cb92-9" title="9">grstyle set ci, <span class="kw">opacity</span>(<span class="dv">20</span>)</a>
<a class="sourceLine" id="cb92-10" title="10"></a>
<a class="sourceLine" id="cb92-11" title="11"><span class="kw">tw</span> (lfitci price length <span class="cf">if</span> foreign)                <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb92-12" title="12"><span class="st">   </span>(lfitci price length <span class="cf">if</span> <span class="op">!</span>foreign)               <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb92-13" title="13"><span class="st">   </span>(scatter price length <span class="cf">if</span> foreign, <span class="kw">jitter</span>(<span class="dv">2</span>))    <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb92-14" title="14"><span class="st">   </span>(scatter price length <span class="cf">if</span> <span class="op">!</span>foreign, <span class="kw">jitter</span>(<span class="dv">2</span>)),  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb92-15" title="15"><span class="st">   </span><span class="kw">legend</span>(<span class="kw">order</span>(<span class="dv">4</span> <span class="st">&quot;Domestic&quot;</span> <span class="dv">5</span> <span class="st">&quot;Foreign&quot;</span>)) </a></code></pre></div>
<p><strong>Grstyle + macro</strong></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1">grstyle init</a>
<a class="sourceLine" id="cb93-2" title="2">grstyle set mesh, horizontal compact</a>
<a class="sourceLine" id="cb93-3" title="3">grstyle set legend <span class="dv">5</span>, nobox inside</a>
<a class="sourceLine" id="cb93-4" title="4">grstyle set ci, <span class="kw">opacity</span>(<span class="dv">20</span>) </a>
<a class="sourceLine" id="cb93-5" title="5">     </a>
<a class="sourceLine" id="cb93-6" title="6">colorpalette hue, <span class="kw">n</span>(<span class="dv">2</span>) <span class="kw">opacity</span>(<span class="dv">80</span>) nograph</a>
<a class="sourceLine" id="cb93-7" title="7">local osca1 <span class="kw">mc</span>(<span class="st">&quot;`r(p1)&#39;&quot;</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">msiz</span>(5pt)</a>
<a class="sourceLine" id="cb93-8" title="8">local osca2 <span class="kw">mc</span>(<span class="st">&quot;`r(p2)&#39;&quot;</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vthin) <span class="kw">msiz</span>(5pt)   </a>
<a class="sourceLine" id="cb93-9" title="9"></a>
<a class="sourceLine" id="cb93-10" title="10">colorpalette hue, <span class="kw">n</span>(<span class="dv">2</span>)  nograph</a>
<a class="sourceLine" id="cb93-11" title="11"><span class="kw">tw</span> (lfitci  price length <span class="cf">if</span> foreign,  <span class="kw">clc</span>(<span class="st">&quot;`r(p1)&#39;&quot;</span>))     <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb93-12" title="12"><span class="st">   </span>(lfitci  price length <span class="cf">if</span> <span class="op">!</span>foreign, <span class="kw">clc</span>(<span class="st">&quot;`r(p2)&#39;&quot;</span>))     <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb93-13" title="13"><span class="st">   </span>(scatter price length <span class="cf">if</span> foreign,  <span class="kw">jitter</span>(<span class="dv">2</span>) <span class="st">`</span><span class="dt">osca1&#39;)  ///</span></a>
<a class="sourceLine" id="cb93-14" title="14"><span class="dt">   (scatter price length if !foreign, jitter(2) </span><span class="st">`</span>osca2<span class="st">&#39;), ///</span></a>
<a class="sourceLine" id="cb93-15" title="15"><span class="st">   legend(order(5 &quot;Domestic&quot; 6 &quot;Foreign&quot;))</span></a></code></pre></div>
</div>
<div id="application-shigoku-e-youkoso" class="section level2">
<h2><span class="header-section-number">4.9</span> Application: Shigoku e youkoso…</h2>
<p>… Welcome to hell</p>
<ul>
<li>Objectif: affecter une palette séquentielle à une aire (ici densité) les couleurs changeant pour chaque valeur de (x,y).</li>
<li><p>Données: Gapminder (à utiliser avec précaution). Les densités des espérances de vie calculées des pays, donc sur un nombre restreint très d’observations.</p></li>
<li><strong>Problèmes identifiés rapidement</strong>:</li>
<li>Comment appliquée une couleur aux valeurs de x (espérance de vie)
<ul>
<li>Impossible d’utiliser directement <code>rarea</code>, une seule couleur peut-être est appliquée à l’air</li>
<li>Solution : refaire l’aire à partir de droites (<em>spike</em> <strong><code>tw spike</code></strong>)</li>
<li>Appliquée une palette séquentielle sur chaque ligne du graphique</li>
<li>Faire concorder la palette à tous les points d’observations (années) qui ne débutent et ne finissent pas sur les mêmes valeurs</li>
</ul></li>
<li><strong>Problèmes rencontrés durant la programmation…et j’ai pas forcément compris pourquoi</strong>
<ul>
<li>Si on affecte une seule couleur au densités avec <strong><code>rarea</code></strong>, les graphiques pour les différentes années peuvent être générées directement en translatant les valeurs de Y (offset). Là, ça ne fonctionne visiblement pas avec <strong><code>rspike</code></strong>. Les différents graphiques ont du être combinés, ce qui augmente fortement le temps d’exécution.</li>
<li>La macro élargie pour générer les couleurs de transition ne comporte que des chaines de caractères (code rgb). Le premier code couleur n’a pas de double quotes…. et je ne comprend pa pourquoi. Le problème a été réglé sans faire appel à la raison.</li>
</ul></li>
</ul>
<p>Bref, c’est vraiment un peu l’enfer…et j’ai tout naturellement appliqué une palette de couleur adaptée: <strong>inferno</strong> (collection <em>viridis</em>)</p>
<p>L’idée est de présenter une visualisation différente du “treemap” généré plus haut avec python</p>
<p><strong>Treemap espérance de vie dans le monde en 2007</strong> [cf partie Python]</p>
<iframe width="800" height="600" src="imgf/g29.html">
</iframe>
<p><strong>Graphique</strong></p>
<p><em>Graphique 52</em><br />
<img src="imgf/g51.png" /></p>
<p><strong>Programme</strong></p>
<ul>
<li><strong>Partie 1</strong>: estimation des densités et points de transition des couleurs</li>
</ul>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1">use life_exp, clear</a>
<a class="sourceLine" id="cb94-2" title="2">keep <span class="cf">if</span> <span class="kw">inlist</span>(year,<span class="dv">1957</span>, <span class="dv">2007</span>)</a>
<a class="sourceLine" id="cb94-3" title="3"></a>
<a class="sourceLine" id="cb94-4" title="4">keep <span class="cf">if</span> continent<span class="op">!=</span><span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb94-5" title="5"></a>
<a class="sourceLine" id="cb94-6" title="6">local l <span class="dv">1957</span> <span class="dv">2007</span></a>
<a class="sourceLine" id="cb94-7" title="7">foreach i of local l {</a>
<a class="sourceLine" id="cb94-8" title="8">kdensity lifeexp <span class="cf">if</span>  year<span class="op">==</span><span class="st">`</span><span class="dt">i&#39;, gen(_x</span><span class="st">`</span>i<span class="st">&#39; _d`i&#39;</span><span class="er">)</span> nograph <span class="kw">bwidth</span>(<span class="dv">0</span>) <span class="kw">n</span>(<span class="dv">200</span>) <span class="kw">kernel</span>(gauss)</a>
<a class="sourceLine" id="cb94-9" title="9">gen x<span class="st">`</span><span class="dt">i&#39; = round(_x</span><span class="st">`</span>i<span class="st">&#39; - 28)</span></a>
<a class="sourceLine" id="cb94-10" title="10"><span class="st">}</span></a></code></pre></div>
<p>La première partie vise à générer les variables pour le graphique * les coordonnées (x,y) (espérance de vie, densité). On a pris 200 valeurs, pour cacher au maximun l’effet d’escalier * Les variables x1957 et x2007: * Elles vont permettre de générer une palette de couleurs de transition * On a besoin de valeurs entières pour utiliser les macros <code>r(p(#))</code> de colorpalette * On translate les valeurs pour démarrer la palette avec la macro <code>r(p1)</code></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1">    Variable <span class="op">|</span><span class="st">        </span>Obs        Mean    Std. Dev.       Min        Max</a>
<a class="sourceLine" id="cb95-2" title="2"><span class="op">-------------+---------------------------------------------------------</span></a>
<a class="sourceLine" id="cb95-3" title="3"><span class="st">       </span>x1957 <span class="op">|</span><span class="st">        </span><span class="dv">200</span>        <span class="fl">25.2</span>    <span class="fl">13.98923</span>          <span class="dv">1</span>         <span class="dv">49</span></a>
<a class="sourceLine" id="cb95-4" title="4">       x2007 <span class="op">|</span><span class="st">        </span><span class="dv">200</span>        <span class="fl">35.5</span>    <span class="fl">13.22059</span>         <span class="dv">13</span>         <span class="dv">58</span></a></code></pre></div>
<ul>
<li>La palette de transition à donc une longueur de 58
<ul>
<li>En 1957, la première couleur sera donc celle qui correspont à <code>r(p1)</code>, la dernière à <code>r(p49)</code></li>
<li>En 2007, la première couleur sera donc celle qui correspond à <code>r(p13)</code>, la dernière à <code>r(p58)</code></li>
</ul></li>
</ul>
<p><strong>Pourquoi autant de points de transition?</strong><br />
Si je prenais selement la couleur de départ (<code>r(p1)</code>: rgb=“0 0 4”) et la couleur d’arrivée d’arrivée(<code>r(p58)</code>: rgb=“252 255” “165”), ma palette finale sur 200 couleurs ne serait plus calée sur la palette inferno [voir plus bas].</p>
<ul>
<li><strong>Partie 2</strong>: la palette de transition</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1"><span class="op">**</span><span class="st"> </span><span class="dv">1957</span> <span class="op">**</span></a>
<a class="sourceLine" id="cb96-2" title="2">levelsof x1957, <span class="kw">local</span>(l)</a>
<a class="sourceLine" id="cb96-3" title="3">colorpalette plasma,  <span class="kw">n</span>(<span class="dv">58</span>)  nograph</a>
<a class="sourceLine" id="cb96-4" title="4">foreach l2 of local l {</a>
<a class="sourceLine" id="cb96-5" title="5">local c<span class="st">`</span><span class="dt">l2&#39;  &quot;</span><span class="st">`</span><span class="kw">r</span>(p<span class="st">`</span><span class="dt">l2&#39;)&#39;&quot; </span></a>
<a class="sourceLine" id="cb96-6" title="6"><span class="dt">local coul X </span><span class="st">`</span>coul<span class="st">&#39;   &quot;`c`l2&#39;&#39;&quot;</span></a>
<a class="sourceLine" id="cb96-7" title="7"><span class="st">}</span></a>
<a class="sourceLine" id="cb96-8" title="8"><span class="st">local z: subinstr local coul &quot;X&quot; &quot; &quot;, all</span></a></code></pre></div>
<ul>
<li>Pour récupérer les couleurs de transitions, on programme une macro élargie dans une boucle</li>
<li>Et c’est là qu’un mystère apparait, et c’est également là qu’on comprend la nécessité de toujours visualiser le contenu de ce genre de macro avec <strong><code>mac list _nom macro</code></strong>
<ul>
<li>Pour mettre à la suite les codes couleurs de la matrice de transition, normalement la macro devrait s’écrire:</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1">  <span class="st">`</span><span class="dt">local coul coul </span><span class="st">`</span>c<span class="st">`</span><span class="dt">l2&#39;&#39;&quot;</span><span class="st">`</span></a></code></pre></div>
<ul>
<li>Mais…. où sont <strong>passées les quotes de la première couleur (13 8 135)</strong>??????:</li>
</ul>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1">. mac list _coul</a>
<a class="sourceLine" id="cb98-2" title="2">_coul<span class="op">:</span><span class="st">          </span><span class="dv">13</span> <span class="dv">8</span> <span class="dv">135</span> <span class="st">&quot;26 6 140&quot;</span> <span class="st">&quot;36 6 145&quot;</span> <span class="st">&quot;45 5 148&quot;</span> <span class="st">&quot;53 4 152&quot;</span> <span class="st">&quot;60 4 155&quot;</span> <span class="st">&quot;68 3 158&quot;</span> <span class="st">&quot;75 3 161&quot;</span> <span class="st">&quot;83 2</span></a>
<a class="sourceLine" id="cb98-3" title="3"><span class="st">                163&quot;</span> <span class="st">&quot;90 1 165&quot;</span> <span class="st">&quot;97 0 166&quot;</span> <span class="st">&quot;104 0 168&quot;</span> <span class="st">&quot;111 0 168&quot;</span> <span class="st">&quot;117 1 168&quot;</span> <span class="st">&quot;124 2 168&quot;</span> <span class="st">&quot;131 5 167&quot;</span> <span class="st">&quot;137 9</span></a>
<a class="sourceLine" id="cb98-4" title="4"><span class="st">                166&quot;</span> <span class="st">&quot;144 13 164&quot;</span> <span class="st">&quot;150 18 161&quot;</span> <span class="st">&quot;156 23 158&quot;</span> <span class="st">&quot;162 28 155&quot;</span> <span class="st">&quot;167 33 151&quot;</span> <span class="st">&quot;173 38 147&quot;</span> <span class="st">&quot;178 43</span></a>
<a class="sourceLine" id="cb98-5" title="5"><span class="st">                143&quot;</span> <span class="st">&quot;183 48 139&quot;</span> <span class="st">&quot;188 53 135&quot;</span> <span class="st">&quot;192 58 131&quot;</span> <span class="st">&quot;197 63 126&quot;</span> <span class="st">&quot;201 68 122&quot;</span> <span class="st">&quot;205 73 118&quot;</span> <span class="st">&quot;209 78</span></a>
<a class="sourceLine" id="cb98-6" title="6"><span class="st">                114&quot;</span> <span class="st">&quot;213 84 110&quot;</span> <span class="st">&quot;217 89 106&quot;</span> <span class="st">&quot;221 94 102&quot;</span> <span class="st">&quot;224 99 98&quot;</span> <span class="st">&quot;227 104 95&quot;</span> <span class="st">&quot;231 110 91&quot;</span> <span class="st">&quot;234 115</span></a>
<a class="sourceLine" id="cb98-7" title="7"><span class="st">                87&quot;</span> <span class="st">&quot;237 121 83&quot;</span> <span class="st">&quot;239 126 79&quot;</span> <span class="st">&quot;242 132 75&quot;</span> <span class="st">&quot;244 138 72&quot;</span> <span class="st">&quot;246 144 68&quot;</span> <span class="st">&quot;248 150 64&quot;</span> <span class="st">&quot;250 156</span></a>
<a class="sourceLine" id="cb98-8" title="8"><span class="st">                60&quot;</span> <span class="st">&quot;251 162 56&quot;</span> <span class="st">&quot;252 169 52&quot;</span> <span class="st">&quot;253 176 49&quot;</span> <span class="st">&quot;254 182 45&quot;</span></a></code></pre></div>
<ul>
<li>Solution:
<ul>
<li>J’ai utilisée la fameuse technique du <em>“au point où j’en suis jen n’ai plus grand chose à perdre”</em>: j’ai donc ajouté une expression au début de la macro (ici la lettre c):</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1">    <span class="op">**</span><span class="st">`</span><span class="dt">local coul X </span><span class="st">`</span>coul<span class="st">&#39; &quot;`c`l2&#39;&#39;&quot;`**</span></a></code></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1">mac list _coul</a>
<a class="sourceLine" id="cb100-2" title="2">_coul<span class="op">:</span><span class="st">          </span>X X X X X X X X X X X [......] X X X X X X X X X X X <span class="st">&quot;13 8 135&quot;</span> <span class="st">&quot;26 6 140&quot;</span> <span class="st">&quot;36 6 145&quot;</span> <span class="st">&quot;45 5 148&quot;</span> <span class="st">&quot;53 4 152&quot;</span></a>
<a class="sourceLine" id="cb100-3" title="3">                <span class="st">&quot;60 4 155&quot;</span> <span class="st">&quot;68 3 158&quot;</span> <span class="st">&quot;75 3 161&quot;</span> <span class="st">&quot;83 2 163&quot;</span> <span class="st">&quot;90 1 165&quot;</span> <span class="st">&quot;97 0 166&quot;</span> <span class="st">&quot;104 0 168&quot;</span> <span class="st">&quot;111 0 168&quot;</span> <span class="st">&quot;117 1 168&quot;</span> </a>
<a class="sourceLine" id="cb100-4" title="4">                <span class="st">&quot;124 2 168&quot;</span> <span class="st">&quot;131 5 167&quot;</span> <span class="st">&quot;137 9 166&quot;</span> <span class="st">&quot;144 13 164&quot;</span> <span class="st">&quot;150 18 161&quot;</span> <span class="st">&quot;156 23 158&quot;</span> <span class="st">&quot;162 28 155&quot;</span> <span class="st">&quot;167 33 151&quot;</span></a>
<a class="sourceLine" id="cb100-5" title="5">                <span class="st">&quot;173 38 147&quot;</span> <span class="st">&quot;178 43 143&quot;</span> <span class="st">&quot;183 48 139&quot;</span> <span class="st">&quot;188 53 135&quot;</span> <span class="st">&quot;192 58 131&quot;</span> <span class="st">&quot;197 63 126&quot;</span> <span class="st">&quot;201 68 122&quot;</span> <span class="st">&quot;205 73 118&quot;</span></a>
<a class="sourceLine" id="cb100-6" title="6">                <span class="st">&quot;209 78 114&quot;</span> <span class="st">&quot;213 84 110&quot;</span> <span class="st">&quot;217 89 106&quot;</span> <span class="st">&quot;221 94 102&quot;</span> <span class="st">&quot;224 99 98&quot;</span> <span class="st">&quot;227 104 95&quot;</span> <span class="st">&quot;231 110 91&quot;</span> <span class="st">&quot;234 115 87&quot;</span></a>
<a class="sourceLine" id="cb100-7" title="7">                <span class="st">&quot;237 121 83&quot;</span> <span class="st">&quot;239 126 79&quot;</span> <span class="st">&quot;242 132 75&quot;</span> <span class="st">&quot;244 138 72&quot;</span> <span class="st">&quot;246 144 68&quot;</span> <span class="st">&quot;248 150 64&quot;</span> <span class="st">&quot;250 156 60&quot;</span> <span class="st">&quot;251 162 56&quot;</span></a>
<a class="sourceLine" id="cb100-8" title="8">                <span class="st">&quot;252 169 52&quot;</span> <span class="st">&quot;253 176 49&quot;</span> <span class="st">&quot;254 182 45&quot;</span></a></code></pre></div>
<ul>
<li>Les double quotes ont bien été remises pour le premier code couleur <strong>“13 8 135”</strong></li>
<li>Il ne reste plus qu’à se débarasser des X qui ont été généré par l’expression avec la fonction <strong><code>subinstr</code></strong>. Cette fonction permet de remplacer un caractère ou une chaîne de caractère par un.e autre: ici X (“X”) par une chaîne vide ("")</li>
</ul>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" title="1">local z<span class="op">:</span><span class="st"> </span>subinstr local coul <span class="st">&quot;X&quot;</span> <span class="st">&quot; &quot;</span>, all</a>
<a class="sourceLine" id="cb101-2" title="2">mac list _z</a>
<a class="sourceLine" id="cb101-3" title="3">_z<span class="op">:</span><span class="st">              &quot;13 8 135&quot;</span> <span class="st">&quot;26 6 140&quot;</span> <span class="st">&quot;36 6 145&quot;</span> <span class="st">&quot;45 5 148&quot;</span> <span class="st">&quot;53 4 152&quot;</span> <span class="st">&quot;60 4 155&quot;</span> <span class="st">&quot;68 3 158&quot;</span> <span class="st">&quot;75 3 161&quot;</span> <span class="st">&quot;83</span></a>
<a class="sourceLine" id="cb101-4" title="4"><span class="st">                2 163&quot;</span> <span class="st">&quot;90 1 165&quot;</span> <span class="st">&quot;97 0 166&quot;</span> <span class="st">&quot;104 0 168&quot;</span> <span class="st">&quot;111 0 168&quot;</span> <span class="st">&quot;117 1 168&quot;</span> <span class="st">&quot;124 2 168&quot;</span> <span class="st">&quot;131 5 167&quot;</span> <span class="st">&quot;137</span></a>
<a class="sourceLine" id="cb101-5" title="5"><span class="st">                9 166&quot;</span> <span class="st">&quot;144 13 164&quot;</span> <span class="st">&quot;150 18 161&quot;</span> <span class="st">&quot;156 23 158&quot;</span> <span class="st">&quot;162 28 155&quot;</span> <span class="st">&quot;167 33 151&quot;</span> <span class="st">&quot;173 38 147&quot;</span> <span class="st">&quot;178 43</span></a>
<a class="sourceLine" id="cb101-6" title="6"><span class="st">                143&quot;</span> <span class="st">&quot;183 48 139&quot;</span> <span class="st">&quot;188 53 135&quot;</span> <span class="st">&quot;192 58 131&quot;</span> <span class="st">&quot;197 63 126&quot;</span> <span class="st">&quot;201 68 122&quot;</span> <span class="st">&quot;205 73 118&quot;</span> <span class="st">&quot;209 78</span></a>
<a class="sourceLine" id="cb101-7" title="7"><span class="st">                114&quot;</span> <span class="st">&quot;213 84 110&quot;</span> <span class="st">&quot;217 89 106&quot;</span> <span class="st">&quot;221 94 102&quot;</span> <span class="st">&quot;224 99 98&quot;</span> <span class="st">&quot;227 104 95&quot;</span> <span class="st">&quot;231 110 91&quot;</span> <span class="st">&quot;234 115</span></a>
<a class="sourceLine" id="cb101-8" title="8"><span class="st">                87&quot;</span> <span class="st">&quot;237 121 83&quot;</span> <span class="st">&quot;239 126 79&quot;</span> <span class="st">&quot;242 132 75&quot;</span> <span class="st">&quot;244 138 72&quot;</span> <span class="st">&quot;246 144 68&quot;</span> <span class="st">&quot;248 150 64&quot;</span> <span class="st">&quot;250 156</span></a>
<a class="sourceLine" id="cb101-9" title="9"><span class="st">                60&quot;</span> <span class="st">&quot;251 162 56&quot;</span> <span class="st">&quot;252 169 52&quot;</span> <span class="st">&quot;253 176 49&quot;</span> <span class="st">&quot;254 182 45&quot;</span></a></code></pre></div>
<p><strong>Partie 3: le graphique</strong></p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1">grstyle init w57, replace </a>
<a class="sourceLine" id="cb102-2" title="2">grstyle set legend, nobox stack</a>
<a class="sourceLine" id="cb102-3" title="3">grstyle set mesh,  horizontal</a>
<a class="sourceLine" id="cb102-4" title="4">grstyle set color <span class="st">`</span><span class="dt">z&#39;, n(200)</span></a>
<a class="sourceLine" id="cb102-5" title="5"><span class="dt">forvalue i=1/200 {</span></a>
<a class="sourceLine" id="cb102-6" title="6"><span class="dt">local sp </span><span class="st">`</span>sp<span class="st">&#39; spike _d1957  _x1957 in `i&#39;</span>  <span class="cf">if</span> _x1957<span class="op">&gt;</span><span class="dv">30</span> <span class="op">&amp;</span><span class="st">  </span>_x1957<span class="op">&lt;</span><span class="dv">83</span>, <span class="kw">lw</span>(vthick) <span class="kw">lc</span>(<span class="st">&quot;`r(p`i&#39;)&#39;&quot;</span>) <span class="op">||</span></a>
<a class="sourceLine" id="cb102-7" title="7"><span class="er">}</span></a>
<a class="sourceLine" id="cb102-8" title="8">tw <span class="st">`</span><span class="dt">sp&#39;  , legend(order(1 &quot;30 ans&quot; 41 &quot;40 ans&quot; 81 &quot;50 ans&quot; 121 &quot;60 ans&quot; 161 &quot;70 ans&quot; 200 &quot;80 ans&quot;) pos(2) col(1)   /// </span></a>
<a class="sourceLine" id="cb102-9" title="9"><span class="dt">            xlabel(30(10)80) ylabel(0(.02).05, nogrid labc(%0))                                                     ///</span></a>
<a class="sourceLine" id="cb102-10" title="10"><span class="dt">            xtitle(&quot;Espérance de vie&quot;) ytitle(&quot;&quot;) title(&quot;1957&quot;, pos(11)) scheme(w57) save(w1, replace)             ///</span></a>
<a class="sourceLine" id="cb102-11" title="11"></a>
<a class="sourceLine" id="cb102-12" title="12"></a>
<a class="sourceLine" id="cb102-13" title="13"><span class="dt">** 2007 **</span></a>
<a class="sourceLine" id="cb102-14" title="14"><span class="dt">[Idem 2007]: on change la variable de la ligne levelsof... 2007 au lieu de 1957, et l&#39;année dans le titre [peut-être automatisé dans une boucle]</span></a>
<a class="sourceLine" id="cb102-15" title="15"></a>
<a class="sourceLine" id="cb102-16" title="16"><span class="dt">** Graphique combiné</span></a>
<a class="sourceLine" id="cb102-17" title="17"></a>
<a class="sourceLine" id="cb102-18" title="18"><span class="dt">grc1leg  w2 w1, col(1) xcommon ycommon xsize(15) ysize(20)                                   ///</span></a>
<a class="sourceLine" id="cb102-19" title="19"><span class="dt">         legendfrom(w1) pos(3)                                                               ///</span></a>
<a class="sourceLine" id="cb102-20" title="20"><span class="dt">         title(&quot;Monde&quot;, pos(11)) graphr(color(white)) scheme(w07 w57)</span></a></code></pre></div>
<ul>
<li>Pas de difficulté particulière pour le graphique:
<ul>
<li>On utilise la palette de transition pour générer 200 couleurs (nombre de coordonnées estimées avec <strong><code>kdensity</code></strong>) <strong><code>grstyle set color couleurs_de_transition, n(200)</code></strong><br />
</li>
<li>On génère 200 droites avec <em><code>spike</code></em>, en appliquant la couleur de l’option <em>lc()</em> avec l’expression de la macro <strong>r(p#)</strong></li>
<li>Pour la légende, je me suis contenté d’intervalles tous les 10 ans.</li>
<li>Je conseille de sauvegarder le graph en dur. J’ai eu des problème de mémoire en répétant l’exécution avec <strong><code>name()</code></strong></li>
</ul></li>
<li>Graphique combiné
<ul>
<li>Temps d’exécution forcément très long. J’espère quand m^me trouver une solution avec <strong><code>rspike</code></strong> prochainement</li>
<li>J’utilise la commande <strong><code>grc1leg</code></strong> pour reporter une seule légende comme elles sont communes aux deux graphiques</li>
</ul></li>
</ul>
<p><strong>Niveau continents</strong><br />
Encore quelques ajustement au niveau des axes, mais voici un rendu possible avec 4 années d’observation</p>
<p><em>Graphique 53</em><br />
<img src="imgf/g49.png" /></p>
<p><strong>Graphiques sans couleurs de transition</strong></p>
<p><em>Graphique 54</em><br />
Plus simple à programmer, car on a besoin seulement d’une couleur de départ et d’une couleur d’arrivée, la seconde partie du programme n’est pas nécessaire <img src="imgf/g54.png" /></p>
</div>
</div>
<div id="visualisation-des-données-avec-stata" class="section level1">
<h1><span class="header-section-number">5</span> Visualisation des données avec Stata</h1>
<p><strong>Principe de la section</strong>:</p>
<ul>
<li>Reprendre les principales représentations graphiques <a href="https://www.data-to-viz.com" class="uri">https://www.data-to-viz.com</a></li>
<li>Commande(s) Stata internes ou externes</li>
<li>Rappel sur des points de vigilance et limites, et lorsque c’est possibles les solutions ou les moyens de les contourner</li>
<li>Les Exemples programmés avec Stata s’appuient sur les visualisations du site <a href="https://www.data-to-viz.com" class="uri">https://www.data-to-viz.com</a>
<ul>
<li>Comparaison avec R [ggplot2]</li>
</ul></li>
<li>Une partie dédiée aux présentations des résultats de modélisation: effets marinaux, odds ratios, risk ratio</li>
</ul>
<p><strong>Liens sites Stata</strong> <strong>Stata sheet</strong>:<br />
<br> <strong>Galerie Sdas</strong> [programmes courts]: <a href="https://www.surveydesign.com.au/tipsgraphs.html" class="uri">https://www.surveydesign.com.au/tipsgraphs.html</a> <br> <strong>Galerie Maarten Buis</strong>: <a href="http://www.maartenbuis.nl/workshops/graphs_in_stata/workshop.html" class="uri">http://www.maartenbuis.nl/workshops/graphs_in_stata/workshop.html</a> <br> <strong>Site de Demetris Christodoulou</strong> [A utiliser]<br />
<a href="https://graphworkflow.com/" class="uri">https://graphworkflow.com/</a></p>
<ul>
<li>Partie dédiée à la sémiologie graphique</li>
<li>Galerie de graphique Stata
<ul>
<li>Explication des objectifs</li>
<li>Justification des choix</li>
<li>Mise à disposition du programme</li>
</ul></li>
</ul>
<div id="variables-continuesnumériques" class="section level2">
<h2><span class="header-section-number">5.1</span> Variables continues/numériques</h2>
<div id="histogrammes-et-densités" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Histogrammes et densités</h3>
<ul>
<li>Analyse des distributions: une ou plusieurs variables numériques ou une variable numérique par niveau d’une variable catégorielle</li>
<li>Vue de face</li>
<li>Limite: Nombre d’objets empilés sur un même graphique</li>
<li>Combinaison possible avec les visualisation vue de dessus (nuages - contourplot - heatplot) pour faire apparaitre les distributions marginales dans le graphique</li>
<li>Warning pour les histogrammes: la définition des bornes des peut différées d’un logiciel à l’autre, c’est le cas avec R (voir exemple ci-dessous)</li>
</ul>
<p><strong>Exemple</strong></p>
<p>Données:</p>
<ul>
<li>Prix des nuitées des logements proposés par “Airbnb” sur la côte d’Azur</li>
<li>N=10000</li>
<li>Exemple avec codes R: <a href="https://www.data-to-viz.com/story/OneNum.html" class="uri">https://www.data-to-viz.com/story/OneNum.html</a></li>
</ul>
<p><em>Histogramme</em></p>
<ul>
<li>Commande <code>histogram</code> si une variable ou <code>tw histogram</code> si plusieurs variables ou croisément dans un même graphique avec une variable catégorielle</li>
<li><strong><code>help histogram</code></strong></li>
</ul>
<p>Syntaxe avec 2 variables [graph non reporté]</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" title="1">tw histogram var1, <span class="kw">fc</span>(red) <span class="kw">lc</span>(red) <span class="op">||</span><span class="st"> </span>histogram var2, <span class="kw">fc</span>(blue) <span class="kw">lc</span>(red)</a></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1">clear</a>
<a class="sourceLine" id="cb104-2" title="2">import delimited <span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/1_OneNum.csv&quot;</span></a>
<a class="sourceLine" id="cb104-3" title="3"></a>
<a class="sourceLine" id="cb104-4" title="4"><span class="op">*</span><span class="st"> </span>intervalle=<span class="dv">10</span> =<span class="er">&gt;</span><span class="st"> </span>ici intervalles par défaut</a>
<a class="sourceLine" id="cb104-5" title="5">sort price</a>
<a class="sourceLine" id="cb104-6" title="6">tw histogram price2 <span class="cf">if</span> price2<span class="op">&lt;</span><span class="dv">300</span>, freq <span class="kw">fc</span>(<span class="st">&quot;105 179 162%80&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;233 236 239&quot;</span>) <span class="kw">lw</span>(vvthin)  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb104-7" title="7"><span class="kw">title</span>(<span class="st">&quot;{bf:Night price distribution of Airbnb appartements}&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>))                      <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb104-8" title="8"><span class="kw">start</span>(<span class="dv">0</span>) <span class="kw">width</span>(<span class="dv">10</span>)  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb104-9" title="9"><span class="kw">xlabel</span>(<span class="dv">0</span>(<span class="dv">50</span>)<span class="dv">300</span>)    <span class="op">/</span><span class="er">//</span><span class="st">  </span></a>
<a class="sourceLine" id="cb104-10" title="10"><span class="kw">ylabel</span>(<span class="dv">0</span>(<span class="dv">250</span>)<span class="dv">800</span>) </a></code></pre></div>
<p><em>Graphique 55</em><br />
<img src="imgf/g55.png" style="width:50.0%" /></p>
<p>Avec ggplot (R)</p>
<p><em>Graphique 56</em><br />
<img src="imgf/g56.png" style="width:50.0%" /></p>
<p>La définition des bornes des intervalles n’est donc pas la même: <strong>Stata</strong> <span class="math inline">\([lb;ub[\)</span> et <strong>R</strong> <span class="math inline">\(]lb;ub]\)</span>.<br />
Pour obtenir le même histogramme: <code>gen price2 = price - 1</code></p>
<p><em>Graphique 57</em><br />
<img src="imgf/g57.png" style="width:50.0%" /></p>
<p><em>Densité</em></p>
<ul>
<li>Commande <strong><code>kdensity</code></strong> [interne] <strong><code>kdens</code></strong> [externe - Ben Jann] pour tracer une courbe seulement</li>
<li>Pour reporter une aire on génère les coordonnées sous forme de variables avec l’option <code>gen(x d)</code> et on utilise les graphiques type <strong><code>area</code></strong> ou <strong><code>rarea</code></strong></li>
<li>options principales
<ul>
<li><strong><code>kernel()</code></strong> pour le type de smoothing.</li>
<li><strong><code>bw(#)</code></strong> pour le fenêtrage. Préférer <code>kernel(gauss)</code> pour un bon rendu.</li>
<li><strong><code>n(#)</code></strong> pour le nombre de coordonnées générées.</li>
<li><strong><code>nograph</code></strong> pour une densité sous forme d’aire, et gagner du temps d’exécution</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" title="1">capt drop d x</a>
<a class="sourceLine" id="cb105-2" title="2">kdensity price <span class="cf">if</span> price<span class="op">&lt;</span><span class="dv">300</span>, <span class="kw">gen</span>(x d) nogr</a>
<a class="sourceLine" id="cb105-3" title="3">tw area  d x,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%90&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb105-4" title="4"><span class="st">   </span><span class="kw">title</span>(<span class="st">&quot;Par défaut&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>) <span class="kw">size</span>(medium))  <span class="kw">name</span>(g1,replace) nodraw</a>
<a class="sourceLine" id="cb105-5" title="5"></a>
<a class="sourceLine" id="cb105-6" title="6">capt drop d x</a>
<a class="sourceLine" id="cb105-7" title="7">kdensity price <span class="cf">if</span> price<span class="op">&lt;</span><span class="dv">300</span>, <span class="kw">gen</span>(x d) nogr <span class="kw">kernel</span>(gauss) </a>
<a class="sourceLine" id="cb105-8" title="8">tw area  d x,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%90&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb105-9" title="9"><span class="st">   </span><span class="kw">title</span>(<span class="st">&quot;kernel(gauss)&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>) <span class="kw">size</span>(medium)) <span class="kw">name</span>(g2,replace) nodraw</a>
<a class="sourceLine" id="cb105-10" title="10"></a>
<a class="sourceLine" id="cb105-11" title="11">capt drop d x</a>
<a class="sourceLine" id="cb105-12" title="12">kdensity price <span class="cf">if</span> price<span class="op">&lt;</span><span class="dv">300</span>, <span class="kw">gen</span>(x d) nogr <span class="kw">kernel</span>(gauss) <span class="kw">n</span>(<span class="dv">200</span>) </a>
<a class="sourceLine" id="cb105-13" title="13">tw area  d x,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%90&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb105-14" title="14"><span class="st">   </span><span class="kw">title</span>(<span class="st">&quot;kernel(gauss) + n(200)&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>) <span class="kw">size</span>(medium)) <span class="kw">name</span>(g3,replace) nodraw</a>
<a class="sourceLine" id="cb105-15" title="15"></a>
<a class="sourceLine" id="cb105-16" title="16">capt drop d x</a>
<a class="sourceLine" id="cb105-17" title="17">kdensity price <span class="cf">if</span> price<span class="op">&lt;</span><span class="dv">300</span>, <span class="kw">gen</span>(x d) nogr <span class="kw">kernel</span>(gauss) <span class="kw">bw</span>(<span class="dv">10</span>) <span class="kw">n</span>(<span class="dv">200</span>) </a>
<a class="sourceLine" id="cb105-18" title="18">tw area  d x,  <span class="kw">fc</span>(<span class="st">&quot;105 179 162%90&quot;</span>) <span class="kw">lc</span>(<span class="st">&quot;black&quot;</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb105-19" title="19"><span class="kw">title</span>(<span class="st">&quot;kernel(gauss) + n(200) + bw(10)&quot;</span>, <span class="kw">pos</span>(<span class="dv">11</span>) <span class="kw">size</span>(medium)) <span class="kw">name</span>(g4,replace) nodraw</a>
<a class="sourceLine" id="cb105-20" title="20"></a>
<a class="sourceLine" id="cb105-21" title="21">graph combine g1 g2 g3 g4</a></code></pre></div>
<p><em>Graphique 58</em><br />
<img src="imgf/g58.png" style="width:75.0%" /></p>
</div>
<div id="boxplot-et-violin-plot" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Boxplot et violin plot</h3>
<p><strong>Boxplot</strong></p>
<ul>
<li>Commande <strong><code>graph box</code></strong>. La syntaxe peut s’avérer pénible avec, au final, de grosses limitations (voir application plus bas)
<ul>
<li>Pour changer les options des box [sans l’option <code>over</code>]: <strong><code>box(1, options) box(2, options)...</code></strong></li>
<li>Pour changer les options des markers (outliers) [sans l’option <code>over</code>]: <strong><code>m(1, options) m(2, options)...</code></strong></li>
<li>Sans l’option <code>over()</code> impossible de passer le libellé des box sur un axe (obligatoirement une légende)</li>
<li>Avec l’option <code>over()</code> les options <code>box(#,..)</code>* et *<code>marker(#,...). Aller savoir pourquoi. On peut de nouveau appliquer des couleurs différentes recréant des vartiables avec **</code>separate`**….lourd</li>
<li>Graphique de type oneway, on ne peut pas superposer d’autres information via un autre objet graphique</li>
</ul></li>
<li>Analyse des distributions: une ou plusieurs variables numériques ou une variable numérique par niveau d’une variable catégorielle</li>
<li><p>Résume la distribution de la variable numérique: Quartiles (la boite - box) - limites jusqu’à outliers (moustaches - whiskers) - outliers reportés par un nuage (option)</p></li>
<li>Limites:
<ul>
<li>Ne permet pas de visualiser la forme de la distribution (unimodale, multimodale…)</li>
<li>Ne permet pas de visualiser si les différences d’effectifs</li>
</ul></li>
<li>Si deux variables, combinaison possible avec une visualisation vue de haut (<em>nuages</em> - <em>contourplot</em> - <em>heatplot</em>) pour regarder les distributions marginales dans le graphique</li>
<li>Amélioration de la box: retrait au niveau de la valeur médiane pour mieux la faire apparaître (<em>notches</em>): Non implémenté dans Stata</li>
<li><p>Ajout d’un nuage de point, d’un histogramme ou de spike pour vizualiser les distributions et les tailles des effectifs : Non implémenté dans Stata, mais on peut passer par des graphiques combiné Voir l’exemple ci-dessous</p></li>
</ul>
<p><strong>Exemple</strong></p>
<ul>
<li>Voir <a href="https://www.data-to-viz.com/caveat/boxplot.html" class="uri">https://www.data-to-viz.com/caveat/boxplot.html</a></li>
<li>Données: 4 variables générées aléatoirement</li>
<li>On utilisera la palette de couleur <strong>Spectral</strong> (collection <em>colorbrewer</em>)</li>
</ul>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1">clear</a>
<a class="sourceLine" id="cb106-2" title="2">set obs <span class="dv">1000</span></a>
<a class="sourceLine" id="cb106-3" title="3"></a>
<a class="sourceLine" id="cb106-4" title="4">gen A =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">10</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb106-5" title="5">gen B =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">13</span>,<span class="dv">1</span>) <span class="cf">in</span> <span class="dv">1</span><span class="op">/</span><span class="dv">500</span></a>
<a class="sourceLine" id="cb106-6" title="6">replace B =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">18</span>,<span class="dv">1</span>) <span class="cf">in</span> <span class="dv">501</span><span class="op">/</span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb106-7" title="7">gen C =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">25</span>,<span class="dv">5</span>) <span class="cf">in</span> <span class="dv">1</span><span class="op">/</span><span class="dv">20</span></a>
<a class="sourceLine" id="cb106-8" title="8">gen D =<span class="st"> </span><span class="kw">rnormal</span>(<span class="dv">12</span>,<span class="dv">2</span>) <span class="cf">in</span> <span class="dv">1</span><span class="op">/</span><span class="dv">100</span></a>
<a class="sourceLine" id="cb106-9" title="9"></a>
<a class="sourceLine" id="cb106-10" title="10">grstyle init</a>
<a class="sourceLine" id="cb106-11" title="11">grstyle set mesh, compact </a>
<a class="sourceLine" id="cb106-12" title="12">grstyle set legend <span class="dv">6</span>, nobox</a></code></pre></div>
<p><em>Box plot</em></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1">local varlist A B C D</a>
<a class="sourceLine" id="cb107-2" title="2">colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph </a>
<a class="sourceLine" id="cb107-3" title="3">forvalue i=<span class="dv">1</span><span class="op">/</span><span class="dv">4</span> {</a>
<a class="sourceLine" id="cb107-4" title="4">local box <span class="st">`</span><span class="dt">box&#39; box(</span><span class="st">`</span>i<span class="st">&#39;, fc(&quot;`r(p`i&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) lc(black) lw(vthin)) m(`i&#39;</span>, <span class="kw">mc</span>(<span class="st">&quot;`r(p`i&#39;)&#39;&quot;</span>) <span class="kw">mlw</span>(vthin) <span class="kw">mlc</span>(black) <span class="kw">msiz</span>(vsmall)<span class="er">)</span></a>
<a class="sourceLine" id="cb107-5" title="5">} </a>
<a class="sourceLine" id="cb107-6" title="6">graph box <span class="st">`</span><span class="dt">varlist&#39; , </span><span class="st">`</span>box<span class="st">&#39; legend(col(4))  name(g1,replace) </span></a></code></pre></div>
<p><em>Graphique 59</em><br />
<img src="imgf/g64.png" style="width:75.0%" /></p>
<ul>
<li>Avantage: résume bien l’information niveau quantiles et présence potentielle d’outliers</li>
<li>Limite: pas d’information sur la forme des distributions et la taille des effectifs</li>
</ul>
<p><em>Box plot + Histogramme</em></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">local k=<span class="dv">1</span></a>
<a class="sourceLine" id="cb108-2" title="2"><span class="op">*</span><span class="st"> </span>local varlist A B C D</a>
<a class="sourceLine" id="cb108-3" title="3">foreach v of local varlist {</a>
<a class="sourceLine" id="cb108-4" title="4">colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph </a>
<a class="sourceLine" id="cb108-5" title="5">local j=<span class="st">`</span><span class="dt">k++&#39;</span></a>
<a class="sourceLine" id="cb108-6" title="6"><span class="dt">tw histogram </span><span class="st">`</span>v<span class="st">&#39;, xlabel(,nogrid) ylabel(0(.05).25) xtitle(&quot;&quot;) ytitle(&quot;&quot;) ///</span></a>
<a class="sourceLine" id="cb108-7" title="7"><span class="st">fc(&quot;`r(p`j&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) lc(&quot;`r(p`j&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) name(`v&#39;</span>, replace<span class="er">)</span> nodraw</a>
<a class="sourceLine" id="cb108-8" title="8">} </a>
<a class="sourceLine" id="cb108-9" title="9"></a>
<a class="sourceLine" id="cb108-10" title="10">graph combine <span class="st">`</span><span class="dt">varlist&#39;, col(4) name(g2,replace) ysize(10) xsize(20)</span></a>
<a class="sourceLine" id="cb108-11" title="11"><span class="dt">graph combine g1 g2, col(1) ysize(20) xsize(20)</span></a></code></pre></div>
<p><em>Graphique 60</em><br />
<img src="imgf/g65.png" style="width:75.0%" /></p>
<ul>
<li><strong>Avantage</strong>: la variable B apparaît bien comme bimodale, la largeur des barres permet de visualiser la taille des effectifs, par exemple faible pour la variable B</li>
<li><strong>Limite</strong>: la commande <code>histogram</code> ne permet pas de mettre l’histogramme à l’horizontal….balot</li>
</ul>
<p><em>Box plot + scatter</em></p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1">capt drop y</a>
<a class="sourceLine" id="cb109-2" title="2">gen y =<span class="st"> </span><span class="kw">runiform</span>(<span class="dv">400</span>,<span class="dv">600</span>)</a>
<a class="sourceLine" id="cb109-3" title="3"></a>
<a class="sourceLine" id="cb109-4" title="4">local k=<span class="dv">1</span></a>
<a class="sourceLine" id="cb109-5" title="5"><span class="op">*</span>local varlist A B C D</a>
<a class="sourceLine" id="cb109-6" title="6">foreach v of local varlist {</a>
<a class="sourceLine" id="cb109-7" title="7">colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph </a>
<a class="sourceLine" id="cb109-8" title="8">local j=<span class="st">`</span><span class="dt">k++&#39;</span></a>
<a class="sourceLine" id="cb109-9" title="9"><span class="dt">tw scatter   </span><span class="st">`</span>v<span class="st">&#39;  y,  xlabel(200(200)800) ylabel(-10(10)40) xlabel(,nogrid labc(%0))  xtitle(&quot;&quot;) ytitle(&quot;&quot;) jitter(1) ///</span></a>
<a class="sourceLine" id="cb109-10" title="10"><span class="st">mc(&quot;`r(p`j&#39;</span><span class="er">)</span><span class="st">&#39;&quot;)  mlw(vvthin) msiz(tiny) name(`v&#39;</span><span class="dv">2</span>, replace<span class="er">)</span> nodraw</a>
<a class="sourceLine" id="cb109-11" title="11">}</a>
<a class="sourceLine" id="cb109-12" title="12"></a>
<a class="sourceLine" id="cb109-13" title="13">graph combine A2 B2 C2 D2 , <span class="kw">col</span>(<span class="dv">4</span>) <span class="kw">name</span>(g3,replace) </a>
<a class="sourceLine" id="cb109-14" title="14">graph combine g1 g3, <span class="kw">col</span>(<span class="dv">1</span>) <span class="kw">ysize</span>(<span class="dv">20</span>) <span class="kw">xsize</span>(<span class="dv">20</span>)</a></code></pre></div>
<p><em>Graphique 61</em><br />
<img src="imgf/g66.png" style="width:75.0%" /></p>
<ul>
<li><strong>Avantages</strong>:
<ul>
<li>Idem qu’avac les histogrammes, on peut visualiser la bimodalité de B et les différences d’effectifs</li>
<li>lecture dans le même sens que les box</li>
</ul></li>
<li><strong>Limites/à prévoir</strong>:
<ul>
<li>Couleurs vraiment nécessaires???</li>
<li>Prévoir un nuage sur un sous-échantillon (problème d’overplotting). C’est limite pour les variables A et B</li>
</ul></li>
</ul>
<p><em>Box plot + spike</em> [variante du nuage]</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1">local k=<span class="dv">1</span></a>
<a class="sourceLine" id="cb110-2" title="2"><span class="op">*</span><span class="st"> </span>local varlist A B C D</a>
<a class="sourceLine" id="cb110-3" title="3">foreach v of local varlist {</a>
<a class="sourceLine" id="cb110-4" title="4">colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph <span class="kw">intensity</span>(<span class="dv">1</span>) </a>
<a class="sourceLine" id="cb110-5" title="5">local j=<span class="st">`</span><span class="dt">k++&#39;</span></a>
<a class="sourceLine" id="cb110-6" title="6"><span class="dt">spikeplot </span><span class="st">`</span>v<span class="st">&#39; ,  horizontal lc(&quot;`r(p`j&#39;</span><span class="er">)</span><span class="st">&#39;&quot;) lw(vvthin) ///</span></a>
<a class="sourceLine" id="cb110-7" title="7"><span class="st">xlabel(0 1, labc(%0)) ylabel(-10(10)40) ytitle(&quot;&quot;) name(`v&#39;</span><span class="dv">3</span>, replace<span class="er">)</span> nodraw</a>
<a class="sourceLine" id="cb110-8" title="8">}</a>
<a class="sourceLine" id="cb110-9" title="9"></a>
<a class="sourceLine" id="cb110-10" title="10">graph combine A3 B3 C3 D3 , <span class="kw">col</span>(<span class="dv">4</span>) <span class="kw">name</span>(g4,replace) </a>
<a class="sourceLine" id="cb110-11" title="11">graph combine g1 g4, <span class="kw">col</span>(<span class="dv">1</span>) <span class="kw">ysize</span>(<span class="dv">20</span>) <span class="kw">xsize</span>(<span class="dv">20</span>)</a></code></pre></div>
<p><em>Graphique 62</em><br />
<img src="imgf/g67.png" style="width:75.0%" /></p>
<p><strong>Avantages</strong> et <strong>limites</strong> identiques que pour le nuage de points</p>
<p><strong>Violin plot</strong></p>
<p>Le graphique de type <em>violon</em> ajoute aux box plot un graphique de type aire représentant la densité d’une variable</p>
<ul>
<li>Seulement une commande externe <strong><code>vioplot</code></strong> de <strong>Nick Winter</strong> [<strong><code>ssc install vioplot</code></strong>]
<ul>
<li>On garde la main sur l’estimation de la densité avec les option <code>bw()</code> <code>kernel()</code> et <code>n()</code></li>
<li>Les échelles de la densité sont standardisée: affecte le rendu, et donc différence avec des fonctions issues d’autres logiciels. Ce n’est pas forcément une critique, mais il faut le savoir</li>
</ul></li>
<li>Principe du violon: Densité reportée en mirroir + boxplot</li>
<li>Si seulement les densités: <strong>bean plot</strong></li>
<li>Combinaison possible avec les visualisation de haut (nuages - contourplot - heatplot) pour faire apparaitre les distributions marginales dans le graphique</li>
<li>Pas dans la commande <code>vioplot</code>
<ul>
<li>Ajout de jitters ou d’un histogramme sur des intervalles très fins pour faire apparaître les sample size. On peut représenter un demi violon d’un côté et un histogramme de l’autre</li>
<li>Voir le dernier exemple de la section <strong>macro</strong> pour visualiser une variante, croisant 2 valeurs d’une variable catégorielle (pas possible avec vioplot) sur 2 demi violon</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1">grstyle init v, replace</a>
<a class="sourceLine" id="cb111-2" title="2">grstyle set mesh, compact </a>
<a class="sourceLine" id="cb111-3" title="3">grstyle set legend <span class="dv">6</span>, nobox</a>
<a class="sourceLine" id="cb111-4" title="4">grstyle set color Spectral, <span class="kw">n</span>(<span class="dv">4</span>)</a>
<a class="sourceLine" id="cb111-5" title="5"></a>
<a class="sourceLine" id="cb111-6" title="6">local k=<span class="dv">1</span></a>
<a class="sourceLine" id="cb111-7" title="7">local varlist A B C D</a>
<a class="sourceLine" id="cb111-8" title="8">foreach v of local varlist {</a>
<a class="sourceLine" id="cb111-9" title="9"><span class="op">**</span>colorpalette Spectral, <span class="kw">n</span>(<span class="dv">4</span>) nograph </a>
<a class="sourceLine" id="cb111-10" title="10">local j=<span class="st">`</span><span class="dt">k++&#39;</span></a>
<a class="sourceLine" id="cb111-11" title="11"><span class="dt">tw scatter   </span><span class="st">`</span>v<span class="st">&#39;  y,  xlabel(200(200)800) ylabel(-10(10)40) xlabel(,nogrid labc(%0)) ///</span></a>
<a class="sourceLine" id="cb111-12" title="12"><span class="st">   xtitle(&quot;&quot;) ytitle(&quot;&quot;) jitter(1)  mc(black)  mlw(vvthin) msiz(tiny) name(`v&#39;</span><span class="dv">4</span>, replace<span class="er">)</span> nodraw</a>
<a class="sourceLine" id="cb111-13" title="13">}</a>
<a class="sourceLine" id="cb111-14" title="14">graph combine A4 B4 C4 D4 , <span class="kw">col</span>(<span class="dv">4</span>) <span class="kw">name</span>(g5,replace)</a>
<a class="sourceLine" id="cb111-15" title="15"></a>
<a class="sourceLine" id="cb111-16" title="16">vioplot A B C D, <span class="kw">kernel</span>(gauss) <span class="kw">ygap</span>(<span class="dv">120</span>) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb111-17" title="17"><span class="kw">median</span>(<span class="kw">m</span>(pipe) <span class="kw">msa</span>(<span class="dv">90</span>) <span class="kw">mc</span>(white) <span class="kw">mlw</span>(vvthin))  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb111-18" title="18"><span class="kw">density</span>(<span class="kw">lc</span>(black) <span class="kw">lw</span>(vthin))  <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb111-19" title="19"><span class="kw">scheme</span>(v) <span class="kw">name</span>(g6,replace)</a>
<a class="sourceLine" id="cb111-20" title="20"></a>
<a class="sourceLine" id="cb111-21" title="21">graph combine  g6 g5, <span class="kw">col</span>(<span class="dv">1</span>)</a></code></pre></div>
<p><em>Graphique 63</em><br />
<img src="imgf/g68.png" style="width:75.0%" /></p>
<p>Ici on a ajouté le nuage en couleur noir, bien plus lisible pour les deux variables avec petit nombre d’observations</p>
<p><strong>Application Densités - Box Plot - Violin (bean) plot avec plusieurs variables (17)</strong></p>
<p><em>Comment représenter un nombre important de densités (ou histogramme) sur un même graphique [densité - box plot - violin plot - ridge line]</em></p>
<p><em>Données</em>: Question posée sur un forum de <em>Reddit</em> (N=49): quelle probabilité vous affectez à des expressions telles que “almostnochance” “unlikely” “abouteven” “probably” “almostcertainly”….En tout 17 expressions. La base comporte 17 variables (les expressions) et 46 observations.</p>
<p>Application données par le site <strong>data to viz</strong>. Code R disponible: <a href="https://www.data-to-viz.com/caveat/multi_distribution.html" class="uri">https://www.data-to-viz.com/caveat/multi_distribution.html</a></p>
<p><em>Préparation des données</em></p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">clear</a>
<a class="sourceLine" id="cb112-2" title="2">import delimited <span class="st">&quot;https://raw.githubusercontent.com/zonination/perceptions/master/probly.csv&quot;</span> </a>
<a class="sourceLine" id="cb112-3" title="3"></a>
<a class="sourceLine" id="cb112-4" title="4">set obs <span class="st">`</span><span class="dt">=_N+200&#39;</span></a>
<a class="sourceLine" id="cb112-5" title="5"></a>
<a class="sourceLine" id="cb112-6" title="6"><span class="dt">order almostnochance highlyunlikely chancesareslight improbable /// </span></a>
<a class="sourceLine" id="cb112-7" title="7"><span class="dt">      littlechance unlikely wedoubt probablynot abouteven betterthaneven ///</span></a>
<a class="sourceLine" id="cb112-8" title="8"><span class="dt">      likely probable webelieve probably verygoodchance highlylikely almostcertainly</span></a>
<a class="sourceLine" id="cb112-9" title="9"></a>
<a class="sourceLine" id="cb112-10" title="10"><span class="dt">qui ds    </span></a>
<a class="sourceLine" id="cb112-11" title="11"><span class="dt">local varlist </span><span class="st">`</span><span class="kw">r</span>(varlist)<span class="st">&#39;</span></a>
<a class="sourceLine" id="cb112-12" title="12"><span class="st">*local varlist almostnochance unlikely abouteven probable almostcertainly</span></a>
<a class="sourceLine" id="cb112-13" title="13"></a>
<a class="sourceLine" id="cb112-14" title="14"><span class="st">sum `varlist&#39;</span></a>
<a class="sourceLine" id="cb112-15" title="15"></a>
<a class="sourceLine" id="cb112-16" title="16">  Variable <span class="op">|</span><span class="st">        </span>Obs        Mean    Std. Dev.       Min        Max</a>
<a class="sourceLine" id="cb112-17" title="17"><span class="op">-------------+---------------------------------------------------------</span></a>
<a class="sourceLine" id="cb112-18" title="18">almostnoch<span class="op">~</span>e <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">5.631522</span>    <span class="fl">13.81477</span>        <span class="fl">.05</span>         <span class="dv">95</span></a>
<a class="sourceLine" id="cb112-19" title="19">highlyunli<span class="op">~</span>y <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">10.13043</span>      <span class="fl">13.523</span>          <span class="dv">2</span>         <span class="dv">90</span></a>
<a class="sourceLine" id="cb112-20" title="20">chancesare<span class="op">~</span>t <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">14.08696</span>    <span class="fl">8.948808</span>          <span class="dv">5</span>         <span class="dv">40</span></a>
<a class="sourceLine" id="cb112-21" title="21">  improbable <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">18.02176</span>    <span class="fl">14.38436</span>          <span class="dv">0</span>         <span class="dv">50</span></a>
<a class="sourceLine" id="cb112-22" title="22">littlechance <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">15.97826</span>    <span class="fl">14.32091</span>          <span class="dv">2</span>        <span class="dv">100</span></a>
<a class="sourceLine" id="cb112-23" title="23"><span class="op">-------------+---------------------------------------------------------</span></a>
<a class="sourceLine" id="cb112-24" title="24"><span class="st">    </span>unlikely <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">19.93478</span>    <span class="fl">10.04745</span>          <span class="dv">2</span>         <span class="dv">36</span></a>
<a class="sourceLine" id="cb112-25" title="25">     wedoubt <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">27.86957</span>    <span class="fl">20.17546</span>          <span class="dv">1</span>        <span class="dv">100</span></a>
<a class="sourceLine" id="cb112-26" title="26"> probablynot <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">29.47609</span>    <span class="fl">14.85888</span>         <span class="dv">10</span>        <span class="dv">100</span></a>
<a class="sourceLine" id="cb112-27" title="27">   abouteven <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">49.56522</span>    <span class="fl">1.857743</span>         <span class="dv">40</span>         <span class="dv">52</span></a>
<a class="sourceLine" id="cb112-28" title="28">betterthan<span class="op">~</span>n <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">58.39348</span>    <span class="fl">11.78821</span>          <span class="dv">5</span>         <span class="dv">98</span></a>
<a class="sourceLine" id="cb112-29" title="29"><span class="op">-------------+---------------------------------------------------------</span></a>
<a class="sourceLine" id="cb112-30" title="30"><span class="st">      </span>likely <span class="op">|</span><span class="st">         </span><span class="dv">46</span>          <span class="dv">72</span>    <span class="fl">9.874771</span>         <span class="dv">40</span>         <span class="dv">90</span></a>
<a class="sourceLine" id="cb112-31" title="31">    probable <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">71.45652</span>    <span class="fl">10.24306</span>         <span class="dv">50</span>         <span class="dv">90</span></a>
<a class="sourceLine" id="cb112-32" title="32">   webelieve <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">68.52174</span>    <span class="fl">16.73418</span>          <span class="dv">5</span>        <span class="dv">100</span></a>
<a class="sourceLine" id="cb112-33" title="33">    probably <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">71.52174</span>    <span class="fl">10.97419</span>         <span class="dv">45</span>         <span class="dv">90</span></a>
<a class="sourceLine" id="cb112-34" title="34">verygoodch<span class="op">~</span>e <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">79.76087</span>    <span class="fl">6.467645</span>         <span class="dv">65</span>         <span class="dv">91</span></a>
<a class="sourceLine" id="cb112-35" title="35"><span class="op">-------------+---------------------------------------------------------</span></a>
<a class="sourceLine" id="cb112-36" title="36">highlylikely <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">86.21739</span>    <span class="fl">12.87877</span>         <span class="dv">15</span>         <span class="dv">99</span></a>
<a class="sourceLine" id="cb112-37" title="37">almostcert<span class="op">~</span>y <span class="op">|</span><span class="st">         </span><span class="dv">46</span>    <span class="fl">92.64565</span>    <span class="fl">7.103542</span>         <span class="dv">60</span>         <span class="dv">99</span></a></code></pre></div>
<p><em>Densités sur un même graphique: illisible</em></p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1">qui ds    </a>
<a class="sourceLine" id="cb113-2" title="2">local varlist <span class="st">`</span><span class="dt">r(varlist)&#39;</span></a>
<a class="sourceLine" id="cb113-3" title="3"><span class="dt">local w: word count(</span><span class="st">`</span>varlist<span class="st">&#39;)      </span></a>
<a class="sourceLine" id="cb113-4" title="4"><span class="st">grstyle init</span></a>
<a class="sourceLine" id="cb113-5" title="5"><span class="st">grstyle set plain, horizontal grid</span></a>
<a class="sourceLine" id="cb113-6" title="6"><span class="st">grstyle set mesh</span></a>
<a class="sourceLine" id="cb113-7" title="7"><span class="st">grstyle set legend, nobox</span></a>
<a class="sourceLine" id="cb113-8" title="8"><span class="st">grstyle set color viridis, n(`w&#39;</span><span class="er">)</span> <span class="kw">opacity</span>(<span class="dv">60</span>) </a>
<a class="sourceLine" id="cb113-9" title="9"></a>
<a class="sourceLine" id="cb113-10" title="10">capt drop _x<span class="op">*</span><span class="st"> </span>_d<span class="op">*</span></a>
<a class="sourceLine" id="cb113-11" title="11"></a>
<a class="sourceLine" id="cb113-12" title="12">local i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb113-13" title="13">foreach v of local varlist {</a>
<a class="sourceLine" id="cb113-14" title="14">colorpalette viridis, <span class="kw">n</span>(<span class="st">`</span><span class="dt">w&#39;) nograph opacity(50)</span></a>
<a class="sourceLine" id="cb113-15" title="15"><span class="dt">local j = </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb113-16" title="16"></a>
<a class="sourceLine" id="cb113-17" title="17"><span class="st">local lab`j&#39;</span><span class="op">:</span><span class="st"> </span>variable label <span class="st">`</span><span class="dt">v&#39;</span></a>
<a class="sourceLine" id="cb113-18" title="18"><span class="dt">local leg </span><span class="st">`</span>leg<span class="st">&#39; `j&#39;</span> <span class="st">&quot;`lab`j&#39;&#39;&quot;</span></a>
<a class="sourceLine" id="cb113-19" title="19"></a>
<a class="sourceLine" id="cb113-20" title="20">local coul<span class="st">`</span><span class="dt">j&#39; &quot;&quot;</span><span class="st">`</span><span class="kw">r</span>(p<span class="st">`</span><span class="dt">j&#39;)&#39;&quot;&quot;</span></a>
<a class="sourceLine" id="cb113-21" title="21"><span class="dt">qui kdensity </span><span class="st">`</span>v<span class="st">&#39;, generate(_x`j&#39;</span> _d<span class="st">`</span><span class="dt">j&#39;) nogr kernel(gauss) n(200)</span></a>
<a class="sourceLine" id="cb113-22" title="22"><span class="dt">qui replace _x</span><span class="st">`</span>j<span class="st">&#39;=100 if _x`j&#39;</span><span class="op">&gt;</span><span class="dv">100</span></a>
<a class="sourceLine" id="cb113-23" title="23">qui replace _x<span class="st">`</span><span class="dt">j&#39;=0 if _x</span><span class="st">`</span>j<span class="st">&#39;&lt;0</span></a>
<a class="sourceLine" id="cb113-24" title="24"><span class="st">local area `area&#39;</span> area _d<span class="st">`</span><span class="dt">j&#39; _x</span><span class="st">`</span>j<span class="st">&#39;, xscale(r(0 100)) xlabel(0(10)100) fc(`coul`j&#39;&#39;) lc(`coul`j&#39;&#39;)   ||</span></a>
<a class="sourceLine" id="cb113-25" title="25"><span class="st">}</span></a>
<a class="sourceLine" id="cb113-26" title="26"><span class="st">tw `area&#39;</span>, <span class="kw">legend</span>(<span class="kw">order</span>(<span class="st">`</span><span class="dt">leg&#39;) pos(2) col(1)) xtitle(&quot;Probabilité assignée&quot;) scale(.6)</span></a></code></pre></div>
<p><em>Graphique 64</em><br />
<img src="imgf/g60.png" style="width:75.0%" /></p>
<p><em>Solution 1: faceting</em><br />
<br> Densité [pas d’échelle commune pour l’axe y]</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1">capt drop _x<span class="op">*</span><span class="st"> </span>_d<span class="op">*</span></a>
<a class="sourceLine" id="cb114-2" title="2">qui ds</a>
<a class="sourceLine" id="cb114-3" title="3">local varlist <span class="st">`</span><span class="dt">r(varlist)&#39;</span></a>
<a class="sourceLine" id="cb114-4" title="4"></a>
<a class="sourceLine" id="cb114-5" title="5"><span class="dt">local i = 1</span></a>
<a class="sourceLine" id="cb114-6" title="6"><span class="dt">foreach v of local varlist {</span></a>
<a class="sourceLine" id="cb114-7" title="7"><span class="dt">colorpalette viridis, n(17) nograph  opacity(80)</span></a>
<a class="sourceLine" id="cb114-8" title="8"><span class="dt">local j = </span><span class="st">`</span>i<span class="op">++</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb114-9" title="9"><span class="st">local coul`j&#39;</span> <span class="st">&quot;&quot;`</span><span class="dt">r(p</span><span class="st">`</span>j<span class="st">&#39;)&#39;&quot;&quot;</span></a>
<a class="sourceLine" id="cb114-10" title="10">qui kdensity <span class="st">`</span><span class="dt">v&#39;, generate(_x</span><span class="st">`</span>j<span class="st">&#39; _d`j&#39;</span><span class="er">)</span> nogr <span class="kw">kernel</span>(gauss) <span class="kw">n</span>(<span class="dv">200</span>)</a>
<a class="sourceLine" id="cb114-11" title="11">qui replace _x<span class="st">`</span><span class="dt">j&#39;=100 if _x</span><span class="st">`</span>j<span class="st">&#39;&gt;100</span></a>
<a class="sourceLine" id="cb114-12" title="12"><span class="st">qui replace _x`j&#39;</span>=<span class="dv">0</span> <span class="cf">if</span> _x<span class="st">`</span><span class="dt">j&#39;&lt;0</span></a>
<a class="sourceLine" id="cb114-13" title="13"><span class="dt">tw area _d</span><span class="st">`</span>j<span class="st">&#39; _x`j&#39;</span>, <span class="kw">xscale</span>(<span class="kw">r</span>(<span class="dv">0</span> <span class="dv">100</span>)) <span class="kw">xlabel</span>(<span class="dv">0</span>(<span class="dv">25</span>)<span class="dv">100</span>) <span class="kw">ytitle</span>(<span class="st">&quot;&quot;</span>) <span class="kw">fc</span>(<span class="st">`</span><span class="dt">coul</span><span class="st">`</span>j<span class="st">&#39;&#39;</span>) <span class="kw">lc</span>(<span class="st">`</span><span class="dt">coul</span><span class="st">`</span>j<span class="st">&#39;&#39;</span>) <span class="kw">name</span>(g<span class="st">`</span><span class="dt">j&#39;, replace) nodraw  </span></a>
<a class="sourceLine" id="cb114-14" title="14"><span class="dt">local comb </span><span class="st">`</span>comb<span class="st">&#39; g`j&#39;</span></a>
<a class="sourceLine" id="cb114-15" title="15"><span class="er">}</span></a>
<a class="sourceLine" id="cb114-16" title="16">graph combine <span class="st">`</span><span class="dt">comb&#39; , col(5)  title(&quot;Probabilité assignée&quot;, pos(11)) // xcommon ycommon</span></a></code></pre></div>
<p><em>Graphique 65</em><br />
<img src="imgf/g61.png" style="width:75.0%" /></p>
<p><em>Graphique 66</em> Histogramme [échelle commune pour l’axe y]</p>
<p><em>Solution 2: Box plot</em></p>
<p><em>Graphique 67</em> <img src="imgf/g62.png" style="width:75.0%" /></p>
<p><em>Solution 3: Violin plot</em></p>
<p><em>Graphique 68</em><br />
<img src="imgf/g63.png" style="width:75.0%" /></p>
<p>[Avec les labels c’est mieux =&gt; A faire]</p>
<p><em>Solution 4: Ridge line</em><br />
Appelé également <strong>Joy plot</strong>, en référence à la pochette de album de <strong>Joy Division</strong> <em>Unkown Pleasure</em>. Beaucoup plus difficile, et plus long, à programmer si on veut appliquer proprement la théorie car on ne part pas d’une estimation des densités une à une. Sinon il suffit d’empiler le graphique précédent en excluant les densités en mirroir et en reparamétrant l’offset (différence entre les minimums des axes y)<br />
Solution dans R [<strong><code>ggridges</code></strong>] et Python. A faire avec Stata</p>
</div>
<div id="nuages-et-densités-2d" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Nuages et Densités 2d</h3>
<ul>
<li>Représentation des distributions vue du dessus. La commande Stata est <strong>scatter</strong> [<strong>scatteri</strong> si on entre directement des coordonnées et non des variables]</li>
<li>Ajout des représentations précédentes pour visualiser les distributions marginales</li>
<li>La bulles d’un nuage peut être appréhendé comme la surface supérieure d’un histogramme positionné sur 2 axes</li>
<li>Le principal point de vigilance sur ce type de graphique est l’<strong>overplotting</strong> qui peut rendre le graphique difficile à lire</li>
<li>Plus il y a de bulles dans une zônz, plus la densité croisée est élevée. Plusieurs types de représentations pour faire apparaitre le niveau de la densité
<ul>
<li>Représentation empruntée à la topologie: des courbes de niveau. Plus la densité s’élève, plus l’écart entre deux courbes se ressère
<ul>
<li>Commande <strong>contour</strong> et <strong>contourline</strong> après avoir estimé les densités avec la commande externe <strong>kdens2</strong> [Christopher J Baum]</li>
</ul></li>
<li>Représentation plutôt empruntée à physique: plus la densité s’élève, plus la chaleur augmente. On applique une palette de couleur séquentielle sur un zonage fin du graphique: couleur froide faible densité, couleur chaude densité élevé.
<ul>
<li>Commande externe <strong>heatplot</strong> [Ben Jann]</li>
</ul></li>
</ul></li>
</ul>
<p><strong>Scatter</strong></p>
<ul>
<li>Distribution croisée vue du haut de deux variables. Avec une variable catégorielles, les différentes valeurs sont identifiées par des couleurs différentes</li>
<li>Limite: <strong>overplotting</strong>
<ul>
<li>forte concentration de points sur une zône</li>
<li>Taille des effectifs trop élevé</li>
<li>Plusieurs solutions pour limiter ou éliminer l’effet</li>
</ul></li>
<li>Combinaison possible avec les histogrammes, densités, boxplot et violin plot qui permettre de décrire les distributions marginales des deux variables continues</li>
<li>Extension: <strong>bubble plot</strong> avec un poids pour chaque coordonnées</li>
</ul>
<p><strong>Exemple</strong></p>
<ul>
<li>Données sur les prix de vente des appartements à New-York selon la surface d’habitation ()</li>
<li>N = 1460</li>
<li>Variables <em>grlivarea</em> (surface d’habitation) et <em>saleprice</em> (prix)</li>
<li>Source: <a href="https://www.data-to-viz.com/story/TwoNum.html" class="uri">https://www.data-to-viz.com/story/TwoNum.html</a></li>
</ul>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1">clear</a>
<a class="sourceLine" id="cb115-2" title="2">import delimited  <span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/2_TwoNum.csv&quot;</span></a></code></pre></div>
<ul>
<li>Overplotting manifeste, graphique peu lisible</li>
</ul>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1">clear</a>
<a class="sourceLine" id="cb116-2" title="2">import delimited  <span class="st">&quot;https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/2_TwoNum.csv&quot;</span></a></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">local ylab  <span class="dv">200000</span> <span class="st">&quot;20K&quot;</span> <span class="dv">400000</span> <span class="st">&quot;40k&quot;</span> <span class="dv">600000</span> <span class="st">&quot;60k&quot;</span> <span class="dv">800000</span> <span class="st">&quot;80k&quot;</span>, <span class="kw">angle</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb117-2" title="2">tw scatter saleprice grlivarea, <span class="kw">mc</span>(<span class="st">&quot;105 179 162&quot;</span>)  <span class="kw">ylabel</span>(<span class="st">`</span><span class="dt">ylab&#39;) </span></a></code></pre></div>
<p><em>Graphique 69</em></p>
<p><img src="imgf/g69.png" style="width:50.0%" /></p>
<ul>
<li><strong>Réduction/suppression de l’overplotting</strong>
<ul>
<li>Contour</li>
<li>Taille des bulles</li>
<li>Sous-échantilllon</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1">local ylab  <span class="dv">200000</span> <span class="st">&quot;20K&quot;</span> <span class="dv">400000</span> <span class="st">&quot;40k&quot;</span> <span class="dv">600000</span> <span class="st">&quot;60k&quot;</span> <span class="dv">800000</span> <span class="st">&quot;80k&quot;</span>, <span class="kw">angle</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb118-2" title="2"></a>
<a class="sourceLine" id="cb118-3" title="3"><span class="op">*</span>Contour</a>
<a class="sourceLine" id="cb118-4" title="4">tw scatter saleprice grlivarea, <span class="kw">mc</span>(<span class="st">&quot;105 179 162&quot;</span>) <span class="kw">mlc</span>(black) <span class="kw">mlw</span>(vvthin) <span class="kw">ylabel</span>(<span class="st">`</span><span class="dt">ylab&#39;) ///</span></a>
<a class="sourceLine" id="cb118-5" title="5"><span class="dt">title(&quot;contour noir vvthin&quot;, pos(1)) name(g1,replace)</span></a>
<a class="sourceLine" id="cb118-6" title="6"></a>
<a class="sourceLine" id="cb118-7" title="7"><span class="dt">tw scatter saleprice grlivarea, mc(&quot;105 179 162&quot;) mlc(white) mlw(vvthin) ylabel(</span><span class="st">`</span>ylab<span class="st">&#39;) ///</span></a>
<a class="sourceLine" id="cb118-8" title="8"><span class="st">title(&quot;contour blanc vvthin&quot;, pos(1)) name(g2,replace) </span></a>
<a class="sourceLine" id="cb118-9" title="9"></a>
<a class="sourceLine" id="cb118-10" title="10"><span class="st">*Taille</span></a>
<a class="sourceLine" id="cb118-11" title="11"><span class="st">tw scatter saleprice grlivarea, mc(&quot;105 179 162&quot;) msiz(tiny) mlc(black) mlw(vvthin) /// </span></a>
<a class="sourceLine" id="cb118-12" title="12"><span class="st">ylabel(`ylab&#39;</span>)  <span class="kw">title</span>(<span class="st">&quot;size tiny + contour 1&quot;</span>, <span class="kw">pos</span>(<span class="dv">1</span>)) <span class="kw">name</span>(g3,replace)</a>
<a class="sourceLine" id="cb118-13" title="13"></a>
<a class="sourceLine" id="cb118-14" title="14">tw scatter saleprice grlivarea, <span class="kw">mc</span>(<span class="st">&quot;105 179 162&quot;</span>) <span class="kw">msiz</span>(vtiny) <span class="op">/</span><span class="er">//</span></a>
<a class="sourceLine" id="cb118-15" title="15"><span class="kw">ylabel</span>(<span class="st">`</span><span class="dt">ylab&#39;)  title(&quot;size vtiny&quot;, pos(1)) name(g4,replace)</span></a>
<a class="sourceLine" id="cb118-16" title="16"></a>
<a class="sourceLine" id="cb118-17" title="17"><span class="dt">*Sample</span></a>
<a class="sourceLine" id="cb118-18" title="18"><span class="dt">capt gen u=runiform()</span></a>
<a class="sourceLine" id="cb118-19" title="19"><span class="dt">tw scatter saleprice grlivarea if u&lt;.2, mc(&quot;105 179 162&quot;) mlc(black) mlw(vvthin) ///</span></a>
<a class="sourceLine" id="cb118-20" title="20"><span class="dt">ylabel(</span><span class="st">`</span>ylab<span class="st">&#39;) xlabel(0(2000)6000) title(&quot;Sample 1: 20%&quot;, pos(1)) name(g5,replace)</span></a>
<a class="sourceLine" id="cb118-21" title="21"></a>
<a class="sourceLine" id="cb118-22" title="22"><span class="st">tw scatter saleprice grlivarea if u&lt;.1, mc(&quot;105 179 162&quot;) mlc(black) mlw(vvthin) ///</span></a>
<a class="sourceLine" id="cb118-23" title="23"><span class="st">ylabel(`ylab&#39;</span>) <span class="kw">xlabel</span>(<span class="dv">0</span>(<span class="dv">2000</span>)<span class="dv">6000</span>) <span class="kw">title</span>(<span class="st">&quot;Sample 2: 10%&quot;</span>, <span class="kw">pos</span>(<span class="dv">1</span>)) <span class="kw">name</span>(g6,replace)</a>
<a class="sourceLine" id="cb118-24" title="24"></a>
<a class="sourceLine" id="cb118-25" title="25"></a>
<a class="sourceLine" id="cb118-26" title="26">graph combine g1 g2 g3 g4 g5 g6, <span class="kw">col</span>(<span class="dv">2</span>) <span class="kw">xsize</span>(<span class="dv">20</span>) <span class="kw">ysize</span>(<span class="dv">20</span>) <span class="kw">scale</span>(.<span class="dv">6</span>)</a></code></pre></div>
<p><em>Graphique 70</em></p>
<p><img src="imgf/g70.png" /></p>
<p><strong>Contourplot - heatplot</strong></p>
<ul>
<li>On reporte la densité croisée des deux variables</li>
<li>Résoud le problème de l’overplotting</li>
<li><strong>Coutour plot</strong>:
<ul>
<li>Si seulement les lignes sont reportées: principe des courbes de niveau, plus les courbes se resserrent et plus la densité augente</li>
<li>On peut afecter une palette de couleur aux surfaces entre les lignes</li>
</ul></li>
<li><strong>Heatplot</strong>: principe d’un histogramme vu du dessus, avec une palette de couleurs séquentielle affectée à la surface du dessus. La surface est souvent sous forme d’héxagone</li>
</ul>
<p><strong>Application</strong></p>
<ul>
<li>Données de la base nhanes2</li>
<li>Représentation précédentes avec correction overplotting</li>
<li>Représentation des densités marginales (histo ou densité)</li>
</ul>
</div>
<div id="courbes" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Courbes</h3>
<p>Effet spaghetti</p>
</div>
<div id="lollipop" class="section level3">
<h3><span class="header-section-number">5.1.5</span> Lollipop ???</h3>
</div>
</div>
<div id="variables-catégorielles-uneplusieurs" class="section level2">
<h2><span class="header-section-number">5.2</span> Variable(s) catégorielles: une/plusieurs</h2>
<p>=&gt;bar =&gt; catplot () spineplot [N.Cox] =&gt; tarte au camembert et problème relatifs à ce genre de représentation</p>
</div>
<div id="variables-continues-et-catégorielles" class="section level2">
<h2><span class="header-section-number">5.3</span> Variables continues et catégorielles</h2>
<p>=&gt; reprendres graph variables continues statrifiées par les valeurs d’une variable cat</p>
<p><strong>Faire un tableau listant les commandes graphiques (interne et quelques externes)?????</strong> * nom de la commande * son usage: description variables continue/catégorielle - post estimation…. * éventuellement un commentaire =&gt; faire un fichier excel - l’importer et utiliser kable</p>
</div>
<div id="résultats-de" class="section level2">
<h2><span class="header-section-number">5.4</span> Résultats de</h2>
<ul>
<li>Coef regression: type forest plot</li>
<li>Effet marginaux: marginsplot et contour….what else</li>
</ul>
</div>
<div id="graph-interactifs-et-dynamiques" class="section level2">
<h2><span class="header-section-number">5.5</span> Graph interactifs et dynamiques</h2>
<ul>
<li><a href="https://www.francetvinfo.fr/sante/maladie/coronavirus/infographies-covid-19-morts-hospitalisations-age-malades-l-evolution-de-l-epidemie-en-france-et-dans-le-monde-en-cartes-et-graphiques.html">France Info</a></li>
<li><a href="https://www.ined.fr/fr/tout-savoir-population/graphiques-cartes/population-cartes-interactives/">Site Ined</a></li>
</ul>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
